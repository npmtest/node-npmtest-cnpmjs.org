{"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/test.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/test.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":2,"18":2,"19":1,"20":1,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":2,"40":2,"41":1,"42":2,"43":2,"44":1,"45":2,"46":2,"47":1,"48":2,"49":2,"50":1,"51":1,"52":1,"53":1,"54":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[1,1],"5":[1,1],"6":[1,1],"7":[1,1],"8":[1,1],"9":[1,1],"10":[1,1,1],"11":[1,1],"12":[1,1],"13":[1,1],"14":[1,1],"15":[1,1],"16":[1,1],"17":[1,1]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":1,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":5},"end":{"line":61,"column":17}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":5},"end":{"line":82,"column":17}}},"6":{"name":"(anonymous_6)","line":91,"loc":{"start":{"line":91,"column":77},"end":{"line":94,"column":10}}},"7":{"name":"(anonymous_7)","line":112,"loc":{"start":{"line":112,"column":83},"end":{"line":115,"column":10}},"skip":true},"8":{"name":"(anonymous_8)","line":123,"loc":{"start":{"line":123,"column":77},"end":{"line":126,"column":10}},"skip":true},"9":{"name":"(anonymous_9)","line":139,"loc":{"start":{"line":139,"column":12},"end":{"line":139,"column":40}},"skip":true},"10":{"name":"(anonymous_10)","line":147,"loc":{"start":{"line":147,"column":77},"end":{"line":150,"column":10}},"skip":true},"11":{"name":"(anonymous_11)","line":158,"loc":{"start":{"line":158,"column":83},"end":{"line":161,"column":10}},"skip":true},"12":{"name":"(anonymous_12)","line":169,"loc":{"start":{"line":169,"column":79},"end":{"line":172,"column":10}},"skip":true},"13":{"name":"(anonymous_13)","line":180,"loc":{"start":{"line":180,"column":75},"end":{"line":183,"column":10}},"skip":true}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":195,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":56,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":8},"end":{"line":53,"column":9}},"11":{"start":{"line":43,"column":12},"end":{"line":46,"column":14}},"12":{"start":{"line":47,"column":12},"end":{"line":47,"column":18}},"13":{"start":{"line":50,"column":12},"end":{"line":51,"column":33}},"14":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"15":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"16":{"start":{"line":61,"column":4},"end":{"line":63,"column":9}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"18":{"start":{"line":64,"column":4},"end":{"line":77,"column":5}},"19":{"start":{"line":70,"column":8},"end":{"line":70,"column":14}},"20":{"start":{"line":76,"column":8},"end":{"line":76,"column":14}},"21":{"start":{"line":82,"column":4},"end":{"line":84,"column":9}},"22":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"23":{"start":{"line":85,"column":4},"end":{"line":194,"column":5}},"24":{"start":{"line":91,"column":8},"end":{"line":99,"column":10}},"25":{"start":{"line":98,"column":12},"end":{"line":98,"column":35}},"26":{"start":{"line":102,"column":8},"end":{"line":104,"column":63}},"27":{"start":{"line":105,"column":8},"end":{"line":105,"column":14}},"28":{"start":{"line":112,"column":8},"end":{"line":121,"column":10},"skip":true},"29":{"start":{"line":119,"column":12},"end":{"line":119,"column":55},"skip":true},"30":{"start":{"line":120,"column":12},"end":{"line":120,"column":48},"skip":true},"31":{"start":{"line":123,"column":8},"end":{"line":136,"column":10},"skip":true},"32":{"start":{"line":130,"column":12},"end":{"line":130,"column":76},"skip":true},"33":{"start":{"line":131,"column":12},"end":{"line":131,"column":73},"skip":true},"34":{"start":{"line":132,"column":12},"end":{"line":132,"column":74},"skip":true},"35":{"start":{"line":133,"column":12},"end":{"line":133,"column":79},"skip":true},"36":{"start":{"line":134,"column":12},"end":{"line":134,"column":25},"skip":true},"37":{"start":{"line":135,"column":12},"end":{"line":135,"column":45},"skip":true},"38":{"start":{"line":138,"column":8},"end":{"line":145,"column":14},"skip":true},"39":{"start":{"line":143,"column":16},"end":{"line":143,"column":29},"skip":true},"40":{"start":{"line":144,"column":16},"end":{"line":144,"column":55},"skip":true},"41":{"start":{"line":147,"column":8},"end":{"line":156,"column":10},"skip":true},"42":{"start":{"line":154,"column":12},"end":{"line":154,"column":25},"skip":true},"43":{"start":{"line":155,"column":12},"end":{"line":155,"column":45},"skip":true},"44":{"start":{"line":158,"column":8},"end":{"line":167,"column":10},"skip":true},"45":{"start":{"line":165,"column":12},"end":{"line":165,"column":25},"skip":true},"46":{"start":{"line":166,"column":12},"end":{"line":166,"column":48},"skip":true},"47":{"start":{"line":169,"column":8},"end":{"line":178,"column":10},"skip":true},"48":{"start":{"line":176,"column":12},"end":{"line":176,"column":25},"skip":true},"49":{"start":{"line":177,"column":12},"end":{"line":177,"column":46},"skip":true},"50":{"start":{"line":180,"column":8},"end":{"line":189,"column":10},"skip":true},"51":{"start":{"line":187,"column":12},"end":{"line":187,"column":94},"skip":true},"52":{"start":{"line":188,"column":12},"end":{"line":188,"column":48},"skip":true},"53":{"start":{"line":192,"column":8},"end":{"line":192,"column":35},"skip":true},"54":{"start":{"line":193,"column":8},"end":{"line":193,"column":14},"skip":true}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":40,"type":"switch","locations":[{"start":{"line":42,"column":8},"end":{"line":47,"column":18}},{"start":{"line":49,"column":8},"end":{"line":52,"column":18}}]},"5":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":44}},{"start":{"line":44,"column":48},"end":{"line":44,"column":66}}]},"6":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":21},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":72}}]},"7":{"line":64,"type":"switch","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":14}},{"start":{"line":75,"column":4},"end":{"line":76,"column":14}}]},"8":{"line":85,"type":"switch","locations":[{"start":{"line":90,"column":4},"end":{"line":105,"column":14}},{"start":{"line":111,"column":4},"end":{"line":193,"column":14},"skip":true}]},"9":{"line":91,"type":"binary-expr","locations":[{"start":{"line":91,"column":42},"end":{"line":91,"column":73}},{"start":{"line":91,"column":77},"end":{"line":99,"column":9}}]},"10":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":18},"end":{"line":102,"column":32}},{"start":{"line":103,"column":12},"end":{"line":103,"column":53}},{"start":{"line":104,"column":12},"end":{"line":104,"column":61}}]},"11":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":45},"end":{"line":112,"column":79},"skip":true},{"start":{"line":112,"column":83},"end":{"line":121,"column":9},"skip":true}]},"12":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":42},"end":{"line":123,"column":73},"skip":true},{"start":{"line":123,"column":77},"end":{"line":136,"column":9},"skip":true}]},"13":{"line":138,"type":"binary-expr","locations":[{"start":{"line":138,"column":48},"end":{"line":138,"column":85},"skip":true},{"start":{"line":139,"column":12},"end":{"line":145,"column":13},"skip":true}]},"14":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":42},"end":{"line":147,"column":73},"skip":true},{"start":{"line":147,"column":77},"end":{"line":156,"column":9},"skip":true}]},"15":{"line":158,"type":"binary-expr","locations":[{"start":{"line":158,"column":45},"end":{"line":158,"column":79},"skip":true},{"start":{"line":158,"column":83},"end":{"line":167,"column":9},"skip":true}]},"16":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":43},"end":{"line":169,"column":75},"skip":true},{"start":{"line":169,"column":79},"end":{"line":178,"column":9},"skip":true}]},"17":{"line":180,"type":"binary-expr","locations":[{"start":{"line":180,"column":41},"end":{"line":180,"column":71},"skip":true},{"start":{"line":180,"column":75},"end":{"line":189,"column":9},"skip":true}]}},"code":["/* istanbul instrument in package npmtest_cnpmjs_org */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        switch (local.modeJs) {","        // re-init local from window.local","        case 'browser':","            local = local.global.utility2.objectSetDefault(","                local.global.utility2_rollup || local.global.local,","                local.global.utility2","            );","            break;","        // re-init local from example.js","        case 'node':","            local = (local.global.utility2_rollup || require('utility2'))","                .requireReadme();","            break;","        }","        // export local","        local.global.local = local;","    }());","","","","    // run shared js-env code - function","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - function","    case 'browser':","        break;","","","","    // run node js-env code - function","    case 'node':","        break;","    }","","","","    // run shared js-env code - post-init","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - post-init","    case 'browser':","        local.testCase_browser_nullCase = local.testCase_browser_nullCase || function (","            options,","            onError","        ) {","        /*","         * this function will test browsers's null-case handling-behavior-behavior","         */","            onError(null, options);","        };","","        // run tests","        local.nop(local.modeTest &&","            document.querySelector('#testRunButton1') &&","            document.querySelector('#testRunButton1').click());","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApidoc's default handling-behavior-behavior","         */","            options = { modulePathList: module.paths };","            local.buildApidoc(options, onError);","        };","","        local.testCase_buildApp_default = local.testCase_buildApp_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApp's default handling-behavior-behavior","         */","            local.testCase_buildReadme_default(options, local.onErrorThrow);","            local.testCase_buildLib_default(options, local.onErrorThrow);","            local.testCase_buildTest_default(options, local.onErrorThrow);","            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);","            options = [];","            local.buildApp(options, onError);","        };","","        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||","            function (options, onError) {","            /*","             * this function will test buildCustomOrg's default handling-behavior","             */","                options = {};","                local.buildCustomOrg(options, onError);","            };","","        local.testCase_buildLib_default = local.testCase_buildLib_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildLib's default handling-behavior","         */","            options = {};","            local.buildLib(options, onError);","        };","","        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildReadme's default handling-behavior-behavior","         */","            options = {};","            local.buildReadme(options, onError);","        };","","        local.testCase_buildTest_default = local.testCase_buildTest_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildTest's default handling-behavior","         */","            options = {};","            local.buildTest(options, onError);","        };","","        local.testCase_webpage_default = local.testCase_webpage_default || function (","            options,","            onError","        ) {","        /*","         * this function will test webpage's default handling-behavior","         */","            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };","            local.browserTest(options, onError);","        };","","        // run test-server","        local.testRunServer(local);","        break;","    }","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"40":2,"43":1,"47":1,"50":1,"52":1,"55":2,"61":2,"62":2,"64":2,"70":1,"76":1,"82":2,"83":2,"85":2,"91":1,"98":1,"102":1,"105":1,"112":1,"119":1,"120":1,"123":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"138":1,"143":2,"144":2,"147":1,"154":2,"155":2,"158":1,"165":2,"166":2,"169":1,"176":2,"177":2,"180":1,"187":1,"188":1,"192":1,"193":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/lib.npmtest_cnpmjs.org.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/lib.npmtest_cnpmjs.org.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1]},"f":{"1":2,"2":2,"3":2},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":53,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":52,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":41,"column":8},"end":{"line":41,"column":54}},"11":{"start":{"line":43,"column":8},"end":{"line":43,"column":55}},"12":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":46,"column":12},"end":{"line":46,"column":61}},"14":{"start":{"line":48,"column":12},"end":{"line":48,"column":35}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":49}},"16":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":16},"end":{"line":41,"column":44}},{"start":{"line":41,"column":48},"end":{"line":41,"column":53}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]}},"code":["/* istanbul instrument in package npmtest_cnpmjs_org */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || local;","        // init lib","        local.local = local.npmtest_cnpmjs_org = local;","        // init exports","        if (local.modeJs === 'browser') {","            local.global.utility2_npmtest_cnpmjs_org = local;","        } else {","            module.exports = local;","            module.exports.__dirname = __dirname;","            module.exports.module = module;","        }","    }());","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"41":2,"43":2,"45":2,"46":1,"48":1,"49":1,"50":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/example.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/example.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1,"29":1,"30":2,"31":0,"32":0,"33":0,"34":1,"35":2,"36":2,"37":3,"38":3,"39":3,"40":3,"41":0,"42":3,"43":3,"44":3,"45":1,"46":3,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":6,"60":6,"61":1,"62":2,"63":0,"64":2,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[2,0],"8":[2,1,1,1,1,1],"9":[0,2,0],"10":[1,1],"11":[2,1,1],"12":[1,0],"13":[0,2],"14":[2,0,0,0,0,0,0],"15":[0,3],"16":[3,0],"17":[1,1],"18":[0,1],"19":[1,2,0,2],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":3,"8":3,"9":3,"10":1,"11":6,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":13}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":5},"end":{"line":33,"column":17}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":24},"end":{"line":37,"column":36}}},"4":{"name":"(anonymous_4)","line":69,"loc":{"start":{"line":69,"column":31},"end":{"line":69,"column":48}},"skip":true},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":26},"end":{"line":78,"column":45}},"skip":true},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":33},"end":{"line":123,"column":48}},"skip":true},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":27},"end":{"line":125,"column":39}},"skip":true},"8":{"name":"(anonymous_8)","line":133,"loc":{"start":{"line":133,"column":59},"end":{"line":133,"column":74}},"skip":true},"9":{"name":"(anonymous_9)","line":143,"loc":{"start":{"line":143,"column":45},"end":{"line":143,"column":62}},"skip":true},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":73},"end":{"line":144,"column":92}},"skip":true},"11":{"name":"(anonymous_11)","line":272,"loc":{"start":{"line":272,"column":51},"end":{"line":272,"column":77}},"skip":true},"12":{"name":"(anonymous_12)","line":315,"loc":{"start":{"line":315,"column":32},"end":{"line":315,"column":61}},"skip":true}},"statementMap":{"1":{"start":{"line":26,"column":0},"end":{"line":326,"column":5}},"2":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"3":{"start":{"line":33,"column":4},"end":{"line":60,"column":9}},"4":{"start":{"line":35,"column":8},"end":{"line":35,"column":19}},"5":{"start":{"line":37,"column":8},"end":{"line":49,"column":13}},"6":{"start":{"line":38,"column":12},"end":{"line":48,"column":13}},"7":{"start":{"line":39,"column":16},"end":{"line":42,"column":30}},"8":{"start":{"line":44,"column":16},"end":{"line":47,"column":27}},"9":{"start":{"line":51,"column":8},"end":{"line":53,"column":21}},"10":{"start":{"line":55,"column":8},"end":{"line":57,"column":45}},"11":{"start":{"line":59,"column":8},"end":{"line":59,"column":35}},"12":{"start":{"line":61,"column":4},"end":{"line":325,"column":5}},"13":{"start":{"line":69,"column":8},"end":{"line":121,"column":10},"skip":true},"14":{"start":{"line":70,"column":12},"end":{"line":88,"column":13},"skip":true},"15":{"start":{"line":76,"column":16},"end":{"line":87,"column":19},"skip":true},"16":{"start":{"line":79,"column":20},"end":{"line":86,"column":21},"skip":true},"17":{"start":{"line":82,"column":24},"end":{"line":82,"column":43},"skip":true},"18":{"start":{"line":83,"column":24},"end":{"line":83,"column":30},"skip":true},"19":{"start":{"line":85,"column":24},"end":{"line":85,"column":49},"skip":true},"20":{"start":{"line":89,"column":12},"end":{"line":107,"column":13},"skip":true},"21":{"start":{"line":92,"column":16},"end":{"line":102,"column":17},"skip":true},"22":{"start":{"line":93,"column":20},"end":{"line":93,"column":86},"skip":true},"23":{"start":{"line":94,"column":20},"end":{"line":95,"column":45},"skip":true},"24":{"start":{"line":96,"column":20},"end":{"line":96,"column":42},"skip":true},"25":{"start":{"line":97,"column":20},"end":{"line":97,"column":48},"skip":true},"26":{"start":{"line":100,"column":20},"end":{"line":100,"column":85},"skip":true},"27":{"start":{"line":101,"column":20},"end":{"line":101,"column":96},"skip":true},"28":{"start":{"line":103,"column":16},"end":{"line":103,"column":22},"skip":true},"29":{"start":{"line":106,"column":16},"end":{"line":106,"column":22},"skip":true},"30":{"start":{"line":108,"column":12},"end":{"line":120,"column":13},"skip":true},"31":{"start":{"line":114,"column":16},"end":{"line":119,"column":17},"skip":true},"32":{"start":{"line":116,"column":20},"end":{"line":116,"column":78},"skip":true},"33":{"start":{"line":118,"column":20},"end":{"line":118,"column":47},"skip":true},"34":{"start":{"line":123,"column":8},"end":{"line":141,"column":11},"skip":true},"35":{"start":{"line":124,"column":12},"end":{"line":124,"column":54},"skip":true},"36":{"start":{"line":125,"column":12},"end":{"line":140,"column":14},"skip":true},"37":{"start":{"line":126,"column":16},"end":{"line":126,"column":28},"skip":true},"38":{"start":{"line":127,"column":16},"end":{"line":127,"column":69},"skip":true},"39":{"start":{"line":128,"column":16},"end":{"line":128,"column":75},"skip":true},"40":{"start":{"line":129,"column":16},"end":{"line":131,"column":17},"skip":true},"41":{"start":{"line":130,"column":20},"end":{"line":130,"column":27},"skip":true},"42":{"start":{"line":133,"column":16},"end":{"line":137,"column":36},"skip":true},"43":{"start":{"line":134,"column":20},"end":{"line":136,"column":55},"skip":true},"44":{"start":{"line":139,"column":16},"end":{"line":139,"column":57},"skip":true},"45":{"start":{"line":143,"column":8},"end":{"line":147,"column":11},"skip":true},"46":{"start":{"line":144,"column":12},"end":{"line":146,"column":15},"skip":true},"47":{"start":{"line":145,"column":16},"end":{"line":145,"column":70},"skip":true},"48":{"start":{"line":149,"column":8},"end":{"line":149,"column":31},"skip":true},"49":{"start":{"line":150,"column":8},"end":{"line":150,"column":14},"skip":true},"50":{"start":{"line":158,"column":8},"end":{"line":158,"column":31},"skip":true},"51":{"start":{"line":160,"column":8},"end":{"line":160,"column":33},"skip":true},"52":{"start":{"line":161,"column":8},"end":{"line":161,"column":37},"skip":true},"53":{"start":{"line":162,"column":8},"end":{"line":162,"column":35},"skip":true},"54":{"start":{"line":164,"column":8},"end":{"line":164,"column":50},"skip":true},"55":{"start":{"line":166,"column":8},"end":{"line":256,"column":2},"skip":true},"56":{"start":{"line":258,"column":8},"end":{"line":286,"column":9},"skip":true},"57":{"start":{"line":259,"column":12},"end":{"line":269,"column":14},"skip":true},"58":{"start":{"line":271,"column":12},"end":{"line":285,"column":19},"skip":true},"59":{"start":{"line":274,"column":20},"end":{"line":274,"column":35},"skip":true},"60":{"start":{"line":275,"column":20},"end":{"line":284,"column":21},"skip":true},"61":{"start":{"line":277,"column":24},"end":{"line":277,"column":64},"skip":true},"62":{"start":{"line":279,"column":24},"end":{"line":279,"column":40},"skip":true},"63":{"start":{"line":281,"column":24},"end":{"line":281,"column":40},"skip":true},"64":{"start":{"line":283,"column":24},"end":{"line":283,"column":39},"skip":true},"65":{"start":{"line":288,"column":8},"end":{"line":290,"column":9},"skip":true},"66":{"start":{"line":289,"column":12},"end":{"line":289,"column":18},"skip":true},"67":{"start":{"line":291,"column":8},"end":{"line":293,"column":54},"skip":true},"68":{"start":{"line":296,"column":8},"end":{"line":301,"column":37},"skip":true},"69":{"start":{"line":303,"column":8},"end":{"line":303,"column":82},"skip":true},"70":{"start":{"line":306,"column":8},"end":{"line":308,"column":9},"skip":true},"71":{"start":{"line":307,"column":12},"end":{"line":307,"column":82},"skip":true},"72":{"start":{"line":310,"column":8},"end":{"line":312,"column":9},"skip":true},"73":{"start":{"line":311,"column":12},"end":{"line":311,"column":18},"skip":true},"74":{"start":{"line":313,"column":8},"end":{"line":313,"column":54},"skip":true},"75":{"start":{"line":314,"column":8},"end":{"line":314,"column":69},"skip":true},"76":{"start":{"line":315,"column":8},"end":{"line":323,"column":36},"skip":true},"77":{"start":{"line":316,"column":12},"end":{"line":316,"column":61},"skip":true},"78":{"start":{"line":317,"column":12},"end":{"line":320,"column":13},"skip":true},"79":{"start":{"line":318,"column":16},"end":{"line":318,"column":75},"skip":true},"80":{"start":{"line":319,"column":16},"end":{"line":319,"column":23},"skip":true},"81":{"start":{"line":321,"column":12},"end":{"line":321,"column":38},"skip":true},"82":{"start":{"line":322,"column":12},"end":{"line":322,"column":27},"skip":true},"83":{"start":{"line":324,"column":8},"end":{"line":324,"column":14},"skip":true}},"branchMap":{"1":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":23},"end":{"line":39,"column":62}},{"start":{"line":40,"column":20},"end":{"line":40,"column":70}},{"start":{"line":41,"column":20},"end":{"line":41,"column":71}},{"start":{"line":42,"column":20},"end":{"line":42,"column":29}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":37}},{"start":{"line":45,"column":20},"end":{"line":45,"column":61}},{"start":{"line":46,"column":20},"end":{"line":46,"column":70}},{"start":{"line":47,"column":20},"end":{"line":47,"column":26}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":20}},{"start":{"line":53,"column":14},"end":{"line":53,"column":20}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":44}},{"start":{"line":55,"column":49},"end":{"line":57,"column":43}}]},"5":{"line":55,"type":"cond-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":54}},{"start":{"line":57,"column":14},"end":{"line":57,"column":43}}]},"6":{"line":61,"type":"switch","locations":[{"start":{"line":68,"column":4},"end":{"line":150,"column":14},"skip":true},{"start":{"line":156,"column":4},"end":{"line":324,"column":14},"skip":true}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true},{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":16},"end":{"line":70,"column":22},"skip":true},{"start":{"line":70,"column":27},"end":{"line":70,"column":32},"skip":true},{"start":{"line":71,"column":20},"end":{"line":71,"column":39},"skip":true},{"start":{"line":72,"column":20},"end":{"line":72,"column":49},"skip":true},{"start":{"line":73,"column":20},"end":{"line":73,"column":58},"skip":true},{"start":{"line":74,"column":20},"end":{"line":74,"column":69},"skip":true}]},"9":{"line":79,"type":"switch","locations":[{"start":{"line":80,"column":20},"end":{"line":80,"column":33},"skip":true},{"start":{"line":81,"column":20},"end":{"line":83,"column":30},"skip":true},{"start":{"line":84,"column":20},"end":{"line":85,"column":49},"skip":true}]},"10":{"line":89,"type":"switch","locations":[{"start":{"line":90,"column":12},"end":{"line":103,"column":22},"skip":true},{"start":{"line":105,"column":12},"end":{"line":106,"column":22},"skip":true}]},"11":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":25},"skip":true},{"start":{"line":89,"column":29},"end":{"line":89,"column":48},"skip":true},{"start":{"line":89,"column":52},"end":{"line":89,"column":74},"skip":true}]},"12":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true},{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true}]},"13":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true},{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true}]},"14":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":61},"skip":true},{"start":{"line":108,"column":66},"end":{"line":108,"column":72},"skip":true},{"start":{"line":108,"column":77},"end":{"line":108,"column":82},"skip":true},{"start":{"line":109,"column":20},"end":{"line":109,"column":39},"skip":true},{"start":{"line":110,"column":20},"end":{"line":110,"column":49},"skip":true},{"start":{"line":111,"column":20},"end":{"line":111,"column":58},"skip":true},{"start":{"line":112,"column":20},"end":{"line":112,"column":68},"skip":true}]},"15":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true},{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true}]},"16":{"line":134,"type":"cond-expr","locations":[{"start":{"line":135,"column":26},"end":{"line":135,"column":29},"skip":true},{"start":{"line":136,"column":26},"end":{"line":136,"column":54},"skip":true}]},"17":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":27},"end":{"line":164,"column":43},"skip":true},{"start":{"line":164,"column":47},"end":{"line":164,"column":49},"skip":true}]},"18":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true},{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true}]},"19":{"line":275,"type":"switch","locations":[{"start":{"line":276,"column":20},"end":{"line":277,"column":64},"skip":true},{"start":{"line":278,"column":20},"end":{"line":279,"column":40},"skip":true},{"start":{"line":280,"column":20},"end":{"line":281,"column":40},"skip":true},{"start":{"line":282,"column":20},"end":{"line":283,"column":39},"skip":true}]},"20":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true},{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true}]},"21":{"line":288,"type":"binary-expr","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":40},"skip":true},{"start":{"line":288,"column":44},"end":{"line":288,"column":67},"skip":true}]},"22":{"line":292,"type":"binary-expr","locations":[{"start":{"line":292,"column":12},"end":{"line":292,"column":50},"skip":true},{"start":{"line":293,"column":12},"end":{"line":293,"column":53},"skip":true}]},"23":{"line":297,"type":"binary-expr","locations":[{"start":{"line":297,"column":12},"end":{"line":297,"column":68},"skip":true},{"start":{"line":298,"column":12},"end":{"line":301,"column":36},"skip":true}]},"24":{"line":303,"type":"binary-expr","locations":[{"start":{"line":303,"column":43},"end":{"line":303,"column":75},"skip":true},{"start":{"line":303,"column":79},"end":{"line":303,"column":81},"skip":true}]},"25":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true},{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true}]},"26":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true},{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true}]},"27":{"line":313,"type":"binary-expr","locations":[{"start":{"line":313,"column":27},"end":{"line":313,"column":43},"skip":true},{"start":{"line":313,"column":47},"end":{"line":313,"column":53},"skip":true}]},"28":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true},{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true}]}},"code":["/*","example.js","","quickstart example","","instruction","    1. save this script as example.js","    2. run the shell command:","        $ npm install npmtest-cnpmjs.org && PORT=8081 node example.js","    3. play with the browser-demo on http://127.0.0.1:8081","*/","","","","/* istanbul instrument in package npmtest_cnpmjs_org */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - pre-init","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || (local.modeJs === 'browser'","            ? local.global.utility2_npmtest_cnpmjs_org","            : global.utility2_moduleExports);","        // export local","        local.global.local = local;","    }());","    switch (local.modeJs) {","","","","    // post-init","    // run browser js-env code - post-init","    /* istanbul ignore next */","    case 'browser':","        local.testRunBrowser = function (event) {","            if (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('onreset'))) {","                // reset output","                Array.from(","                    document.querySelectorAll('body > .resettable')","                ).forEach(function (element) {","                    switch (element.tagName) {","                    case 'INPUT':","                    case 'TEXTAREA':","                        element.value = '';","                        break;","                    default:","                        element.textContent = '';","                    }","                });","            }","            switch (event && event.currentTarget && event.currentTarget.id) {","            case 'testRunButton1':","                // show tests","                if (document.querySelector('#testReportDiv1').style.display === 'none') {","                    document.querySelector('#testReportDiv1').style.display = 'block';","                    document.querySelector('#testRunButton1').textContent =","                        'hide internal test';","                    local.modeTest = true;","                    local.testRunDefault(local);","                // hide tests","                } else {","                    document.querySelector('#testReportDiv1').style.display = 'none';","                    document.querySelector('#testRunButton1').textContent = 'run internal test';","                }","                break;","            // custom-case","            default:","                break;","            }","            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('oneval')))) {","                // try to eval input-code","                try {","                    /*jslint evil: true*/","                    eval(document.querySelector('#inputTextareaEval1').value);","                } catch (errorCaught) {","                    console.error(errorCaught);","                }","            }","        };","        // log stderr and stdout to #outputTextareaStdout1","        ['error', 'log'].forEach(function (key) {","            console[key + '_original'] = console[key];","            console[key] = function () {","                var element;","                console[key + '_original'].apply(console, arguments);","                element = document.querySelector('#outputTextareaStdout1');","                if (!element) {","                    return;","                }","                // append text to #outputTextareaStdout1","                element.value += Array.from(arguments).map(function (arg) {","                    return typeof arg === 'string'","                        ? arg","                        : JSON.stringify(arg, null, 4);","                }).join(' ') + '\\n';","                // scroll textarea to bottom","                element.scrollTop = element.scrollHeight;","            };","        });","        // init event-handling","        ['change', 'click', 'keyup'].forEach(function (event) {","            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {","                element.addEventListener(event, local.testRunBrowser);","            });","        });","        // run tests","        local.testRunBrowser();","        break;","","","","    // run node js-env code - post-init","    /* istanbul ignore next */","    case 'node':","        // export local","        module.exports = local;","        // require modules","        local.fs = require('fs');","        local.http = require('http');","        local.url = require('url');","        // init assets","        local.assetsDict = local.assetsDict || {};","        /* jslint-ignore-begin */","        local.assetsDict['/assets.index.template.html'] = '\\","<!doctype html>\\n\\","<html lang=\"en\">\\n\\","<head>\\n\\","<meta charset=\"UTF-8\">\\n\\","<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\","<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\","<style>\\n\\","/*csslint\\n\\","    box-sizing: false,\\n\\","    universal-selector: false\\n\\","*/\\n\\","* {\\n\\","    box-sizing: border-box;\\n\\","}\\n\\","body {\\n\\","    background: #dde;\\n\\","    font-family: Arial, Helvetica, sans-serif;\\n\\","    margin: 2rem;\\n\\","}\\n\\","body > * {\\n\\","    margin-bottom: 1rem;\\n\\","}\\n\\",".utility2FooterDiv {\\n\\","    margin-top: 20px;\\n\\","    text-align: center;\\n\\","}\\n\\","</style>\\n\\","<style>\\n\\","/*csslint\\n\\","*/\\n\\","textarea {\\n\\","    font-family: monospace;\\n\\","    height: 10rem;\\n\\","    width: 100%;\\n\\","}\\n\\","textarea[readonly] {\\n\\","    background: #ddd;\\n\\","}\\n\\","</style>\\n\\","</head>\\n\\","<body>\\n\\","<!-- utility2-comment\\n\\","<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\","utility2-comment -->\\n\\","<h1>\\n\\","<!-- utility2-comment\\n\\","    <a\\n\\","        {{#if env.npm_package_homepage}}\\n\\","        href=\"{{env.npm_package_homepage}}\"\\n\\","        {{/if env.npm_package_homepage}}\\n\\","        target=\"_blank\"\\n\\","    >\\n\\","utility2-comment -->\\n\\","        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\","<!-- utility2-comment\\n\\","    </a>\\n\\","utility2-comment -->\\n\\","</h1>\\n\\","<h3>{{env.npm_package_description}}</h3>\\n\\","<!-- utility2-comment\\n\\","<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\","<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\","<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\","utility2-comment -->\\n\\","\\n\\","\\n\\","\\n\\","<label>stderr and stdout</label>\\n\\","<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\","<!-- utility2-comment\\n\\","{{#if isRollup}}\\n\\","<script src=\"assets.app.js\"></script>\\n\\","{{#unless isRollup}}\\n\\","utility2-comment -->\\n\\","<script src=\"assets.utility2.rollup.js\"></script>\\n\\","<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\","<script src=\"assets.npmtest_cnpmjs_org.rollup.js\"></script>\\n\\","<script src=\"assets.example.js\"></script>\\n\\","<script src=\"assets.test.js\"></script>\\n\\","<!-- utility2-comment\\n\\","{{/if isRollup}}\\n\\","utility2-comment -->\\n\\","<div class=\"utility2FooterDiv\">\\n\\","    [ this app was created with\\n\\","    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\","    ]\\n\\","</div>\\n\\","</body>\\n\\","</html>\\n\\","';","        /* jslint-ignore-end */","        if (local.templateRender) {","            local.assetsDict['/'] = local.templateRender(","                local.assetsDict['/assets.index.template.html'],","                {","                    env: local.objectSetDefault(local.env, {","                        npm_package_description: 'the greatest app in the world!',","                        npm_package_name: 'my-app',","                        npm_package_nameAlias: 'my_app',","                        npm_package_version: '0.0.1'","                    })","                }","            );","        } else {","            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']","                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {","                    // jslint-hack","                    String(match0);","                    switch (match1) {","                    case 'npm_package_description':","                        return 'the greatest app in the world!';","                    case 'npm_package_name':","                        return 'my-app';","                    case 'npm_package_nameAlias':","                        return 'my_app';","                    case 'npm_package_version':","                        return '0.0.1';","                    }","                });","        }","        // run the cli","        if (local.global.utility2_rollup || module !== require.main) {","            break;","        }","        local.assetsDict['/assets.example.js'] =","            local.assetsDict['/assets.example.js'] ||","            local.fs.readFileSync(__filename, 'utf8');","        // bug-workaround - long $npm_package_buildCustomOrg","        /* jslint-ignore-begin */","        local.assetsDict['/assets.npmtest_cnpmjs_org.rollup.js'] =","            local.assetsDict['/assets.npmtest_cnpmjs_org.rollup.js'] ||","            local.fs.readFileSync(","                local.npmtest_cnpmjs_org.__dirname + '/lib.npmtest_cnpmjs_org.js',","                'utf8'","            ).replace((/^#!/), '//');","        /* jslint-ignore-end */","        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';","        // if $npm_config_timeout_exit exists,","        // then exit this process after $npm_config_timeout_exit ms","        if (Number(process.env.npm_config_timeout_exit)) {","            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));","        }","        // start server","        if (local.global.utility2_serverHttp1) {","            break;","        }","        process.env.PORT = process.env.PORT || '8081';","        console.error('server starting on port ' + process.env.PORT);","        local.http.createServer(function (request, response) {","            request.urlParsed = local.url.parse(request.url);","            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {","                response.end(local.assetsDict[request.urlParsed.pathname]);","                return;","            }","            response.statusCode = 404;","            response.end();","        }).listen(process.env.PORT);","        break;","    }","}());",""],"l":{"26":2,"28":2,"33":2,"35":2,"37":2,"38":2,"39":2,"44":1,"51":2,"55":2,"59":2,"61":2,"69":1,"70":2,"76":2,"79":2,"82":2,"83":2,"85":1,"89":2,"92":1,"93":1,"94":1,"96":1,"97":1,"100":1,"101":1,"103":1,"106":1,"108":2,"114":1,"116":1,"118":1,"123":1,"124":2,"125":2,"126":3,"127":3,"128":3,"129":3,"130":1,"133":3,"134":3,"139":3,"143":1,"144":3,"145":1,"149":1,"150":1,"158":1,"160":1,"161":1,"162":1,"164":1,"166":1,"258":1,"259":1,"271":1,"274":6,"275":6,"277":1,"279":2,"281":1,"283":2,"288":1,"289":1,"291":1,"296":1,"303":1,"306":1,"307":1,"310":1,"311":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"319":1,"321":1,"322":1,"324":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1,"8":0,"9":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":22},"end":{"line":20,"column":46}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":20},"end":{"line":25,"column":44}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":33}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":39}},"3":{"start":{"line":18,"column":0},"end":{"line":18,"column":24}},"4":{"start":{"line":20,"column":0},"end":{"line":23,"column":2}},"5":{"start":{"line":21,"column":2},"end":{"line":21,"column":34}},"6":{"start":{"line":22,"column":2},"end":{"line":22,"column":22}},"7":{"start":{"line":25,"column":0},"end":{"line":28,"column":2}},"8":{"start":{"line":26,"column":2},"end":{"line":26,"column":34}},"9":{"start":{"line":27,"column":2},"end":{"line":27,"column":20}}},"branchMap":{},"code":["/**!"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('./config');","","exports.loadConfig = config.loadConfig;","exports.config = config;","","exports.startWorker = function (customConfig) {","  config.loadConfig(customConfig);","  require('./worker');","};","","exports.startSync = function (customConfig) {","  config.loadConfig(customConfig);","  require('./sync');","};",""],"l":{"15":1,"17":1,"18":1,"20":1,"21":0,"22":0,"25":1,"26":0,"27":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/config/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/config/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1,"21":1,"22":1,"23":0,"24":0,"25":0},"b":{"1":[1,0],"2":[0,1],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":248,"loc":{"start":{"line":248,"column":20},"end":{"line":248,"column":44}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":30}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":23}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":23}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":49}},"7":{"start":{"line":11,"column":0},"end":{"line":11,"column":35}},"8":{"start":{"line":12,"column":0},"end":{"line":12,"column":65}},"9":{"start":{"line":14,"column":0},"end":{"line":224,"column":2}},"10":{"start":{"line":226,"column":0},"end":{"line":241,"column":1}},"11":{"start":{"line":227,"column":2},"end":{"line":227,"column":19}},"12":{"start":{"line":228,"column":2},"end":{"line":237,"column":3}},"13":{"start":{"line":229,"column":4},"end":{"line":229,"column":58}},"14":{"start":{"line":233,"column":4},"end":{"line":233,"column":53}},"15":{"start":{"line":234,"column":4},"end":{"line":236,"column":5}},"16":{"start":{"line":235,"column":6},"end":{"line":235,"column":60}},"17":{"start":{"line":238,"column":2},"end":{"line":240,"column":3}},"18":{"start":{"line":239,"column":4},"end":{"line":239,"column":49}},"19":{"start":{"line":243,"column":0},"end":{"line":243,"column":27}},"20":{"start":{"line":244,"column":0},"end":{"line":244,"column":30}},"21":{"start":{"line":246,"column":0},"end":{"line":246,"column":24}},"22":{"start":{"line":248,"column":0},"end":{"line":253,"column":2}},"23":{"start":{"line":249,"column":2},"end":{"line":251,"column":3}},"24":{"start":{"line":250,"column":4},"end":{"line":250,"column":11}},"25":{"start":{"line":252,"column":2},"end":{"line":252,"column":38}}},"branchMap":{"1":{"line":12,"type":"binary-expr","locations":[{"start":{"line":12,"column":24},"end":{"line":12,"column":40}},{"start":{"line":12,"column":44},"end":{"line":12,"column":48}}]},"2":{"line":226,"type":"if","locations":[{"start":{"line":226,"column":0},"end":{"line":226,"column":0}},{"start":{"line":226,"column":0},"end":{"line":226,"column":0}}]},"3":{"line":228,"type":"if","locations":[{"start":{"line":228,"column":2},"end":{"line":228,"column":2}},{"start":{"line":228,"column":2},"end":{"line":228,"column":2}}]},"4":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":4},"end":{"line":234,"column":4}},{"start":{"line":234,"column":4},"end":{"line":234,"column":4}}]},"5":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":2},"end":{"line":238,"column":2}},{"start":{"line":238,"column":2},"end":{"line":238,"column":2}}]},"6":{"line":249,"type":"if","locations":[{"start":{"line":249,"column":2},"end":{"line":249,"column":2}},{"start":{"line":249,"column":2},"end":{"line":249,"column":2}}]}},"code":["'use strict';","","var mkdirp = require('mkdirp');","var copy = require('copy-to');","var path = require('path');","var fs = require('fs');","var os = require('os');","","var version = require('../package.json').version;","","var root = path.dirname(__dirname);","var dataDir = path.join(process.env.HOME || root, '.cnpmjs.org');","","var config = {","  version: version,","  dataDir: dataDir,","","  /**","   * Cluster mode","   */","  enableCluster: false,","  numCPUs: os.cpus().length,","","  /*","   * server configure","   */","","  registryPort: 7001,","  webPort: 7002,","  bindingHost: '127.0.0.1', // only binding on 127.0.0.1 for local access","","  // debug mode","  // if in debug mode, some middleware like limit wont load","  // logger module will print to stdout","  debug: process.env.NODE_ENV === 'development',","  // page mode, enable on development env","  pagemock: process.env.NODE_ENV === 'development',","  // session secret","  sessionSecret: 'cnpmjs.org test session secret',","  // max request json body size","  jsonLimit: '10mb',","  // log dir name","  logdir: path.join(dataDir, 'logs'),","  // update file template dir","  uploadDir: path.join(dataDir, 'downloads'),","  // web page viewCache","  viewCache: false,","","  // config for koa-limit middleware","  // for limit download rates","  limit: {","    enable: false,","    token: 'koa-limit:download',","    limit: 1000,","    interval: 1000 * 60 * 60 * 24,","    whiteList: [],","    blackList: [],","    message: 'request frequency limited, any question, please contact fengmk2@gmail.com',","  },","","  enableCompress: false, // enable gzip response or not","","  // default system admins","  admins: {","    // name: email","    fengmk2: 'fengmk2@gmail.com',","    admin: 'admin@cnpmjs.org',","    dead_horse: 'dead_horse@qq.com',","  },","","  // email notification for errors","  // check https://github.com/andris9/Nodemailer for more informations","  mail: {","    enable: false,","    appname: 'cnpmjs.org',","    from: 'cnpmjs.org mail sender <adderss@gmail.com>',","    service: 'gmail',","    auth: {","      user: 'address@gmail.com',","      pass: 'your password'","    }","  },","","  logoURL: 'https://os.alipayobjects.com/rmsportal/oygxuIUkkrRccUz.jpg', // cnpm logo image url","  adBanner: '',","  customReadmeFile: '', // you can use your custom readme file instead the cnpm one","  customFooter: '', // you can add copyright and site total script html here","  npmClientName: 'cnpm', // use `${name} install package`","  packagePageContributorSearch: true, // package page contributor link to search, default is true","","  // max handle number of package.json `dependencies` property","  maxDependencies: 200,","  // backup filepath prefix","  backupFilePrefix: '/cnpm/backup/',","","  /**","   * database config","   */","","  database: {","    db: 'cnpmjs_test',","    username: 'root',","    password: '',","","    // the sql dialect of the database","    // - currently supported: 'mysql', 'sqlite', 'postgres', 'mariadb'","    dialect: 'sqlite',","","    // custom host; default: 127.0.0.1","    host: '127.0.0.1',","","    // custom port; default: 3306","    port: 3306,","","    // use pooling in order to reduce db connection overload and to increase speed","    // currently only for mysql and postgresql (since v1.5.0)","    pool: {","      maxConnections: 10,","      minConnections: 0,","      maxIdleTime: 30000","    },","","    // the storage engine for 'sqlite'","    // default store into ~/.cnpmjs.org/data.sqlite","    storage: path.join(dataDir, 'data.sqlite'),","","    logging: !!process.env.SQL_DEBUG,","  },","","  // package tarball store in local filesystem by default","  nfs: require('fs-cnpm')({","    dir: path.join(dataDir, 'nfs')","  }),","  // if set true, will 302 redirect to `nfs.url(dist.key)`","  downloadRedirectToNFS: false,","","  // registry url name","  registryHost: 'r.cnpmjs.org',","","  /**","   * registry mode config","   */","","  // enable private mode or not","  // private mode: only admins can publish, other users just can sync package from source npm","  // public mode: all users can publish","  enablePrivate: false,","","  // registry scopes, if don't set, means do not support scopes","  scopes: [ '@cnpm', '@cnpmtest', '@cnpm-test' ],","","  // some registry already have some private packages in global scope","  // but we want to treat them as scoped private packages,","  // so you can use this white list.","  privatePackages: [],","","  /**","   * sync configs","   */","","  // the official npm registry","  // cnpm wont directly sync from this one","  // but sometimes will request it for some package infomations","  // please don't change it if not necessary","  officialNpmRegistry: 'https://registry.npmjs.com',","  officialNpmReplicate: 'https://replicate.npmjs.com',","","  // sync source, upstream registry","  // If you want to directly sync from official npm's registry","  // please drop them an email first","  sourceNpmRegistry: 'https://registry.npm.taobao.org',","","  // upstream registry is base on cnpm/cnpmjs.org or not","  // if your upstream is official npm registry, please turn it off","  sourceNpmRegistryIsCNpm: true,","","  // if install return 404, try to sync from source registry","  syncByInstall: true,","","  // sync mode select","  // none: do not sync any module, proxy all public modules from sourceNpmRegistry","  // exist: only sync exist modules","  // all: sync all modules","  syncModel: 'none', // 'none', 'all', 'exist'","","  syncConcurrency: 1,","  // sync interval, default is 10 minutes","  syncInterval: '10m',","","  // sync polular modules, default to false","  // because cnpm can't auto sync tag change for now","  // so we want to sync popular modules to ensure their tags","  syncPopular: false,","  syncPopularInterval: '1h',","  // top 100","  topPopular: 100,","","  // sync devDependencies or not, default is false","  syncDevDependencies: false,","","  // changes streaming sync","  syncChangesStream: false,","  handleSyncRegistry: 'http://127.0.0.1:7001',","","  // badge subject on http://shields.io/","  badgePrefixURL: 'https://img.shields.io/badge',","  badgeSubject: 'cnpm',","","  // custom user service, @see https://github.com/cnpm/cnpmjs.org/wiki/Use-Your-Own-User-Authorization","  // when you not intend to ingegrate with your company's user system, then use null, it would","  // use the default cnpm user system","  userService: null,","","  // always-auth https://docs.npmjs.com/misc/config#always-auth","  // Force npm to always require authentication when accessing the registry, even for GET requests.","  alwaysAuth: false,","","  // if you're behind firewall, need to request through http proxy, please set this","  // e.g.: `httpProxy: 'http://proxy.mycompany.com:8080'`","  httpProxy: null,","","  // snyk.io root url","  snykUrl: 'https://snyk.io',","};","","if (process.env.NODE_ENV !== 'test') {","  var customConfig;","  if (process.env.NODE_ENV === 'development') {","    customConfig = path.join(root, 'config', 'config.js');","  } else {","    // 1. try to load `$dataDir/config.json` first, not exists then goto 2.","    // 2. load config/config.js, everything in config.js will cover the same key in index.js","    customConfig = path.join(dataDir, 'config.json');","    if (!fs.existsSync(customConfig)) {","      customConfig = path.join(root, 'config', 'config.js');","    }","  }","  if (fs.existsSync(customConfig)) {","    copy(require(customConfig)).override(config);","  }","}","","mkdirp.sync(config.logdir);","mkdirp.sync(config.uploadDir);","","module.exports = config;","","config.loadConfig = function (customConfig) {","  if (!customConfig) {","    return;","  }","  copy(customConfig).override(config);","};",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"9":1,"11":1,"12":1,"14":1,"226":1,"227":0,"228":0,"229":0,"233":0,"234":0,"235":0,"238":0,"239":0,"243":1,"244":1,"246":1,"248":1,"249":0,"250":0,"252":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/dispatch.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/dispatch.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":0,"11":0,"12":0,"13":2,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"b":{"1":[0,2],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"forkWorker","line":26,"loc":{"start":{"line":26,"column":0},"end":{"line":26,"column":22}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":16},"end":{"line":30,"column":34}}},"3":{"name":"(anonymous_3)","line":32,"loc":{"start":{"line":32,"column":22},"end":{"line":32,"column":40}}},"4":{"name":"(anonymous_4)","line":35,"loc":{"start":{"line":35,"column":16},"end":{"line":35,"column":48}}},"5":{"name":"forkSyncer","line":44,"loc":{"start":{"line":44,"column":0},"end":{"line":44,"column":22}}},"6":{"name":"(anonymous_6)","line":46,"loc":{"start":{"line":46,"column":20},"end":{"line":46,"column":44}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":44}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":51}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":44}},"8":{"start":{"line":11,"column":0},"end":{"line":12,"column":98}},"9":{"start":{"line":14,"column":0},"end":{"line":24,"column":1}},"10":{"start":{"line":15,"column":2},"end":{"line":15,"column":15}},"11":{"start":{"line":16,"column":2},"end":{"line":18,"column":3}},"12":{"start":{"line":17,"column":4},"end":{"line":17,"column":17}},"13":{"start":{"line":20,"column":2},"end":{"line":20,"column":22}},"14":{"start":{"line":21,"column":2},"end":{"line":23,"column":3}},"15":{"start":{"line":22,"column":4},"end":{"line":22,"column":22}},"16":{"start":{"line":26,"column":0},"end":{"line":42,"column":1}},"17":{"start":{"line":27,"column":2},"end":{"line":41,"column":5}},"18":{"start":{"line":31,"column":4},"end":{"line":31,"column":81}},"19":{"start":{"line":33,"column":4},"end":{"line":34,"column":77}},"20":{"start":{"line":36,"column":4},"end":{"line":36,"column":43}},"21":{"start":{"line":37,"column":4},"end":{"line":38,"column":75}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":33}},"23":{"start":{"line":40,"column":4},"end":{"line":40,"column":86}},"24":{"start":{"line":44,"column":0},"end":{"line":54,"column":1}},"25":{"start":{"line":45,"column":2},"end":{"line":45,"column":43}},"26":{"start":{"line":46,"column":2},"end":{"line":53,"column":5}},"27":{"start":{"line":47,"column":4},"end":{"line":48,"column":63}},"28":{"start":{"line":49,"column":4},"end":{"line":49,"column":39}},"29":{"start":{"line":50,"column":4},"end":{"line":51,"column":50}},"30":{"start":{"line":52,"column":4},"end":{"line":52,"column":33}}},"branchMap":{"1":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":0},"end":{"line":14,"column":0}},{"start":{"line":14,"column":0},"end":{"line":14,"column":0}}]},"2":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":2},"end":{"line":16,"column":2}},{"start":{"line":16,"column":2},"end":{"line":16,"column":2}}]},"3":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":2},"end":{"line":21,"column":2}},{"start":{"line":21,"column":2},"end":{"line":21,"column":2}}]}},"code":["'use strict';","","var childProcess = require('child_process');","var path = require('path');","var util = require('util');","var cfork = require('cfork');","var config = require('./config');","var workerPath = path.join(__dirname, 'worker.js');","var syncPath = path.join(__dirname, 'sync');","","console.log('Starting cnpmjs.org ...\\ncluster: %s\\nadmins: %j\\nscopes: %j\\nsourceNpmRegistry: %s\\nsyncModel: %s',","  config.enableCluster, config.admins, config.scopes, config.sourceNpmRegistry, config.syncModel);","","if (config.enableCluster) {","  forkWorker();","  if (config.syncModel !== 'none') {","    forkSyncer();","  }","} else {","  require(workerPath);","  if (config.syncModel !== 'none') {","    require(syncPath);","  }","}","","function forkWorker() {","  cfork({","    exec: workerPath,","    count: config.numCPUs,","  }).on('fork', function (worker) {","    console.log('[%s] [worker:%d] new worker start', Date(), worker.process.pid);","  }).on('disconnect', function (worker) {","    console.error('[%s] [master:%s] wroker:%s disconnect, suicide: %s, state: %s.',","      Date(), process.pid, worker.process.pid, worker.suicide, worker.state);","  }).on('exit', function (worker, code, signal) {","    var exitCode = worker.process.exitCode;","    var err = new Error(util.format('worker %s died (code: %s, signal: %s, suicide: %s, state: %s)',","      worker.process.pid, exitCode, signal, worker.suicide, worker.state));","    err.name = 'WorkerDiedError';","    console.error('[%s] [master:%s] wroker exit: %s', Date(), process.pid, err.stack);","  });","}","","function forkSyncer() {","  var syncer = childProcess.fork(syncPath);","  syncer.on('exit', function (code, signal) {","    var err = new Error(util.format('syncer %s died (code: %s, signal: %s, stdout: %s, stderr: %s)',","      syncer.pid, code, signal, syncer.stdout, syncer.stderr));","    err.name = 'SyncerWorkerDiedError';","    console.error('[%s] [master:%s] syncer exit: %s: %s',","      Date(), process.pid, err.name, err.message);","    setTimeout(forkSyncer, 1000);","  });","}",""],"l":{"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"11":2,"14":2,"15":0,"16":0,"17":0,"20":2,"21":0,"22":0,"26":1,"27":0,"31":0,"33":0,"36":0,"37":0,"39":0,"40":0,"44":1,"45":0,"46":0,"47":0,"49":0,"50":0,"52":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/worker.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/worker.js","s":{"1":4,"2":4,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":9},"end":{"line":20,"column":41}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":45}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":35}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":40}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":57}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":47}},"8":{"start":{"line":12,"column":0},"end":{"line":16,"column":24}},"9":{"start":{"line":18,"column":0},"end":{"line":28,"column":3}},"10":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"11":{"start":{"line":22,"column":6},"end":{"line":22,"column":107}},"12":{"start":{"line":24,"column":4},"end":{"line":24,"column":23}},"13":{"start":{"line":25,"column":4},"end":{"line":25,"column":29}},"14":{"start":{"line":26,"column":4},"end":{"line":26,"column":22}}},"branchMap":{"1":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":4}},{"start":{"line":21,"column":4},"end":{"line":21,"column":4}}]}},"code":["'use strict';","","var graceful = require('graceful');","var registry = require('./servers/registry');","var web = require('./servers/web');","var logger = require('./common/logger');","var config = require('./config');","","registry.listen(config.registryPort, config.bindingHost);","web.listen(config.webPort, config.bindingHost);","","console.log('[%s] [worker:%d] Server started, registry server listen at %s:%d, web listen at %s:%d, cluster: %s',","  new Date(), process.pid,","  config.bindingHost, config.registryPort,","  config.bindingHost, config.webPort,","  config.enableCluster);","","graceful({","  server: [registry, web],","  error: function (err, throwErrorCount) {","    if (err.message) {","      err.message += ' (uncaughtException throw ' + throwErrorCount + ' times on pid:' + process.pid + ')';","    }","    console.error(err);","    console.error(err.stack);","    logger.error(err);","  }","});",""],"l":{"3":4,"4":4,"5":0,"6":0,"7":0,"9":0,"10":0,"12":0,"18":0,"21":0,"22":0,"24":0,"25":0,"26":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/servers/registry.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/servers/registry.js","s":{"1":6,"2":6,"3":6,"4":6,"5":6,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":52,"loc":{"start":{"line":52,"column":16},"end":{"line":52,"column":36}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":25}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":43}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":41}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":34}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":43}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":41}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":50}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":59}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":28}},"13":{"start":{"line":15,"column":0},"end":{"line":15,"column":55}},"14":{"start":{"line":16,"column":0},"end":{"line":16,"column":45}},"15":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}},"16":{"start":{"line":19,"column":0},"end":{"line":19,"column":17}},"17":{"start":{"line":20,"column":0},"end":{"line":20,"column":23}},"18":{"start":{"line":21,"column":0},"end":{"line":21,"column":54}},"19":{"start":{"line":22,"column":0},"end":{"line":22,"column":61}},"20":{"start":{"line":23,"column":0},"end":{"line":23,"column":21}},"21":{"start":{"line":25,"column":0},"end":{"line":25,"column":45}},"22":{"start":{"line":26,"column":0},"end":{"line":26,"column":17}},"23":{"start":{"line":27,"column":0},"end":{"line":27,"column":65}},"24":{"start":{"line":28,"column":0},"end":{"line":30,"column":4}},"25":{"start":{"line":31,"column":0},"end":{"line":31,"column":16}},"26":{"start":{"line":32,"column":0},"end":{"line":32,"column":22}},"27":{"start":{"line":33,"column":0},"end":{"line":33,"column":18}},"28":{"start":{"line":35,"column":0},"end":{"line":37,"column":1}},"29":{"start":{"line":36,"column":2},"end":{"line":36,"column":52}},"30":{"start":{"line":38,"column":0},"end":{"line":38,"column":35}},"31":{"start":{"line":39,"column":0},"end":{"line":39,"column":28}},"32":{"start":{"line":45,"column":0},"end":{"line":45,"column":33}},"33":{"start":{"line":46,"column":0},"end":{"line":46,"column":12}},"34":{"start":{"line":52,"column":0},"end":{"line":57,"column":3}},"35":{"start":{"line":53,"column":2},"end":{"line":53,"column":19}},"36":{"start":{"line":54,"column":2},"end":{"line":54,"column":25}},"37":{"start":{"line":55,"column":2},"end":{"line":55,"column":39}},"38":{"start":{"line":56,"column":2},"end":{"line":56,"column":20}},"39":{"start":{"line":59,"column":0},"end":{"line":59,"column":40}},"40":{"start":{"line":61,"column":0},"end":{"line":63,"column":1}},"41":{"start":{"line":62,"column":2},"end":{"line":62,"column":34}},"42":{"start":{"line":65,"column":0},"end":{"line":65,"column":21}}},"branchMap":{"1":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":0},"end":{"line":35,"column":0}},{"start":{"line":35,"column":0},"end":{"line":35,"column":0}}]},"2":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":12},"end":{"line":55,"column":19}},{"start":{"line":55,"column":23},"end":{"line":55,"column":38}}]},"3":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":0},"end":{"line":61,"column":0}},{"start":{"line":61,"column":0},"end":{"line":61,"column":0}}]}},"code":["'use strict';","","var koa = require('koa');","var app = module.exports = koa();","var http = require('http');","var middlewares = require('koa-middlewares');","var routes = require('../routes/registry');","var logger = require('../common/logger');","var config = require('../config');","var block = require('../middleware/block');","var auth = require('../middleware/auth');","var staticCache = require('../middleware/static');","var notFound = require('../middleware/registry_not_found');","var cors = require('kcors');","var proxyToNpm = require('../middleware/proxy_to_npm');","var maxrequests = require('koa-maxrequests');","","app.use(maxrequests());","app.use(block());","middlewares.jsonp(app);","app.use(middlewares.rt({ headerName: 'X-ReadTime' }));","app.use(middlewares.rewrite('/favicon.ico', '/favicon.png'));","app.use(staticCache);","","app.keys = ['todokey', config.sessionSecret];","app.proxy = true;","app.use(middlewares.bodyParser({ jsonLimit: config.jsonLimit }));","app.use(cors({","  allowMethods: 'GET,HEAD',","}));","app.use(auth());","app.use(proxyToNpm());","app.use(notFound);","","if (config.enableCompress) {","  app.use(middlewares.compress({ threshold: 150 }));","}","app.use(middlewares.conditional());","app.use(middlewares.etag());","","/**"," * Routes"," */","","app.use(middlewares.router(app));","routes(app);","","/**"," * Error handler"," */","","app.on('error', function (err, ctx) {","  console.log(err);","  console.log(err.stack);","  err.url = err.url || ctx.request.url;","  logger.error(err);","});","","app = http.createServer(app.callback());","","if (!module.parent) {","  app.listen(config.registryPort);","}","","module.exports = app;",""],"l":{"3":6,"4":6,"5":6,"6":6,"7":6,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"25":0,"26":0,"27":0,"28":0,"31":0,"32":0,"33":0,"35":0,"36":0,"38":0,"39":0,"45":0,"46":0,"52":0,"53":0,"54":0,"55":0,"56":0,"59":0,"61":0,"62":0,"65":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/routes/registry.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/routes/registry.js","s":{"1":8,"2":8,"3":8,"4":8,"5":8,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":1,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"routes","line":36,"loc":{"start":{"line":36,"column":0},"end":{"line":36,"column":21}}},"2":{"name":"jsonp","line":38,"loc":{"start":{"line":38,"column":2},"end":{"line":38,"column":24}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":43}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":55}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":61}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":49}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":60}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":59}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":48}},"9":{"start":{"line":13,"column":0},"end":{"line":13,"column":66}},"10":{"start":{"line":14,"column":0},"end":{"line":14,"column":72}},"11":{"start":{"line":15,"column":0},"end":{"line":15,"column":70}},"12":{"start":{"line":16,"column":0},"end":{"line":16,"column":70}},"13":{"start":{"line":17,"column":0},"end":{"line":17,"column":80}},"14":{"start":{"line":18,"column":0},"end":{"line":18,"column":68}},"15":{"start":{"line":19,"column":0},"end":{"line":19,"column":66}},"16":{"start":{"line":20,"column":0},"end":{"line":20,"column":57}},"17":{"start":{"line":21,"column":0},"end":{"line":21,"column":70}},"18":{"start":{"line":22,"column":0},"end":{"line":22,"column":81}},"19":{"start":{"line":23,"column":0},"end":{"line":23,"column":70}},"20":{"start":{"line":24,"column":0},"end":{"line":24,"column":74}},"21":{"start":{"line":25,"column":0},"end":{"line":25,"column":78}},"22":{"start":{"line":26,"column":0},"end":{"line":26,"column":81}},"23":{"start":{"line":28,"column":0},"end":{"line":28,"column":58}},"24":{"start":{"line":29,"column":0},"end":{"line":29,"column":60}},"25":{"start":{"line":30,"column":0},"end":{"line":30,"column":64}},"26":{"start":{"line":32,"column":0},"end":{"line":32,"column":42}},"27":{"start":{"line":33,"column":0},"end":{"line":33,"column":66}},"28":{"start":{"line":34,"column":0},"end":{"line":34,"column":63}},"29":{"start":{"line":36,"column":0},"end":{"line":136,"column":1}},"30":{"start":{"line":38,"column":2},"end":{"line":43,"column":3}},"31":{"start":{"line":39,"column":4},"end":{"line":39,"column":16}},"32":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"33":{"start":{"line":41,"column":6},"end":{"line":41,"column":29}},"34":{"start":{"line":45,"column":2},"end":{"line":45,"column":33}},"35":{"start":{"line":49,"column":2},"end":{"line":49,"column":29}},"36":{"start":{"line":50,"column":2},"end":{"line":50,"column":37}},"37":{"start":{"line":52,"column":2},"end":{"line":52,"column":34}},"38":{"start":{"line":56,"column":2},"end":{"line":56,"column":70}},"39":{"start":{"line":58,"column":2},"end":{"line":58,"column":81}},"40":{"start":{"line":60,"column":2},"end":{"line":60,"column":52}},"41":{"start":{"line":61,"column":2},"end":{"line":61,"column":59}},"42":{"start":{"line":64,"column":2},"end":{"line":64,"column":74}},"43":{"start":{"line":65,"column":2},"end":{"line":65,"column":53}},"44":{"start":{"line":68,"column":2},"end":{"line":68,"column":58}},"45":{"start":{"line":69,"column":2},"end":{"line":69,"column":36}},"46":{"start":{"line":70,"column":2},"end":{"line":70,"column":76}},"47":{"start":{"line":71,"column":2},"end":{"line":71,"column":50}},"48":{"start":{"line":74,"column":2},"end":{"line":74,"column":76}},"49":{"start":{"line":75,"column":2},"end":{"line":75,"column":47}},"50":{"start":{"line":78,"column":2},"end":{"line":78,"column":100}},"51":{"start":{"line":79,"column":2},"end":{"line":79,"column":63}},"52":{"start":{"line":80,"column":2},"end":{"line":80,"column":94}},"53":{"start":{"line":81,"column":2},"end":{"line":81,"column":56}},"54":{"start":{"line":84,"column":2},"end":{"line":85,"column":44}},"55":{"start":{"line":86,"column":2},"end":{"line":86,"column":92}},"56":{"start":{"line":89,"column":2},"end":{"line":89,"column":106}},"57":{"start":{"line":90,"column":2},"end":{"line":90,"column":75}},"58":{"start":{"line":93,"column":2},"end":{"line":93,"column":101}},"59":{"start":{"line":94,"column":2},"end":{"line":94,"column":70}},"60":{"start":{"line":98,"column":2},"end":{"line":98,"column":53}},"61":{"start":{"line":99,"column":2},"end":{"line":99,"column":54}},"62":{"start":{"line":100,"column":2},"end":{"line":100,"column":73}},"63":{"start":{"line":103,"column":2},"end":{"line":103,"column":48}},"64":{"start":{"line":104,"column":2},"end":{"line":104,"column":57}},"65":{"start":{"line":107,"column":2},"end":{"line":107,"column":58}},"66":{"start":{"line":108,"column":2},"end":{"line":108,"column":84}},"67":{"start":{"line":109,"column":2},"end":{"line":109,"column":52}},"68":{"start":{"line":112,"column":2},"end":{"line":112,"column":72}},"69":{"start":{"line":113,"column":2},"end":{"line":113,"column":97}},"70":{"start":{"line":116,"column":2},"end":{"line":116,"column":67}},"71":{"start":{"line":117,"column":2},"end":{"line":117,"column":93}},"72":{"start":{"line":120,"column":2},"end":{"line":120,"column":83}},"73":{"start":{"line":121,"column":2},"end":{"line":121,"column":109}},"74":{"start":{"line":124,"column":2},"end":{"line":124,"column":86}},"75":{"start":{"line":125,"column":2},"end":{"line":125,"column":112}},"76":{"start":{"line":128,"column":2},"end":{"line":128,"column":87}},"77":{"start":{"line":129,"column":2},"end":{"line":129,"column":121}},"78":{"start":{"line":131,"column":2},"end":{"line":131,"column":88}},"79":{"start":{"line":134,"column":2},"end":{"line":134,"column":94}},"80":{"start":{"line":135,"column":2},"end":{"line":135,"column":128}},"81":{"start":{"line":138,"column":0},"end":{"line":138,"column":24}}},"branchMap":{"1":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":4}},{"start":{"line":40,"column":4},"end":{"line":40,"column":4}}]}},"code":["'use strict';","","var limit = require('../middleware/limit');","var login = require('../middleware/login');","var publishable = require('../middleware/publishable');","var syncByInstall = require('../middleware/sync_by_install');","var editable = require('../middleware/editable');","var existsPackage = require('../middleware/exists_package');","var unpublishable = require('../middleware/unpublishable');","","var showTotal = require('../controllers/total');","","var listAll = require('../controllers/registry/package/list_all');","var listShorts = require('../controllers/registry/package/list_shorts');","var listSince = require('../controllers/registry/package/list_since');","var listAllVersions = require('../controllers/registry/package/list');","var listDependents = require('../controllers/registry/package/list_dependents');","var getOneVersion = require('../controllers/registry/package/show');","var savePackage = require('../controllers/registry/package/save');","var tag = require('../controllers/registry/package/tag');","var removePackage = require('../controllers/registry/package/remove');","var removeOneVersion = require('../controllers/registry/package/remove_version');","var updatePackage = require('../controllers/registry/package/update');","var downloadPackage = require('../controllers/registry/package/download');","var downloadTotal = require('../controllers/registry/package/download_total');","var listPackagesByUser = require('../controllers/registry/package/list_by_user');","","var addUser = require('../controllers/registry/user/add');","var showUser = require('../controllers/registry/user/show');","var updateUser = require('../controllers/registry/user/update');","","var sync = require('../controllers/sync');","var userPackage = require('../controllers/registry/user_package');","var tags = require('../controllers/registry/package/dist_tag');","","function routes(app) {","","  function* jsonp(next) {","    yield* next;","    if (this.body) {","      this.jsonp = this.body;","    }","  }","","  app.get('/', jsonp, showTotal);","","  // before /:name/:version","  // get all modules, for npm search","  app.get('/-/all', listAll);","  app.get('/-/all/since', listSince);","  // get all module names, for auto completion","  app.get('/-/short', listShorts);","","  // module","  // scope package: params: [$name]","  app.get(/^\\/(@[\\w\\-\\.]+\\/[^\\/]+)$/, syncByInstall, listAllVersions);","  // scope package: params: [$name, $version]","  app.get(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/([^\\/]+)$/, syncByInstall, getOneVersion);","","  app.get('/:name', syncByInstall, listAllVersions);","  app.get('/:name/:version', syncByInstall, getOneVersion);","","  // try to add module","  app.put(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, login, publishable, savePackage);","  app.put('/:name', login, publishable, savePackage);","","  // sync from source npm","  app.put(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/sync$/, sync.sync);","  app.put('/:name/sync', sync.sync);","  app.get(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/sync\\/log\\/(\\d+)$/, sync.getSyncLog);","  app.get('/:name/sync/log/:id', sync.getSyncLog);","","  // add tag","  app.put(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/([\\w\\-\\.]+)$/, login, editable, tag);","  app.put('/:name/:tag', login, editable, tag);","","  // need limit by ip","  app.get(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/download\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, limit, downloadPackage);","  app.get('/:name/download/:filename', limit, downloadPackage);","  app.get(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/\\-\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, limit, downloadPackage);","  app.get('/:name/-/:filename', limit, downloadPackage);","","  // delete tarball and remove one version","  app.delete(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/download\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/\\-rev\\/([\\w\\-\\.]+)$/,","    login, unpublishable, removeOneVersion);","  app.delete('/:name/download/:filename/-rev/:rev', login, unpublishable, removeOneVersion);","","  // update module, unpublish will PUT this","  app.put(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/\\-rev\\/([\\w\\-\\.]+)$/, login, publishable, editable, updatePackage);","  app.put('/:name/-rev/:rev', login, publishable, editable, updatePackage);","","  // remove all versions","  app.delete(/^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/\\-rev\\/([\\w\\-\\.]+)$/, login, unpublishable, removePackage);","  app.delete('/:name/-rev/:rev', login, unpublishable, removePackage);","","  // try to create a new user","  // https://registry.npmjs.org/-/user/org.couchdb.user:fengmk2","  app.put('/-/user/org.couchdb.user::name', addUser);","  app.get('/-/user/org.couchdb.user::name', showUser);","  app.put('/-/user/org.couchdb.user::name/-rev/:rev', login, updateUser);","","  // list all packages of user","  app.get('/-/by-user/:user', userPackage.list);","  app.get('/-/users/:user/packages', listPackagesByUser);","","  // download times","  app.get('/downloads/range/:range/:name', downloadTotal);","  app.get(/^\\/downloads\\/range\\/([^\\/]+)\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, downloadTotal);","  app.get('/downloads/range/:range', downloadTotal);","","  // GET /-/package/:pkg/dependents","  app.get('/-/package/:name/dependents', existsPackage, listDependents);","  app.get(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dependents$/, existsPackage, listDependents);","","  // GET /-/package/:pkg/dist-tags -- returns the package's dist-tags","  app.get('/-/package/:name/dist-tags', existsPackage, tags.index);","  app.get(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dist\\-tags$/, existsPackage, tags.index);","","  // PUT /-/package/:pkg/dist-tags -- Set package's dist-tags to provided object body (removing missing)","  app.put('/-/package/:name/dist-tags', login, existsPackage, editable, tags.save);","  app.put(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dist\\-tags$/, login, existsPackage, editable, tags.save);","","  // POST /-/package/:pkg/dist-tags -- Add/modify dist-tags from provided object body (merge)","  app.post('/-/package/:name/dist-tags', login, existsPackage, editable, tags.update);","  app.post(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dist\\-tags$/, login, existsPackage, editable, tags.update);","","  // PUT /-/package/:pkg/dist-tags/:tag -- Set package's dist-tags[tag] to provided string body","  app.put('/-/package/:name/dist-tags/:tag', login, existsPackage, editable, tags.set);","  app.put(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dist\\-tags\\/([\\w\\-\\.]+)$/, login, existsPackage, editable, tags.set);","  // POST /-/package/:pkg/dist-tags/:tag -- Same as PUT /-/package/:pkg/dist-tags/:tag","  app.post('/-/package/:name/dist-tags/:tag', login, existsPackage, editable, tags.set);","","  // DELETE /-/package/:pkg/dist-tags/:tag -- Remove tag from dist-tags","  app.delete('/-/package/:name/dist-tags/:tag', login, existsPackage, editable, tags.destroy);","  app.delete(/^\\/\\-\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/dist\\-tags\\/([\\w\\-\\.]+)$/, login, existsPackage, editable, tags.destroy);","}","","module.exports = routes;",""],"l":{"3":8,"4":8,"5":8,"6":8,"7":8,"8":0,"9":0,"11":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"28":0,"29":0,"30":0,"32":0,"33":0,"34":0,"36":1,"38":1,"39":0,"40":0,"41":0,"45":0,"49":0,"50":0,"52":0,"56":0,"58":0,"60":0,"61":0,"64":0,"65":0,"68":0,"69":0,"70":0,"71":0,"74":0,"75":0,"78":0,"79":0,"80":0,"81":0,"84":0,"86":0,"89":0,"90":0,"93":0,"94":0,"98":0,"99":0,"100":0,"103":0,"104":0,"107":0,"108":0,"109":0,"112":0,"113":0,"116":0,"117":0,"120":0,"121":0,"124":0,"125":0,"128":0,"129":0,"131":0,"134":0,"135":0,"138":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/limit.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/limit.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"b":{"1":[1,0]},"f":{"1":0},"fnMap":{"1":{"name":"ignoreLimit","line":23,"loc":{"start":{"line":23,"column":19},"end":{"line":23,"column":47}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":33}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":31}},"4":{"start":{"line":22,"column":0},"end":{"line":28,"column":1}},"5":{"start":{"line":23,"column":2},"end":{"line":25,"column":4}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":16}},"7":{"start":{"line":27,"column":2},"end":{"line":27,"column":38}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":0},"end":{"line":22,"column":0}},{"start":{"line":22,"column":0},"end":{"line":22,"column":0}}]}},"code":["/**!"," * cnpmjs.org - middleware/limit.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","var limit = require('koa-limit');","","var limitConfig = config.limit;","","if (!limitConfig.enable) {","  module.exports = function *ignoreLimit(next) {","    yield *next;","  };","} else {","  module.exports = limit(limitConfig);","}",""],"l":{"17":1,"18":1,"20":1,"22":1,"23":1,"24":0,"27":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/login.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/login.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"login","line":19,"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":39}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":19,"column":0},"end":{"line":42,"column":2}},"3":{"start":{"line":20,"column":2},"end":{"line":31,"column":3}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":40}},"5":{"start":{"line":22,"column":4},"end":{"line":24,"column":12}},"6":{"start":{"line":26,"column":4},"end":{"line":29,"column":6}},"7":{"start":{"line":30,"column":4},"end":{"line":30,"column":11}},"8":{"start":{"line":33,"column":2},"end":{"line":40,"column":3}},"9":{"start":{"line":34,"column":4},"end":{"line":34,"column":22}},"10":{"start":{"line":35,"column":4},"end":{"line":38,"column":6}},"11":{"start":{"line":39,"column":4},"end":{"line":39,"column":11}},"12":{"start":{"line":41,"column":2},"end":{"line":41,"column":14}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]},"2":{"line":22,"type":"cond-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":14}},{"start":{"line":24,"column":8},"end":{"line":24,"column":11}}]},"3":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":33,"column":2}},{"start":{"line":33,"column":2},"end":{"line":33,"column":2}}]}},"code":["/*!"," * cnpmjs.org - middleware/login.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var http = require('http');","","module.exports = function *login(next) {","  if (this.user.error) {","    var status = this.user.error.status;","    this.status = http.STATUS_CODES[status]","      ? status","      : 500;","","    this.body = {","      error: this.user.error.name,","      reason: this.user.error.message","    };","    return;","  }","","  if (!this.user.name) {","    this.status = 401;","    this.body = {","      error: 'unauthorized',","      reason: 'Login first'","    };","    return;","  }","  yield *next;","};",""],"l":{"17":1,"19":1,"20":0,"21":0,"22":0,"26":0,"30":0,"33":0,"34":0,"35":0,"39":0,"41":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/publishable.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/publishable.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"publishable","line":21,"loc":{"start":{"line":21,"column":17},"end":{"line":21,"column":45}}},"2":{"name":"checkScope","line":63,"loc":{"start":{"line":63,"column":0},"end":{"line":63,"column":31}}},"3":{"name":"assertNoneScope","line":87,"loc":{"start":{"line":87,"column":0},"end":{"line":87,"column":36}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":34}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":67}},"4":{"start":{"line":21,"column":0},"end":{"line":57,"column":2}},"5":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":22}},"7":{"start":{"line":28,"column":2},"end":{"line":35,"column":3}},"8":{"start":{"line":29,"column":4},"end":{"line":29,"column":22}},"9":{"start":{"line":30,"column":4},"end":{"line":33,"column":6}},"10":{"start":{"line":34,"column":4},"end":{"line":34,"column":11}},"11":{"start":{"line":40,"column":2},"end":{"line":40,"column":48}},"12":{"start":{"line":43,"column":2},"end":{"line":45,"column":3}},"13":{"start":{"line":44,"column":4},"end":{"line":44,"column":22}},"14":{"start":{"line":48,"column":2},"end":{"line":53,"column":3}},"15":{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},"16":{"start":{"line":50,"column":6},"end":{"line":50,"column":24}},"17":{"start":{"line":52,"column":4},"end":{"line":52,"column":11}},"18":{"start":{"line":56,"column":2},"end":{"line":56,"column":30}},"19":{"start":{"line":63,"column":0},"end":{"line":81,"column":1}},"20":{"start":{"line":64,"column":2},"end":{"line":67,"column":3}},"21":{"start":{"line":65,"column":4},"end":{"line":65,"column":21}},"22":{"start":{"line":66,"column":4},"end":{"line":66,"column":17}},"23":{"start":{"line":69,"column":2},"end":{"line":69,"column":33}},"24":{"start":{"line":70,"column":2},"end":{"line":78,"column":3}},"25":{"start":{"line":71,"column":4},"end":{"line":71,"column":42}},"26":{"start":{"line":72,"column":4},"end":{"line":72,"column":21}},"27":{"start":{"line":73,"column":4},"end":{"line":76,"column":6}},"28":{"start":{"line":77,"column":4},"end":{"line":77,"column":17}},"29":{"start":{"line":80,"column":2},"end":{"line":80,"column":14}},"30":{"start":{"line":87,"column":0},"end":{"line":101,"column":1}},"31":{"start":{"line":88,"column":2},"end":{"line":88,"column":19}},"32":{"start":{"line":89,"column":2},"end":{"line":95,"column":3}},"33":{"start":{"line":90,"column":4},"end":{"line":93,"column":6}},"34":{"start":{"line":94,"column":4},"end":{"line":94,"column":11}},"35":{"start":{"line":97,"column":2},"end":{"line":100,"column":4}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"2":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":28,"column":2}},{"start":{"line":28,"column":2},"end":{"line":28,"column":2}}]},"3":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":13},"end":{"line":40,"column":29}},{"start":{"line":40,"column":33},"end":{"line":40,"column":47}}]},"4":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"5":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":6},"end":{"line":43,"column":28}},{"start":{"line":43,"column":32},"end":{"line":43,"column":75}}]},"6":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":2},"end":{"line":48,"column":2}},{"start":{"line":48,"column":2},"end":{"line":48,"column":2}}]},"7":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":64,"column":2}},{"start":{"line":64,"column":2},"end":{"line":64,"column":2}}]},"9":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":6},"end":{"line":64,"column":22}},{"start":{"line":64,"column":26},"end":{"line":64,"column":49}}]},"10":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]},"11":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/publishable.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var util = require('util');","var config = require('../config');","var debug = require('debug')('cnpmjs.org:middlewares/publishable');","","module.exports = function *publishable(next) {","  // admins always can publish and unpublish","  if (this.user.isAdmin) {","    return yield next;","  }","","  // private mode, normal user can't publish and unpublish","  if (config.enablePrivate) {","    this.status = 403;","    this.body = {","      error: 'no_perms',","      reason: 'Private mode enable, only admin can publish this module'","    };","    return;","  }","","  // public mode, normal user have permission to publish `scoped package`","  // and only can publish with scopes in `ctx.user.scopes`, default is `config.scopes`","","  var name = this.params.name || this.params[0];","","  // check if is private package list in config","  if (config.privatePackages && config.privatePackages.indexOf(name) !== -1) {","    return yield next;","  }","","  // scoped module","  if (name[0] === '@') {","    if (checkScope(name, this)) {","      return yield next;","    }","    return;","  }","","  // none-scope","  assertNoneScope(name, this);","};","","/**"," * check module's scope legal"," */","","function checkScope(name, ctx) {","  if (!ctx.user.scopes || !ctx.user.scopes.length) {","    ctx.status = 404;","    return false;","  }","","  var scope = name.split('/')[0];","  if (ctx.user.scopes.indexOf(scope) === -1) {","    debug('assert scope  %s error', name);","    ctx.status = 400;","    ctx.body = {","      error: 'invalid scope',","      reason: util.format('scope %s not match legal scopes: %s', scope, ctx.user.scopes.join(', '))","    };","    return false;","  }","","  return true;","}","","/**"," * check if user have permission to publish without scope"," */","","function assertNoneScope(name, ctx) {","  ctx.status = 403;","  if (ctx.user.scopes.length === 0) {","    ctx.body = {","      error: 'no_perms',","      reason: 'can\\'t publish non-scoped package, please set `config.scopes`'","    };","    return;","  }","","  ctx.body = {","    error: 'no_perms',","    reason: 'only allow publish with ' + ctx.user.scopes.join(', ') + ' scope(s)'","  };","}",""],"l":{"17":1,"18":1,"19":1,"21":1,"23":0,"24":0,"28":0,"29":0,"30":0,"34":0,"40":0,"43":0,"44":0,"48":0,"49":0,"50":0,"52":0,"56":0,"63":1,"64":0,"65":0,"66":0,"69":0,"70":0,"71":0,"72":0,"73":0,"77":0,"80":0,"87":1,"88":0,"89":0,"90":0,"94":0,"97":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/sync_by_install.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/sync_by_install.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"syncByInstall","line":21,"loc":{"start":{"line":21,"column":17},"end":{"line":21,"column":47}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":34}},"2":{"start":{"line":21,"column":0},"end":{"line":50,"column":2}},"3":{"start":{"line":22,"column":2},"end":{"line":22,"column":25}},"4":{"start":{"line":23,"column":2},"end":{"line":26,"column":3}},"5":{"start":{"line":25,"column":4},"end":{"line":25,"column":22}},"6":{"start":{"line":28,"column":2},"end":{"line":28,"column":34}},"7":{"start":{"line":29,"column":2},"end":{"line":31,"column":3}},"8":{"start":{"line":30,"column":4},"end":{"line":30,"column":22}},"9":{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},"10":{"start":{"line":35,"column":4},"end":{"line":35,"column":22}},"11":{"start":{"line":38,"column":2},"end":{"line":38,"column":48}},"12":{"start":{"line":41,"column":2},"end":{"line":46,"column":3}},"13":{"start":{"line":42,"column":4},"end":{"line":42,"column":35}},"14":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"15":{"start":{"line":44,"column":6},"end":{"line":44,"column":24}},"16":{"start":{"line":48,"column":2},"end":{"line":48,"column":24}},"17":{"start":{"line":49,"column":2},"end":{"line":49,"column":13}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"3":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":6},"end":{"line":29,"column":9}},{"start":{"line":29,"column":13},"end":{"line":29,"column":35}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"5":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":13},"end":{"line":38,"column":29}},{"start":{"line":38,"column":33},"end":{"line":38,"column":47}}]},"6":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":2}},{"start":{"line":41,"column":2},"end":{"line":41,"column":2}}]},"7":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":6},"end":{"line":41,"column":10}},{"start":{"line":41,"column":14},"end":{"line":41,"column":29}}]},"8":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]}},"code":["/**"," * Copyright(c) cnpm and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","","/**"," * {Boolean} this.allowSync  -  allow sync triggle by cnpm install"," */","","module.exports = function* syncByInstall(next) {","  this.allowSync = false;","  if (!config.syncByInstall) {","    // only config.enablePrivate should enable sync on install","    return yield next;","  }","  // request not by node, consider it request from web, don't sync","  var ua = this.get('user-agent');","  if (!ua || ua.indexOf('node') < 0) {","    return yield next;","  }","","  // if request with `/xxx?write=true`, meaning the read request using for write, don't sync","  if (this.query.write) {","    return yield next;","  }","","  var name = this.params.name || this.params[0];","","  // private scoped package don't sync","  if (name && name[0] === '@') {","    var scope = name.split('/')[0];","    if (config.scopes.indexOf(scope) >= 0) {","      return yield next;","    }","  }","","  this.allowSync = true;","  yield next;","};",""],"l":{"15":1,"21":1,"22":0,"23":0,"25":0,"28":0,"29":0,"30":0,"34":0,"35":0,"38":0,"41":0,"42":0,"43":0,"44":0,"48":0,"49":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/editable.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/editable.js","s":{"1":10,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"editable","line":20,"loc":{"start":{"line":20,"column":17},"end":{"line":20,"column":42}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":52}},"2":{"start":{"line":20,"column":0},"end":{"line":42,"column":2}},"3":{"start":{"line":21,"column":2},"end":{"line":21,"column":45}},"4":{"start":{"line":22,"column":2},"end":{"line":22,"column":54}},"5":{"start":{"line":23,"column":2},"end":{"line":31,"column":3}},"6":{"start":{"line":24,"column":4},"end":{"line":26,"column":5}},"7":{"start":{"line":25,"column":6},"end":{"line":25,"column":25}},"8":{"start":{"line":27,"column":4},"end":{"line":27,"column":80}},"9":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"10":{"start":{"line":29,"column":6},"end":{"line":29,"column":25}},"11":{"start":{"line":33,"column":2},"end":{"line":33,"column":20}},"12":{"start":{"line":34,"column":2},"end":{"line":34,"column":57}},"13":{"start":{"line":35,"column":2},"end":{"line":37,"column":3}},"14":{"start":{"line":36,"column":4},"end":{"line":36,"column":39}},"15":{"start":{"line":38,"column":2},"end":{"line":41,"column":4}}},"branchMap":{"1":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":17},"end":{"line":21,"column":26}},{"start":{"line":21,"column":30},"end":{"line":21,"column":44}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":19},"end":{"line":22,"column":35}},{"start":{"line":22,"column":39},"end":{"line":22,"column":53}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"4":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":6},"end":{"line":23,"column":14}},{"start":{"line":23,"column":18},"end":{"line":23,"column":28}}]},"5":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"6":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":4}},{"start":{"line":28,"column":4},"end":{"line":28,"column":4}}]},"7":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/editable.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var packageService = require('../services/package');","","// admin or module's maintainer can modified the module","module.exports = function* editable(next) {","  var username = this.user && this.user.name;","  var moduleName = this.params.name || this.params[0];","  if (username && moduleName) {","    if (this.user.isAdmin) {","      return yield* next;","    }","    var isMaintainer = yield* packageService.isMaintainer(moduleName, username);","    if (isMaintainer) {","      return yield* next;","    }","  }","","  this.status = 403;","  var message = 'not authorized to modify ' + moduleName;","  if (username) {","    message = username + ' ' + message;","  }","  this.body = {","    error: 'forbidden user',","    reason: message","  };","};",""],"l":{"17":10,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"27":0,"28":0,"29":0,"33":0,"34":0,"35":0,"36":0,"38":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/package.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/package.js","s":{"1":22,"2":22,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":1,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"301":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"314":0,"315":0,"316":0,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"335":0,"336":0,"337":0,"338":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":16},"end":{"line":17,"column":31}}},"2":{"name":"parseRow","line":30,"loc":{"start":{"line":30,"column":0},"end":{"line":30,"column":23}}},"3":{"name":"stringifyPackage","line":41,"loc":{"start":{"line":41,"column":0},"end":{"line":41,"column":31}}},"4":{"name":"(anonymous_4)","line":45,"loc":{"start":{"line":45,"column":24},"end":{"line":45,"column":39}}},"5":{"name":"(anonymous_5)","line":51,"loc":{"start":{"line":51,"column":20},"end":{"line":51,"column":46}}},"6":{"name":"(anonymous_6)","line":57,"loc":{"start":{"line":57,"column":25},"end":{"line":57,"column":47}}},"7":{"name":"(anonymous_7)","line":65,"loc":{"start":{"line":65,"column":27},"end":{"line":65,"column":51}}},"8":{"name":"(anonymous_8)","line":68,"loc":{"start":{"line":68,"column":26},"end":{"line":68,"column":40}}},"9":{"name":"(anonymous_9)","line":71,"loc":{"start":{"line":71,"column":12},"end":{"line":71,"column":30}}},"10":{"name":"(anonymous_10)","line":84,"loc":{"start":{"line":84,"column":26},"end":{"line":84,"column":43}}},"11":{"name":"(anonymous_11)","line":90,"loc":{"start":{"line":90,"column":36},"end":{"line":90,"column":54}}},"12":{"name":"(anonymous_12)","line":104,"loc":{"start":{"line":104,"column":21},"end":{"line":104,"column":36}}},"13":{"name":"(anonymous_13)","line":115,"loc":{"start":{"line":115,"column":22},"end":{"line":115,"column":40}}},"14":{"name":"(anonymous_14)","line":131,"loc":{"start":{"line":131,"column":21},"end":{"line":131,"column":36}}},"15":{"name":"(anonymous_15)","line":146,"loc":{"start":{"line":146,"column":28},"end":{"line":146,"column":49}}},"16":{"name":"(anonymous_16)","line":151,"loc":{"start":{"line":151,"column":32},"end":{"line":151,"column":53}}},"17":{"name":"(anonymous_17)","line":155,"loc":{"start":{"line":155,"column":23},"end":{"line":155,"column":36}}},"18":{"name":"(anonymous_18)","line":161,"loc":{"start":{"line":161,"column":22},"end":{"line":161,"column":38}}},"19":{"name":"(anonymous_19)","line":169,"loc":{"start":{"line":169,"column":22},"end":{"line":169,"column":38}}},"20":{"name":"(anonymous_20)","line":177,"loc":{"start":{"line":177,"column":34},"end":{"line":177,"column":55}}},"21":{"name":"(anonymous_21)","line":183,"loc":{"start":{"line":183,"column":38},"end":{"line":183,"column":59}}},"22":{"name":"(anonymous_22)","line":187,"loc":{"start":{"line":187,"column":23},"end":{"line":187,"column":36}}},"23":{"name":"(anonymous_23)","line":189,"loc":{"start":{"line":189,"column":12},"end":{"line":189,"column":28}}},"24":{"name":"(anonymous_24)","line":199,"loc":{"start":{"line":199,"column":22},"end":{"line":199,"column":38}}},"25":{"name":"listPublicModuleNamesSince","line":208,"loc":{"start":{"line":208,"column":37},"end":{"line":208,"column":81}}},"26":{"name":"(anonymous_26)","line":227,"loc":{"start":{"line":227,"column":35},"end":{"line":227,"column":48}}},"27":{"name":"(anonymous_27)","line":230,"loc":{"start":{"line":230,"column":21},"end":{"line":230,"column":36}}},"28":{"name":"(anonymous_28)","line":232,"loc":{"start":{"line":232,"column":9},"end":{"line":232,"column":24}}},"29":{"name":"(anonymous_29)","line":237,"loc":{"start":{"line":237,"column":28},"end":{"line":237,"column":63}}},"30":{"name":"(anonymous_30)","line":252,"loc":{"start":{"line":252,"column":32},"end":{"line":252,"column":49}}},"31":{"name":"(anonymous_31)","line":266,"loc":{"start":{"line":266,"column":21},"end":{"line":266,"column":37}}},"32":{"name":"(anonymous_32)","line":325,"loc":{"start":{"line":325,"column":30},"end":{"line":325,"column":50}}},"33":{"name":"(anonymous_33)","line":335,"loc":{"start":{"line":335,"column":36},"end":{"line":335,"column":59}}},"34":{"name":"(anonymous_34)","line":347,"loc":{"start":{"line":347,"column":29},"end":{"line":347,"column":52}}},"35":{"name":"(anonymous_35)","line":357,"loc":{"start":{"line":357,"column":34},"end":{"line":357,"column":62}}},"36":{"name":"(anonymous_36)","line":371,"loc":{"start":{"line":371,"column":35},"end":{"line":371,"column":52}}},"37":{"name":"(anonymous_37)","line":384,"loc":{"start":{"line":384,"column":30},"end":{"line":384,"column":47}}},"38":{"name":"(anonymous_38)","line":392,"loc":{"start":{"line":392,"column":41},"end":{"line":392,"column":68}}},"39":{"name":"(anonymous_39)","line":403,"loc":{"start":{"line":403,"column":23},"end":{"line":403,"column":54}}},"40":{"name":"(anonymous_40)","line":424,"loc":{"start":{"line":424,"column":23},"end":{"line":424,"column":45}}},"41":{"name":"(anonymous_41)","line":428,"loc":{"start":{"line":428,"column":27},"end":{"line":428,"column":44}}},"42":{"name":"(anonymous_42)","line":432,"loc":{"start":{"line":432,"column":32},"end":{"line":432,"column":48}}},"43":{"name":"(anonymous_43)","line":436,"loc":{"start":{"line":436,"column":34},"end":{"line":436,"column":67}}},"44":{"name":"(anonymous_44)","line":445,"loc":{"start":{"line":445,"column":25},"end":{"line":445,"column":42}}},"45":{"name":"(anonymous_45)","line":452,"loc":{"start":{"line":452,"column":24},"end":{"line":452,"column":53}}},"46":{"name":"(anonymous_46)","line":468,"loc":{"start":{"line":468,"column":26},"end":{"line":468,"column":57}}},"47":{"name":"(anonymous_47)","line":476,"loc":{"start":{"line":476,"column":25},"end":{"line":476,"column":48}}},"48":{"name":"(anonymous_48)","line":482,"loc":{"start":{"line":482,"column":19},"end":{"line":482,"column":35}}},"49":{"name":"(anonymous_49)","line":489,"loc":{"start":{"line":489,"column":38},"end":{"line":489,"column":55}}},"50":{"name":"(anonymous_50)","line":493,"loc":{"start":{"line":493,"column":36},"end":{"line":493,"column":59}}},"51":{"name":"(anonymous_51)","line":497,"loc":{"start":{"line":497,"column":39},"end":{"line":497,"column":62}}},"52":{"name":"(anonymous_52)","line":502,"loc":{"start":{"line":502,"column":38},"end":{"line":502,"column":66}}},"53":{"name":"(anonymous_53)","line":506,"loc":{"start":{"line":506,"column":41},"end":{"line":506,"column":69}}},"54":{"name":"getMaintainerModel","line":514,"loc":{"start":{"line":514,"column":0},"end":{"line":514,"column":35}}},"55":{"name":"(anonymous_55)","line":518,"loc":{"start":{"line":518,"column":26},"end":{"line":518,"column":43}}},"56":{"name":"(anonymous_56)","line":525,"loc":{"start":{"line":525,"column":19},"end":{"line":525,"column":35}}},"57":{"name":"(anonymous_57)","line":533,"loc":{"start":{"line":533,"column":34},"end":{"line":533,"column":51}}},"58":{"name":"(anonymous_58)","line":538,"loc":{"start":{"line":538,"column":31},"end":{"line":538,"column":48}}},"59":{"name":"(anonymous_59)","line":545,"loc":{"start":{"line":545,"column":25},"end":{"line":545,"column":59}}},"60":{"name":"(anonymous_60)","line":557,"loc":{"start":{"line":557,"column":27},"end":{"line":557,"column":43}}},"61":{"name":"(anonymous_61)","line":581,"loc":{"start":{"line":581,"column":23},"end":{"line":581,"column":50}}},"62":{"name":"(anonymous_62)","line":588,"loc":{"start":{"line":588,"column":21},"end":{"line":588,"column":38}}},"63":{"name":"(anonymous_63)","line":602,"loc":{"start":{"line":602,"column":22},"end":{"line":602,"column":62}}},"64":{"name":"(anonymous_64)","line":604,"loc":{"start":{"line":604,"column":19},"end":{"line":604,"column":38}}},"65":{"name":"(anonymous_65)","line":616,"loc":{"start":{"line":616,"column":17},"end":{"line":616,"column":43}}},"66":{"name":"add","line":671,"loc":{"start":{"line":671,"column":18},"end":{"line":671,"column":44}}},"67":{"name":"(anonymous_67)","line":689,"loc":{"start":{"line":689,"column":21},"end":{"line":689,"column":44}}},"68":{"name":"(anonymous_68)","line":698,"loc":{"start":{"line":698,"column":28},"end":{"line":698,"column":51}}},"69":{"name":"(anonymous_69)","line":704,"loc":{"start":{"line":704,"column":18},"end":{"line":704,"column":33}}},"70":{"name":"(anonymous_70)","line":709,"loc":{"start":{"line":709,"column":34},"end":{"line":709,"column":51}}},"71":{"name":"(anonymous_71)","line":715,"loc":{"start":{"line":715,"column":18},"end":{"line":715,"column":33}}},"72":{"name":"(anonymous_72)","line":721,"loc":{"start":{"line":721,"column":32},"end":{"line":721,"column":54}}},"73":{"name":"(anonymous_73)","line":725,"loc":{"start":{"line":725,"column":31},"end":{"line":725,"column":48}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":31}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":21}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":23}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":27}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":35}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":41}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":54}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":47}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":49}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":53}},"13":{"start":{"line":17,"column":0},"end":{"line":27,"column":2}},"14":{"start":{"line":18,"column":2},"end":{"line":21,"column":3}},"15":{"start":{"line":20,"column":4},"end":{"line":20,"column":50}},"16":{"start":{"line":22,"column":2},"end":{"line":22,"column":40}},"17":{"start":{"line":23,"column":2},"end":{"line":26,"column":3}},"18":{"start":{"line":25,"column":4},"end":{"line":25,"column":48}},"19":{"start":{"line":30,"column":0},"end":{"line":38,"column":1}},"20":{"start":{"line":31,"column":2},"end":{"line":37,"column":3}},"21":{"start":{"line":32,"column":4},"end":{"line":36,"column":5}},"22":{"start":{"line":33,"column":6},"end":{"line":33,"column":21}},"23":{"start":{"line":35,"column":6},"end":{"line":35,"column":111}},"24":{"start":{"line":39,"column":0},"end":{"line":39,"column":28}},"25":{"start":{"line":41,"column":0},"end":{"line":43,"column":1}},"26":{"start":{"line":42,"column":2},"end":{"line":42,"column":49}},"27":{"start":{"line":45,"column":0},"end":{"line":49,"column":2}},"28":{"start":{"line":46,"column":2},"end":{"line":46,"column":46}},"29":{"start":{"line":47,"column":2},"end":{"line":47,"column":16}},"30":{"start":{"line":48,"column":2},"end":{"line":48,"column":13}},"31":{"start":{"line":51,"column":0},"end":{"line":55,"column":2}},"32":{"start":{"line":52,"column":2},"end":{"line":52,"column":62}},"33":{"start":{"line":53,"column":2},"end":{"line":53,"column":16}},"34":{"start":{"line":54,"column":2},"end":{"line":54,"column":13}},"35":{"start":{"line":57,"column":0},"end":{"line":63,"column":2}},"36":{"start":{"line":58,"column":2},"end":{"line":58,"column":51}},"37":{"start":{"line":59,"column":2},"end":{"line":61,"column":3}},"38":{"start":{"line":60,"column":4},"end":{"line":60,"column":16}},"39":{"start":{"line":62,"column":2},"end":{"line":62,"column":57}},"40":{"start":{"line":65,"column":0},"end":{"line":82,"column":2}},"41":{"start":{"line":66,"column":2},"end":{"line":66,"column":72}},"42":{"start":{"line":67,"column":2},"end":{"line":67,"column":22}},"43":{"start":{"line":68,"column":2},"end":{"line":73,"column":5}},"44":{"start":{"line":69,"column":4},"end":{"line":69,"column":34}},"45":{"start":{"line":70,"column":4},"end":{"line":70,"column":23}},"46":{"start":{"line":72,"column":4},"end":{"line":72,"column":33}},"47":{"start":{"line":75,"column":2},"end":{"line":75,"column":54}},"48":{"start":{"line":76,"column":2},"end":{"line":78,"column":3}},"49":{"start":{"line":77,"column":4},"end":{"line":77,"column":16}},"50":{"start":{"line":80,"column":2},"end":{"line":80,"column":34}},"51":{"start":{"line":81,"column":2},"end":{"line":81,"column":41}},"52":{"start":{"line":84,"column":0},"end":{"line":86,"column":2}},"53":{"start":{"line":85,"column":2},"end":{"line":85,"column":55}},"54":{"start":{"line":90,"column":0},"end":{"line":113,"column":2}},"55":{"start":{"line":91,"column":2},"end":{"line":98,"column":5}},"56":{"start":{"line":100,"column":2},"end":{"line":102,"column":3}},"57":{"start":{"line":101,"column":4},"end":{"line":101,"column":14}},"58":{"start":{"line":104,"column":2},"end":{"line":106,"column":5}},"59":{"start":{"line":105,"column":4},"end":{"line":105,"column":25}},"60":{"start":{"line":108,"column":2},"end":{"line":112,"column":5}},"61":{"start":{"line":115,"column":0},"end":{"line":144,"column":2}},"62":{"start":{"line":116,"column":2},"end":{"line":118,"column":3}},"63":{"start":{"line":117,"column":4},"end":{"line":117,"column":14}},"64":{"start":{"line":121,"column":2},"end":{"line":126,"column":5}},"65":{"start":{"line":127,"column":2},"end":{"line":129,"column":3}},"66":{"start":{"line":128,"column":4},"end":{"line":128,"column":14}},"67":{"start":{"line":131,"column":2},"end":{"line":133,"column":5}},"68":{"start":{"line":132,"column":4},"end":{"line":132,"column":25}},"69":{"start":{"line":135,"column":2},"end":{"line":142,"column":5}},"70":{"start":{"line":143,"column":2},"end":{"line":143,"column":14}},"71":{"start":{"line":146,"column":0},"end":{"line":149,"column":2}},"72":{"start":{"line":147,"column":2},"end":{"line":147,"column":61}},"73":{"start":{"line":148,"column":2},"end":{"line":148,"column":43}},"74":{"start":{"line":151,"column":0},"end":{"line":175,"column":2}},"75":{"start":{"line":152,"column":2},"end":{"line":152,"column":72}},"76":{"start":{"line":153,"column":2},"end":{"line":153,"column":50}},"77":{"start":{"line":154,"column":2},"end":{"line":154,"column":15}},"78":{"start":{"line":155,"column":2},"end":{"line":157,"column":5}},"79":{"start":{"line":156,"column":4},"end":{"line":156,"column":18}},"80":{"start":{"line":160,"column":2},"end":{"line":160,"column":79}},"81":{"start":{"line":161,"column":2},"end":{"line":165,"column":5}},"82":{"start":{"line":162,"column":4},"end":{"line":164,"column":5}},"83":{"start":{"line":163,"column":6},"end":{"line":163,"column":23}},"84":{"start":{"line":168,"column":2},"end":{"line":168,"column":79}},"85":{"start":{"line":169,"column":2},"end":{"line":173,"column":5}},"86":{"start":{"line":170,"column":4},"end":{"line":172,"column":5}},"87":{"start":{"line":171,"column":6},"end":{"line":171,"column":23}},"88":{"start":{"line":174,"column":2},"end":{"line":174,"column":15}},"89":{"start":{"line":177,"column":0},"end":{"line":180,"column":2}},"90":{"start":{"line":178,"column":2},"end":{"line":178,"column":67}},"91":{"start":{"line":179,"column":2},"end":{"line":179,"column":43}},"92":{"start":{"line":183,"column":0},"end":{"line":205,"column":2}},"93":{"start":{"line":184,"column":2},"end":{"line":184,"column":72}},"94":{"start":{"line":185,"column":2},"end":{"line":185,"column":50}},"95":{"start":{"line":186,"column":2},"end":{"line":186,"column":15}},"96":{"start":{"line":187,"column":2},"end":{"line":195,"column":5}},"97":{"start":{"line":188,"column":4},"end":{"line":188,"column":18}},"98":{"start":{"line":190,"column":4},"end":{"line":190,"column":34}},"99":{"start":{"line":191,"column":4},"end":{"line":193,"column":5}},"100":{"start":{"line":192,"column":6},"end":{"line":192,"column":20}},"101":{"start":{"line":194,"column":4},"end":{"line":194,"column":19}},"102":{"start":{"line":198,"column":2},"end":{"line":198,"column":79}},"103":{"start":{"line":199,"column":2},"end":{"line":203,"column":5}},"104":{"start":{"line":200,"column":4},"end":{"line":202,"column":5}},"105":{"start":{"line":201,"column":6},"end":{"line":201,"column":23}},"106":{"start":{"line":204,"column":2},"end":{"line":204,"column":15}},"107":{"start":{"line":208,"column":0},"end":{"line":225,"column":2}},"108":{"start":{"line":209,"column":2},"end":{"line":211,"column":3}},"109":{"start":{"line":210,"column":4},"end":{"line":210,"column":36}},"110":{"start":{"line":212,"column":2},"end":{"line":219,"column":5}},"111":{"start":{"line":220,"column":2},"end":{"line":220,"column":17}},"112":{"start":{"line":221,"column":2},"end":{"line":223,"column":3}},"113":{"start":{"line":222,"column":4},"end":{"line":222,"column":28}},"114":{"start":{"line":224,"column":2},"end":{"line":224,"column":28}},"115":{"start":{"line":227,"column":0},"end":{"line":235,"column":2}},"116":{"start":{"line":228,"column":2},"end":{"line":228,"column":67}},"117":{"start":{"line":229,"column":2},"end":{"line":229,"column":37}},"118":{"start":{"line":230,"column":2},"end":{"line":234,"column":5}},"119":{"start":{"line":231,"column":4},"end":{"line":231,"column":46}},"120":{"start":{"line":233,"column":4},"end":{"line":233,"column":20}},"121":{"start":{"line":237,"column":0},"end":{"line":250,"column":2}},"122":{"start":{"line":238,"column":2},"end":{"line":244,"column":5}},"123":{"start":{"line":246,"column":2},"end":{"line":248,"column":3}},"124":{"start":{"line":247,"column":4},"end":{"line":247,"column":18}},"125":{"start":{"line":249,"column":2},"end":{"line":249,"column":14}},"126":{"start":{"line":252,"column":0},"end":{"line":263,"column":2}},"127":{"start":{"line":253,"column":2},"end":{"line":261,"column":5}},"128":{"start":{"line":262,"column":2},"end":{"line":262,"column":41}},"129":{"start":{"line":266,"column":0},"end":{"line":323,"column":2}},"130":{"start":{"line":267,"column":2},"end":{"line":267,"column":38}},"131":{"start":{"line":268,"column":2},"end":{"line":270,"column":3}},"132":{"start":{"line":269,"column":4},"end":{"line":269,"column":26}},"133":{"start":{"line":271,"column":2},"end":{"line":271,"column":42}},"134":{"start":{"line":272,"column":2},"end":{"line":272,"column":65}},"135":{"start":{"line":273,"column":2},"end":{"line":273,"column":36}},"136":{"start":{"line":277,"column":2},"end":{"line":277,"column":52}},"137":{"start":{"line":278,"column":2},"end":{"line":278,"column":71}},"138":{"start":{"line":279,"column":2},"end":{"line":284,"column":3}},"139":{"start":{"line":280,"column":4},"end":{"line":283,"column":7}},"140":{"start":{"line":285,"column":2},"end":{"line":285,"column":35}},"141":{"start":{"line":287,"column":2},"end":{"line":287,"column":27}},"142":{"start":{"line":288,"column":2},"end":{"line":288,"column":21}},"143":{"start":{"line":289,"column":2},"end":{"line":289,"column":35}},"144":{"start":{"line":290,"column":2},"end":{"line":290,"column":33}},"145":{"start":{"line":291,"column":2},"end":{"line":291,"column":29}},"146":{"start":{"line":292,"column":2},"end":{"line":292,"column":33}},"147":{"start":{"line":294,"column":2},"end":{"line":296,"column":3}},"148":{"start":{"line":295,"column":4},"end":{"line":295,"column":29}},"149":{"start":{"line":297,"column":2},"end":{"line":300,"column":4}},"150":{"start":{"line":302,"column":2},"end":{"line":304,"column":3}},"151":{"start":{"line":303,"column":4},"end":{"line":303,"column":18}},"152":{"start":{"line":306,"column":2},"end":{"line":306,"column":17}},"153":{"start":{"line":307,"column":2},"end":{"line":315,"column":3}},"154":{"start":{"line":308,"column":4},"end":{"line":308,"column":24}},"155":{"start":{"line":309,"column":4},"end":{"line":314,"column":5}},"156":{"start":{"line":310,"column":6},"end":{"line":310,"column":19}},"157":{"start":{"line":311,"column":6},"end":{"line":313,"column":7}},"158":{"start":{"line":312,"column":8},"end":{"line":312,"column":22}},"159":{"start":{"line":317,"column":2},"end":{"line":320,"column":3}},"160":{"start":{"line":319,"column":4},"end":{"line":319,"column":61}},"161":{"start":{"line":322,"column":2},"end":{"line":322,"column":16}},"162":{"start":{"line":325,"column":0},"end":{"line":333,"column":2}},"163":{"start":{"line":326,"column":2},"end":{"line":326,"column":46}},"164":{"start":{"line":327,"column":2},"end":{"line":330,"column":3}},"165":{"start":{"line":329,"column":4},"end":{"line":329,"column":16}},"166":{"start":{"line":331,"column":2},"end":{"line":331,"column":38}},"167":{"start":{"line":332,"column":2},"end":{"line":332,"column":37}},"168":{"start":{"line":335,"column":0},"end":{"line":345,"column":2}},"169":{"start":{"line":336,"column":2},"end":{"line":336,"column":44}},"170":{"start":{"line":337,"column":2},"end":{"line":339,"column":3}},"171":{"start":{"line":338,"column":4},"end":{"line":338,"column":16}},"172":{"start":{"line":340,"column":2},"end":{"line":340,"column":30}},"173":{"start":{"line":341,"column":2},"end":{"line":343,"column":3}},"174":{"start":{"line":342,"column":4},"end":{"line":342,"column":23}},"175":{"start":{"line":344,"column":2},"end":{"line":344,"column":52}},"176":{"start":{"line":347,"column":0},"end":{"line":355,"column":2}},"177":{"start":{"line":348,"column":2},"end":{"line":348,"column":45}},"178":{"start":{"line":349,"column":2},"end":{"line":351,"column":3}},"179":{"start":{"line":350,"column":4},"end":{"line":350,"column":16}},"180":{"start":{"line":352,"column":2},"end":{"line":352,"column":30}},"181":{"start":{"line":353,"column":2},"end":{"line":353,"column":22}},"182":{"start":{"line":354,"column":2},"end":{"line":354,"column":53}},"183":{"start":{"line":357,"column":0},"end":{"line":369,"column":2}},"184":{"start":{"line":358,"column":2},"end":{"line":358,"column":45}},"185":{"start":{"line":359,"column":2},"end":{"line":361,"column":3}},"186":{"start":{"line":360,"column":4},"end":{"line":360,"column":16}},"187":{"start":{"line":362,"column":2},"end":{"line":362,"column":32}},"188":{"start":{"line":364,"column":2},"end":{"line":364,"column":30}},"189":{"start":{"line":365,"column":2},"end":{"line":365,"column":32}},"190":{"start":{"line":366,"column":2},"end":{"line":366,"column":38}},"191":{"start":{"line":368,"column":2},"end":{"line":368,"column":52}},"192":{"start":{"line":371,"column":0},"end":{"line":382,"column":2}},"193":{"start":{"line":372,"column":2},"end":{"line":375,"column":5}},"194":{"start":{"line":376,"column":2},"end":{"line":378,"column":3}},"195":{"start":{"line":377,"column":4},"end":{"line":377,"column":16}},"196":{"start":{"line":380,"column":2},"end":{"line":380,"column":47}},"197":{"start":{"line":381,"column":2},"end":{"line":381,"column":26}},"198":{"start":{"line":384,"column":0},"end":{"line":390,"column":2}},"199":{"start":{"line":385,"column":2},"end":{"line":389,"column":5}},"200":{"start":{"line":392,"column":0},"end":{"line":399,"column":2}},"201":{"start":{"line":393,"column":2},"end":{"line":398,"column":5}},"202":{"start":{"line":403,"column":0},"end":{"line":422,"column":2}},"203":{"start":{"line":404,"column":2},"end":{"line":404,"column":52}},"204":{"start":{"line":405,"column":2},"end":{"line":407,"column":3}},"205":{"start":{"line":406,"column":4},"end":{"line":406,"column":16}},"206":{"start":{"line":409,"column":2},"end":{"line":409,"column":51}},"207":{"start":{"line":410,"column":2},"end":{"line":415,"column":3}},"208":{"start":{"line":411,"column":4},"end":{"line":414,"column":7}},"209":{"start":{"line":416,"column":2},"end":{"line":416,"column":25}},"210":{"start":{"line":417,"column":2},"end":{"line":417,"column":24}},"211":{"start":{"line":418,"column":2},"end":{"line":420,"column":3}},"212":{"start":{"line":419,"column":4},"end":{"line":419,"column":28}},"213":{"start":{"line":421,"column":2},"end":{"line":421,"column":13}},"214":{"start":{"line":424,"column":0},"end":{"line":426,"column":2}},"215":{"start":{"line":425,"column":2},"end":{"line":425,"column":47}},"216":{"start":{"line":428,"column":0},"end":{"line":430,"column":2}},"217":{"start":{"line":429,"column":2},"end":{"line":429,"column":50}},"218":{"start":{"line":432,"column":0},"end":{"line":434,"column":2}},"219":{"start":{"line":433,"column":2},"end":{"line":433,"column":47}},"220":{"start":{"line":436,"column":0},"end":{"line":443,"column":2}},"221":{"start":{"line":437,"column":2},"end":{"line":442,"column":5}},"222":{"start":{"line":445,"column":0},"end":{"line":447,"column":2}},"223":{"start":{"line":446,"column":2},"end":{"line":446,"column":54}},"224":{"start":{"line":452,"column":0},"end":{"line":466,"column":2}},"225":{"start":{"line":453,"column":2},"end":{"line":458,"column":5}},"226":{"start":{"line":459,"column":2},"end":{"line":461,"column":3}},"227":{"start":{"line":460,"column":4},"end":{"line":460,"column":15}},"228":{"start":{"line":462,"column":2},"end":{"line":465,"column":12}},"229":{"start":{"line":468,"column":0},"end":{"line":474,"column":2}},"230":{"start":{"line":469,"column":2},"end":{"line":469,"column":17}},"231":{"start":{"line":470,"column":2},"end":{"line":472,"column":3}},"232":{"start":{"line":471,"column":4},"end":{"line":471,"column":61}},"233":{"start":{"line":473,"column":2},"end":{"line":473,"column":21}},"234":{"start":{"line":476,"column":0},"end":{"line":485,"column":2}},"235":{"start":{"line":477,"column":2},"end":{"line":481,"column":5}},"236":{"start":{"line":482,"column":2},"end":{"line":484,"column":5}},"237":{"start":{"line":483,"column":4},"end":{"line":483,"column":26}},"238":{"start":{"line":489,"column":0},"end":{"line":491,"column":2}},"239":{"start":{"line":490,"column":2},"end":{"line":490,"column":58}},"240":{"start":{"line":493,"column":0},"end":{"line":495,"column":2}},"241":{"start":{"line":494,"column":2},"end":{"line":494,"column":62}},"242":{"start":{"line":497,"column":0},"end":{"line":499,"column":2}},"243":{"start":{"line":498,"column":2},"end":{"line":498,"column":66}},"244":{"start":{"line":502,"column":0},"end":{"line":504,"column":2}},"245":{"start":{"line":503,"column":2},"end":{"line":503,"column":72}},"246":{"start":{"line":506,"column":0},"end":{"line":512,"column":2}},"247":{"start":{"line":507,"column":2},"end":{"line":507,"column":81}},"248":{"start":{"line":508,"column":2},"end":{"line":510,"column":3}},"249":{"start":{"line":509,"column":4},"end":{"line":509,"column":50}},"250":{"start":{"line":511,"column":2},"end":{"line":511,"column":16}},"251":{"start":{"line":514,"column":0},"end":{"line":516,"column":1}},"252":{"start":{"line":515,"column":2},"end":{"line":515,"column":87}},"253":{"start":{"line":518,"column":0},"end":{"line":531,"column":2}},"254":{"start":{"line":519,"column":2},"end":{"line":519,"column":44}},"255":{"start":{"line":520,"column":2},"end":{"line":520,"column":51}},"256":{"start":{"line":521,"column":2},"end":{"line":523,"column":3}},"257":{"start":{"line":522,"column":4},"end":{"line":522,"column":21}},"258":{"start":{"line":524,"column":2},"end":{"line":524,"column":49}},"259":{"start":{"line":525,"column":2},"end":{"line":530,"column":5}},"260":{"start":{"line":526,"column":4},"end":{"line":529,"column":6}},"261":{"start":{"line":533,"column":0},"end":{"line":536,"column":2}},"262":{"start":{"line":534,"column":2},"end":{"line":534,"column":44}},"263":{"start":{"line":535,"column":2},"end":{"line":535,"column":42}},"264":{"start":{"line":538,"column":0},"end":{"line":543,"column":2}},"265":{"start":{"line":539,"column":2},"end":{"line":542,"column":4}},"266":{"start":{"line":545,"column":0},"end":{"line":579,"column":2}},"267":{"start":{"line":546,"column":2},"end":{"line":546,"column":51}},"268":{"start":{"line":547,"column":2},"end":{"line":550,"column":4}},"269":{"start":{"line":551,"column":2},"end":{"line":551,"column":26}},"270":{"start":{"line":552,"column":2},"end":{"line":552,"column":24}},"271":{"start":{"line":553,"column":2},"end":{"line":561,"column":3}},"272":{"start":{"line":555,"column":4},"end":{"line":555,"column":77}},"273":{"start":{"line":556,"column":4},"end":{"line":560,"column":5}},"274":{"start":{"line":557,"column":6},"end":{"line":559,"column":9}},"275":{"start":{"line":558,"column":8},"end":{"line":558,"column":25}},"276":{"start":{"line":563,"column":2},"end":{"line":563,"column":27}},"277":{"start":{"line":564,"column":2},"end":{"line":573,"column":3}},"278":{"start":{"line":567,"column":4},"end":{"line":567,"column":25}},"279":{"start":{"line":568,"column":9},"end":{"line":573,"column":3}},"280":{"start":{"line":570,"column":4},"end":{"line":570,"column":24}},"281":{"start":{"line":571,"column":9},"end":{"line":573,"column":3}},"282":{"start":{"line":572,"column":4},"end":{"line":572,"column":24}},"283":{"start":{"line":575,"column":2},"end":{"line":578,"column":4}},"284":{"start":{"line":581,"column":0},"end":{"line":584,"column":2}},"285":{"start":{"line":582,"column":2},"end":{"line":582,"column":61}},"286":{"start":{"line":583,"column":2},"end":{"line":583,"column":29}},"287":{"start":{"line":588,"column":0},"end":{"line":600,"column":2}},"288":{"start":{"line":589,"column":2},"end":{"line":589,"column":79}},"289":{"start":{"line":590,"column":2},"end":{"line":592,"column":3}},"290":{"start":{"line":591,"column":4},"end":{"line":591,"column":37}},"291":{"start":{"line":593,"column":2},"end":{"line":593,"column":38}},"292":{"start":{"line":594,"column":2},"end":{"line":598,"column":3}},"293":{"start":{"line":597,"column":4},"end":{"line":597,"column":29}},"294":{"start":{"line":599,"column":2},"end":{"line":599,"column":14}},"295":{"start":{"line":602,"column":0},"end":{"line":612,"column":2}},"296":{"start":{"line":603,"column":2},"end":{"line":603,"column":17}},"297":{"start":{"line":604,"column":2},"end":{"line":610,"column":5}},"298":{"start":{"line":605,"column":4},"end":{"line":609,"column":8}},"299":{"start":{"line":611,"column":2},"end":{"line":611,"column":21}},"300":{"start":{"line":616,"column":0},"end":{"line":667,"column":2}},"301":{"start":{"line":617,"column":2},"end":{"line":617,"column":26}},"302":{"start":{"line":618,"column":2},"end":{"line":618,"column":35}},"303":{"start":{"line":619,"column":2},"end":{"line":619,"column":32}},"304":{"start":{"line":625,"column":2},"end":{"line":625,"column":15}},"305":{"start":{"line":627,"column":2},"end":{"line":628,"column":28}},"306":{"start":{"line":629,"column":2},"end":{"line":629,"column":60}},"307":{"start":{"line":630,"column":2},"end":{"line":632,"column":3}},"308":{"start":{"line":631,"column":4},"end":{"line":631,"column":31}},"309":{"start":{"line":634,"column":2},"end":{"line":639,"column":3}},"310":{"start":{"line":635,"column":4},"end":{"line":635,"column":65}},"311":{"start":{"line":636,"column":4},"end":{"line":638,"column":5}},"312":{"start":{"line":637,"column":6},"end":{"line":637,"column":33}},"313":{"start":{"line":641,"column":2},"end":{"line":648,"column":5}},"314":{"start":{"line":650,"column":2},"end":{"line":653,"column":4}},"315":{"start":{"line":655,"column":2},"end":{"line":655,"column":25}},"316":{"start":{"line":656,"column":2},"end":{"line":664,"column":3}},"317":{"start":{"line":657,"column":4},"end":{"line":663,"column":7}},"318":{"start":{"line":666,"column":2},"end":{"line":666,"column":14}},"319":{"start":{"line":671,"column":0},"end":{"line":687,"column":2}},"320":{"start":{"line":672,"column":2},"end":{"line":677,"column":5}},"321":{"start":{"line":678,"column":2},"end":{"line":680,"column":3}},"322":{"start":{"line":679,"column":4},"end":{"line":679,"column":15}},"323":{"start":{"line":682,"column":2},"end":{"line":685,"column":5}},"324":{"start":{"line":686,"column":2},"end":{"line":686,"column":26}},"325":{"start":{"line":689,"column":0},"end":{"line":696,"column":2}},"326":{"start":{"line":690,"column":2},"end":{"line":695,"column":5}},"327":{"start":{"line":698,"column":0},"end":{"line":707,"column":2}},"328":{"start":{"line":699,"column":2},"end":{"line":703,"column":5}},"329":{"start":{"line":704,"column":2},"end":{"line":706,"column":5}},"330":{"start":{"line":705,"column":4},"end":{"line":705,"column":20}},"331":{"start":{"line":709,"column":0},"end":{"line":718,"column":2}},"332":{"start":{"line":710,"column":2},"end":{"line":714,"column":5}},"333":{"start":{"line":715,"column":2},"end":{"line":717,"column":5}},"334":{"start":{"line":716,"column":4},"end":{"line":716,"column":20}},"335":{"start":{"line":721,"column":0},"end":{"line":723,"column":2}},"336":{"start":{"line":722,"column":2},"end":{"line":722,"column":50}},"337":{"start":{"line":725,"column":0},"end":{"line":727,"column":2}},"338":{"start":{"line":726,"column":2},"end":{"line":726,"column":51}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":2}},{"start":{"line":18,"column":2},"end":{"line":18,"column":2}}]},"2":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":2},"end":{"line":31,"column":2}},{"start":{"line":31,"column":2},"end":{"line":31,"column":2}}]},"4":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":6},"end":{"line":31,"column":9}},{"start":{"line":31,"column":13},"end":{"line":31,"column":24}}]},"5":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":2},"end":{"line":59,"column":2}},{"start":{"line":59,"column":2},"end":{"line":59,"column":2}}]},"6":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]},"7":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":2},"end":{"line":100,"column":2}},{"start":{"line":100,"column":2},"end":{"line":100,"column":2}}]},"8":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":2},"end":{"line":116,"column":2}},{"start":{"line":116,"column":2},"end":{"line":116,"column":2}}]},"9":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":2},"end":{"line":127,"column":2}},{"start":{"line":127,"column":2},"end":{"line":127,"column":2}}]},"10":{"line":162,"type":"if","locations":[{"start":{"line":162,"column":4},"end":{"line":162,"column":4}},{"start":{"line":162,"column":4},"end":{"line":162,"column":4}}]},"11":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":4},"end":{"line":170,"column":4}},{"start":{"line":170,"column":4},"end":{"line":170,"column":4}}]},"12":{"line":191,"type":"if","locations":[{"start":{"line":191,"column":4},"end":{"line":191,"column":4}},{"start":{"line":191,"column":4},"end":{"line":191,"column":4}}]},"13":{"line":200,"type":"if","locations":[{"start":{"line":200,"column":4},"end":{"line":200,"column":4}},{"start":{"line":200,"column":4},"end":{"line":200,"column":4}}]},"14":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":2},"end":{"line":209,"column":2}},{"start":{"line":209,"column":2},"end":{"line":209,"column":2}}]},"15":{"line":262,"type":"binary-expr","locations":[{"start":{"line":262,"column":9},"end":{"line":262,"column":12}},{"start":{"line":262,"column":16},"end":{"line":262,"column":32}},{"start":{"line":262,"column":36},"end":{"line":262,"column":40}}]},"16":{"line":268,"type":"if","locations":[{"start":{"line":268,"column":2},"end":{"line":268,"column":2}},{"start":{"line":268,"column":2},"end":{"line":268,"column":2}}]},"17":{"line":272,"type":"binary-expr","locations":[{"start":{"line":272,"column":20},"end":{"line":272,"column":31}},{"start":{"line":272,"column":35},"end":{"line":272,"column":58}},{"start":{"line":272,"column":62},"end":{"line":272,"column":64}}]},"18":{"line":273,"type":"binary-expr","locations":[{"start":{"line":273,"column":13},"end":{"line":273,"column":29}},{"start":{"line":273,"column":33},"end":{"line":273,"column":35}}]},"19":{"line":277,"type":"binary-expr","locations":[{"start":{"line":277,"column":21},"end":{"line":277,"column":37}},{"start":{"line":277,"column":41},"end":{"line":277,"column":51}}]},"20":{"line":279,"type":"if","locations":[{"start":{"line":279,"column":2},"end":{"line":279,"column":2}},{"start":{"line":279,"column":2},"end":{"line":279,"column":2}}]},"21":{"line":294,"type":"if","locations":[{"start":{"line":294,"column":2},"end":{"line":294,"column":2}},{"start":{"line":294,"column":2},"end":{"line":294,"column":2}}]},"22":{"line":302,"type":"if","locations":[{"start":{"line":302,"column":2},"end":{"line":302,"column":2}},{"start":{"line":302,"column":2},"end":{"line":302,"column":2}}]},"23":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":4},"end":{"line":309,"column":4}},{"start":{"line":309,"column":4},"end":{"line":309,"column":4}}]},"24":{"line":311,"type":"if","locations":[{"start":{"line":311,"column":6},"end":{"line":311,"column":6}},{"start":{"line":311,"column":6},"end":{"line":311,"column":6}}]},"25":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":2},"end":{"line":317,"column":2}},{"start":{"line":317,"column":2},"end":{"line":317,"column":2}}]},"26":{"line":327,"type":"if","locations":[{"start":{"line":327,"column":2},"end":{"line":327,"column":2}},{"start":{"line":327,"column":2},"end":{"line":327,"column":2}}]},"27":{"line":337,"type":"if","locations":[{"start":{"line":337,"column":2},"end":{"line":337,"column":2}},{"start":{"line":337,"column":2},"end":{"line":337,"column":2}}]},"28":{"line":340,"type":"binary-expr","locations":[{"start":{"line":340,"column":12},"end":{"line":340,"column":23}},{"start":{"line":340,"column":27},"end":{"line":340,"column":29}}]},"29":{"line":349,"type":"if","locations":[{"start":{"line":349,"column":2},"end":{"line":349,"column":2}},{"start":{"line":349,"column":2},"end":{"line":349,"column":2}}]},"30":{"line":352,"type":"binary-expr","locations":[{"start":{"line":352,"column":12},"end":{"line":352,"column":23}},{"start":{"line":352,"column":27},"end":{"line":352,"column":29}}]},"31":{"line":359,"type":"if","locations":[{"start":{"line":359,"column":2},"end":{"line":359,"column":2}},{"start":{"line":359,"column":2},"end":{"line":359,"column":2}}]},"32":{"line":364,"type":"binary-expr","locations":[{"start":{"line":364,"column":12},"end":{"line":364,"column":23}},{"start":{"line":364,"column":27},"end":{"line":364,"column":29}}]},"33":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":2},"end":{"line":376,"column":2}},{"start":{"line":376,"column":2},"end":{"line":376,"column":2}}]},"34":{"line":405,"type":"if","locations":[{"start":{"line":405,"column":2},"end":{"line":405,"column":2}},{"start":{"line":405,"column":2},"end":{"line":405,"column":2}}]},"35":{"line":410,"type":"if","locations":[{"start":{"line":410,"column":2},"end":{"line":410,"column":2}},{"start":{"line":410,"column":2},"end":{"line":410,"column":2}}]},"36":{"line":418,"type":"if","locations":[{"start":{"line":418,"column":2},"end":{"line":418,"column":2}},{"start":{"line":418,"column":2},"end":{"line":418,"column":2}}]},"37":{"line":459,"type":"if","locations":[{"start":{"line":459,"column":2},"end":{"line":459,"column":2}},{"start":{"line":459,"column":2},"end":{"line":459,"column":2}}]},"38":{"line":508,"type":"if","locations":[{"start":{"line":508,"column":2},"end":{"line":508,"column":2}},{"start":{"line":508,"column":2},"end":{"line":508,"column":2}}]},"39":{"line":508,"type":"binary-expr","locations":[{"start":{"line":508,"column":6},"end":{"line":508,"column":27}},{"start":{"line":508,"column":31},"end":{"line":508,"column":55}}]},"40":{"line":515,"type":"cond-expr","locations":[{"start":{"line":515,"column":41},"end":{"line":515,"column":64}},{"start":{"line":515,"column":67},"end":{"line":515,"column":86}}]},"41":{"line":521,"type":"if","locations":[{"start":{"line":521,"column":2},"end":{"line":521,"column":2}},{"start":{"line":521,"column":2},"end":{"line":521,"column":2}}]},"42":{"line":553,"type":"if","locations":[{"start":{"line":553,"column":2},"end":{"line":553,"column":2}},{"start":{"line":553,"column":2},"end":{"line":553,"column":2}}]},"43":{"line":555,"type":"binary-expr","locations":[{"start":{"line":555,"column":13},"end":{"line":555,"column":22}},{"start":{"line":555,"column":26},"end":{"line":555,"column":43}},{"start":{"line":555,"column":47},"end":{"line":555,"column":76}}]},"44":{"line":556,"type":"if","locations":[{"start":{"line":556,"column":4},"end":{"line":556,"column":4}},{"start":{"line":556,"column":4},"end":{"line":556,"column":4}}]},"45":{"line":556,"type":"binary-expr","locations":[{"start":{"line":556,"column":8},"end":{"line":556,"column":10}},{"start":{"line":556,"column":14},"end":{"line":556,"column":27}}]},"46":{"line":564,"type":"if","locations":[{"start":{"line":564,"column":2},"end":{"line":564,"column":2}},{"start":{"line":564,"column":2},"end":{"line":564,"column":2}}]},"47":{"line":564,"type":"binary-expr","locations":[{"start":{"line":564,"column":6},"end":{"line":564,"column":15}},{"start":{"line":564,"column":19},"end":{"line":564,"column":54}}]},"48":{"line":568,"type":"if","locations":[{"start":{"line":568,"column":9},"end":{"line":568,"column":9}},{"start":{"line":568,"column":9},"end":{"line":568,"column":9}}]},"49":{"line":571,"type":"if","locations":[{"start":{"line":571,"column":9},"end":{"line":571,"column":9}},{"start":{"line":571,"column":9},"end":{"line":571,"column":9}}]},"50":{"line":590,"type":"if","locations":[{"start":{"line":590,"column":2},"end":{"line":590,"column":2}},{"start":{"line":590,"column":2},"end":{"line":590,"column":2}}]},"51":{"line":594,"type":"if","locations":[{"start":{"line":594,"column":2},"end":{"line":594,"column":2}},{"start":{"line":594,"column":2},"end":{"line":594,"column":2}}]},"52":{"line":617,"type":"binary-expr","locations":[{"start":{"line":617,"column":12},"end":{"line":617,"column":19}},{"start":{"line":617,"column":23},"end":{"line":617,"column":25}}]},"53":{"line":618,"type":"binary-expr","locations":[{"start":{"line":618,"column":14},"end":{"line":618,"column":27}},{"start":{"line":618,"column":31},"end":{"line":618,"column":34}}]},"54":{"line":634,"type":"if","locations":[{"start":{"line":634,"column":2},"end":{"line":634,"column":2}},{"start":{"line":634,"column":2},"end":{"line":634,"column":2}}]},"55":{"line":656,"type":"if","locations":[{"start":{"line":656,"column":2},"end":{"line":656,"column":2}},{"start":{"line":656,"column":2},"end":{"line":656,"column":2}}]},"56":{"line":678,"type":"if","locations":[{"start":{"line":678,"column":2},"end":{"line":678,"column":2}},{"start":{"line":678,"column":2},"end":{"line":678,"column":2}}]}},"code":["'use strict';","","var semver = require('semver');","var models = require('../models');","var common = require('./common');","var Tag = models.Tag;","var User = models.User;","var Module = models.Module;","var ModuleStar = models.ModuleStar;","var ModuleKeyword = models.ModuleKeyword;","var PrivateModuleMaintainer = models.ModuleMaintainer;","var ModuleDependency = models.ModuleDependency;","var ModuleUnpublished = models.ModuleUnpublished;","var NpmModuleMaintainer = models.NpmModuleMaintainer;","","// module","var _parseRow = function (row) {","  if (row.package.indexOf('%7B%22') === 0) {","    // now store package will encodeURIComponent() after JSON.stringify","    row.package = decodeURIComponent(row.package);","  }","  row.package = JSON.parse(row.package);","  if (typeof row.publish_time === 'string') {","    // pg bigint is string","    row.publish_time = Number(row.publish_time);","  }","};","","// module:read","function parseRow(row) {","  if (row && row.package) {","    try {","      _parseRow(row);","    } catch (e) {","      console.warn('parse package error: %s, id: %s version: %s, error: %s', row.name, row.id, row.version, e);","    }","  }","}","exports.parseRow = parseRow;","","function stringifyPackage(pkg) {","  return encodeURIComponent(JSON.stringify(pkg));","}","","exports.getModuleById = function* (id) {","  var row = yield Module.findById(Number(id));","  parseRow(row);","  return row;","};","","exports.getModule = function* (name, version) {","  var row = yield* Module.findByNameAndVersion(name, version);","  parseRow(row);","  return row;","};","","exports.getModuleByTag = function* (name, tag) {","  var tag = yield* Tag.findByNameAndTag(name, tag);","  if (!tag) {","    return null;","  }","  return yield* exports.getModule(tag.name, tag.version);","};","","exports.getModuleByRange = function* (name, range) {","  var rows = yield exports.listModulesByName(name, [ 'id', 'version' ]);","  var versionMap = {};","  var versions = rows.map(function(row) {","    versionMap[row.version] = row;","    return row.version;","  }).filter(function(version) {","    return semver.valid(version);","  });","","  var version = semver.maxSatisfying(versions, range);","  if (!versionMap[version]) {","    return null;","  }","","  var id = versionMap[version].id;","  return yield exports.getModuleById(id);","};","","exports.getLatestModule = function* (name) {","  return yield* exports.getModuleByTag(name, 'latest');","};","","// module:list","","exports.listPrivateModulesByScope = function* (scope) {","  var tags = yield Tag.findAll({","    where: {","      tag: 'latest',","      name: {","        like: scope + '/%'","      }","    }","  });","","  if (tags.length === 0) {","    return [];","  }","","  var ids = tags.map(function (tag) {","    return tag.module_id;","  });","","  return yield Module.findAll({","    where: {","      id: ids","    }","  });","};","","exports.listModules = function* (names) {","  if (names.length === 0) {","    return [];","  }","","  // fetch latest module tags","  var tags = yield Tag.findAll({","    where: {","      name: names,","      tag: 'latest'","    }","  });","  if (tags.length === 0) {","    return [];","  }","","  var ids = tags.map(function (tag) {","    return tag.module_id;","  });","","  var rows = yield Module.findAll({","    where: {","      id: ids","    },","    attributes: [","      'name', 'description', 'version',","    ]","  });","  return rows;","};","","exports.listModulesByUser = function* (username) {","  var names = yield* exports.listModuleNamesByUser(username);","  return yield* exports.listModules(names);","};","","exports.listModuleNamesByUser = function* (username) {","  var sql = 'SELECT distinct(name) AS name FROM module WHERE author=?;';","  var rows = yield* models.query(sql, [username]);","  var map = {};","  var names = rows.map(function (r) {","    return r.name;","  });","","  // find from npm module maintainer table","  var moduleNames = yield* NpmModuleMaintainer.listModuleNamesByUser(username);","  moduleNames.forEach(function (name) {","    if (!map[name]) {","      names.push(name);","    }","  });","","  // find from private module maintainer table","  moduleNames = yield* PrivateModuleMaintainer.listModuleNamesByUser(username);","  moduleNames.forEach(function (name) {","    if (!map[name]) {","      names.push(name);","    }","  });","  return names;","};","","exports.listPublicModulesByUser = function* (username) {","  var names = yield* exports.listPublicModuleNamesByUser(username);","  return yield* exports.listModules(names);","};","","// return user all public package names","exports.listPublicModuleNamesByUser = function* (username) {","  var sql = 'SELECT distinct(name) AS name FROM module WHERE author=?;';","  var rows = yield* models.query(sql, [username]);","  var map = {};","  var names = rows.map(function (r) {","    return r.name;","  }).filter(function (name) {","    var matched = name[0] !== '@';","    if (matched) {","      map[name] = 1;","    }","    return matched;","  });","","  // find from npm module maintainer table","  var moduleNames = yield* NpmModuleMaintainer.listModuleNamesByUser(username);","  moduleNames.forEach(function (name) {","    if (!map[name]) {","      names.push(name);","    }","  });","  return names;","};","","// start must be a date or timestamp","exports.listPublicModuleNamesSince = function* listPublicModuleNamesSince(start) {","  if (!(start instanceof Date)) {","    start = new Date(Number(start));","  }","  var rows = yield Tag.findAll({","    attributes: ['name'],","    where: {","      gmt_modified: {","        gt: start","      }","    },","  });","  var names = {};","  for (var i = 0; i < rows.length; i++) {","    names[rows[i].name] = 1;","  }","  return Object.keys(names);","};","","exports.listAllPublicModuleNames = function* () {","  var sql = 'SELECT DISTINCT(name) AS name FROM tag ORDER BY name';","  var rows = yield models.query(sql);","  return rows.filter(function (row) {","    return !common.isPrivatePackage(row.name);","  }).map(function (row) {","    return row.name;","  });","};","","exports.listModulesByName = function* (moduleName, attributes) {","  var mods = yield Module.findAll({","    where: {","      name: moduleName","    },","    order: [ ['id', 'DESC'] ],","    attributes,","  });","","  for (var mod of mods) {","    parseRow(mod);","  }","  return mods;","};","","exports.getModuleLastModified = function* (name) {","  var mod = yield Module.find({","    where: {","      name: name,","    },","    order: [","      ['gmt_modified', 'DESC']","    ],","    attributes: [ 'gmt_modified' ]","  });","  return mod && mod.gmt_modified || null;","};","","// module:update","exports.saveModule = function* (mod) {","  var keywords = mod.package.keywords;","  if (typeof keywords === 'string') {","    keywords = [keywords];","  }","  var pkg = stringifyPackage(mod.package);","  var description = mod.package && mod.package.description || '';","  var dist = mod.package.dist || {};","  // dist.tarball = '';","  // dist.shasum = '';","  // dist.size = 0;","  var publish_time = mod.publish_time || Date.now();","  var item = yield* Module.findByNameAndVersion(mod.name, mod.version);","  if (!item) {","    item = Module.build({","      name: mod.name,","      version: mod.version","    });","  }","  item.publish_time = publish_time;","  // meaning first maintainer, more maintainers please check module_maintainer table","  item.author = mod.author;","  item.package = pkg;","  item.dist_tarball = dist.tarball;","  item.dist_shasum = dist.shasum;","  item.dist_size = dist.size;","  item.description = description;","","  if (item.changed()) {","    item = yield item.save();","  }","  var result = {","    id: item.id,","    gmt_modified: item.gmt_modified","  };","","  if (!Array.isArray(keywords)) {","    return result;","  }","","  var words = [];","  for (var i = 0; i < keywords.length; i++) {","    var w = keywords[i];","    if (typeof w === 'string') {","      w = w.trim();","      if (w) {","        words.push(w);","      }","    }","  }","","  if (words.length > 0) {","    // add keywords","    yield* exports.addKeywords(mod.name, description, words);","  }","","  return result;","};","","exports.updateModulePackage = function* (id, pkg) {","  var mod = yield Module.findById(Number(id));","  if (!mod) {","    // not exists","    return null;","  }","  mod.package = stringifyPackage(pkg);","  return yield mod.save(['package']);","};","","exports.updateModulePackageFields = function* (id, fields) {","  var mod = yield exports.getModuleById(id);","  if (!mod) {","    return null;","  }","  var pkg = mod.package || {};","  for (var k in fields) {","    pkg[k] = fields[k];","  }","  return yield exports.updateModulePackage(id, pkg);","};","","exports.updateModuleReadme = function* (id, readme) {","  var mod = yield* exports.getModuleById(id);","  if (!mod) {","    return null;","  }","  var pkg = mod.package || {};","  pkg.readme = readme;","  return yield* exports.updateModulePackage(id, pkg);","};","","exports.updateModuleDescription = function* (id, description) {","  var mod = yield* exports.getModuleById(id);","  if (!mod) {","    return null;","  }","  mod.description = description;","  // also need to update package.description","  var pkg = mod.package || {};","  pkg.description = description;","  mod.package = stringifyPackage(pkg);","","  return yield mod.save(['description', 'package']);","};","","exports.updateModuleLastModified = function* (name) {","  var row = yield Module.find({","    where: { name: name },","    order: [ [ 'gmt_modified', 'DESC' ] ],","  });","  if (!row) {","    return null;","  }","  // gmt_modified is readonly, we must use setDataValue","  row.setDataValue('gmt_modified', new Date());","  return yield row.save();","};","","exports.removeModulesByName = function* (name) {","  yield Module.destroy({","    where: {","      name: name","    }","  });","};","","exports.removeModulesByNameAndVersions = function* (name, versions) {","  yield Module.destroy({","    where: {","      name: name,","      version: versions","    }","  });","};","","// tags","","exports.addModuleTag = function* (name, tag, version) {","  var mod = yield* exports.getModule(name, version);","  if (!mod) {","    return null;","  }","","  var row = yield* Tag.findByNameAndTag(name, tag);","  if (!row) {","    row = Tag.build({","      name: name,","      tag: tag","    });","  }","  row.module_id = mod.id;","  row.version = version;","  if (row.changed()) {","    return yield row.save();","  }","  return row;","};","","exports.getModuleTag = function* (name, tag) {","  return yield Tag.findByNameAndTag(name, tag);","};","","exports.removeModuleTags = function* (name) {","  return yield Tag.destroy({where: {name: name}});","};","","exports.removeModuleTagsByIds = function* (ids) {","  return yield Tag.destroy({where: {id: ids}});","};","","exports.removeModuleTagsByNames = function* (moduleName, tagNames) {","  return yield Tag.destroy({","    where: {","      name: moduleName,","      tag: tagNames","    }","  });","};","","exports.listModuleTags = function* (name) {","  return yield Tag.findAll({ where: { name: name } });","};","","// dependencies","","// name => dependency","exports.addDependency = function* (name, dependency) {","  var row = yield ModuleDependency.find({","    where: {","      name: dependency,","      dependent: name","    }","  });","  if (row) {","    return row;","  }","  return yield ModuleDependency.build({","    name: dependency,","    dependent: name","  }).save();","};","","exports.addDependencies = function* (name, dependencies) {","  var tasks = [];","  for (var i = 0; i < dependencies.length; i++) {","    tasks.push(exports.addDependency(name, dependencies[i]));","  }","  return yield tasks;","};","","exports.listDependents = function* (dependency) {","  var items = yield ModuleDependency.findAll({","    where: {","      name: dependency","    }","  });","  return items.map(function (item) {","    return item.dependent;","  });","};","","// maintainers","","exports.listPublicModuleMaintainers = function* (name) {","  return yield* NpmModuleMaintainer.listMaintainers(name);","};","","exports.addPublicModuleMaintainer = function* (name, user) {","  return yield* NpmModuleMaintainer.addMaintainer(name, user);","};","","exports.removePublicModuleMaintainer = function* (name, user) {","  return yield* NpmModuleMaintainer.removeMaintainers(name, user);","};","","// only can add to cnpm maintainer table","exports.addPrivateModuleMaintainers = function* (name, usernames) {","  return yield* PrivateModuleMaintainer.addMaintainers(name, usernames);","};","","exports.updatePrivateModuleMaintainers = function* (name, usernames) {","  var result = yield* PrivateModuleMaintainer.updateMaintainers(name, usernames);","  if (result.add.length > 0 || result.remove.length > 0) {","    yield* exports.updateModuleLastModified(name);","  }","  return result;","};","","function* getMaintainerModel(name) {","  return common.isPrivatePackage(name) ? PrivateModuleMaintainer : NpmModuleMaintainer;","}","","exports.listMaintainers = function* (name) {","  var mod = yield* getMaintainerModel(name);","  var usernames = yield* mod.listMaintainers(name);","  if (usernames.length === 0) {","    return usernames;","  }","  var users = yield* User.listByNames(usernames);","  return users.map(function (user) {","    return {","      name: user.name,","      email: user.email","    };","  });","};","","exports.listMaintainerNamesOnly = function* (name) {","  var mod = yield* getMaintainerModel(name);","  return yield* mod.listMaintainers(name);","};","","exports.removeAllMaintainers = function* (name) {","  return yield [","    PrivateModuleMaintainer.removeAllMaintainers(name),","    NpmModuleMaintainer.removeAllMaintainers(name),","  ];","};","","exports.authMaintainer = function* (packageName, username) {","  var mod = yield* getMaintainerModel(packageName);","  var rs = yield [","    mod.listMaintainers(packageName),","    exports.getLatestModule(packageName)","  ];","  var maintainers = rs[0];","  var latestMod = rs[1];","  if (maintainers.length === 0) {","    // if not found maintainers, try to get from latest module package info","    var ms = latestMod && latestMod.package && latestMod.package.maintainers;","    if (ms && ms.length > 0) {","      maintainers = ms.map(function (user) {","        return user.name;","      });","    }","  }","","  var isMaintainer = false;","  if (latestMod && !latestMod.package._publish_on_cnpm) {","    // no one can update public package maintainers","    // public package only sync from source npm registry","    isMaintainer = false;","  } else if (maintainers.length === 0) {","    // no maintainers, meaning this module is free for everyone","    isMaintainer = true;","  } else if (maintainers.indexOf(username) >= 0) {","    isMaintainer = true;","  }","","  return {","    isMaintainer: isMaintainer,","    maintainers: maintainers","  };","};","","exports.isMaintainer = function* (name, username) {","  var result = yield* exports.authMaintainer(name, username);","  return result.isMaintainer;","};","","// module keywords","","exports.addKeyword = function* (data) {","  var item = yield ModuleKeyword.findByKeywordAndName(data.keyword, data.name);","  if (!item) {","    item = ModuleKeyword.build(data);","  }","  item.description = data.description;","  if (item.changed()) {","    // make sure object will change, otherwise will cause empty sql error","    // @see https://github.com/cnpm/cnpmjs.org/issues/533","    return yield item.save();","  }","  return item;","};","","exports.addKeywords = function* (name, description, keywords) {","  var tasks = [];","  keywords.forEach(function (keyword) {","    tasks.push(exports.addKeyword({","      name: name,","      keyword: keyword,","      description: description","    }));","  });","  return yield tasks;","};","","// search","","exports.search = function* (word, options) {","  options = options || {};","  var limit = options.limit || 100;","  word = word.replace(/^%/, ''); //ignore prefix %","","  // search flows:","  // 1. prefix search by name","  // 2. like search by name","  // 3. keyword equal search","  var ids = {};","","  var sql = 'SELECT module_id FROM tag WHERE LOWER(name) LIKE LOWER(?) AND tag=\\'latest\\' \\","    ORDER BY name LIMIT ?;';","  var rows = yield* models.query(sql, [word + '%', limit ]);","  for (var i = 0; i < rows.length; i++) {","    ids[rows[i].module_id] = 1;","  }","","  if (rows.length < 20) {","    rows = yield* models.query(sql, [ '%' + word + '%', limit ]);","    for (var i = 0; i < rows.length; i++) {","      ids[rows[i].module_id] = 1;","    }","  }","","  var keywordRows = yield ModuleKeyword.findAll({","    attributes: [ 'name', 'description' ],","    where: {","      keyword: word","    },","    limit: limit,","    order: [ [ 'id', 'DESC' ] ]","  });","","  var data = {","    keywordMatchs: keywordRows,","    searchMatchs: []","  };","","  ids = Object.keys(ids);","  if (ids.length > 0) {","    data.searchMatchs = yield Module.findAll({","      attributes: [ 'name', 'description' ],","      where: {","        id: ids","      },","      order: 'name'","    });","  }","","  return data;","};","","// module star","","exports.addStar = function* add(name, user) {","  var row = yield ModuleStar.find({","    where: {","      name: name,","      user: user","    }","  });","  if (row) {","    return row;","  }","","  row = ModuleStar.build({","    name: name,","    user: user","  });","  return yield row.save();","};","","exports.removeStar = function* (name, user) {","  return yield ModuleStar.destroy({","    where: {","      name: name,","      user: user","    }","  });","};","","exports.listStarUserNames = function* (moduleName) {","  var rows = yield ModuleStar.findAll({","    where: {","      name: moduleName","    }","  });","  return rows.map(function (row) {","    return row.user;","  });","};","","exports.listUserStarModuleNames = function* (user) {","  var rows = yield ModuleStar.findAll({","    where: {","      user: user","    }","  });","  return rows.map(function (row) {","    return row.name;","  });","};","","// unpublish info","exports.saveUnpublishedModule = function* (name, pkg) {","  return yield* ModuleUnpublished.save(name, pkg);","};","","exports.getUnpublishedModule = function* (name) {","  return yield* ModuleUnpublished.findByName(name);","};",""],"l":{"3":22,"4":22,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"17":0,"18":0,"20":0,"22":0,"23":0,"25":0,"30":1,"31":0,"32":0,"33":0,"35":0,"39":0,"41":1,"42":0,"45":0,"46":0,"47":0,"48":0,"51":0,"52":0,"53":0,"54":0,"57":0,"58":0,"59":0,"60":0,"62":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"72":0,"75":0,"76":0,"77":0,"80":0,"81":0,"84":0,"85":0,"90":0,"91":0,"100":0,"101":0,"104":0,"105":0,"108":0,"115":0,"116":0,"117":0,"121":0,"127":0,"128":0,"131":0,"132":0,"135":0,"143":0,"146":0,"147":0,"148":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"160":0,"161":0,"162":0,"163":0,"168":0,"169":0,"170":0,"171":0,"174":0,"177":0,"178":0,"179":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"190":0,"191":0,"192":0,"194":0,"198":0,"199":0,"200":0,"201":0,"204":0,"208":0,"209":0,"210":0,"212":0,"220":0,"221":0,"222":0,"224":0,"227":0,"228":0,"229":0,"230":0,"231":0,"233":0,"237":0,"238":0,"246":0,"247":0,"249":0,"252":0,"253":0,"262":0,"266":0,"267":0,"268":0,"269":0,"271":0,"272":0,"273":0,"277":0,"278":0,"279":0,"280":0,"285":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"294":0,"295":0,"297":0,"302":0,"303":0,"306":0,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"317":0,"319":0,"322":0,"325":0,"326":0,"327":0,"329":0,"331":0,"332":0,"335":0,"336":0,"337":0,"338":0,"340":0,"341":0,"342":0,"344":0,"347":0,"348":0,"349":0,"350":0,"352":0,"353":0,"354":0,"357":0,"358":0,"359":0,"360":0,"362":0,"364":0,"365":0,"366":0,"368":0,"371":0,"372":0,"376":0,"377":0,"380":0,"381":0,"384":0,"385":0,"392":0,"393":0,"403":0,"404":0,"405":0,"406":0,"409":0,"410":0,"411":0,"416":0,"417":0,"418":0,"419":0,"421":0,"424":0,"425":0,"428":0,"429":0,"432":0,"433":0,"436":0,"437":0,"445":0,"446":0,"452":0,"453":0,"459":0,"460":0,"462":0,"468":0,"469":0,"470":0,"471":0,"473":0,"476":0,"477":0,"482":0,"483":0,"489":0,"490":0,"493":0,"494":0,"497":0,"498":0,"502":0,"503":0,"506":0,"507":0,"508":0,"509":0,"511":0,"514":1,"515":0,"518":0,"519":0,"520":0,"521":0,"522":0,"524":0,"525":0,"526":0,"533":0,"534":0,"535":0,"538":0,"539":0,"545":0,"546":0,"547":0,"551":0,"552":0,"553":0,"555":0,"556":0,"557":0,"558":0,"563":0,"564":0,"567":0,"568":0,"570":0,"571":0,"572":0,"575":0,"581":0,"582":0,"583":0,"588":0,"589":0,"590":0,"591":0,"593":0,"594":0,"597":0,"599":0,"602":0,"603":0,"604":0,"605":0,"611":0,"616":0,"617":0,"618":0,"619":0,"625":0,"627":0,"629":0,"630":0,"631":0,"634":0,"635":0,"636":0,"637":0,"641":0,"650":0,"655":0,"656":0,"657":0,"666":0,"671":0,"672":0,"678":0,"679":0,"682":0,"686":0,"689":0,"690":0,"698":0,"699":0,"704":0,"705":0,"709":0,"710":0,"715":0,"716":0,"721":0,"722":0,"725":0,"726":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/index.js","s":{"1":50,"2":50,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"load","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":20}}},"2":{"name":"(anonymous_2)","line":38,"loc":{"start":{"line":38,"column":9},"end":{"line":38,"column":31}}},"3":{"name":"(anonymous_3)","line":46,"loc":{"start":{"line":46,"column":12},"end":{"line":46,"column":34}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":27}},"2":{"start":{"line":16,"column":0},"end":{"line":16,"column":47}},"3":{"start":{"line":18,"column":0},"end":{"line":20,"column":1}},"4":{"start":{"line":19,"column":2},"end":{"line":19,"column":54}},"5":{"start":{"line":22,"column":0},"end":{"line":50,"column":2}},"6":{"start":{"line":39,"column":4},"end":{"line":39,"column":41}},"7":{"start":{"line":40,"column":4},"end":{"line":40,"column":56}},"8":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"9":{"start":{"line":42,"column":6},"end":{"line":42,"column":21}},"10":{"start":{"line":44,"column":4},"end":{"line":44,"column":19}},"11":{"start":{"line":47,"column":4},"end":{"line":47,"column":44}},"12":{"start":{"line":48,"column":4},"end":{"line":48,"column":27}}},"branchMap":{"1":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]},"2":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":11},"end":{"line":48,"column":15}},{"start":{"line":48,"column":19},"end":{"line":48,"column":26}}]}},"code":["/**!"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var path = require('path');","var sequelize = require('../common/sequelize');","","function load(name) {","  return sequelize.import(path.join(__dirname, name));","}","","module.exports = {","  sequelize: sequelize,","  Module: load('module'),","  ModuleLog: load('module_log'),","  ModuleStar: load('module_star'),","  ModuleKeyword: load('module_keyword'),","  ModuleDependency: load('module_deps'),","  ModuleMaintainer: load('module_maintainer'),","  ModuleUnpublished: load('module_unpublished'),","  NpmModuleMaintainer: load('npm_module_maintainer'),","","  Tag: load('tag'),","  User: load('user'),","  Total: load('total'),","  DownloadTotal: load('download_total'),","","  query: function* (sql, args) {","    var options = { replacements: args };","    var data = yield this.sequelize.query(sql, options);","    if (/select /i.test(sql)) {","      return data[0];","    }","    return data[1];","  },","  queryOne: function* (sql, args) {","    var rows = yield* this.query(sql, args);","    return rows && rows[0];","  }","};",""],"l":{"15":50,"16":50,"18":1,"19":0,"22":0,"39":0,"40":0,"41":0,"42":0,"44":0,"47":0,"48":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/sequelize.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/sequelize.js","s":{"1":52,"2":52,"3":52,"4":52,"5":0,"6":0,"7":0,"8":52,"9":52,"10":52,"11":52,"12":0,"13":52,"14":52,"15":0},"b":{"1":[0,52],"2":[52,0],"3":[0,0],"4":[0,52]},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":37}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":52}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":34}},"4":{"start":{"line":21,"column":0},"end":{"line":52,"column":1}},"5":{"start":{"line":36,"column":2},"end":{"line":36,"column":135}},"6":{"start":{"line":37,"column":2},"end":{"line":37,"column":38}},"7":{"start":{"line":38,"column":2},"end":{"line":51,"column":4}},"8":{"start":{"line":54,"column":0},"end":{"line":54,"column":31}},"9":{"start":{"line":57,"column":0},"end":{"line":57,"column":27}},"10":{"start":{"line":60,"column":0},"end":{"line":60,"column":57}},"11":{"start":{"line":61,"column":0},"end":{"line":63,"column":1}},"12":{"start":{"line":62,"column":2},"end":{"line":62,"column":55}},"13":{"start":{"line":65,"column":0},"end":{"line":71,"column":2}},"14":{"start":{"line":73,"column":0},"end":{"line":73,"column":91}},"15":{"start":{"line":75,"column":0},"end":{"line":75,"column":27}}},"branchMap":{"1":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":0},"end":{"line":21,"column":0}},{"start":{"line":21,"column":0},"end":{"line":21,"column":0}}]},"2":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":23}},{"start":{"line":21,"column":27},"end":{"line":21,"column":63}}]},"3":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":22},"end":{"line":46,"column":48}},{"start":{"line":46,"column":52},"end":{"line":46,"column":54}}]},"4":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":0},"end":{"line":61,"column":0}},{"start":{"line":61,"column":0},"end":{"line":61,"column":0}}]}},"code":["/**!"," * cnpmjs.org - common/sequelize.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var Sequelize = require('sequelize');","var DataTypes = require('sequelize/lib/data-types');","var config = require('../config');","","if (config.mysqlServers && config.database.dialect === 'sqlite') {","  // https://github.com/cnpm/cnpmjs.org/wiki/Migrating-from-1.x-to-2.x","  // forward compat with old style on 1.x","  // mysqlServers: [","  //   {","  //     host: '127.0.0.1',","  //     port: 3306,","  //     user: 'root',","  //     password: ''","  //   }","  // ],","  // mysqlDatabase: 'cnpmjs_test',","  // mysqlMaxConnections: 4,","  // mysqlQueryTimeout: 5000,","","  console.warn('[WARNNING] your config.js was too old, please @see https://github.com/cnpm/cnpmjs.org/wiki/Migrating-from-1.x-to-2.x');","  var server = config.mysqlServers[0];","  config.database = {","    db: config.mysqlDatabase,","    username: server.user,","    password: server.password,","    dialect: 'mysql',","    host: server.host,","    port: server.port,","    pool: {","      maxConnections: config.mysqlMaxConnections || 10,","      minConnections: 0,","      maxIdleTime: 30000","    },","    logging: !!process.env.SQL_DEBUG,","  };","}","","var database = config.database;","","// sync database before app start, defaul is false","database.syncFirst = false;","","// add longtext for mysql","Sequelize.LONGTEXT = DataTypes.LONGTEXT = DataTypes.TEXT;","if (config.dialect === 'mysql') {","  Sequelize.LONGTEXT = DataTypes.LONGTEXT = 'LONGTEXT';","}","","database.define = {","  timestamps: true,","  createdAt: 'gmt_create',","  updatedAt: 'gmt_modified',","  charset: 'utf8',","  collate: 'utf8_general_ci',","};","","var sequelize = new Sequelize(database.db, database.username, database.password, database);","","module.exports = sequelize;",""],"l":{"17":52,"18":52,"19":52,"21":52,"36":0,"37":0,"38":0,"54":52,"57":52,"60":52,"61":52,"62":0,"65":52,"73":52,"75":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/bin/change_password.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/bin/change_password.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":3},"end":{"line":13,"column":17}}},"2":{"name":"(anonymous_2)","line":22,"loc":{"start":{"line":22,"column":9},"end":{"line":22,"column":22}}}},"statementMap":{"1":{"start":{"line":6,"column":0},"end":{"line":6,"column":42}},"2":{"start":{"line":7,"column":0},"end":{"line":7,"column":23}},"3":{"start":{"line":8,"column":0},"end":{"line":8,"column":33}},"4":{"start":{"line":10,"column":0},"end":{"line":10,"column":31}},"5":{"start":{"line":11,"column":0},"end":{"line":11,"column":34}},"6":{"start":{"line":13,"column":0},"end":{"line":24,"column":3}},"7":{"start":{"line":14,"column":2},"end":{"line":14,"column":61}},"8":{"start":{"line":15,"column":2},"end":{"line":15,"column":23}},"9":{"start":{"line":16,"column":2},"end":{"line":16,"column":66}},"10":{"start":{"line":17,"column":2},"end":{"line":17,"column":56}},"11":{"start":{"line":18,"column":2},"end":{"line":18,"column":37}},"12":{"start":{"line":19,"column":2},"end":{"line":19,"column":27}},"13":{"start":{"line":20,"column":2},"end":{"line":20,"column":95}},"14":{"start":{"line":21,"column":2},"end":{"line":21,"column":18}},"15":{"start":{"line":23,"column":2},"end":{"line":23,"column":17}}},"branchMap":{},"code":["\"use strict\";","// Only support for ./services/DefaultUserService. If you use custom user service, ignore this file.","// call with:","// $ node ./bin/change_password.js 'username' 'new_password'","","var UserModel = require('../models').User;","var co = require('co');","var utility = require('utility');","","var username = process.argv[2];","var newPassword = process.argv[3];","","co(function * () {","  var user = yield UserModel.find({where: {name: username}});","  var salt = user.salt;","  console.log(`user original password_sha: ${user.password_sha}`);","  var newPasswordSha = utility.sha1(newPassword + salt);","  user.password_sha = newPasswordSha;","  user = yield user.save();","  console.log(`change user password successful!! user new password_sha: ${user.password_sha}`);","  process.exit(0);","}).catch(function (e) {","  console.log(e);","});",""],"l":{"6":2,"7":0,"8":0,"10":0,"11":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"23":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/bin/cli.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/bin/cli.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":1,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":1,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"list","line":25,"loc":{"start":{"line":25,"column":0},"end":{"line":25,"column":19}}},"2":{"name":"start","line":50,"loc":{"start":{"line":50,"column":0},"end":{"line":50,"column":24}}},"3":{"name":"(anonymous_3)","line":72,"loc":{"start":{"line":72,"column":39},"end":{"line":72,"column":55}}},"4":{"name":"(anonymous_4)","line":86,"loc":{"start":{"line":86,"column":15},"end":{"line":86,"column":26}}},"5":{"name":"stop","line":93,"loc":{"start":{"line":93,"column":0},"end":{"line":93,"column":23}}},"6":{"name":"(anonymous_6)","line":98,"loc":{"start":{"line":98,"column":18},"end":{"line":98,"column":33}}},"7":{"name":"initDatabase","line":109,"loc":{"start":{"line":109,"column":0},"end":{"line":109,"column":32}}},"8":{"name":"(anonymous_8)","line":113,"loc":{"start":{"line":113,"column":10},"end":{"line":113,"column":22}}},"9":{"name":"(anonymous_9)","line":114,"loc":{"start":{"line":114,"column":24},"end":{"line":114,"column":39}}},"10":{"name":"(anonymous_10)","line":125,"loc":{"start":{"line":125,"column":11},"end":{"line":125,"column":26}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":47}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":35}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":23}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":31}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":35}},"7":{"start":{"line":23,"column":0},"end":{"line":23,"column":49}},"8":{"start":{"line":25,"column":0},"end":{"line":27,"column":1}},"9":{"start":{"line":26,"column":2},"end":{"line":26,"column":24}},"10":{"start":{"line":29,"column":0},"end":{"line":30,"column":20}},"11":{"start":{"line":32,"column":0},"end":{"line":39,"column":17}},"12":{"start":{"line":41,"column":0},"end":{"line":45,"column":16}},"13":{"start":{"line":47,"column":0},"end":{"line":47,"column":28}},"14":{"start":{"line":50,"column":0},"end":{"line":91,"column":1}},"15":{"start":{"line":51,"column":2},"end":{"line":51,"column":16}},"16":{"start":{"line":52,"column":2},"end":{"line":52,"column":78}},"17":{"start":{"line":53,"column":2},"end":{"line":53,"column":23}},"18":{"start":{"line":55,"column":2},"end":{"line":55,"column":53}},"19":{"start":{"line":56,"column":2},"end":{"line":56,"column":18}},"20":{"start":{"line":57,"column":2},"end":{"line":63,"column":3}},"21":{"start":{"line":58,"column":4},"end":{"line":62,"column":5}},"22":{"start":{"line":59,"column":6},"end":{"line":59,"column":35}},"23":{"start":{"line":61,"column":6},"end":{"line":61,"column":61}},"24":{"start":{"line":65,"column":2},"end":{"line":70,"column":3}},"25":{"start":{"line":66,"column":4},"end":{"line":66,"column":23}},"26":{"start":{"line":67,"column":4},"end":{"line":69,"column":5}},"27":{"start":{"line":68,"column":6},"end":{"line":68,"column":78}},"28":{"start":{"line":71,"column":2},"end":{"line":78,"column":3}},"29":{"start":{"line":72,"column":4},"end":{"line":77,"column":7}},"30":{"start":{"line":73,"column":6},"end":{"line":75,"column":7}},"31":{"start":{"line":74,"column":8},"end":{"line":74,"column":26}},"32":{"start":{"line":76,"column":6},"end":{"line":76,"column":18}},"33":{"start":{"line":80,"column":2},"end":{"line":80,"column":51}},"34":{"start":{"line":81,"column":2},"end":{"line":81,"column":43}},"35":{"start":{"line":83,"column":2},"end":{"line":83,"column":56}},"36":{"start":{"line":86,"column":2},"end":{"line":88,"column":5}},"37":{"start":{"line":87,"column":4},"end":{"line":87,"column":27}},"38":{"start":{"line":90,"column":2},"end":{"line":90,"column":64}},"39":{"start":{"line":93,"column":0},"end":{"line":107,"column":1}},"40":{"start":{"line":94,"column":2},"end":{"line":94,"column":78}},"41":{"start":{"line":95,"column":2},"end":{"line":95,"column":42}},"42":{"start":{"line":96,"column":2},"end":{"line":106,"column":3}},"43":{"start":{"line":97,"column":4},"end":{"line":97,"column":55}},"44":{"start":{"line":98,"column":4},"end":{"line":105,"column":7}},"45":{"start":{"line":99,"column":6},"end":{"line":102,"column":7}},"46":{"start":{"line":100,"column":8},"end":{"line":100,"column":25}},"47":{"start":{"line":101,"column":8},"end":{"line":101,"column":18}},"48":{"start":{"line":103,"column":6},"end":{"line":103,"column":52}},"49":{"start":{"line":104,"column":6},"end":{"line":104,"column":29}},"50":{"start":{"line":109,"column":0},"end":{"line":130,"column":1}},"51":{"start":{"line":110,"column":2},"end":{"line":110,"column":36}},"52":{"start":{"line":112,"column":2},"end":{"line":129,"column":7}},"53":{"start":{"line":114,"column":6},"end":{"line":123,"column":9}},"54":{"start":{"line":115,"column":8},"end":{"line":122,"column":9}},"55":{"start":{"line":116,"column":10},"end":{"line":116,"column":71}},"56":{"start":{"line":117,"column":10},"end":{"line":117,"column":29}},"57":{"start":{"line":118,"column":10},"end":{"line":118,"column":20}},"58":{"start":{"line":120,"column":10},"end":{"line":120,"column":90}},"59":{"start":{"line":121,"column":10},"end":{"line":121,"column":21}},"60":{"start":{"line":126,"column":6},"end":{"line":126,"column":67}},"61":{"start":{"line":127,"column":6},"end":{"line":127,"column":25}},"62":{"start":{"line":128,"column":6},"end":{"line":128,"column":16}}},"branchMap":{"1":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":16},"end":{"line":52,"column":31}},{"start":{"line":52,"column":35},"end":{"line":52,"column":77}}]},"2":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":2},"end":{"line":57,"column":2}},{"start":{"line":57,"column":2},"end":{"line":57,"column":2}}]},"3":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":65,"column":2}},{"start":{"line":65,"column":2},"end":{"line":65,"column":2}}]},"4":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":2},"end":{"line":71,"column":2}},{"start":{"line":71,"column":2},"end":{"line":71,"column":2}}]},"5":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":6},"end":{"line":73,"column":6}},{"start":{"line":73,"column":6},"end":{"line":73,"column":6}}]},"6":{"line":94,"type":"binary-expr","locations":[{"start":{"line":94,"column":16},"end":{"line":94,"column":31}},{"start":{"line":94,"column":35},"end":{"line":94,"column":77}}]},"7":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":2},"end":{"line":96,"column":2}},{"start":{"line":96,"column":2},"end":{"line":96,"column":2}}]},"8":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":6},"end":{"line":99,"column":6}},{"start":{"line":99,"column":6},"end":{"line":99,"column":6}}]},"9":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":8},"end":{"line":115,"column":8}},{"start":{"line":115,"column":8},"end":{"line":115,"column":8}}]}},"code":["//#!/usr/bin/env node","","/**!"," * Copyright(c) cnpm and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <m@fengmk2.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:cli');","var program = require('commander');","var path = require('path');","var fs = require('fs');","var mkdirp = require('mkdirp');","var treekill = require('treekill');","var version = require('../package.json').version;","","function list(val) {","  return val.split(',');","}","","program","  .version(version);","","program","  .command('start')","  .description('start cnpmjs.org server')","  .option('--admins <admins>', 'set admins', list)","  .option('--scopes <scopes>', 'set scopes', list)","  // .option('--cluster', 'enable cluster mode')","  .option('--dataDir <dataDir>', 'cnpmjs.org data dir, default is `$HOME/.cnpmjs.org`')","  .action(start);","","program","  .command('stop')","  .description('stop cnpmjs.org server')","  .option('--dataDir <dataDir>', 'cnpmjs.org data dir, default is `$HOME/.cnpmjs.org`')","  .action(stop);","","program.parse(process.argv);","","","function start(options) {","  stop(options);","  var dataDir = options.dataDir || path.join(process.env.HOME, '.cnpmjs.org');","  mkdirp.sync(dataDir);","","  var configfile = path.join(dataDir, 'config.json');","  var config = {};","  if (fs.existsSync(configfile)) {","    try {","      config = require(configfile);","    } catch (err) {","      console.warn('load old %s error: %s', configfile, err);","    }","  }","  // config.enableCluster = !!options.cluster;","  if (options.admins) {","    config.admins = {};","    for (var i = 0; i < options.admins.length; i++) {","      config.admins[options.admins[i]] = options.admins[i] + '@localhost.com';","    }","  }","  if (options.scopes) {","    config.scopes = options.scopes.map(function (name) {","      if (name[0] !== '@') {","        name = '@' + name;","      }","      return name;","    });","  }","","  var configJSON = JSON.stringify(config, null, 2);","  fs.writeFileSync(configfile, configJSON);","","  debug('save config %s to %s', configJSON, configfile);","","  // if sqlite db file not exists, init first","  initDatabase(function() {","    require('../dispatch');","  });","","  fs.writeFileSync(path.join(dataDir, 'pid'), process.pid + '');","}","","function stop(options) {","  var dataDir = options.dataDir || path.join(process.env.HOME, '.cnpmjs.org');","  var pidfile = path.join(dataDir, 'pid');","  if (fs.existsSync(pidfile)) {","    var pid = Number(fs.readFileSync(pidfile, 'utf8'));","    treekill(pid, function (err) {","      if (err) {","        console.log(err);","        throw err;","      }","      console.log('cnpmjs.org server:%d stop', pid);","      fs.unlinkSync(pidfile);","    });","  }","}","","function initDatabase(callback) {","  var models = require('../models');","","  models.sequelize.sync({ force: false })","    .then(function () {","      models.Total.init(function (err) {","        if (err) {","          console.error('[models/init_script.js] sequelize init fail');","          console.error(err);","          throw err;","        } else {","          console.log('[models/init_script.js] `sqlite` sequelize sync and init success');","          callback();","        }","      });","    })","    .catch(function (err) {","      console.error('[models/init_script.js] sequelize sync fail');","      console.error(err);","      throw err;","    });","}",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"25":1,"26":0,"29":1,"32":1,"41":1,"47":1,"50":1,"51":0,"52":0,"53":0,"55":0,"56":0,"57":0,"58":0,"59":0,"61":0,"65":0,"66":0,"67":0,"68":0,"71":0,"72":0,"73":0,"74":0,"76":0,"80":0,"81":0,"83":0,"86":0,"87":0,"90":0,"93":1,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"103":0,"104":0,"109":1,"110":0,"112":0,"114":0,"115":0,"116":0,"117":0,"118":0,"120":0,"121":0,"126":0,"127":0,"128":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/logger.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/logger.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":3,"15":1,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},"b":{"1":[1,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"errorFormater","line":30,"loc":{"start":{"line":30,"column":0},"end":{"line":30,"column":28}}},"2":{"name":"(anonymous_2)","line":36,"loc":{"start":{"line":36,"column":18},"end":{"line":36,"column":30}}},"3":{"name":"(anonymous_3)","line":47,"loc":{"start":{"line":47,"column":18},"end":{"line":47,"column":30}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":52}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":43}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":35}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":29}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":25}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":36}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":31}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":47}},"10":{"start":{"line":13,"column":0},"end":{"line":13,"column":47}},"11":{"start":{"line":15,"column":0},"end":{"line":23,"column":3}},"12":{"start":{"line":25,"column":0},"end":{"line":25,"column":14}},"13":{"start":{"line":26,"column":0},"end":{"line":28,"column":1}},"14":{"start":{"line":27,"column":2},"end":{"line":27,"column":31}},"15":{"start":{"line":30,"column":0},"end":{"line":34,"column":1}},"16":{"start":{"line":31,"column":2},"end":{"line":31,"column":33}},"17":{"start":{"line":32,"column":2},"end":{"line":32,"column":42}},"18":{"start":{"line":33,"column":2},"end":{"line":33,"column":18}},"19":{"start":{"line":36,"column":0},"end":{"line":45,"column":2}},"20":{"start":{"line":37,"column":2},"end":{"line":37,"column":40}},"21":{"start":{"line":38,"column":2},"end":{"line":40,"column":3}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":81}},"23":{"start":{"line":41,"column":2},"end":{"line":43,"column":3}},"24":{"start":{"line":42,"column":4},"end":{"line":42,"column":29}},"25":{"start":{"line":44,"column":2},"end":{"line":44,"column":39}},"26":{"start":{"line":47,"column":0},"end":{"line":56,"column":2}},"27":{"start":{"line":48,"column":2},"end":{"line":48,"column":40}},"28":{"start":{"line":49,"column":2},"end":{"line":51,"column":3}},"29":{"start":{"line":50,"column":4},"end":{"line":50,"column":81}},"30":{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},"31":{"start":{"line":53,"column":4},"end":{"line":53,"column":29}},"32":{"start":{"line":55,"column":2},"end":{"line":55,"column":45}}},"branchMap":{"1":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":10},"end":{"line":20,"column":22}},{"start":{"line":20,"column":26},"end":{"line":20,"column":33}}]},"2":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":2}},{"start":{"line":38,"column":2},"end":{"line":38,"column":2}}]},"3":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":2}},{"start":{"line":41,"column":2},"end":{"line":41,"column":2}}]},"4":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":49,"column":2}},{"start":{"line":49,"column":2},"end":{"line":49,"column":2}}]},"5":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":52,"column":2}},{"start":{"line":52,"column":2},"end":{"line":52,"column":2}}]}},"code":["'use strict';","","const debug = require('debug')('cnpmjs.org:logger');","const formater = require('error-formater');","const Logger = require('mini-logger');","const utility = require('utility');","const util = require('util');","const os = require('os');","const config = require('../config');","const mail = require('./mail');","","const isTEST = process.env.NODE_ENV === 'test';","const categories = ['sync_info', 'sync_error'];","","const logger = module.exports = Logger({","  categories: categories,","  dir: config.logdir,","  duration: '1d',","  format: '[{category}.]YYYY-MM-DD[.log]',","  stdout: config.debug && !isTEST,","  errorFormater: errorFormater,","  seperator: os.EOL,","});","","const to = [];","for (var user in config.admins) {","  to.push(config.admins[user]);","}","","function errorFormater(err) {","  const msg = formater.both(err);","  mail.error(to, msg.json.name, msg.text);","  return msg.text;","}","","logger.syncInfo = function () {","  const args = [].slice.call(arguments);","  if (typeof args[0] === 'string') {","    args[0] = util.format('[%s][%s] ', utility.logDate(), process.pid) + args[0];","  }","  if (debug.enabled) {","    debug.apply(debug, args);","  }","  logger.sync_info.apply(logger, args);","};","","logger.syncError =function () {","  const args = [].slice.call(arguments);","  if (typeof args[0] === 'string') {","    args[0] = util.format('[%s][%s] ', utility.logDate(), process.pid) + args[0];","  }","  if (debug.enabled) {","    debug.apply(debug, args);","  }","  logger.sync_error.apply(logger, arguments);","};",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"12":1,"13":1,"15":1,"25":1,"26":1,"27":3,"30":1,"31":0,"32":0,"33":0,"36":1,"37":0,"38":0,"39":0,"41":0,"42":0,"44":0,"47":1,"48":0,"49":0,"50":0,"52":0,"53":0,"55":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/mail.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/mail.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":1,"10":1,"11":0,"12":0,"13":0,"14":1,"15":1,"16":3,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},"b":{"1":[1,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":3,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"sendLogMail","line":52,"loc":{"start":{"line":52,"column":17},"end":{"line":52,"column":74}}},"2":{"name":"(anonymous_2)","line":59,"loc":{"start":{"line":59,"column":15},"end":{"line":59,"column":32}}},"3":{"name":"(anonymous_3)","line":60,"loc":{"start":{"line":60,"column":19},"end":{"line":60,"column":58}}},"4":{"name":"(anonymous_4)","line":72,"loc":{"start":{"line":72,"column":15},"end":{"line":72,"column":54}}},"5":{"name":"(anonymous_5)","line":91,"loc":{"start":{"line":91,"column":30},"end":{"line":91,"column":53}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":39}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":33}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":23}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":43}},"5":{"start":{"line":22,"column":0},"end":{"line":22,"column":15}},"6":{"start":{"line":23,"column":0},"end":{"line":39,"column":1}},"7":{"start":{"line":25,"column":2},"end":{"line":25,"column":26}},"8":{"start":{"line":27,"column":2},"end":{"line":38,"column":4}},"9":{"start":{"line":41,"column":0},"end":{"line":41,"column":14}},"10":{"start":{"line":52,"column":0},"end":{"line":56,"column":2}},"11":{"start":{"line":53,"column":2},"end":{"line":53,"column":94}},"12":{"start":{"line":54,"column":2},"end":{"line":54,"column":22}},"13":{"start":{"line":55,"column":2},"end":{"line":55,"column":68}},"14":{"start":{"line":58,"column":0},"end":{"line":58,"column":40}},"15":{"start":{"line":59,"column":0},"end":{"line":63,"column":3}},"16":{"start":{"line":60,"column":2},"end":{"line":62,"column":4}},"17":{"start":{"line":61,"column":4},"end":{"line":61,"column":55}},"18":{"start":{"line":72,"column":0},"end":{"line":94,"column":2}},"19":{"start":{"line":73,"column":2},"end":{"line":73,"column":38}},"20":{"start":{"line":75,"column":2},"end":{"line":78,"column":3}},"21":{"start":{"line":76,"column":4},"end":{"line":76,"column":93}},"22":{"start":{"line":77,"column":4},"end":{"line":77,"column":22}},"23":{"start":{"line":80,"column":2},"end":{"line":82,"column":3}},"24":{"start":{"line":81,"column":4},"end":{"line":81,"column":55}},"25":{"start":{"line":84,"column":2},"end":{"line":89,"column":4}},"26":{"start":{"line":91,"column":2},"end":{"line":93,"column":5}},"27":{"start":{"line":92,"column":4},"end":{"line":92,"column":26}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":0},"end":{"line":23,"column":0}},{"start":{"line":23,"column":0},"end":{"line":23,"column":0}}]},"2":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":12},"end":{"line":32,"column":29}},{"start":{"line":32,"column":33},"end":{"line":32,"column":47}}]},"3":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":13},"end":{"line":73,"column":21}},{"start":{"line":73,"column":25},"end":{"line":73,"column":37}}]},"4":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]},"5":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":2},"end":{"line":80,"column":2}},{"start":{"line":80,"column":2},"end":{"line":80,"column":2}}]},"6":{"line":85,"type":"binary-expr","locations":[{"start":{"line":85,"column":10},"end":{"line":85,"column":25}},{"start":{"line":85,"column":29},"end":{"line":85,"column":46}}]}},"code":["/**!"," * cnpmjs.org - common/mail.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var nodemailer = require('nodemailer');","var utility = require('utility');","var os = require('os');","var mailConfig = require('../config').mail;","","var smtpConfig;","if (mailConfig.auth) {","  // new style","  smtpConfig = mailConfig;","} else {","  smtpConfig = {","    enable: mailConfig.enable,","    // backward compat","    host: mailConfig.host,","    port: mailConfig.port,","    secure: mailConfig.secure || mailConfig.ssl,","    debug: mailConfig.debug,","    auth: {","      user: mailConfig.user,","      pass: mailConfig.pass","    }","  };","}","","var transport;","","/**"," * Send notice email with mail level and appname."," *"," * @param {String|Array} to, email or email list."," * @param {String} level, e.g.: 'log, warn, error'."," * @param {String} subject"," * @param {String} html"," * @param {Function(err, result)} callback"," */","exports.notice = function sendLogMail(to, level, subject, html, callback) {","  subject = '[' + mailConfig.appname + '] [' + level + '] [' + os.hostname() + '] ' + subject;","  html = String(html);","  exports.send(to, subject, html.replace(/\\n/g, '<br/>'), callback);","};","","var LEVELS = [ 'log', 'warn', 'error' ];","LEVELS.forEach(function (level) {","  exports[level] = function (to, subject, html, callback) {","    exports.notice(to, level, subject, html, callback);","  };","});","","/**"," * Send email."," * @param {String|Array} to, email or email list."," * @param {String} subject"," * @param {String} html"," * @param {Function(err, result)} callback"," */","exports.send = function (to, subject, html, callback) {","  callback = callback || utility.noop;","","  if (mailConfig.enable === false) {","    console.log('[send mail debug] [%s] to: %s, subject: %s\\n%s', Date(), to, subject, html);","    return callback();","  }","","  if (!transport) {","    transport = nodemailer.createTransport(smtpConfig);","  }","","  var message = {","    from: mailConfig.from || mailConfig.sender,","    to: to,","    subject: subject,","    html: html,","  };","","  transport.sendMail(message, function (err, result) {","    callback(err, result);","  });","};",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"23":1,"25":1,"27":0,"41":1,"52":1,"53":0,"54":0,"55":0,"58":1,"59":1,"60":3,"61":0,"72":1,"73":0,"75":0,"76":0,"77":0,"80":0,"81":0,"84":0,"91":0,"92":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/markdown.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/markdown.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":28,"loc":{"start":{"line":28,"column":17},"end":{"line":28,"column":47}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":25}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":40}},"3":{"start":{"line":21,"column":0},"end":{"line":21,"column":31}},"4":{"start":{"line":23,"column":0},"end":{"line":26,"column":3}},"5":{"start":{"line":28,"column":0},"end":{"line":34,"column":2}},"6":{"start":{"line":29,"column":2},"end":{"line":29,"column":32}},"7":{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},"8":{"start":{"line":31,"column":4},"end":{"line":31,"column":21}},"9":{"start":{"line":33,"column":2},"end":{"line":33,"column":14}}},"branchMap":{"1":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":30,"column":2}},{"start":{"line":30,"column":2},"end":{"line":30,"column":2}}]}},"code":["/**!"," * cnpmjs.org - common/markdown.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var xss = require('xss');","var MarkdownIt = require('markdown-it');","","// allow class attr on code","xss.whiteList.code = ['class'];","","var md = new MarkdownIt({","  html: true,","  linkify: true,","});","","exports.render = function (content, filterXss) {","  var html = md.render(content);","  if (filterXss !== false) {","    html = xss(html);","  }","  return html;","};",""],"l":{"17":1,"18":1,"21":1,"23":1,"28":1,"29":0,"30":0,"31":0,"33":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/nfs.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/nfs.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":34}},"2":{"start":{"line":17,"column":0},"end":{"line":17,"column":28}}},"branchMap":{},"code":["/*!"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","","module.exports = config.nfs;",""],"l":{"15":1,"17":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/urllib.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/common/urllib.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1},"b":{"1":[0,1],"2":[0,0],"3":[0,0]},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":36}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":31}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":42}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":54}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":34}},"6":{"start":{"line":23,"column":0},"end":{"line":23,"column":14}},"7":{"start":{"line":24,"column":0},"end":{"line":24,"column":15}},"8":{"start":{"line":26,"column":0},"end":{"line":67,"column":1}},"9":{"start":{"line":27,"column":2},"end":{"line":27,"column":39}},"10":{"start":{"line":28,"column":2},"end":{"line":28,"column":43}},"11":{"start":{"line":29,"column":2},"end":{"line":57,"column":3}},"12":{"start":{"line":30,"column":4},"end":{"line":35,"column":7}},"13":{"start":{"line":36,"column":4},"end":{"line":41,"column":7}},"14":{"start":{"line":42,"column":9},"end":{"line":57,"column":3}},"15":{"start":{"line":43,"column":4},"end":{"line":48,"column":7}},"16":{"start":{"line":49,"column":4},"end":{"line":54,"column":7}},"17":{"start":{"line":56,"column":4},"end":{"line":56,"column":71}},"18":{"start":{"line":59,"column":2},"end":{"line":62,"column":5}},"19":{"start":{"line":63,"column":2},"end":{"line":66,"column":5}},"20":{"start":{"line":69,"column":0},"end":{"line":72,"column":3}},"21":{"start":{"line":74,"column":0},"end":{"line":74,"column":24}},"22":{"start":{"line":75,"column":0},"end":{"line":75,"column":46}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":0},"end":{"line":26,"column":0}},{"start":{"line":26,"column":0},"end":{"line":26,"column":0}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"3":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":9},"end":{"line":42,"column":9}},{"start":{"line":42,"column":9},"end":{"line":42,"column":9}}]}},"code":["/**!"," * cnpmjs.org - common/urllib.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var urlparse = require('url').parse;","var urllib = require('urllib');","var HttpAgent = require('agentkeepalive');","var HttpsAgent = require('agentkeepalive').HttpsAgent;","var config = require('../config');","","var httpAgent;","var httpsAgent;","","if (config.httpProxy) {","  var tunnel = require('tunnel-agent');","  var urlinfo = urlparse(config.httpProxy);","  if (urlinfo.protocol === 'http:') {","    httpAgent = tunnel.httpOverHttp({","      proxy: {","        host: urlinfo.hostname,","        port: urlinfo.port","      }","    });","    httpsAgent = tunnel.httpsOverHttp({","      proxy: {","        host: urlinfo.hostname,","        port: urlinfo.port","      }","    });","  } else if (urlinfo.protocol === 'https:') {","    httpAgent = tunnel.httpOverHttps({","      proxy: {","        host: urlinfo.hostname,","        port: urlinfo.port","      }","    });","    httpsAgent = tunnel.httpsOverHttps({","      proxy: {","        host: urlinfo.hostname,","        port: urlinfo.port","      }","    });","  } else {","    throw new TypeError('httpProxy format error: ' + config.httpProxy);","  }","} else {","  httpAgent = new HttpAgent({","    timeout: 0,","    keepAliveTimeout: 15000","  });","  httpsAgent = new HttpsAgent({","    timeout: 0,","    keepAliveTimeout: 15000","  });","}","","var client = urllib.create({","  agent: httpAgent,","  httpsAgent: httpsAgent","});","","module.exports = client;","module.exports.USER_AGENT = urllib.USER_AGENT;",""],"l":{"17":1,"18":1,"19":1,"20":1,"21":1,"23":1,"24":1,"26":1,"27":0,"28":0,"29":0,"30":0,"36":0,"42":0,"43":0,"49":0,"56":0,"59":1,"63":1,"69":1,"74":1,"75":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/sync.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/sync.js","s":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":15},"end":{"line":22,"column":28}}},"2":{"name":"(anonymous_2)","line":62,"loc":{"start":{"line":62,"column":21},"end":{"line":62,"column":38}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":60}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":44}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":55}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":34}},"5":{"start":{"line":22,"column":0},"end":{"line":60,"column":2}},"6":{"start":{"line":23,"column":2},"end":{"line":23,"column":47}},"7":{"start":{"line":24,"column":2},"end":{"line":24,"column":48}},"8":{"start":{"line":25,"column":2},"end":{"line":25,"column":23}},"9":{"start":{"line":26,"column":2},"end":{"line":32,"column":3}},"10":{"start":{"line":29,"column":4},"end":{"line":29,"column":33}},"11":{"start":{"line":30,"column":4},"end":{"line":30,"column":21}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":21}},"13":{"start":{"line":33,"column":2},"end":{"line":33,"column":46}},"14":{"start":{"line":34,"column":2},"end":{"line":34,"column":43}},"15":{"start":{"line":35,"column":2},"end":{"line":35,"column":52}},"16":{"start":{"line":36,"column":2},"end":{"line":43,"column":3}},"17":{"start":{"line":37,"column":4},"end":{"line":37,"column":22}},"18":{"start":{"line":38,"column":4},"end":{"line":41,"column":6}},"19":{"start":{"line":42,"column":4},"end":{"line":42,"column":11}},"20":{"start":{"line":45,"column":2},"end":{"line":50,"column":4}},"21":{"start":{"line":52,"column":2},"end":{"line":52,"column":68}},"22":{"start":{"line":53,"column":2},"end":{"line":53,"column":46}},"23":{"start":{"line":55,"column":2},"end":{"line":55,"column":20}},"24":{"start":{"line":56,"column":2},"end":{"line":59,"column":4}},"25":{"start":{"line":62,"column":0},"end":{"line":80,"column":2}},"26":{"start":{"line":63,"column":2},"end":{"line":63,"column":55}},"27":{"start":{"line":64,"column":2},"end":{"line":64,"column":46}},"28":{"start":{"line":66,"column":2},"end":{"line":69,"column":3}},"29":{"start":{"line":67,"column":4},"end":{"line":67,"column":22}},"30":{"start":{"line":68,"column":4},"end":{"line":68,"column":11}},"31":{"start":{"line":70,"column":2},"end":{"line":70,"column":34}},"32":{"start":{"line":71,"column":2},"end":{"line":73,"column":3}},"33":{"start":{"line":72,"column":4},"end":{"line":72,"column":23}},"34":{"start":{"line":75,"column":2},"end":{"line":75,"column":27}},"35":{"start":{"line":76,"column":2},"end":{"line":78,"column":3}},"36":{"start":{"line":77,"column":4},"end":{"line":77,"column":51}},"37":{"start":{"line":79,"column":2},"end":{"line":79,"column":35}}},"branchMap":{"1":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":17},"end":{"line":23,"column":31}},{"start":{"line":23,"column":35},"end":{"line":23,"column":46}}]},"2":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":13},"end":{"line":24,"column":29}},{"start":{"line":24,"column":33},"end":{"line":24,"column":47}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"4":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"5":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":6},"end":{"line":36,"column":24}},{"start":{"line":36,"column":28},"end":{"line":36,"column":35}},{"start":{"line":36,"column":39},"end":{"line":36,"column":57}}]},"6":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":21},"end":{"line":63,"column":35}},{"start":{"line":63,"column":39},"end":{"line":63,"column":53}}]},"7":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":15},"end":{"line":64,"column":40}},{"start":{"line":64,"column":44},"end":{"line":64,"column":45}}]},"8":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":2},"end":{"line":66,"column":2}},{"start":{"line":66,"column":2},"end":{"line":66,"column":2}}]},"9":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":2},"end":{"line":71,"column":2}},{"start":{"line":71,"column":2},"end":{"line":71,"column":2}}]},"10":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]}},"code":["/**!"," * cnpmjs.org - controllers/sync.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:controllers:sync');","var Log = require('../services/module_log');","var SyncModuleWorker = require('./sync_module_worker');","var config = require('../config');","","exports.sync = function* () {","  var username = this.user.name || 'anonymous';","  var name = this.params.name || this.params[0];","  var type = 'package';","  if (name.indexOf(':') > 0) {","    // user:fengmk2","    // package:pedding","    var splits = name.split(':');","    type = splits[0];","    name = splits[1];","  }","  var publish = this.query.publish === 'true';","  var noDep = this.query.nodeps === 'true';","  debug('sync %s with query: %j', name, this.query);","  if (type === 'package' && publish && !this.user.isAdmin) {","    this.status = 403;","    this.body = {","      error: 'no_perms',","      reason: 'Only admin can publish'","    };","    return;","  }","","  var options = {","    type: type,","    publish: publish,","    noDep: noDep,","    syncUpstreamFirst: config.sourceNpmRegistryIsCNpm,","  };","","  var logId = yield* SyncModuleWorker.sync(name, username, options);","  debug('sync %s got log id %j', name, logId);","","  this.status = 201;","  this.body = {","    ok: true,","    logId: logId","  };","};","","exports.getSyncLog = function* (next) {","  var logId = Number(this.params.id || this.params[1]);","  var offset = Number(this.query.offset) || 0;","","  if (!logId) { // NaN","    this.status = 404;","    return;","  }","  var row = yield* Log.get(logId);","  if (!row) {","    return yield* next;","  }","","  var log = row.log.trim();","  if (offset > 0) {","    log = log.split('\\n').slice(offset).join('\\n');","  }","  this.body = {ok: true, log: log};","};",""],"l":{"17":2,"18":2,"19":0,"20":0,"22":0,"23":0,"24":0,"25":0,"26":0,"29":0,"30":0,"31":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"42":0,"45":0,"52":0,"53":0,"55":0,"56":0,"62":0,"63":0,"64":0,"66":0,"67":0,"68":0,"70":0,"71":0,"72":0,"75":0,"76":0,"77":0,"79":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/module_log.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/module_log.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":17},"end":{"line":20,"column":34}}},"2":{"name":"(anonymous_2)","line":31,"loc":{"start":{"line":31,"column":17},"end":{"line":31,"column":37}}},"3":{"name":"(anonymous_3)","line":52,"loc":{"start":{"line":52,"column":14},"end":{"line":52,"column":29}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":33}},"3":{"start":{"line":20,"column":0},"end":{"line":27,"column":2}},"4":{"start":{"line":21,"column":2},"end":{"line":25,"column":5}},"5":{"start":{"line":26,"column":2},"end":{"line":26,"column":26}},"6":{"start":{"line":29,"column":0},"end":{"line":29,"column":25}},"7":{"start":{"line":31,"column":0},"end":{"line":50,"column":2}},"8":{"start":{"line":32,"column":2},"end":{"line":34,"column":3}},"9":{"start":{"line":33,"column":4},"end":{"line":33,"column":16}},"10":{"start":{"line":36,"column":2},"end":{"line":36,"column":35}},"11":{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},"12":{"start":{"line":38,"column":4},"end":{"line":38,"column":16}},"13":{"start":{"line":41,"column":2},"end":{"line":45,"column":3}},"14":{"start":{"line":42,"column":4},"end":{"line":42,"column":26}},"15":{"start":{"line":44,"column":4},"end":{"line":44,"column":18}},"16":{"start":{"line":46,"column":2},"end":{"line":48,"column":3}},"17":{"start":{"line":47,"column":4},"end":{"line":47,"column":54}},"18":{"start":{"line":49,"column":2},"end":{"line":49,"column":33}},"19":{"start":{"line":52,"column":0},"end":{"line":54,"column":2}},"20":{"start":{"line":53,"column":2},"end":{"line":53,"column":38}}},"branchMap":{"1":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":14},"end":{"line":23,"column":27}},{"start":{"line":23,"column":31},"end":{"line":23,"column":42}}]},"2":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"3":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":37,"column":2}},{"start":{"line":37,"column":2},"end":{"line":37,"column":2}}]},"4":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":2},"end":{"line":41,"column":2}},{"start":{"line":41,"column":2},"end":{"line":41,"column":2}}]},"5":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":46,"column":2}},{"start":{"line":46,"column":2},"end":{"line":46,"column":2}}]}},"code":["/**!"," * cnpmjs.org - services/module_log.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var models = require('../models');","var ModuleLog = models.ModuleLog;","","exports.create = function* (data) {","  var row = ModuleLog.build({","    name: data.name,","    username: data.username || 'anonymous',","    log: ''","  });","  return yield row.save();","};","","var ONE_MB = 1024 * 1024;","","exports.append = function* (id, log) {","  if (!log) {","    return null;","  }","","  var row = yield* exports.get(id);","  if (!row) {","    return null;","  }","","  if (row.log) {","    row.log += '\\n' + log;","  } else {","    row.log = log;","  }","  if (row.log.length >= ONE_MB) {","    row.log = '...\\n' + row.log.substring(ONE_MB / 2);","  }","  return yield row.save(['log']);","};","","exports.get = function* (id) {","  return yield ModuleLog.findById(id);","};",""],"l":{"17":2,"18":0,"20":0,"21":0,"26":0,"29":0,"31":0,"32":0,"33":0,"36":0,"37":0,"38":0,"41":0,"42":0,"44":0,"46":0,"47":0,"49":0,"52":0,"53":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/sync_module_worker.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/sync_module_worker.js","s":{"1":4,"2":4,"3":4,"4":4,"5":4,"6":4,"7":4,"8":4,"9":4,"10":4,"11":4,"12":4,"13":4,"14":4,"15":4,"16":4,"17":4,"18":4,"19":4,"20":4,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":1,"243":0,"244":0,"245":0,"246":0,"247":0,"248":1,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":1,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"301":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"314":0,"315":0,"316":0,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"335":0,"336":0,"337":0,"338":0,"339":0,"340":0,"341":0,"342":0,"343":0,"344":0,"345":0,"346":0,"347":0,"348":0,"349":0,"350":0,"351":0,"352":0,"353":0,"354":0,"355":0,"356":0,"357":0,"358":0,"359":0,"360":0,"361":0,"362":0,"363":0,"364":0,"365":0,"366":0,"367":0,"368":0,"369":0,"370":0,"371":0,"372":0,"373":0,"374":0,"375":0,"376":0,"377":0,"378":0,"379":0,"380":0,"381":0,"382":0,"383":0,"384":0,"385":0,"386":0,"387":0,"388":0,"389":0,"390":0,"391":0,"392":0,"393":0,"394":0,"395":0,"396":0,"397":0,"398":0,"399":0,"400":0,"401":0,"402":0,"403":0,"404":0,"405":0,"406":0,"407":0,"408":0,"409":0,"410":0,"411":0,"412":0,"413":0,"414":0,"415":0,"416":0,"417":0,"418":0,"419":0,"420":0,"421":0,"422":0,"423":1,"424":0,"425":0,"426":0,"427":0,"428":0,"429":0,"430":0,"431":0,"432":0,"433":0,"434":0,"435":1,"436":0,"437":0,"438":0,"439":0,"440":0,"441":0,"442":0,"443":0,"444":0,"445":0,"446":0,"447":0,"448":0,"449":0,"450":1,"451":0,"452":0,"453":0,"454":0,"455":0,"456":0,"457":0,"458":0,"459":0,"460":0,"461":0,"462":1,"463":0,"464":0,"465":0,"466":0,"467":0,"468":0,"469":0,"470":0,"471":0,"472":0,"473":0,"474":1,"475":0,"476":0,"477":0,"478":0,"479":0,"480":0,"481":0,"482":0,"483":0,"484":0,"485":0,"486":0,"487":0,"488":0,"489":0,"490":0,"491":0,"492":0,"493":0,"494":0,"495":0,"496":0,"497":0,"498":1,"499":0,"500":0,"501":0,"502":0,"503":0,"504":0,"505":0,"506":0,"507":0,"508":1,"509":0,"510":0,"511":0,"512":0,"513":0,"514":0,"515":0,"516":0,"517":0,"518":0,"519":0,"520":0,"521":0,"522":0,"523":0,"524":0,"525":0,"526":0,"527":0,"528":0,"529":0,"530":0,"531":0,"532":0,"533":0,"534":0,"535":0,"536":0,"537":0,"538":0,"539":0,"540":0,"541":0,"542":0,"543":0,"544":0,"545":0,"546":0,"547":0,"548":0,"549":0,"550":0,"551":0,"552":0,"553":0,"554":0,"555":0,"556":0,"557":0,"558":0,"559":0,"560":0,"561":0,"562":0,"563":0,"564":0,"565":0,"566":0,"567":0,"568":0,"569":0,"570":0,"571":0,"572":0,"573":0,"574":0,"575":0,"576":0,"577":0,"578":0,"579":0,"580":0,"581":0,"582":0,"583":0,"584":0,"585":0,"586":0,"587":0,"588":0,"589":0,"590":0,"591":0,"592":1,"593":0,"594":0,"595":0,"596":0,"597":0,"598":0,"599":0,"600":0,"601":0,"602":0,"603":0,"604":0,"605":0,"606":0,"607":0,"608":0,"609":0,"610":0,"611":0,"612":0,"613":0,"614":0,"615":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0,0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0,0,0,0],"45":[0,0],"46":[0,0,0,0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0,0],"88":[0,0],"89":[0,0],"90":[0,0],"91":[0,0],"92":[0,0],"93":[0,0],"94":[0,0],"95":[0,0],"96":[0,0],"97":[0,0],"98":[0,0],"99":[0,0],"100":[0,0],"101":[0,0],"102":[0,0],"103":[0,0],"104":[0,0],"105":[0,0],"106":[0,0],"107":[0,0],"108":[0,0],"109":[0,0],"110":[0,0],"111":[0,0],"112":[0,0],"113":[0,0],"114":[0,0],"115":[0,0],"116":[0,0],"117":[0,0],"118":[0,0],"119":[0,0],"120":[0,0],"121":[0,0],"122":[0,0],"123":[0,0],"124":[0,0],"125":[0,0],"126":[0,0],"127":[0,0],"128":[0,0],"129":[0,0],"130":[0,0],"131":[0,0],"132":[0,0],"133":[0,0],"134":[0,0],"135":[0,0],"136":[0,0],"137":[0,0],"138":[0,0],"139":[0,0],"140":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0},"fnMap":{"1":{"name":"SyncModuleWorker","line":34,"loc":{"start":{"line":34,"column":0},"end":{"line":34,"column":35}}},"2":{"name":"(anonymous_2)","line":54,"loc":{"start":{"line":54,"column":21},"end":{"line":54,"column":37}}},"3":{"name":"(anonymous_3)","line":69,"loc":{"start":{"line":69,"column":36},"end":{"line":69,"column":48}}},"4":{"name":"(anonymous_4)","line":86,"loc":{"start":{"line":86,"column":33},"end":{"line":86,"column":45}}},"5":{"name":"(anonymous_5)","line":99,"loc":{"start":{"line":99,"column":38},"end":{"line":99,"column":50}}},"6":{"name":"(anonymous_6)","line":107,"loc":{"start":{"line":107,"column":5},"end":{"line":107,"column":18}}},"7":{"name":"(anonymous_7)","line":109,"loc":{"start":{"line":109,"column":10},"end":{"line":109,"column":22}}},"8":{"name":"(anonymous_8)","line":114,"loc":{"start":{"line":114,"column":11},"end":{"line":114,"column":26}}},"9":{"name":"(anonymous_9)","line":123,"loc":{"start":{"line":123,"column":35},"end":{"line":123,"column":47}}},"10":{"name":"(anonymous_10)","line":127,"loc":{"start":{"line":127,"column":5},"end":{"line":127,"column":18}}},"11":{"name":"(anonymous_11)","line":147,"loc":{"start":{"line":147,"column":11},"end":{"line":147,"column":26}}},"12":{"name":"(anonymous_12)","line":152,"loc":{"start":{"line":152,"column":41},"end":{"line":152,"column":57}}},"13":{"name":"(anonymous_13)","line":157,"loc":{"start":{"line":157,"column":38},"end":{"line":157,"column":54}}},"14":{"name":"(anonymous_14)","line":162,"loc":{"start":{"line":162,"column":33},"end":{"line":162,"column":49}}},"15":{"name":"(anonymous_15)","line":172,"loc":{"start":{"line":172,"column":38},"end":{"line":172,"column":79}}},"16":{"name":"(anonymous_16)","line":183,"loc":{"start":{"line":183,"column":21},"end":{"line":183,"column":34}}},"17":{"name":"(anonymous_17)","line":188,"loc":{"start":{"line":188,"column":42},"end":{"line":188,"column":59}}},"18":{"name":"(anonymous_18)","line":268,"loc":{"start":{"line":268,"column":38},"end":{"line":268,"column":51}}},"19":{"name":"(anonymous_19)","line":283,"loc":{"start":{"line":283,"column":34},"end":{"line":283,"column":60}}},"20":{"name":"(anonymous_20)","line":307,"loc":{"start":{"line":307,"column":40},"end":{"line":307,"column":82}}},"21":{"name":"_listStarUsers","line":420,"loc":{"start":{"line":420,"column":0},"end":{"line":420,"column":34}}},"22":{"name":"(anonymous_22)","line":423,"loc":{"start":{"line":423,"column":16},"end":{"line":423,"column":32}}},"23":{"name":"_saveNpmUser","line":429,"loc":{"start":{"line":429,"column":0},"end":{"line":429,"column":33}}},"24":{"name":"_saveMaintainer","line":448,"loc":{"start":{"line":448,"column":0},"end":{"line":448,"column":53}}},"25":{"name":"(anonymous_25)","line":456,"loc":{"start":{"line":456,"column":42},"end":{"line":456,"column":76}}},"26":{"name":"(anonymous_26)","line":486,"loc":{"start":{"line":486,"column":21},"end":{"line":486,"column":36}}},"27":{"name":"(anonymous_27)","line":498,"loc":{"start":{"line":498,"column":35},"end":{"line":498,"column":57}}},"28":{"name":"(anonymous_28)","line":709,"loc":{"start":{"line":709,"column":25},"end":{"line":709,"column":41}}},"29":{"name":"syncDes","line":747,"loc":{"start":{"line":747,"column":2},"end":{"line":747,"column":22}}},"30":{"name":"(anonymous_30)","line":752,"loc":{"start":{"line":752,"column":51},"end":{"line":752,"column":67}}},"31":{"name":"syncTag","line":770,"loc":{"start":{"line":770,"column":2},"end":{"line":770,"column":22}}},"32":{"name":"(anonymous_32)","line":782,"loc":{"start":{"line":782,"column":43},"end":{"line":782,"column":59}}},"33":{"name":"syncReadme","line":800,"loc":{"start":{"line":800,"column":2},"end":{"line":800,"column":25}}},"34":{"name":"(anonymous_34)","line":806,"loc":{"start":{"line":806,"column":46},"end":{"line":806,"column":62}}},"35":{"name":"syncDeprecateds","line":821,"loc":{"start":{"line":821,"column":2},"end":{"line":821,"column":30}}},"36":{"name":"(anonymous_36)","line":827,"loc":{"start":{"line":827,"column":50},"end":{"line":827,"column":66}}},"37":{"name":"syncMissingUsers","line":844,"loc":{"start":{"line":844,"column":2},"end":{"line":844,"column":31}}},"38":{"name":"(anonymous_38)","line":852,"loc":{"start":{"line":852,"column":17},"end":{"line":852,"column":30}}},"39":{"name":"(anonymous_39)","line":855,"loc":{"start":{"line":855,"column":18},"end":{"line":855,"column":38}}},"40":{"name":"(anonymous_40)","line":871,"loc":{"start":{"line":871,"column":44},"end":{"line":871,"column":64}}},"41":{"name":"syncMissingStarUsers","line":884,"loc":{"start":{"line":884,"column":2},"end":{"line":884,"column":35}}},"42":{"name":"(anonymous_42)","line":890,"loc":{"start":{"line":890,"column":48},"end":{"line":890,"column":68}}},"43":{"name":"syncNpmPackageMaintainers","line":903,"loc":{"start":{"line":903,"column":2},"end":{"line":903,"column":40}}},"44":{"name":"(anonymous_44)","line":910,"loc":{"start":{"line":910,"column":50},"end":{"line":910,"column":66}}},"45":{"name":"(anonymous_45)","line":934,"loc":{"start":{"line":934,"column":45},"end":{"line":934,"column":85}}},"46":{"name":"(anonymous_46)","line":1025,"loc":{"start":{"line":1025,"column":18},"end":{"line":1025,"column":34}}},"47":{"name":"afterUpload","line":1075,"loc":{"start":{"line":1075,"column":2},"end":{"line":1075,"column":32}}},"48":{"name":"(anonymous_48)","line":1126,"loc":{"start":{"line":1126,"column":24},"end":{"line":1126,"column":60}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":62}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":23}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":32}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":40}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":50}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":27}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":23}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":27}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":31}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":32}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":33}},"13":{"start":{"line":15,"column":0},"end":{"line":15,"column":36}},"14":{"start":{"line":16,"column":0},"end":{"line":16,"column":41}},"15":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}},"16":{"start":{"line":18,"column":0},"end":{"line":18,"column":35}},"17":{"start":{"line":19,"column":0},"end":{"line":19,"column":41}},"18":{"start":{"line":20,"column":0},"end":{"line":20,"column":38}},"19":{"start":{"line":21,"column":0},"end":{"line":21,"column":44}},"20":{"start":{"line":22,"column":0},"end":{"line":22,"column":52}},"21":{"start":{"line":23,"column":0},"end":{"line":23,"column":51}},"22":{"start":{"line":24,"column":0},"end":{"line":24,"column":37}},"23":{"start":{"line":25,"column":0},"end":{"line":25,"column":23}},"24":{"start":{"line":27,"column":0},"end":{"line":32,"column":26}},"25":{"start":{"line":34,"column":0},"end":{"line":63,"column":1}},"26":{"start":{"line":35,"column":2},"end":{"line":35,"column":26}},"27":{"start":{"line":36,"column":2},"end":{"line":36,"column":30}},"28":{"start":{"line":37,"column":2},"end":{"line":37,"column":17}},"29":{"start":{"line":38,"column":2},"end":{"line":38,"column":23}},"30":{"start":{"line":39,"column":2},"end":{"line":41,"column":3}},"31":{"start":{"line":40,"column":4},"end":{"line":40,"column":34}},"32":{"start":{"line":43,"column":2},"end":{"line":43,"column":40}},"33":{"start":{"line":44,"column":2},"end":{"line":44,"column":28}},"34":{"start":{"line":45,"column":2},"end":{"line":45,"column":33}},"35":{"start":{"line":47,"column":2},"end":{"line":47,"column":35}},"36":{"start":{"line":48,"column":2},"end":{"line":48,"column":46}},"37":{"start":{"line":49,"column":2},"end":{"line":49,"column":43}},"38":{"start":{"line":50,"column":2},"end":{"line":50,"column":53}},"39":{"start":{"line":52,"column":2},"end":{"line":52,"column":25}},"40":{"start":{"line":53,"column":2},"end":{"line":53,"column":20}},"41":{"start":{"line":54,"column":2},"end":{"line":56,"column":16}},"42":{"start":{"line":55,"column":4},"end":{"line":55,"column":30}},"43":{"start":{"line":57,"column":2},"end":{"line":57,"column":38}},"44":{"start":{"line":58,"column":2},"end":{"line":58,"column":56}},"45":{"start":{"line":60,"column":2},"end":{"line":60,"column":22}},"46":{"start":{"line":61,"column":2},"end":{"line":61,"column":18}},"47":{"start":{"line":62,"column":2},"end":{"line":62,"column":20}},"48":{"start":{"line":65,"column":0},"end":{"line":65,"column":46}},"49":{"start":{"line":67,"column":0},"end":{"line":67,"column":34}},"50":{"start":{"line":69,"column":0},"end":{"line":83,"column":2}},"51":{"start":{"line":70,"column":2},"end":{"line":70,"column":47}},"52":{"start":{"line":71,"column":2},"end":{"line":73,"column":3}},"53":{"start":{"line":72,"column":4},"end":{"line":72,"column":11}},"54":{"start":{"line":74,"column":2},"end":{"line":74,"column":24}},"55":{"start":{"line":75,"column":2},"end":{"line":79,"column":54}},"56":{"start":{"line":80,"column":2},"end":{"line":80,"column":19}},"57":{"start":{"line":82,"column":2},"end":{"line":82,"column":28}},"58":{"start":{"line":86,"column":0},"end":{"line":97,"column":2}},"59":{"start":{"line":87,"column":2},"end":{"line":87,"column":87}},"60":{"start":{"line":88,"column":2},"end":{"line":88,"column":13}},"61":{"start":{"line":89,"column":2},"end":{"line":89,"column":26}},"62":{"start":{"line":90,"column":2},"end":{"line":96,"column":3}},"63":{"start":{"line":91,"column":4},"end":{"line":93,"column":5}},"64":{"start":{"line":92,"column":6},"end":{"line":92,"column":24}},"65":{"start":{"line":94,"column":4},"end":{"line":94,"column":21}},"66":{"start":{"line":95,"column":4},"end":{"line":95,"column":20}},"67":{"start":{"line":99,"column":0},"end":{"line":121,"column":2}},"68":{"start":{"line":100,"column":2},"end":{"line":100,"column":18}},"69":{"start":{"line":101,"column":2},"end":{"line":103,"column":3}},"70":{"start":{"line":102,"column":4},"end":{"line":102,"column":11}},"71":{"start":{"line":104,"column":2},"end":{"line":104,"column":22}},"72":{"start":{"line":105,"column":2},"end":{"line":105,"column":25}},"73":{"start":{"line":106,"column":2},"end":{"line":106,"column":17}},"74":{"start":{"line":107,"column":2},"end":{"line":120,"column":5}},"75":{"start":{"line":108,"column":4},"end":{"line":108,"column":50}},"76":{"start":{"line":110,"column":4},"end":{"line":110,"column":25}},"77":{"start":{"line":111,"column":4},"end":{"line":113,"column":5}},"78":{"start":{"line":112,"column":6},"end":{"line":112,"column":22}},"79":{"start":{"line":115,"column":4},"end":{"line":115,"column":22}},"80":{"start":{"line":116,"column":4},"end":{"line":116,"column":25}},"81":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"82":{"start":{"line":118,"column":6},"end":{"line":118,"column":22}},"83":{"start":{"line":123,"column":0},"end":{"line":150,"column":2}},"84":{"start":{"line":124,"column":2},"end":{"line":125,"column":79}},"85":{"start":{"line":126,"column":2},"end":{"line":126,"column":18}},"86":{"start":{"line":127,"column":2},"end":{"line":149,"column":5}},"87":{"start":{"line":129,"column":4},"end":{"line":135,"column":5}},"88":{"start":{"line":130,"column":6},"end":{"line":134,"column":7}},"89":{"start":{"line":131,"column":8},"end":{"line":131,"column":48}},"90":{"start":{"line":133,"column":8},"end":{"line":133,"column":26}},"91":{"start":{"line":137,"column":4},"end":{"line":140,"column":5}},"92":{"start":{"line":138,"column":6},"end":{"line":138,"column":28}},"93":{"start":{"line":139,"column":6},"end":{"line":139,"column":13}},"94":{"start":{"line":142,"column":4},"end":{"line":142,"column":17}},"95":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"96":{"start":{"line":144,"column":6},"end":{"line":144,"column":29}},"97":{"start":{"line":146,"column":4},"end":{"line":146,"column":14}},"98":{"start":{"line":148,"column":4},"end":{"line":148,"column":22}},"99":{"start":{"line":152,"column":0},"end":{"line":155,"column":2}},"100":{"start":{"line":153,"column":2},"end":{"line":153,"column":28}},"101":{"start":{"line":154,"column":2},"end":{"line":154,"column":29}},"102":{"start":{"line":157,"column":0},"end":{"line":160,"column":2}},"103":{"start":{"line":158,"column":2},"end":{"line":158,"column":24}},"104":{"start":{"line":159,"column":2},"end":{"line":159,"column":26}},"105":{"start":{"line":162,"column":0},"end":{"line":170,"column":2}},"106":{"start":{"line":163,"column":2},"end":{"line":165,"column":3}},"107":{"start":{"line":164,"column":4},"end":{"line":164,"column":11}},"108":{"start":{"line":166,"column":2},"end":{"line":166,"column":28}},"109":{"start":{"line":167,"column":2},"end":{"line":167,"column":24}},"110":{"start":{"line":168,"column":2},"end":{"line":168,"column":25}},"111":{"start":{"line":169,"column":2},"end":{"line":169,"column":45}},"112":{"start":{"line":172,"column":0},"end":{"line":186,"column":2}},"113":{"start":{"line":173,"column":2},"end":{"line":174,"column":40}},"114":{"start":{"line":175,"column":2},"end":{"line":179,"column":3}},"115":{"start":{"line":176,"column":4},"end":{"line":176,"column":27}},"116":{"start":{"line":178,"column":4},"end":{"line":178,"column":24}},"117":{"start":{"line":180,"column":2},"end":{"line":180,"column":33}},"118":{"start":{"line":181,"column":2},"end":{"line":181,"column":18}},"119":{"start":{"line":183,"column":2},"end":{"line":185,"column":5}},"120":{"start":{"line":184,"column":4},"end":{"line":184,"column":35}},"121":{"start":{"line":188,"column":0},"end":{"line":266,"column":2}},"122":{"start":{"line":189,"column":2},"end":{"line":195,"column":3}},"123":{"start":{"line":192,"column":4},"end":{"line":193,"column":32}},"124":{"start":{"line":194,"column":4},"end":{"line":194,"column":11}},"125":{"start":{"line":196,"column":2},"end":{"line":196,"column":22}},"126":{"start":{"line":197,"column":2},"end":{"line":199,"column":3}},"127":{"start":{"line":198,"column":4},"end":{"line":198,"column":42}},"128":{"start":{"line":200,"column":2},"end":{"line":200,"column":64}},"129":{"start":{"line":201,"column":2},"end":{"line":203,"column":3}},"130":{"start":{"line":202,"column":4},"end":{"line":202,"column":26}},"131":{"start":{"line":204,"column":2},"end":{"line":212,"column":5}},"132":{"start":{"line":214,"column":2},"end":{"line":217,"column":3}},"133":{"start":{"line":215,"column":4},"end":{"line":216,"column":29}},"134":{"start":{"line":219,"column":2},"end":{"line":219,"column":83}},"135":{"start":{"line":220,"column":2},"end":{"line":220,"column":17}},"136":{"start":{"line":221,"column":2},"end":{"line":221,"column":80}},"137":{"start":{"line":223,"column":2},"end":{"line":223,"column":16}},"138":{"start":{"line":224,"column":2},"end":{"line":264,"column":3}},"139":{"start":{"line":225,"column":4},"end":{"line":225,"column":12}},"140":{"start":{"line":226,"column":4},"end":{"line":226,"column":50}},"141":{"start":{"line":227,"column":4},"end":{"line":231,"column":7}},"142":{"start":{"line":233,"column":4},"end":{"line":237,"column":5}},"143":{"start":{"line":234,"column":6},"end":{"line":235,"column":40}},"144":{"start":{"line":236,"column":6},"end":{"line":236,"column":12}},"145":{"start":{"line":239,"column":4},"end":{"line":239,"column":23}},"146":{"start":{"line":240,"column":4},"end":{"line":240,"column":25}},"147":{"start":{"line":241,"column":4},"end":{"line":244,"column":5}},"148":{"start":{"line":242,"column":6},"end":{"line":242,"column":22}},"149":{"start":{"line":243,"column":6},"end":{"line":243,"column":73}},"150":{"start":{"line":246,"column":4},"end":{"line":248,"column":5}},"151":{"start":{"line":247,"column":6},"end":{"line":247,"column":25}},"152":{"start":{"line":250,"column":4},"end":{"line":252,"column":5}},"153":{"start":{"line":251,"column":6},"end":{"line":251,"column":12}},"154":{"start":{"line":254,"column":4},"end":{"line":257,"column":5}},"155":{"start":{"line":255,"column":6},"end":{"line":255,"column":57}},"156":{"start":{"line":256,"column":6},"end":{"line":256,"column":12}},"157":{"start":{"line":259,"column":4},"end":{"line":261,"column":5}},"158":{"start":{"line":260,"column":6},"end":{"line":260,"column":44}},"159":{"start":{"line":263,"column":4},"end":{"line":263,"column":22}},"160":{"start":{"line":265,"column":2},"end":{"line":265,"column":79}},"161":{"start":{"line":268,"column":0},"end":{"line":281,"column":2}},"162":{"start":{"line":269,"column":2},"end":{"line":279,"column":3}},"163":{"start":{"line":270,"column":4},"end":{"line":270,"column":33}},"164":{"start":{"line":271,"column":4},"end":{"line":278,"column":5}},"165":{"start":{"line":272,"column":6},"end":{"line":272,"column":46}},"166":{"start":{"line":273,"column":6},"end":{"line":273,"column":33}},"167":{"start":{"line":274,"column":6},"end":{"line":274,"column":66}},"168":{"start":{"line":276,"column":6},"end":{"line":276,"column":30}},"169":{"start":{"line":277,"column":6},"end":{"line":277,"column":77}},"170":{"start":{"line":280,"column":2},"end":{"line":280,"column":16}},"171":{"start":{"line":283,"column":0},"end":{"line":305,"column":2}},"172":{"start":{"line":284,"column":2},"end":{"line":288,"column":3}},"173":{"start":{"line":285,"column":4},"end":{"line":286,"column":27}},"174":{"start":{"line":287,"column":4},"end":{"line":287,"column":25}},"175":{"start":{"line":290,"column":2},"end":{"line":290,"column":32}},"176":{"start":{"line":291,"column":2},"end":{"line":293,"column":3}},"177":{"start":{"line":292,"column":4},"end":{"line":292,"column":48}},"178":{"start":{"line":296,"column":2},"end":{"line":296,"column":107}},"179":{"start":{"line":298,"column":2},"end":{"line":298,"column":72}},"180":{"start":{"line":299,"column":2},"end":{"line":304,"column":3}},"181":{"start":{"line":303,"column":4},"end":{"line":303,"column":75}},"182":{"start":{"line":307,"column":0},"end":{"line":418,"column":2}},"183":{"start":{"line":308,"column":2},"end":{"line":308,"column":18}},"184":{"start":{"line":309,"column":2},"end":{"line":309,"column":33}},"185":{"start":{"line":310,"column":2},"end":{"line":310,"column":17}},"186":{"start":{"line":311,"column":2},"end":{"line":311,"column":17}},"187":{"start":{"line":313,"column":2},"end":{"line":313,"column":69}},"188":{"start":{"line":316,"column":2},"end":{"line":321,"column":3}},"189":{"start":{"line":317,"column":4},"end":{"line":318,"column":42}},"190":{"start":{"line":319,"column":4},"end":{"line":319,"column":51}},"191":{"start":{"line":320,"column":4},"end":{"line":320,"column":11}},"192":{"start":{"line":324,"column":2},"end":{"line":324,"column":52}},"193":{"start":{"line":325,"column":2},"end":{"line":338,"column":3}},"194":{"start":{"line":326,"column":4},"end":{"line":326,"column":78}},"195":{"start":{"line":327,"column":4},"end":{"line":327,"column":22}},"196":{"start":{"line":328,"column":4},"end":{"line":328,"column":27}},"197":{"start":{"line":331,"column":4},"end":{"line":337,"column":5}},"198":{"start":{"line":332,"column":6},"end":{"line":332,"column":53}},"199":{"start":{"line":333,"column":6},"end":{"line":334,"column":71}},"200":{"start":{"line":335,"column":6},"end":{"line":335,"column":54}},"201":{"start":{"line":336,"column":6},"end":{"line":336,"column":13}},"202":{"start":{"line":340,"column":2},"end":{"line":358,"column":3}},"203":{"start":{"line":344,"column":4},"end":{"line":357,"column":5}},"204":{"start":{"line":345,"column":6},"end":{"line":345,"column":96}},"205":{"start":{"line":346,"column":6},"end":{"line":346,"column":24}},"206":{"start":{"line":347,"column":6},"end":{"line":347,"column":29}},"207":{"start":{"line":350,"column":6},"end":{"line":356,"column":7}},"208":{"start":{"line":351,"column":8},"end":{"line":351,"column":55}},"209":{"start":{"line":352,"column":8},"end":{"line":353,"column":89}},"210":{"start":{"line":354,"column":8},"end":{"line":354,"column":56}},"211":{"start":{"line":355,"column":8},"end":{"line":355,"column":15}},"212":{"start":{"line":360,"column":2},"end":{"line":360,"column":29}},"213":{"start":{"line":361,"column":2},"end":{"line":374,"column":3}},"214":{"start":{"line":364,"column":4},"end":{"line":368,"column":5}},"215":{"start":{"line":365,"column":6},"end":{"line":365,"column":45}},"216":{"start":{"line":367,"column":6},"end":{"line":367,"column":17}},"217":{"start":{"line":371,"column":4},"end":{"line":373,"column":5}},"218":{"start":{"line":372,"column":6},"end":{"line":372,"column":45}},"219":{"start":{"line":376,"column":2},"end":{"line":381,"column":3}},"220":{"start":{"line":377,"column":4},"end":{"line":378,"column":57}},"221":{"start":{"line":379,"column":4},"end":{"line":379,"column":51}},"222":{"start":{"line":380,"column":4},"end":{"line":380,"column":11}},"223":{"start":{"line":383,"column":2},"end":{"line":386,"column":21}},"224":{"start":{"line":388,"column":2},"end":{"line":397,"column":3}},"225":{"start":{"line":389,"column":4},"end":{"line":395,"column":5}},"226":{"start":{"line":390,"column":6},"end":{"line":390,"column":53}},"227":{"start":{"line":392,"column":6},"end":{"line":392,"column":85}},"228":{"start":{"line":393,"column":6},"end":{"line":393,"column":54}},"229":{"start":{"line":394,"column":6},"end":{"line":394,"column":13}},"230":{"start":{"line":396,"column":4},"end":{"line":396,"column":58}},"231":{"start":{"line":399,"column":2},"end":{"line":399,"column":15}},"232":{"start":{"line":400,"column":2},"end":{"line":406,"column":3}},"233":{"start":{"line":401,"column":4},"end":{"line":401,"column":43}},"234":{"start":{"line":403,"column":4},"end":{"line":403,"column":83}},"235":{"start":{"line":404,"column":4},"end":{"line":404,"column":52}},"236":{"start":{"line":405,"column":4},"end":{"line":405,"column":11}},"237":{"start":{"line":409,"column":2},"end":{"line":411,"column":3}},"238":{"start":{"line":410,"column":4},"end":{"line":410,"column":28}},"239":{"start":{"line":413,"column":2},"end":{"line":414,"column":63}},"240":{"start":{"line":415,"column":2},"end":{"line":415,"column":49}},"241":{"start":{"line":417,"column":2},"end":{"line":417,"column":18}},"242":{"start":{"line":420,"column":0},"end":{"line":427,"column":1}},"243":{"start":{"line":421,"column":2},"end":{"line":421,"column":62}},"244":{"start":{"line":422,"column":2},"end":{"line":422,"column":19}},"245":{"start":{"line":423,"column":2},"end":{"line":425,"column":5}},"246":{"start":{"line":424,"column":4},"end":{"line":424,"column":25}},"247":{"start":{"line":426,"column":2},"end":{"line":426,"column":17}},"248":{"start":{"line":429,"column":0},"end":{"line":446,"column":1}},"249":{"start":{"line":430,"column":2},"end":{"line":430,"column":48}},"250":{"start":{"line":431,"column":2},"end":{"line":443,"column":3}},"251":{"start":{"line":432,"column":4},"end":{"line":432,"column":53}},"252":{"start":{"line":433,"column":4},"end":{"line":441,"column":5}},"253":{"start":{"line":435,"column":6},"end":{"line":439,"column":9}},"254":{"start":{"line":440,"column":6},"end":{"line":440,"column":62}},"255":{"start":{"line":442,"column":4},"end":{"line":442,"column":29}},"256":{"start":{"line":444,"column":2},"end":{"line":444,"column":31}},"257":{"start":{"line":445,"column":2},"end":{"line":445,"column":14}},"258":{"start":{"line":448,"column":0},"end":{"line":454,"column":1}},"259":{"start":{"line":449,"column":2},"end":{"line":453,"column":3}},"260":{"start":{"line":450,"column":4},"end":{"line":450,"column":71}},"261":{"start":{"line":451,"column":9},"end":{"line":453,"column":3}},"262":{"start":{"line":452,"column":4},"end":{"line":452,"column":74}},"263":{"start":{"line":456,"column":0},"end":{"line":496,"column":2}},"264":{"start":{"line":457,"column":2},"end":{"line":457,"column":59}},"265":{"start":{"line":458,"column":2},"end":{"line":459,"column":23}},"266":{"start":{"line":460,"column":2},"end":{"line":464,"column":3}},"267":{"start":{"line":462,"column":4},"end":{"line":462,"column":73}},"268":{"start":{"line":463,"column":4},"end":{"line":463,"column":14}},"269":{"start":{"line":466,"column":2},"end":{"line":466,"column":77}},"270":{"start":{"line":467,"column":2},"end":{"line":468,"column":33}},"271":{"start":{"line":469,"column":2},"end":{"line":471,"column":3}},"272":{"start":{"line":470,"column":4},"end":{"line":470,"column":11}},"273":{"start":{"line":472,"column":2},"end":{"line":472,"column":90}},"274":{"start":{"line":473,"column":2},"end":{"line":473,"column":16}},"275":{"start":{"line":474,"column":2},"end":{"line":482,"column":3}},"276":{"start":{"line":475,"column":4},"end":{"line":475,"column":22}},"277":{"start":{"line":476,"column":4},"end":{"line":476,"column":32}},"278":{"start":{"line":477,"column":4},"end":{"line":477,"column":23}},"279":{"start":{"line":478,"column":4},"end":{"line":480,"column":5}},"280":{"start":{"line":479,"column":6},"end":{"line":479,"column":44}},"281":{"start":{"line":481,"column":4},"end":{"line":481,"column":26}},"282":{"start":{"line":484,"column":2},"end":{"line":494,"column":3}},"283":{"start":{"line":485,"column":4},"end":{"line":493,"column":5}},"284":{"start":{"line":486,"column":6},"end":{"line":488,"column":9}},"285":{"start":{"line":487,"column":8},"end":{"line":487,"column":31}},"286":{"start":{"line":491,"column":6},"end":{"line":492,"column":43}},"287":{"start":{"line":495,"column":2},"end":{"line":495,"column":64}},"288":{"start":{"line":498,"column":0},"end":{"line":932,"column":2}},"289":{"start":{"line":499,"column":2},"end":{"line":499,"column":18}},"290":{"start":{"line":500,"column":2},"end":{"line":500,"column":25}},"291":{"start":{"line":501,"column":2},"end":{"line":506,"column":4}},"292":{"start":{"line":507,"column":2},"end":{"line":507,"column":29}},"293":{"start":{"line":508,"column":2},"end":{"line":508,"column":26}},"294":{"start":{"line":509,"column":2},"end":{"line":509,"column":34}},"295":{"start":{"line":510,"column":2},"end":{"line":510,"column":39}},"296":{"start":{"line":512,"column":2},"end":{"line":516,"column":3}},"297":{"start":{"line":514,"column":4},"end":{"line":514,"column":73}},"298":{"start":{"line":515,"column":4},"end":{"line":515,"column":14}},"299":{"start":{"line":518,"column":2},"end":{"line":518,"column":37}},"300":{"start":{"line":519,"column":2},"end":{"line":519,"column":15}},"301":{"start":{"line":520,"column":2},"end":{"line":520,"column":29}},"302":{"start":{"line":521,"column":2},"end":{"line":532,"column":3}},"303":{"start":{"line":522,"column":4},"end":{"line":522,"column":26}},"304":{"start":{"line":523,"column":4},"end":{"line":526,"column":5}},"305":{"start":{"line":525,"column":6},"end":{"line":525,"column":15}},"306":{"start":{"line":527,"column":4},"end":{"line":529,"column":5}},"307":{"start":{"line":528,"column":6},"end":{"line":528,"column":21}},"308":{"start":{"line":530,"column":4},"end":{"line":530,"column":23}},"309":{"start":{"line":531,"column":4},"end":{"line":531,"column":38}},"310":{"start":{"line":534,"column":2},"end":{"line":534,"column":16}},"311":{"start":{"line":535,"column":2},"end":{"line":542,"column":3}},"312":{"start":{"line":536,"column":4},"end":{"line":536,"column":23}},"313":{"start":{"line":537,"column":4},"end":{"line":540,"column":5}},"314":{"start":{"line":539,"column":6},"end":{"line":539,"column":15}},"315":{"start":{"line":541,"column":4},"end":{"line":541,"column":28}},"316":{"start":{"line":544,"column":2},"end":{"line":544,"column":27}},"317":{"start":{"line":545,"column":2},"end":{"line":545,"column":23}},"318":{"start":{"line":546,"column":2},"end":{"line":546,"column":31}},"319":{"start":{"line":547,"column":2},"end":{"line":547,"column":26}},"320":{"start":{"line":548,"column":2},"end":{"line":548,"column":28}},"321":{"start":{"line":549,"column":2},"end":{"line":549,"column":24}},"322":{"start":{"line":550,"column":2},"end":{"line":550,"column":30}},"323":{"start":{"line":552,"column":2},"end":{"line":552,"column":30}},"324":{"start":{"line":555,"column":2},"end":{"line":555,"column":45}},"325":{"start":{"line":556,"column":2},"end":{"line":584,"column":3}},"326":{"start":{"line":557,"column":4},"end":{"line":557,"column":23}},"327":{"start":{"line":558,"column":4},"end":{"line":558,"column":25}},"328":{"start":{"line":559,"column":4},"end":{"line":562,"column":5}},"329":{"start":{"line":560,"column":6},"end":{"line":560,"column":41}},"330":{"start":{"line":561,"column":6},"end":{"line":561,"column":29}},"331":{"start":{"line":563,"column":4},"end":{"line":567,"column":5}},"332":{"start":{"line":564,"column":6},"end":{"line":564,"column":35}},"333":{"start":{"line":565,"column":6},"end":{"line":565,"column":36}},"334":{"start":{"line":566,"column":6},"end":{"line":566,"column":48}},"335":{"start":{"line":570,"column":4},"end":{"line":575,"column":5}},"336":{"start":{"line":571,"column":6},"end":{"line":571,"column":35}},"337":{"start":{"line":572,"column":6},"end":{"line":574,"column":7}},"338":{"start":{"line":573,"column":8},"end":{"line":573,"column":52}},"339":{"start":{"line":578,"column":4},"end":{"line":583,"column":5}},"340":{"start":{"line":579,"column":6},"end":{"line":579,"column":41}},"341":{"start":{"line":580,"column":6},"end":{"line":582,"column":7}},"342":{"start":{"line":581,"column":8},"end":{"line":581,"column":50}},"343":{"start":{"line":587,"column":2},"end":{"line":601,"column":3}},"344":{"start":{"line":588,"column":4},"end":{"line":588,"column":28}},"345":{"start":{"line":589,"column":4},"end":{"line":589,"column":42}},"346":{"start":{"line":590,"column":4},"end":{"line":594,"column":5}},"347":{"start":{"line":593,"column":6},"end":{"line":593,"column":34}},"348":{"start":{"line":595,"column":4},"end":{"line":600,"column":5}},"349":{"start":{"line":596,"column":6},"end":{"line":596,"column":29}},"350":{"start":{"line":597,"column":6},"end":{"line":599,"column":7}},"351":{"start":{"line":598,"column":8},"end":{"line":598,"column":47}},"352":{"start":{"line":604,"column":2},"end":{"line":604,"column":34}},"353":{"start":{"line":605,"column":2},"end":{"line":610,"column":3}},"354":{"start":{"line":606,"column":4},"end":{"line":608,"column":5}},"355":{"start":{"line":607,"column":6},"end":{"line":607,"column":31}},"356":{"start":{"line":609,"column":4},"end":{"line":609,"column":38}},"357":{"start":{"line":611,"column":2},"end":{"line":611,"column":80}},"358":{"start":{"line":613,"column":2},"end":{"line":613,"column":29}},"359":{"start":{"line":614,"column":2},"end":{"line":614,"column":36}},"360":{"start":{"line":615,"column":2},"end":{"line":615,"column":53}},"361":{"start":{"line":616,"column":2},"end":{"line":616,"column":32}},"362":{"start":{"line":619,"column":2},"end":{"line":678,"column":3}},"363":{"start":{"line":620,"column":4},"end":{"line":620,"column":34}},"364":{"start":{"line":621,"column":4},"end":{"line":621,"column":32}},"365":{"start":{"line":622,"column":4},"end":{"line":622,"column":30}},"366":{"start":{"line":623,"column":4},"end":{"line":623,"column":34}},"367":{"start":{"line":624,"column":4},"end":{"line":626,"column":5}},"368":{"start":{"line":625,"column":6},"end":{"line":625,"column":15}},"369":{"start":{"line":628,"column":4},"end":{"line":630,"column":5}},"370":{"start":{"line":629,"column":6},"end":{"line":629,"column":34}},"371":{"start":{"line":631,"column":4},"end":{"line":631,"column":32}},"372":{"start":{"line":632,"column":4},"end":{"line":632,"column":74}},"373":{"start":{"line":633,"column":4},"end":{"line":635,"column":5}},"374":{"start":{"line":634,"column":6},"end":{"line":634,"column":44}},"375":{"start":{"line":636,"column":4},"end":{"line":676,"column":5}},"376":{"start":{"line":639,"column":6},"end":{"line":675,"column":7}},"377":{"start":{"line":644,"column":8},"end":{"line":650,"column":9}},"378":{"start":{"line":646,"column":10},"end":{"line":649,"column":13}},"379":{"start":{"line":652,"column":8},"end":{"line":658,"column":9}},"380":{"start":{"line":654,"column":10},"end":{"line":657,"column":13}},"381":{"start":{"line":660,"column":8},"end":{"line":666,"column":9}},"382":{"start":{"line":662,"column":10},"end":{"line":665,"column":13}},"383":{"start":{"line":667,"column":8},"end":{"line":673,"column":9}},"384":{"start":{"line":669,"column":10},"end":{"line":672,"column":13}},"385":{"start":{"line":674,"column":8},"end":{"line":674,"column":17}},"386":{"start":{"line":677,"column":4},"end":{"line":677,"column":34}},"387":{"start":{"line":681,"column":2},"end":{"line":681,"column":31}},"388":{"start":{"line":682,"column":2},"end":{"line":687,"column":3}},"389":{"start":{"line":683,"column":4},"end":{"line":683,"column":33}},"390":{"start":{"line":684,"column":4},"end":{"line":686,"column":5}},"391":{"start":{"line":685,"column":6},"end":{"line":685,"column":34}},"392":{"start":{"line":690,"column":2},"end":{"line":690,"column":42}},"393":{"start":{"line":691,"column":2},"end":{"line":696,"column":3}},"394":{"start":{"line":692,"column":4},"end":{"line":692,"column":41}},"395":{"start":{"line":693,"column":4},"end":{"line":695,"column":5}},"396":{"start":{"line":694,"column":6},"end":{"line":694,"column":46}},"397":{"start":{"line":698,"column":2},"end":{"line":698,"column":23}},"398":{"start":{"line":699,"column":2},"end":{"line":704,"column":3}},"399":{"start":{"line":700,"column":4},"end":{"line":703,"column":5}},"400":{"start":{"line":702,"column":6},"end":{"line":702,"column":26}},"401":{"start":{"line":706,"column":2},"end":{"line":713,"column":3}},"402":{"start":{"line":707,"column":4},"end":{"line":707,"column":53}},"403":{"start":{"line":709,"column":4},"end":{"line":711,"column":7}},"404":{"start":{"line":710,"column":6},"end":{"line":710,"column":45}},"405":{"start":{"line":712,"column":4},"end":{"line":712,"column":78}},"406":{"start":{"line":715,"column":2},"end":{"line":715,"column":30}},"407":{"start":{"line":716,"column":2},"end":{"line":716,"column":20}},"408":{"start":{"line":719,"column":2},"end":{"line":732,"column":3}},"409":{"start":{"line":720,"column":4},"end":{"line":720,"column":28}},"410":{"start":{"line":721,"column":4},"end":{"line":721,"column":45}},"411":{"start":{"line":722,"column":4},"end":{"line":724,"column":5}},"412":{"start":{"line":723,"column":6},"end":{"line":723,"column":15}},"413":{"start":{"line":725,"column":4},"end":{"line":731,"column":5}},"414":{"start":{"line":726,"column":6},"end":{"line":726,"column":52}},"415":{"start":{"line":727,"column":6},"end":{"line":727,"column":50}},"416":{"start":{"line":729,"column":6},"end":{"line":730,"column":73}},"417":{"start":{"line":734,"column":2},"end":{"line":744,"column":3}},"418":{"start":{"line":735,"column":4},"end":{"line":735,"column":57}},"419":{"start":{"line":737,"column":4},"end":{"line":738,"column":61}},"420":{"start":{"line":739,"column":4},"end":{"line":743,"column":5}},"421":{"start":{"line":740,"column":6},"end":{"line":740,"column":85}},"422":{"start":{"line":742,"column":6},"end":{"line":742,"column":77}},"423":{"start":{"line":747,"column":2},"end":{"line":767,"column":3}},"424":{"start":{"line":748,"column":4},"end":{"line":750,"column":5}},"425":{"start":{"line":749,"column":6},"end":{"line":749,"column":13}},"426":{"start":{"line":751,"column":4},"end":{"line":751,"column":80}},"427":{"start":{"line":752,"column":4},"end":{"line":754,"column":8}},"428":{"start":{"line":753,"column":6},"end":{"line":753,"column":79}},"429":{"start":{"line":756,"column":4},"end":{"line":766,"column":5}},"430":{"start":{"line":757,"column":6},"end":{"line":757,"column":40}},"431":{"start":{"line":758,"column":6},"end":{"line":758,"column":21}},"432":{"start":{"line":759,"column":6},"end":{"line":765,"column":7}},"433":{"start":{"line":760,"column":8},"end":{"line":761,"column":54}},"434":{"start":{"line":763,"column":8},"end":{"line":764,"column":44}},"435":{"start":{"line":770,"column":2},"end":{"line":797,"column":3}},"436":{"start":{"line":771,"column":4},"end":{"line":775,"column":5}},"437":{"start":{"line":772,"column":6},"end":{"line":772,"column":71}},"438":{"start":{"line":773,"column":6},"end":{"line":774,"column":47}},"439":{"start":{"line":777,"column":4},"end":{"line":779,"column":5}},"440":{"start":{"line":778,"column":6},"end":{"line":778,"column":13}},"441":{"start":{"line":780,"column":4},"end":{"line":780,"column":64}},"442":{"start":{"line":782,"column":4},"end":{"line":784,"column":8}},"443":{"start":{"line":783,"column":6},"end":{"line":783,"column":65}},"444":{"start":{"line":786,"column":4},"end":{"line":796,"column":5}},"445":{"start":{"line":787,"column":6},"end":{"line":787,"column":32}},"446":{"start":{"line":788,"column":6},"end":{"line":788,"column":21}},"447":{"start":{"line":789,"column":6},"end":{"line":795,"column":7}},"448":{"start":{"line":790,"column":8},"end":{"line":791,"column":54}},"449":{"start":{"line":793,"column":8},"end":{"line":794,"column":58}},"450":{"start":{"line":800,"column":2},"end":{"line":819,"column":3}},"451":{"start":{"line":801,"column":4},"end":{"line":803,"column":5}},"452":{"start":{"line":802,"column":6},"end":{"line":802,"column":13}},"453":{"start":{"line":804,"column":4},"end":{"line":804,"column":70}},"454":{"start":{"line":806,"column":4},"end":{"line":808,"column":8}},"455":{"start":{"line":807,"column":6},"end":{"line":807,"column":69}},"456":{"start":{"line":810,"column":4},"end":{"line":818,"column":5}},"457":{"start":{"line":811,"column":6},"end":{"line":811,"column":35}},"458":{"start":{"line":812,"column":6},"end":{"line":812,"column":21}},"459":{"start":{"line":813,"column":6},"end":{"line":817,"column":7}},"460":{"start":{"line":814,"column":8},"end":{"line":814,"column":80}},"461":{"start":{"line":816,"column":8},"end":{"line":816,"column":47}},"462":{"start":{"line":821,"column":2},"end":{"line":842,"column":3}},"463":{"start":{"line":822,"column":4},"end":{"line":824,"column":5}},"464":{"start":{"line":823,"column":6},"end":{"line":823,"column":13}},"465":{"start":{"line":825,"column":4},"end":{"line":825,"column":84}},"466":{"start":{"line":827,"column":4},"end":{"line":831,"column":8}},"467":{"start":{"line":828,"column":6},"end":{"line":830,"column":9}},"468":{"start":{"line":833,"column":4},"end":{"line":841,"column":5}},"469":{"start":{"line":834,"column":6},"end":{"line":834,"column":39}},"470":{"start":{"line":835,"column":6},"end":{"line":835,"column":21}},"471":{"start":{"line":836,"column":6},"end":{"line":840,"column":7}},"472":{"start":{"line":837,"column":8},"end":{"line":837,"column":80}},"473":{"start":{"line":839,"column":8},"end":{"line":839,"column":80}},"474":{"start":{"line":844,"column":2},"end":{"line":881,"column":3}},"475":{"start":{"line":845,"column":4},"end":{"line":845,"column":26}},"476":{"start":{"line":846,"column":4},"end":{"line":846,"column":42}},"477":{"start":{"line":847,"column":4},"end":{"line":849,"column":5}},"478":{"start":{"line":848,"column":6},"end":{"line":848,"column":13}},"479":{"start":{"line":850,"column":4},"end":{"line":850,"column":46}},"480":{"start":{"line":851,"column":4},"end":{"line":851,"column":17}},"481":{"start":{"line":852,"column":4},"end":{"line":854,"column":7}},"482":{"start":{"line":853,"column":6},"end":{"line":853,"column":22}},"483":{"start":{"line":855,"column":4},"end":{"line":862,"column":7}},"484":{"start":{"line":856,"column":6},"end":{"line":856,"column":28}},"485":{"start":{"line":857,"column":6},"end":{"line":861,"column":7}},"486":{"start":{"line":858,"column":8},"end":{"line":860,"column":9}},"487":{"start":{"line":859,"column":10},"end":{"line":859,"column":38}},"488":{"start":{"line":864,"column":4},"end":{"line":867,"column":5}},"489":{"start":{"line":865,"column":6},"end":{"line":865,"column":69}},"490":{"start":{"line":866,"column":6},"end":{"line":866,"column":13}},"491":{"start":{"line":869,"column":4},"end":{"line":870,"column":61}},"492":{"start":{"line":871,"column":4},"end":{"line":873,"column":8}},"493":{"start":{"line":872,"column":6},"end":{"line":872,"column":36}},"494":{"start":{"line":875,"column":4},"end":{"line":880,"column":5}},"495":{"start":{"line":876,"column":6},"end":{"line":876,"column":21}},"496":{"start":{"line":877,"column":6},"end":{"line":879,"column":7}},"497":{"start":{"line":878,"column":8},"end":{"line":878,"column":65}},"498":{"start":{"line":884,"column":2},"end":{"line":900,"column":3}},"499":{"start":{"line":885,"column":4},"end":{"line":887,"column":5}},"500":{"start":{"line":886,"column":6},"end":{"line":886,"column":13}},"501":{"start":{"line":889,"column":4},"end":{"line":889,"column":75}},"502":{"start":{"line":890,"column":4},"end":{"line":892,"column":8}},"503":{"start":{"line":891,"column":6},"end":{"line":891,"column":52}},"504":{"start":{"line":894,"column":4},"end":{"line":899,"column":5}},"505":{"start":{"line":895,"column":6},"end":{"line":895,"column":21}},"506":{"start":{"line":896,"column":6},"end":{"line":898,"column":7}},"507":{"start":{"line":897,"column":8},"end":{"line":897,"column":63}},"508":{"start":{"line":903,"column":2},"end":{"line":920,"column":3}},"509":{"start":{"line":904,"column":4},"end":{"line":906,"column":5}},"510":{"start":{"line":905,"column":6},"end":{"line":905,"column":13}},"511":{"start":{"line":908,"column":4},"end":{"line":909,"column":59}},"512":{"start":{"line":910,"column":4},"end":{"line":912,"column":8}},"513":{"start":{"line":911,"column":6},"end":{"line":911,"column":53}},"514":{"start":{"line":914,"column":4},"end":{"line":919,"column":5}},"515":{"start":{"line":915,"column":6},"end":{"line":915,"column":21}},"516":{"start":{"line":916,"column":6},"end":{"line":918,"column":7}},"517":{"start":{"line":917,"column":8},"end":{"line":917,"column":73}},"518":{"start":{"line":922,"column":2},"end":{"line":930,"column":4}},"519":{"start":{"line":931,"column":2},"end":{"line":931,"column":28}},"520":{"start":{"line":934,"column":0},"end":{"line":1124,"column":2}},"521":{"start":{"line":935,"column":2},"end":{"line":935,"column":54}},"522":{"start":{"line":936,"column":2},"end":{"line":938,"column":47}},"523":{"start":{"line":939,"column":2},"end":{"line":939,"column":18}},"524":{"start":{"line":940,"column":2},"end":{"line":940,"column":31}},"525":{"start":{"line":941,"column":2},"end":{"line":941,"column":43}},"526":{"start":{"line":942,"column":2},"end":{"line":942,"column":40}},"527":{"start":{"line":943,"column":2},"end":{"line":943,"column":53}},"528":{"start":{"line":944,"column":2},"end":{"line":944,"column":42}},"529":{"start":{"line":946,"column":2},"end":{"line":954,"column":4}},"530":{"start":{"line":956,"column":2},"end":{"line":956,"column":67}},"531":{"start":{"line":957,"column":2},"end":{"line":957,"column":27}},"532":{"start":{"line":958,"column":2},"end":{"line":960,"column":3}},"533":{"start":{"line":959,"column":4},"end":{"line":959,"column":71}},"534":{"start":{"line":962,"column":2},"end":{"line":969,"column":54}},"535":{"start":{"line":971,"column":2},"end":{"line":973,"column":3}},"536":{"start":{"line":972,"column":4},"end":{"line":972,"column":65}},"537":{"start":{"line":975,"column":2},"end":{"line":977,"column":3}},"538":{"start":{"line":976,"column":4},"end":{"line":976,"column":71}},"539":{"start":{"line":979,"column":2},"end":{"line":987,"column":3}},"540":{"start":{"line":980,"column":4},"end":{"line":982,"column":5}},"541":{"start":{"line":981,"column":6},"end":{"line":981,"column":32}},"542":{"start":{"line":984,"column":4},"end":{"line":986,"column":5}},"543":{"start":{"line":985,"column":6},"end":{"line":985,"column":35}},"544":{"start":{"line":990,"column":2},"end":{"line":990,"column":73}},"545":{"start":{"line":992,"column":2},"end":{"line":992,"column":41}},"546":{"start":{"line":993,"column":2},"end":{"line":993,"column":19}},"547":{"start":{"line":995,"column":2},"end":{"line":1073,"column":3}},"548":{"start":{"line":997,"column":4},"end":{"line":997,"column":84}},"549":{"start":{"line":998,"column":4},"end":{"line":998,"column":10}},"550":{"start":{"line":999,"column":4},"end":{"line":1004,"column":5}},"551":{"start":{"line":1000,"column":6},"end":{"line":1000,"column":49}},"552":{"start":{"line":1002,"column":6},"end":{"line":1002,"column":98}},"553":{"start":{"line":1003,"column":6},"end":{"line":1003,"column":16}},"554":{"start":{"line":1006,"column":4},"end":{"line":1006,"column":36}},"555":{"start":{"line":1015,"column":4},"end":{"line":1021,"column":5}},"556":{"start":{"line":1016,"column":6},"end":{"line":1016,"column":82}},"557":{"start":{"line":1017,"column":6},"end":{"line":1017,"column":40}},"558":{"start":{"line":1018,"column":6},"end":{"line":1018,"column":31}},"559":{"start":{"line":1019,"column":6},"end":{"line":1019,"column":62}},"560":{"start":{"line":1020,"column":6},"end":{"line":1020,"column":16}},"561":{"start":{"line":1024,"column":4},"end":{"line":1024,"column":43}},"562":{"start":{"line":1025,"column":4},"end":{"line":1028,"column":7}},"563":{"start":{"line":1026,"column":6},"end":{"line":1026,"column":26}},"564":{"start":{"line":1027,"column":6},"end":{"line":1027,"column":30}},"565":{"start":{"line":1029,"column":4},"end":{"line":1029,"column":33}},"566":{"start":{"line":1030,"column":4},"end":{"line":1030,"column":16}},"567":{"start":{"line":1032,"column":4},"end":{"line":1038,"column":5}},"568":{"start":{"line":1033,"column":6},"end":{"line":1033,"column":72}},"569":{"start":{"line":1034,"column":6},"end":{"line":1034,"column":48}},"570":{"start":{"line":1035,"column":6},"end":{"line":1035,"column":31}},"571":{"start":{"line":1036,"column":6},"end":{"line":1036,"column":62}},"572":{"start":{"line":1037,"column":6},"end":{"line":1037,"column":16}},"573":{"start":{"line":1041,"column":4},"end":{"line":1041,"column":34}},"574":{"start":{"line":1042,"column":4},"end":{"line":1049,"column":5}},"575":{"start":{"line":1043,"column":6},"end":{"line":1044,"column":51}},"576":{"start":{"line":1045,"column":6},"end":{"line":1045,"column":46}},"577":{"start":{"line":1046,"column":6},"end":{"line":1046,"column":31}},"578":{"start":{"line":1047,"column":6},"end":{"line":1047,"column":62}},"579":{"start":{"line":1048,"column":6},"end":{"line":1048,"column":16}},"580":{"start":{"line":1051,"column":4},"end":{"line":1055,"column":6}},"581":{"start":{"line":1057,"column":4},"end":{"line":1057,"column":73}},"582":{"start":{"line":1058,"column":4},"end":{"line":1058,"column":15}},"583":{"start":{"line":1059,"column":4},"end":{"line":1064,"column":5}},"584":{"start":{"line":1060,"column":6},"end":{"line":1060,"column":51}},"585":{"start":{"line":1062,"column":6},"end":{"line":1062,"column":78}},"586":{"start":{"line":1063,"column":6},"end":{"line":1063,"column":16}},"587":{"start":{"line":1065,"column":4},"end":{"line":1065,"column":84}},"588":{"start":{"line":1066,"column":4},"end":{"line":1066,"column":38}},"589":{"start":{"line":1067,"column":4},"end":{"line":1068,"column":49}},"590":{"start":{"line":1069,"column":4},"end":{"line":1069,"column":13}},"591":{"start":{"line":1072,"column":4},"end":{"line":1072,"column":38}},"592":{"start":{"line":1075,"column":2},"end":{"line":1123,"column":3}},"593":{"start":{"line":1078,"column":4},"end":{"line":1078,"column":26}},"594":{"start":{"line":1079,"column":4},"end":{"line":1081,"column":5}},"595":{"start":{"line":1080,"column":6},"end":{"line":1080,"column":61}},"596":{"start":{"line":1083,"column":4},"end":{"line":1089,"column":6}},"597":{"start":{"line":1092,"column":4},"end":{"line":1092,"column":40}},"598":{"start":{"line":1093,"column":4},"end":{"line":1096,"column":5}},"599":{"start":{"line":1095,"column":6},"end":{"line":1095,"column":42}},"600":{"start":{"line":1098,"column":4},"end":{"line":1102,"column":6}},"601":{"start":{"line":1104,"column":4},"end":{"line":1109,"column":5}},"602":{"start":{"line":1105,"column":6},"end":{"line":1105,"column":32}},"603":{"start":{"line":1106,"column":11},"end":{"line":1109,"column":5}},"604":{"start":{"line":1107,"column":6},"end":{"line":1107,"column":28}},"605":{"start":{"line":1108,"column":6},"end":{"line":1108,"column":32}},"606":{"start":{"line":1111,"column":4},"end":{"line":1111,"column":28}},"607":{"start":{"line":1112,"column":4},"end":{"line":1112,"column":49}},"608":{"start":{"line":1114,"column":4},"end":{"line":1120,"column":21}},"609":{"start":{"line":1122,"column":4},"end":{"line":1122,"column":13}},"610":{"start":{"line":1126,"column":0},"end":{"line":1140,"column":2}},"611":{"start":{"line":1127,"column":2},"end":{"line":1127,"column":26}},"612":{"start":{"line":1128,"column":2},"end":{"line":1128,"column":73}},"613":{"start":{"line":1129,"column":2},"end":{"line":1137,"column":5}},"614":{"start":{"line":1138,"column":2},"end":{"line":1138,"column":17}},"615":{"start":{"line":1139,"column":2},"end":{"line":1139,"column":19}}},"branchMap":{"1":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]},"2":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":14},"end":{"line":43,"column":26}},{"start":{"line":43,"column":30},"end":{"line":43,"column":39}}]},"3":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":21},"end":{"line":48,"column":40}},{"start":{"line":48,"column":44},"end":{"line":48,"column":45}}]},"4":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":2},"end":{"line":71,"column":2}},{"start":{"line":71,"column":2},"end":{"line":71,"column":2}}]},"5":{"line":71,"type":"binary-expr","locations":[{"start":{"line":71,"column":6},"end":{"line":71,"column":20}},{"start":{"line":71,"column":24},"end":{"line":71,"column":65}}]},"6":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":2},"end":{"line":90,"column":2}},{"start":{"line":90,"column":2},"end":{"line":90,"column":2}}]},"7":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":91,"column":4}},{"start":{"line":91,"column":4},"end":{"line":91,"column":4}}]},"8":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":2},"end":{"line":101,"column":2}},{"start":{"line":101,"column":2},"end":{"line":101,"column":2}}]},"9":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":4},"end":{"line":111,"column":4}},{"start":{"line":111,"column":4},"end":{"line":111,"column":4}}]},"10":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":117,"column":4}},{"start":{"line":117,"column":4},"end":{"line":117,"column":4}}]},"11":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":4},"end":{"line":129,"column":4}},{"start":{"line":129,"column":4},"end":{"line":129,"column":4}}]},"12":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":4},"end":{"line":137,"column":4}},{"start":{"line":137,"column":4},"end":{"line":137,"column":4}}]},"13":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":2},"end":{"line":163,"column":2}},{"start":{"line":163,"column":2},"end":{"line":163,"column":2}}]},"14":{"line":174,"type":"cond-expr","locations":[{"start":{"line":174,"column":20},"end":{"line":174,"column":29}},{"start":{"line":174,"column":32},"end":{"line":174,"column":38}}]},"15":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":2},"end":{"line":175,"column":2}},{"start":{"line":175,"column":2},"end":{"line":175,"column":2}}]},"16":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":2},"end":{"line":189,"column":2}},{"start":{"line":189,"column":2},"end":{"line":189,"column":2}}]},"17":{"line":189,"type":"binary-expr","locations":[{"start":{"line":189,"column":6},"end":{"line":189,"column":65}},{"start":{"line":190,"column":6},"end":{"line":190,"column":65}},{"start":{"line":191,"column":6},"end":{"line":191,"column":66}}]},"18":{"line":197,"type":"if","locations":[{"start":{"line":197,"column":2},"end":{"line":197,"column":2}},{"start":{"line":197,"column":2},"end":{"line":197,"column":2}}]},"19":{"line":201,"type":"if","locations":[{"start":{"line":201,"column":2},"end":{"line":201,"column":2}},{"start":{"line":201,"column":2},"end":{"line":201,"column":2}}]},"20":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":2},"end":{"line":214,"column":2}},{"start":{"line":214,"column":2},"end":{"line":214,"column":2}}]},"21":{"line":214,"type":"binary-expr","locations":[{"start":{"line":214,"column":6},"end":{"line":214,"column":22}},{"start":{"line":214,"column":26},"end":{"line":214,"column":36}}]},"22":{"line":233,"type":"if","locations":[{"start":{"line":233,"column":4},"end":{"line":233,"column":4}},{"start":{"line":233,"column":4},"end":{"line":233,"column":4}}]},"23":{"line":233,"type":"binary-expr","locations":[{"start":{"line":233,"column":8},"end":{"line":233,"column":25}},{"start":{"line":233,"column":29},"end":{"line":233,"column":40}}]},"24":{"line":241,"type":"if","locations":[{"start":{"line":241,"column":4},"end":{"line":241,"column":4}},{"start":{"line":241,"column":4},"end":{"line":241,"column":4}}]},"25":{"line":241,"type":"binary-expr","locations":[{"start":{"line":241,"column":8},"end":{"line":241,"column":16}},{"start":{"line":241,"column":20},"end":{"line":241,"column":56}}]},"26":{"line":246,"type":"if","locations":[{"start":{"line":246,"column":4},"end":{"line":246,"column":4}},{"start":{"line":246,"column":4},"end":{"line":246,"column":4}}]},"27":{"line":250,"type":"if","locations":[{"start":{"line":250,"column":4},"end":{"line":250,"column":4}},{"start":{"line":250,"column":4},"end":{"line":250,"column":4}}]},"28":{"line":254,"type":"if","locations":[{"start":{"line":254,"column":4},"end":{"line":254,"column":4}},{"start":{"line":254,"column":4},"end":{"line":254,"column":4}}]},"29":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":4},"end":{"line":259,"column":4}},{"start":{"line":259,"column":4},"end":{"line":259,"column":4}}]},"30":{"line":284,"type":"if","locations":[{"start":{"line":284,"column":2},"end":{"line":284,"column":2}},{"start":{"line":284,"column":2},"end":{"line":284,"column":2}}]},"31":{"line":291,"type":"if","locations":[{"start":{"line":291,"column":2},"end":{"line":291,"column":2}},{"start":{"line":291,"column":2},"end":{"line":291,"column":2}}]},"32":{"line":296,"type":"cond-expr","locations":[{"start":{"line":296,"column":52},"end":{"line":296,"column":76}},{"start":{"line":296,"column":79},"end":{"line":296,"column":106}}]},"33":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":2},"end":{"line":299,"column":2}},{"start":{"line":299,"column":2},"end":{"line":299,"column":2}}]},"34":{"line":299,"type":"binary-expr","locations":[{"start":{"line":299,"column":6},"end":{"line":299,"column":14}},{"start":{"line":299,"column":18},"end":{"line":299,"column":39}},{"start":{"line":299,"column":43},"end":{"line":299,"column":83}}]},"35":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":2},"end":{"line":316,"column":2}},{"start":{"line":316,"column":2},"end":{"line":316,"column":2}}]},"36":{"line":331,"type":"if","locations":[{"start":{"line":331,"column":4},"end":{"line":331,"column":4}},{"start":{"line":331,"column":4},"end":{"line":331,"column":4}}]},"37":{"line":331,"type":"binary-expr","locations":[{"start":{"line":331,"column":8},"end":{"line":331,"column":16}},{"start":{"line":331,"column":20},"end":{"line":331,"column":46}}]},"38":{"line":340,"type":"if","locations":[{"start":{"line":340,"column":2},"end":{"line":340,"column":2}},{"start":{"line":340,"column":2},"end":{"line":340,"column":2}}]},"39":{"line":340,"type":"binary-expr","locations":[{"start":{"line":340,"column":6},"end":{"line":340,"column":20}},{"start":{"line":340,"column":24},"end":{"line":340,"column":27}},{"start":{"line":340,"column":31},"end":{"line":340,"column":55}},{"start":{"line":340,"column":59},"end":{"line":340,"column":99}}]},"40":{"line":350,"type":"if","locations":[{"start":{"line":350,"column":6},"end":{"line":350,"column":6}},{"start":{"line":350,"column":6},"end":{"line":350,"column":6}}]},"41":{"line":350,"type":"binary-expr","locations":[{"start":{"line":350,"column":10},"end":{"line":350,"column":18}},{"start":{"line":350,"column":22},"end":{"line":350,"column":48}}]},"42":{"line":361,"type":"if","locations":[{"start":{"line":361,"column":2},"end":{"line":361,"column":2}},{"start":{"line":361,"column":2},"end":{"line":361,"column":2}}]},"43":{"line":364,"type":"if","locations":[{"start":{"line":364,"column":4},"end":{"line":364,"column":4}},{"start":{"line":364,"column":4},"end":{"line":364,"column":4}}]},"44":{"line":364,"type":"binary-expr","locations":[{"start":{"line":364,"column":8},"end":{"line":364,"column":24}},{"start":{"line":364,"column":28},"end":{"line":364,"column":31}},{"start":{"line":364,"column":35},"end":{"line":364,"column":43}},{"start":{"line":364,"column":47},"end":{"line":364,"column":67}},{"start":{"line":364,"column":71},"end":{"line":364,"column":96}}]},"45":{"line":371,"type":"if","locations":[{"start":{"line":371,"column":4},"end":{"line":371,"column":4}},{"start":{"line":371,"column":4},"end":{"line":371,"column":4}}]},"46":{"line":371,"type":"binary-expr","locations":[{"start":{"line":371,"column":8},"end":{"line":371,"column":24}},{"start":{"line":371,"column":28},"end":{"line":371,"column":31}},{"start":{"line":371,"column":35},"end":{"line":371,"column":43}},{"start":{"line":371,"column":47},"end":{"line":371,"column":67}},{"start":{"line":371,"column":71},"end":{"line":371,"column":96}}]},"47":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":2},"end":{"line":376,"column":2}},{"start":{"line":376,"column":2},"end":{"line":376,"column":2}}]},"48":{"line":385,"type":"binary-expr","locations":[{"start":{"line":385,"column":22},"end":{"line":385,"column":30}},{"start":{"line":385,"column":34},"end":{"line":385,"column":51}}]},"49":{"line":388,"type":"if","locations":[{"start":{"line":388,"column":2},"end":{"line":388,"column":2}},{"start":{"line":388,"column":2},"end":{"line":388,"column":2}}]},"50":{"line":409,"type":"if","locations":[{"start":{"line":409,"column":2},"end":{"line":409,"column":2}},{"start":{"line":409,"column":2},"end":{"line":409,"column":2}}]},"51":{"line":431,"type":"if","locations":[{"start":{"line":431,"column":2},"end":{"line":431,"column":2}},{"start":{"line":431,"column":2},"end":{"line":431,"column":2}}]},"52":{"line":433,"type":"if","locations":[{"start":{"line":433,"column":4},"end":{"line":433,"column":4}},{"start":{"line":433,"column":4},"end":{"line":433,"column":4}}]},"53":{"line":433,"type":"binary-expr","locations":[{"start":{"line":433,"column":8},"end":{"line":433,"column":18}},{"start":{"line":433,"column":22},"end":{"line":433,"column":42}}]},"54":{"line":449,"type":"if","locations":[{"start":{"line":449,"column":2},"end":{"line":449,"column":2}},{"start":{"line":449,"column":2},"end":{"line":449,"column":2}}]},"55":{"line":451,"type":"if","locations":[{"start":{"line":451,"column":9},"end":{"line":451,"column":9}},{"start":{"line":451,"column":9},"end":{"line":451,"column":9}}]},"56":{"line":460,"type":"if","locations":[{"start":{"line":460,"column":2},"end":{"line":460,"column":2}},{"start":{"line":460,"column":2},"end":{"line":460,"column":2}}]},"57":{"line":469,"type":"if","locations":[{"start":{"line":469,"column":2},"end":{"line":469,"column":2}},{"start":{"line":469,"column":2},"end":{"line":469,"column":2}}]},"58":{"line":478,"type":"if","locations":[{"start":{"line":478,"column":4},"end":{"line":478,"column":4}},{"start":{"line":478,"column":4},"end":{"line":478,"column":4}}]},"59":{"line":481,"type":"binary-expr","locations":[{"start":{"line":481,"column":4},"end":{"line":481,"column":7}},{"start":{"line":481,"column":11},"end":{"line":481,"column":25}}]},"60":{"line":484,"type":"if","locations":[{"start":{"line":484,"column":2},"end":{"line":484,"column":2}},{"start":{"line":484,"column":2},"end":{"line":484,"column":2}}]},"61":{"line":512,"type":"if","locations":[{"start":{"line":512,"column":2},"end":{"line":512,"column":2}},{"start":{"line":512,"column":2},"end":{"line":512,"column":2}}]},"62":{"line":523,"type":"if","locations":[{"start":{"line":523,"column":4},"end":{"line":523,"column":4}},{"start":{"line":523,"column":4},"end":{"line":523,"column":4}}]},"63":{"line":523,"type":"binary-expr","locations":[{"start":{"line":523,"column":8},"end":{"line":523,"column":18}},{"start":{"line":523,"column":22},"end":{"line":523,"column":37}}]},"64":{"line":527,"type":"if","locations":[{"start":{"line":527,"column":4},"end":{"line":527,"column":4}},{"start":{"line":527,"column":4},"end":{"line":527,"column":4}}]},"65":{"line":537,"type":"if","locations":[{"start":{"line":537,"column":4},"end":{"line":537,"column":4}},{"start":{"line":537,"column":4},"end":{"line":537,"column":4}}]},"66":{"line":555,"type":"binary-expr","locations":[{"start":{"line":555,"column":23},"end":{"line":555,"column":38}},{"start":{"line":555,"column":42},"end":{"line":555,"column":44}}]},"67":{"line":556,"type":"if","locations":[{"start":{"line":556,"column":2},"end":{"line":556,"column":2}},{"start":{"line":556,"column":2},"end":{"line":556,"column":2}}]},"68":{"line":572,"type":"if","locations":[{"start":{"line":572,"column":6},"end":{"line":572,"column":6}},{"start":{"line":572,"column":6},"end":{"line":572,"column":6}}]},"69":{"line":580,"type":"if","locations":[{"start":{"line":580,"column":6},"end":{"line":580,"column":6}},{"start":{"line":580,"column":6},"end":{"line":580,"column":6}}]},"70":{"line":589,"type":"binary-expr","locations":[{"start":{"line":589,"column":22},"end":{"line":589,"column":35}},{"start":{"line":589,"column":39},"end":{"line":589,"column":41}}]},"71":{"line":590,"type":"if","locations":[{"start":{"line":590,"column":4},"end":{"line":590,"column":4}},{"start":{"line":590,"column":4},"end":{"line":590,"column":4}}]},"72":{"line":597,"type":"if","locations":[{"start":{"line":597,"column":6},"end":{"line":597,"column":6}},{"start":{"line":597,"column":6},"end":{"line":597,"column":6}}]},"73":{"line":604,"type":"binary-expr","locations":[{"start":{"line":604,"column":18},"end":{"line":604,"column":27}},{"start":{"line":604,"column":31},"end":{"line":604,"column":33}}]},"74":{"line":606,"type":"if","locations":[{"start":{"line":606,"column":4},"end":{"line":606,"column":4}},{"start":{"line":606,"column":4},"end":{"line":606,"column":4}}]},"75":{"line":613,"type":"binary-expr","locations":[{"start":{"line":613,"column":14},"end":{"line":613,"column":22}},{"start":{"line":613,"column":26},"end":{"line":613,"column":28}}]},"76":{"line":614,"type":"binary-expr","locations":[{"start":{"line":614,"column":17},"end":{"line":614,"column":29}},{"start":{"line":614,"column":33},"end":{"line":614,"column":35}}]},"77":{"line":622,"type":"binary-expr","locations":[{"start":{"line":622,"column":17},"end":{"line":622,"column":23}},{"start":{"line":622,"column":27},"end":{"line":622,"column":29}}]},"78":{"line":624,"type":"if","locations":[{"start":{"line":624,"column":4},"end":{"line":624,"column":4}},{"start":{"line":624,"column":4},"end":{"line":624,"column":4}}]},"79":{"line":624,"type":"binary-expr","locations":[{"start":{"line":624,"column":8},"end":{"line":624,"column":16}},{"start":{"line":624,"column":20},"end":{"line":624,"column":33}},{"start":{"line":624,"column":37},"end":{"line":624,"column":58}}]},"80":{"line":628,"type":"if","locations":[{"start":{"line":628,"column":4},"end":{"line":628,"column":4}},{"start":{"line":628,"column":4},"end":{"line":628,"column":4}}]},"81":{"line":632,"type":"cond-expr","locations":[{"start":{"line":632,"column":42},"end":{"line":632,"column":66}},{"start":{"line":632,"column":69},"end":{"line":632,"column":73}}]},"82":{"line":633,"type":"if","locations":[{"start":{"line":633,"column":4},"end":{"line":633,"column":4}},{"start":{"line":633,"column":4},"end":{"line":633,"column":4}}]},"83":{"line":633,"type":"binary-expr","locations":[{"start":{"line":633,"column":8},"end":{"line":633,"column":28}},{"start":{"line":633,"column":32},"end":{"line":633,"column":55}}]},"84":{"line":636,"type":"if","locations":[{"start":{"line":636,"column":4},"end":{"line":636,"column":4}},{"start":{"line":636,"column":4},"end":{"line":636,"column":4}}]},"85":{"line":636,"type":"binary-expr","locations":[{"start":{"line":636,"column":8},"end":{"line":636,"column":22}},{"start":{"line":637,"column":8},"end":{"line":637,"column":58}}]},"86":{"line":639,"type":"if","locations":[{"start":{"line":639,"column":6},"end":{"line":639,"column":6}},{"start":{"line":639,"column":6},"end":{"line":639,"column":6}}]},"87":{"line":639,"type":"binary-expr","locations":[{"start":{"line":639,"column":11},"end":{"line":639,"column":55}},{"start":{"line":640,"column":11},"end":{"line":640,"column":32}},{"start":{"line":640,"column":36},"end":{"line":640,"column":55}}]},"88":{"line":644,"type":"if","locations":[{"start":{"line":644,"column":8},"end":{"line":644,"column":8}},{"start":{"line":644,"column":8},"end":{"line":644,"column":8}}]},"89":{"line":644,"type":"binary-expr","locations":[{"start":{"line":644,"column":12},"end":{"line":644,"column":39}},{"start":{"line":644,"column":43},"end":{"line":644,"column":62}}]},"90":{"line":652,"type":"if","locations":[{"start":{"line":652,"column":8},"end":{"line":652,"column":8}},{"start":{"line":652,"column":8},"end":{"line":652,"column":8}}]},"91":{"line":652,"type":"binary-expr","locations":[{"start":{"line":652,"column":12},"end":{"line":652,"column":34}},{"start":{"line":652,"column":38},"end":{"line":652,"column":52}}]},"92":{"line":660,"type":"if","locations":[{"start":{"line":660,"column":8},"end":{"line":660,"column":8}},{"start":{"line":660,"column":8},"end":{"line":660,"column":8}}]},"93":{"line":660,"type":"binary-expr","locations":[{"start":{"line":660,"column":12},"end":{"line":660,"column":30}},{"start":{"line":660,"column":34},"end":{"line":660,"column":82}}]},"94":{"line":667,"type":"if","locations":[{"start":{"line":667,"column":8},"end":{"line":667,"column":8}},{"start":{"line":667,"column":8},"end":{"line":667,"column":8}}]},"95":{"line":667,"type":"binary-expr","locations":[{"start":{"line":667,"column":12},"end":{"line":667,"column":37}},{"start":{"line":667,"column":41},"end":{"line":667,"column":60}}]},"96":{"line":684,"type":"if","locations":[{"start":{"line":684,"column":4},"end":{"line":684,"column":4}},{"start":{"line":684,"column":4},"end":{"line":684,"column":4}}]},"97":{"line":690,"type":"binary-expr","locations":[{"start":{"line":690,"column":19},"end":{"line":690,"column":35}},{"start":{"line":690,"column":39},"end":{"line":690,"column":41}}]},"98":{"line":693,"type":"if","locations":[{"start":{"line":693,"column":4},"end":{"line":693,"column":4}},{"start":{"line":693,"column":4},"end":{"line":693,"column":4}}]},"99":{"line":693,"type":"binary-expr","locations":[{"start":{"line":693,"column":8},"end":{"line":693,"column":24}},{"start":{"line":693,"column":28},"end":{"line":693,"column":56}}]},"100":{"line":700,"type":"if","locations":[{"start":{"line":700,"column":4},"end":{"line":700,"column":4}},{"start":{"line":700,"column":4},"end":{"line":700,"column":4}}]},"101":{"line":706,"type":"if","locations":[{"start":{"line":706,"column":2},"end":{"line":706,"column":2}},{"start":{"line":706,"column":2},"end":{"line":706,"column":2}}]},"102":{"line":722,"type":"if","locations":[{"start":{"line":722,"column":4},"end":{"line":722,"column":4}},{"start":{"line":722,"column":4},"end":{"line":722,"column":4}}]},"103":{"line":734,"type":"if","locations":[{"start":{"line":734,"column":2},"end":{"line":734,"column":2}},{"start":{"line":734,"column":2},"end":{"line":734,"column":2}}]},"104":{"line":748,"type":"if","locations":[{"start":{"line":748,"column":4},"end":{"line":748,"column":4}},{"start":{"line":748,"column":4},"end":{"line":748,"column":4}}]},"105":{"line":759,"type":"if","locations":[{"start":{"line":759,"column":6},"end":{"line":759,"column":6}},{"start":{"line":759,"column":6},"end":{"line":759,"column":6}}]},"106":{"line":771,"type":"if","locations":[{"start":{"line":771,"column":4},"end":{"line":771,"column":4}},{"start":{"line":771,"column":4},"end":{"line":771,"column":4}}]},"107":{"line":777,"type":"if","locations":[{"start":{"line":777,"column":4},"end":{"line":777,"column":4}},{"start":{"line":777,"column":4},"end":{"line":777,"column":4}}]},"108":{"line":789,"type":"if","locations":[{"start":{"line":789,"column":6},"end":{"line":789,"column":6}},{"start":{"line":789,"column":6},"end":{"line":789,"column":6}}]},"109":{"line":794,"type":"binary-expr","locations":[{"start":{"line":794,"column":28},"end":{"line":794,"column":35}},{"start":{"line":794,"column":39},"end":{"line":794,"column":56}}]},"110":{"line":801,"type":"if","locations":[{"start":{"line":801,"column":4},"end":{"line":801,"column":4}},{"start":{"line":801,"column":4},"end":{"line":801,"column":4}}]},"111":{"line":813,"type":"if","locations":[{"start":{"line":813,"column":6},"end":{"line":813,"column":6}},{"start":{"line":813,"column":6},"end":{"line":813,"column":6}}]},"112":{"line":822,"type":"if","locations":[{"start":{"line":822,"column":4},"end":{"line":822,"column":4}},{"start":{"line":822,"column":4},"end":{"line":822,"column":4}}]},"113":{"line":836,"type":"if","locations":[{"start":{"line":836,"column":6},"end":{"line":836,"column":6}},{"start":{"line":836,"column":6},"end":{"line":836,"column":6}}]},"114":{"line":847,"type":"if","locations":[{"start":{"line":847,"column":4},"end":{"line":847,"column":4}},{"start":{"line":847,"column":4},"end":{"line":847,"column":4}}]},"115":{"line":857,"type":"if","locations":[{"start":{"line":857,"column":6},"end":{"line":857,"column":6}},{"start":{"line":857,"column":6},"end":{"line":857,"column":6}}]},"116":{"line":857,"type":"binary-expr","locations":[{"start":{"line":857,"column":10},"end":{"line":857,"column":12}},{"start":{"line":857,"column":16},"end":{"line":857,"column":23}}]},"117":{"line":858,"type":"if","locations":[{"start":{"line":858,"column":8},"end":{"line":858,"column":8}},{"start":{"line":858,"column":8},"end":{"line":858,"column":8}}]},"118":{"line":858,"type":"binary-expr","locations":[{"start":{"line":858,"column":12},"end":{"line":858,"column":31}},{"start":{"line":858,"column":35},"end":{"line":858,"column":54}}]},"119":{"line":864,"type":"if","locations":[{"start":{"line":864,"column":4},"end":{"line":864,"column":4}},{"start":{"line":864,"column":4},"end":{"line":864,"column":4}}]},"120":{"line":877,"type":"if","locations":[{"start":{"line":877,"column":6},"end":{"line":877,"column":6}},{"start":{"line":877,"column":6},"end":{"line":877,"column":6}}]},"121":{"line":885,"type":"if","locations":[{"start":{"line":885,"column":4},"end":{"line":885,"column":4}},{"start":{"line":885,"column":4},"end":{"line":885,"column":4}}]},"122":{"line":896,"type":"if","locations":[{"start":{"line":896,"column":6},"end":{"line":896,"column":6}},{"start":{"line":896,"column":6},"end":{"line":896,"column":6}}]},"123":{"line":904,"type":"if","locations":[{"start":{"line":904,"column":4},"end":{"line":904,"column":4}},{"start":{"line":904,"column":4},"end":{"line":904,"column":4}}]},"124":{"line":916,"type":"if","locations":[{"start":{"line":916,"column":6},"end":{"line":916,"column":6}},{"start":{"line":916,"column":6},"end":{"line":916,"column":6}}]},"125":{"line":956,"type":"binary-expr","locations":[{"start":{"line":956,"column":33},"end":{"line":956,"column":59}},{"start":{"line":956,"column":63},"end":{"line":956,"column":65}}]},"126":{"line":958,"type":"if","locations":[{"start":{"line":958,"column":2},"end":{"line":958,"column":2}},{"start":{"line":958,"column":2},"end":{"line":958,"column":2}}]},"127":{"line":959,"type":"binary-expr","locations":[{"start":{"line":959,"column":34},"end":{"line":959,"column":63}},{"start":{"line":959,"column":67},"end":{"line":959,"column":69}}]},"128":{"line":971,"type":"if","locations":[{"start":{"line":971,"column":2},"end":{"line":971,"column":2}},{"start":{"line":971,"column":2},"end":{"line":971,"column":2}}]},"129":{"line":975,"type":"if","locations":[{"start":{"line":975,"column":2},"end":{"line":975,"column":2}},{"start":{"line":975,"column":2},"end":{"line":975,"column":2}}]},"130":{"line":979,"type":"if","locations":[{"start":{"line":979,"column":2},"end":{"line":979,"column":2}},{"start":{"line":979,"column":2},"end":{"line":979,"column":2}}]},"131":{"line":1006,"type":"binary-expr","locations":[{"start":{"line":1006,"column":21},"end":{"line":1006,"column":29}},{"start":{"line":1006,"column":33},"end":{"line":1006,"column":35}}]},"132":{"line":1015,"type":"if","locations":[{"start":{"line":1015,"column":4},"end":{"line":1015,"column":4}},{"start":{"line":1015,"column":4},"end":{"line":1015,"column":4}}]},"133":{"line":1032,"type":"if","locations":[{"start":{"line":1032,"column":4},"end":{"line":1032,"column":4}},{"start":{"line":1032,"column":4},"end":{"line":1032,"column":4}}]},"134":{"line":1042,"type":"if","locations":[{"start":{"line":1042,"column":4},"end":{"line":1042,"column":4}},{"start":{"line":1042,"column":4},"end":{"line":1042,"column":4}}]},"135":{"line":1079,"type":"if","locations":[{"start":{"line":1079,"column":4},"end":{"line":1079,"column":4}},{"start":{"line":1079,"column":4},"end":{"line":1079,"column":4}}]},"136":{"line":1080,"type":"binary-expr","locations":[{"start":{"line":1080,"column":15},"end":{"line":1080,"column":48}},{"start":{"line":1080,"column":52},"end":{"line":1080,"column":60}}]},"137":{"line":1093,"type":"if","locations":[{"start":{"line":1093,"column":4},"end":{"line":1093,"column":4}},{"start":{"line":1093,"column":4},"end":{"line":1093,"column":4}}]},"138":{"line":1104,"type":"if","locations":[{"start":{"line":1104,"column":4},"end":{"line":1104,"column":4}},{"start":{"line":1104,"column":4},"end":{"line":1104,"column":4}}]},"139":{"line":1106,"type":"if","locations":[{"start":{"line":1106,"column":11},"end":{"line":1106,"column":11}},{"start":{"line":1106,"column":11},"end":{"line":1106,"column":11}}]},"140":{"line":1127,"type":"binary-expr","locations":[{"start":{"line":1127,"column":12},"end":{"line":1127,"column":19}},{"start":{"line":1127,"column":23},"end":{"line":1127,"column":25}}]}},"code":["'use strict';","","var debug = require('debug')('cnpmjs.org:sync_module_worker');","var co = require('co');","var gather = require('co-gather');","var defer = require('co-defer');","var thunkify = require('thunkify-wrap');","var EventEmitter = require('events').EventEmitter;","var util = require('util');","var fs = require('fs');","var path = require('path');","var crypto = require('crypto');","var sleep = require('co-sleep');","var utility = require('utility');","var urlparse = require('url').parse;","var urllib = require('../common/urllib');","var config = require('../config');","var nfs = require('../common/nfs');","var logger = require('../common/logger');","var common = require('../lib/common');","var npmSerivce = require('../services/npm');","var packageService = require('../services/package');","var logService = require('../services/module_log');","var User = require('../models').User;","var os = require('os');","","var USER_AGENT = 'sync.cnpmjs.org/' + config.version +","  ' hostname/' + os.hostname() +","  ' syncModel/' + config.syncModel +","  ' syncInterval/' + config.syncInterval +","  ' syncConcurrency/' + config.syncConcurrency +","  ' ' + urllib.USER_AGENT;","","function SyncModuleWorker(options) {","  EventEmitter.call(this);","  this._logId = options.logId;","  this._log = '';","  this._loging = false;","  if (!Array.isArray(options.name)) {","    options.name = [options.name];","  }","","  this.type = options.type || 'package';","  this.names = options.name;","  this.startName = this.names[0];","","  this.username = options.username;","  this.concurrency = options.concurrency || 1;","  this._publish = options.publish === true; // _publish_on_cnpm","  this.syncUpstreamFirst = options.syncUpstreamFirst;","","  this.syncingNames = {};","  this.nameMap = {};","  this.names.forEach(function (name) {","    this.nameMap[name] = true;","  }.bind(this));","  this.noDep = options.noDep === true; // do not sync dependences","  this.syncDevDependencies = config.syncDevDependencies;","","  this.successes = [];","  this.fails = [];","  this.updates = [];","}","","util.inherits(SyncModuleWorker, EventEmitter);","","module.exports = SyncModuleWorker;","","SyncModuleWorker.prototype.finish = function () {","  debug('syncingNames: %j', this.syncingNames);","  if (this._finished || Object.keys(this.syncingNames).length > 0) {","    return;","  }","  this._finished = true;","  this.log('[done] Sync %s %s finished, %d success, %d fail\\nSuccess: [ %s ]\\nFail: [ %s ]',","    this.startName,","    this.type,","    this.successes.length, this.fails.length,","    this.successes.join(', '), this.fails.join(', '));","  this.emit('end');","  // make sure all event listeners release","  this.removeAllListeners();","};","","// log(format, arg1, arg2, ...)","SyncModuleWorker.prototype.log = function () {","  var str = '[' + utility.YYYYMMDDHHmmss() + '] ' + util.format.apply(util, arguments);","  debug(str);","  var logId = this._logId;","  if (logId) {","    if (this._log) {","      this._log += '\\n';","    }","    this._log += str;","    this._saveLog();","  }","};","","SyncModuleWorker.prototype._saveLog = function () {","  var that = this;","  if (that._loging) {","    return;","  }","  that._loging = true;","  var logstr = that._log;","  that._log = '';","  co(function* () {","    yield* logService.append(that._logId, logstr);","  }).then(function () {","    that._loging = false;","    if (that._log) {","      that._saveLog();","    }","  }).catch(function (err) {","    logger.error(err);","    that._loging = false;","    if (that._log) {","      that._saveLog();","    }","  });","};","","SyncModuleWorker.prototype.start = function () {","  this.log('user: %s, sync %s worker start, %d concurrency, nodeps: %s, publish: %s',","    this.username, this.names[0], this.concurrency, this.noDep, this._publish);","  var that = this;","  co(function* () {","    // sync upstream","    if (that.syncUpstreamFirst) {","      try {","        yield that.syncUpstream(that.startName);","      } catch (err) {","        logger.error(err);","      }","    }","","    if (that.type === 'user') {","      yield that.syncUser();","      return;","    }","","    var arr = [];","    for (var i = 0; i < that.concurrency; i++) {","      arr.push(that.next(i));","    }","    yield arr;","  }).catch(function (err) {","    logger.error(err);","  });","};","","SyncModuleWorker.prototype.pushSuccess = function (name) {","  this.successes.push(name);","  this.emit('success', name);","};","","SyncModuleWorker.prototype.pushFail = function (name) {","  this.fails.push(name);","  this.emit('fail', name);","};","","SyncModuleWorker.prototype.add = function (name) {","  if (this.nameMap[name]) {","    return;","  }","  this.nameMap[name] = true;","  this.names.push(name);","  this.emit('add', name);","  this.log('    add dependencies: %s', name);","};","","SyncModuleWorker.prototype._doneOne = function* (concurrencyId, name, success) {","  this.log('----------------- Synced %s %s -------------------',","    name, success ? 'success' : 'fail');","  if (success) {","    this.pushSuccess(name);","  } else {","    this.pushFail(name);","  }","  delete this.syncingNames[name];","  var that = this;","  // relase the stack: https://github.com/cnpm/cnpmjs.org/issues/328","  defer.setImmediate(function* () {","    yield that.next(concurrencyId);","  });","};","","SyncModuleWorker.prototype.syncUpstream = function* (name) {","  if (config.sourceNpmRegistry.indexOf('registry.npmjs.org') >= 0 ||","      config.sourceNpmRegistry.indexOf('registry.npmjs.com') >= 0 ||","      config.sourceNpmRegistry.indexOf('replicate.npmjs.com') >= 0) {","    this.log('----------------- upstream is npm registry: %s, ignore it -------------------',","      config.sourceNpmRegistry);","    return;","  }","  var syncname = name;","  if (this.type === 'user') {","    syncname = this.type + ':' + syncname;","  }","  var url = config.sourceNpmRegistry + '/' + syncname + '/sync';","  if (this.noDep) {","    url += '?nodeps=true';","  }","  var r = yield urllib.request(url, {","    method: 'put',","    timeout: 20000,","    headers: {","      'content-length': 0","    },","    dataType: 'json',","    gzip: true,","  });","","  if (r.status !== 201 || !r.data.ok) {","    return this.log('sync upstream %s error, status: %s, response: %j',","      url, r.status, r.data);","  }","","  var logURL = config.sourceNpmRegistry + '/' + name + '/sync/log/' + r.data.logId;","  var offset = 0;","  this.log('----------------- Syncing upstream %s -------------------', logURL);","","  var count = 0;","  while (true) {","    count++;","    var synclogURL = logURL + '?offset=' + offset;","    var rs = yield urllib.request(synclogURL, {","      timeout: 20000,","      dataType: 'json',","      gzip: true,","    });","","    if (rs.status !== 200 || !rs.data.ok) {","      this.log('sync upstream %s error, status: %s, response: %j',","        synclogURL, rs.status, rs.data);","      break;","    }","","    var data = rs.data;","    var syncDone = false;","    if (data.log && data.log.indexOf('[done] Sync') >= 0) {","      syncDone = true;","      data.log = data.log.replace('[done] Sync', '[Upstream done] Sync');","    }","","    if (data.log) {","      this.log(data.log);","    }","","    if (syncDone) {","      break;","    }","","    if (count >= 30) {","      this.log('sync upstream %s fail, give up', logURL);","      break;","    }","","    if (data.log) {","      offset += data.log.split('\\n').length;","    }","","    yield sleep(2000);","  }","  this.log('----------------- Synced upstream %s -------------------', logURL);","};","","SyncModuleWorker.prototype.syncUser = function* () {","  for (var i = 0; i < this.names.length; i++) {","    var username = this.names[i];","    try {","      var user = yield _saveNpmUser(username);","      this.pushSuccess(username);","      this.log('[c#%s] [%s] sync success: %j', 0, username, user);","    } catch (err) {","      this.pushFail(username);","      this.log('[c#%s] [error] [%s] sync error: %s', 0, username, err.stack);","    }","  }","  this.finish();","};","","SyncModuleWorker.prototype.next = function* (concurrencyId) {","  if (config.syncModel === 'none') {","    this.log('[c#%d] [%s] syncModel is none, ignore',","      concurrencyId, name);","    return this.finish();","  }","","  var name = this.names.shift();","  if (!name) {","    return setImmediate(this.finish.bind(this));","  }","","  // try to sync from official replicate when source npm registry is not cnpmjs.org","  const registry = config.sourceNpmRegistryIsCNpm ? config.sourceNpmRegistry : config.officialNpmReplicate;","","  const versions = yield this.syncByName(concurrencyId, name, registry);","  if (versions && versions.length === 0 && registry === config.officialNpmReplicate) {","    // need to sync sourceNpmRegistry also","    // make sure package data be update event replicate down.","    // https://github.com/npm/registry/issues/129","    yield this.syncByName(concurrencyId, name, config.officialNpmRegistry);","  }","};","","SyncModuleWorker.prototype.syncByName = function* (concurrencyId, name, registry) {","  var that = this;","  that.syncingNames[name] = true;","  var pkg = null;","  var status = 0;","","  this.log('----------------- Syncing %s -------------------', name);","","  // ignore private scoped package","  if (common.isPrivateScopedPackage(name)) {","    this.log('[c#%d] [%s] ignore sync private scoped %j package',","      concurrencyId, name, config.scopes);","    yield this._doneOne(concurrencyId, name, true);","    return;","  }","","  // get from npm","  const packageUrl = '/' + name.replace('/', '%2f');","  try {","    var result = yield npmSerivce.request(packageUrl, { registry: registry });","    pkg = result.data;","    status = result.status;","  } catch (err) {","    // if 404","    if (!err.res || err.res.statusCode !== 404) {","      var errMessage = err.name + ': ' + err.message;","      that.log('[c#%s] [error] [%s] get package(%s%s) error: %s, status: %s',","        concurrencyId, name, registry, packageUrl, errMessage, status);","      yield that._doneOne(concurrencyId, name, false);","      return;","    }","  }","","  if (status === 404 && pkg && pkg.reason === 'deleted' && registry === config.officialNpmReplicate) {","    // unpublished package on replicate.npmjs.com","    // 404 { error: 'not_found', reason: 'deleted' }","    // try to read from registry.npmjs.com and get the whole unpublished info","    try {","      var result = yield npmSerivce.request(packageUrl, { registry: config.sourceNpmRegistry });","      pkg = result.data;","      status = result.status;","    } catch (err) {","      // if 404","      if (!err.res || err.res.statusCode !== 404) {","        var errMessage = err.name + ': ' + err.message;","        that.log('[c#%s] [error] [%s] get package(%s%s) error: %s, status: %s',","          concurrencyId, name, config.sourceNpmRegistry, packageUrl, errMessage, status);","        yield that._doneOne(concurrencyId, name, false);","        return;","      }","    }","  }","","  var unpublishedInfo = null;","  if (status === 404) {","    // check if it's unpublished","    // ignore too long package name, see https://github.com/cnpm/cnpmjs.org/issues/1066","    if (name.length < 80 && pkg && pkg.time && pkg.time.unpublished && pkg.time.unpublished.time) {","      unpublishedInfo = pkg.time.unpublished;","    } else {","      pkg = null;","    }","  } else {","    // unpublished package status become to 200","    if (name.length < 80 && pkg && pkg.time && pkg.time.unpublished && pkg.time.unpublished.time) {","      unpublishedInfo = pkg.time.unpublished;","    }","  }","","  if (!pkg) {","    that.log('[c#%s] [error] [%s] get package(%s%s) error: package not exists, status: %s',","      concurrencyId, name, registry, packageUrl, status);","    yield that._doneOne(concurrencyId, name, true);","    return;","  }","","  that.log('[c#%d] [%s] package(%s%s) status: %s, dist-tags: %j, time.modified: %s, unpublished: %j, start...',","    concurrencyId, name, registry, packageUrl, status,","    pkg['dist-tags'], pkg.time && pkg.time.modified,","    unpublishedInfo);","","  if (unpublishedInfo) {","    try {","      yield that._unpublished(name, unpublishedInfo);","    } catch (err) {","      that.log('[c#%s] [error] [%s] sync error: %s', concurrencyId, name, err.stack);","      yield that._doneOne(concurrencyId, name, false);","      return;","    }","    return yield that._doneOne(concurrencyId, name, true);","  }","","  var versions;","  try {","    versions = yield that._sync(name, pkg);","  } catch (err) {","    that.log('[c#%s] [error] [%s] sync error: %s', concurrencyId, name, err.stack);","    yield that._doneOne(concurrencyId, name, false);","    return;","  }","","  // has new version","  if (versions.length > 0) {","    that.updates.push(name);","  }","","  this.log('[c#%d] [%s] synced success, %d versions: %s',","    concurrencyId, name, versions.length, versions.join(', '));","  yield this._doneOne(concurrencyId, name, true);","","  return versions;","};","","function* _listStarUsers(modName) {","  var users = yield packageService.listStarUserNames(modName);","  var userMap = {};","  users.forEach(function (user) {","    userMap[user] = true;","  });","  return userMap;","}","","function* _saveNpmUser(username) {","  var user = yield npmSerivce.getUser(username);","  if (!user) {","    var existsUser = yield User.findByName(username);","    if (existsUser && existsUser.isNpmUser) {","      // delete it","      yield User.destroy({","        where: {","          name: username,","        }","      });","      return { exists: true, deleted: true, isNpmUser: true };","    }","    return { exists: false };","  }","  yield User.saveNpmUser(user);","  return user;","}","","function* _saveMaintainer(modName, username, action) {","  if (action === 'add') {","    yield* packageService.addPublicModuleMaintainer(modName, username);","  } else if (action === 'remove') {","    yield* packageService.removePublicModuleMaintainer(modName, username);","  }","}","","SyncModuleWorker.prototype._unpublished = function* (name, unpublishedInfo) {","  var mods = yield* packageService.listModulesByName(name);","  this.log('  [%s] start unpublished %d versions from local cnpm registry',","    name, mods.length);","  if (common.isLocalModule(mods)) {","    // publish on cnpm, dont sync this version package","    this.log('  [%s] publish on local cnpm registry, don\\'t sync', name);","    return [];","  }","","  var r = yield* packageService.saveUnpublishedModule(name, unpublishedInfo);","  this.log('    [%s] save unpublished info: %j to row#%s',","    name, unpublishedInfo, r.id);","  if (mods.length === 0) {","    return;","  }","  yield [packageService.removeModulesByName(name), packageService.removeModuleTags(name)];","  var keys = [];","  for (var i = 0; i < mods.length; i++) {","    var row = mods[i];","    var dist = row.package.dist;","    var key = dist.key;","    if (!key) {","      key = urlparse(dist.tarball).pathname;","    }","    key && keys.push(key);","  }","","  if (keys.length > 0) {","    try {","      yield keys.map(function (key) {","        return nfs.remove(key);","      });","    } catch (err) {","      // ignore error here","      this.log('    [%s] delete nfs files: %j error: %s: %s',","        name, keys, err.name, err.message);","    }","  }","  this.log('    [%s] delete nfs files: %j success', name, keys);","};","","SyncModuleWorker.prototype._sync = function* (name, pkg) {","  var that = this;","  var hasModules = false;","  var result = yield [","    packageService.listModulesByName(name),","    packageService.listModuleTags(name),","    _listStarUsers(name),","    packageService.listPublicModuleMaintainers(name),","  ];","  var moduleRows = result[0];","  var tagRows = result[1];","  var existsStarUsers = result[2];","  var existsNpmMaintainers = result[3];","","  if (common.isLocalModule(moduleRows)) {","    // publish on cnpm, dont sync this version package","    that.log('  [%s] publish on local cnpm registry, don\\'t sync', name);","    return [];","  }","","  hasModules = moduleRows.length > 0;","  var map = {};","  var localVersionNames = [];","  for (var i = 0; i < moduleRows.length; i++) {","    var r = moduleRows[i];","    if (!r.package || !r.package.dist) {","      // package json parse error","      continue;","    }","    if (!map.latest) {","      map.latest = r;","    }","    map[r.version] = r;","    localVersionNames.push(r.version);","  }","","  var tags = {};","  for (var i = 0; i < tagRows.length; i++) {","    var r = tagRows[i];","    if (!r.module_id) {","      // no module_id, need to sync tags","      continue;","    }","    tags[r.tag] = r.version;","  }","","  var missingVersions = [];","  var missingTags = [];","  var missingDescriptions = [];","  var missingReadmes = [];","  var missingStarUsers = [];","  var npmUsernames = {};","  var missingDeprecateds = [];","  // [[user, 'add or remove'], ...]","  var diffNpmMaintainers = [];","","  // find out new maintainers","  var pkgMaintainers = pkg.maintainers || [];","  if (Array.isArray(pkgMaintainers)) {","    var existsMap = {};","    var originalMap = {};","    for (var i = 0; i < existsNpmMaintainers.length; i++) {","      var user = existsNpmMaintainers[i];","      existsMap[user] = true;","    }","    for (var i = 0; i < pkgMaintainers.length; i++) {","      var item = pkgMaintainers[i];","      originalMap[item.name] = item;","      npmUsernames[item.name.toLowerCase()] = 1;","    }","","    // find add users","    for (var i = 0; i < pkgMaintainers.length; i++) {","      var item = pkgMaintainers[i];","      if (!existsMap[item.name]) {","        diffNpmMaintainers.push([item.name, 'add']);","      }","    }","","    // find remove users","    for (var i = 0; i < existsNpmMaintainers.length; i++) {","      var user = existsNpmMaintainers[i];","      if (!originalMap[user]) {","        diffNpmMaintainers.push([user, 'remove']);","      }","    }","  }","","  // find out all user names","  for (var v in pkg.versions) {","    var p = pkg.versions[v];","    var maintainers = p.maintainers || [];","    if (!Array.isArray(maintainers)) {","      // http://r.cnpmjs.org/jasmine-node","      // TODO: \"maintainers\": \"Martin H膫陇ger <martin.haeger@gmail.com>\",","      maintainers = [maintainers];","    }","    for (var i = 0; i < maintainers.length; i++) {","      var m = maintainers[i];","      if (m.name) {","        npmUsernames[m.name.toLowerCase()] = 1;","      }","    }","  }","","  // get the missing star users","  var starUsers = pkg.users || {};","  for (var k in starUsers) {","    if (!existsStarUsers[k]) {","      missingStarUsers.push(k);","    }","    npmUsernames[k.toLowerCase()] = 1;","  }","  that.log('  [%s] found %d missing star users', name, missingStarUsers.length);","","  var times = pkg.time || {};","  pkg.versions = pkg.versions || {};","  var remoteVersionNames = Object.keys(pkg.versions);","  var remoteVersionNameMap = {};","","  // find out missing versions","  for (var i = 0; i < remoteVersionNames.length; i++) {","    var v = remoteVersionNames[i];","    remoteVersionNameMap[v] = v;","    var exists = map[v] || {};","    var version = pkg.versions[v];","    if (!version || !version.dist || !version.dist.tarball) {","      continue;","    }","    //patch for readme","    if (!version.readme) {","      version.readme = pkg.readme;","    }","    var publish_time = times[v];","    version.publish_time = publish_time ? Date.parse(publish_time) : null;","    if (!version.maintainers || !version.maintainers[0]) {","      version.maintainers = pkg.maintainers;","    }","    if (exists.package &&","        exists.package.dist.shasum === version.dist.shasum) {","      // * shasum make sure equal","      if ((version.publish_time === exists.publish_time) ||","          (!version.publish_time && exists.publish_time)) {","        // debug('  [%s] %s publish_time equal: %s, %s',","        //   name, version.version, version.publish_time, exists.publish_time);","        // * publish_time make sure equal","        if (exists.description === null && version.description) {","          // * make sure description exists","          missingDescriptions.push({","            id: exists.id,","            description: version.description","          });","        }","","        if (!exists.package.readme && version.readme) {","          // * make sure readme exists","          missingReadmes.push({","            id: exists.id,","            readme: version.readme","          });","        }","","        if (version.deprecated && version.deprecated !== exists.package.deprecated) {","          // need to sync deprecated field","          missingDeprecateds.push({","            id: exists.id,","            deprecated: version.deprecated","          });","        }","        if (exists.package.deprecated && !version.deprecated) {","          // remove deprecated info","          missingDeprecateds.push({","            id: exists.id,","            deprecated: undefined,","          });","        }","        continue;","      }","    }","    missingVersions.push(version);","  }","","  // find out deleted versions","  var deletedVersionNames = [];","  for (var i = 0; i < localVersionNames.length; i++) {","    var v = localVersionNames[i];","    if (!remoteVersionNameMap[v]) {","      deletedVersionNames.push(v);","    }","  }","","  // find out missing tags","  var sourceTags = pkg['dist-tags'] || {};","  for (var t in sourceTags) {","    var sourceTagVersion = sourceTags[t];","    if (sourceTagVersion && tags[t] !== sourceTagVersion) {","      missingTags.push([t, sourceTagVersion]);","    }","  }","  // find out deleted tags","  var deletedTags = [];","  for (var t in tags) {","    if (!sourceTags[t]) {","      // not in remote tags, delete it from local registry","      deletedTags.push(t);","    }","  }","","  if (missingVersions.length === 0) {","    that.log('  [%s] all versions are exists', name);","  } else {","    missingVersions.sort(function (a, b) {","      return a.publish_time - b.publish_time;","    });","    that.log('  [%s] %d versions need to sync', name, missingVersions.length);","  }","","  var syncedVersionNames = [];","  var syncIndex = 0;","","  // sync missing versions","  while (missingVersions.length) {","    var index = syncIndex++;","    var syncModule = missingVersions.shift();","    if (!syncModule.dist.tarball) {","      continue;","    }","    try {","      yield that._syncOneVersion(index, syncModule);","      syncedVersionNames.push(syncModule.version);","    } catch (err) {","      that.log('    [%s:%d] sync error, version: %s, %s: %s',","        syncModule.name, index, syncModule.version, err.name, err.stack);","    }","  }","","  if (deletedVersionNames.length === 0) {","    that.log('  [%s] no versions need to deleted', name);","  } else {","    that.log('  [%s] %d versions: %j need to deleted',","      name, deletedVersionNames.length, deletedVersionNames);","    try {","      yield packageService.removeModulesByNameAndVersions(name, deletedVersionNames);","    } catch (err) {","      that.log('    [%s] delete error, %s: %s', name, err.name, err.message);","    }","  }","","  // sync missing descriptions","  function* syncDes() {","    if (missingDescriptions.length === 0) {","      return;","    }","    that.log('  [%s] saving %d descriptions', name, missingDescriptions.length);","    var res = yield gather(missingDescriptions.map(function (item) {","      return packageService.updateModuleDescription(item.id, item.description);","    }));","","    for (var i = 0; i < res.length; i++) {","      var item = missingDescriptions[i];","      var r = res[i];","      if (r.error) {","        that.log('    save error, id: %s, description: %s, error: %s',","          item.id, item.description, r.error.message);","      } else {","        that.log('    saved, id: %s, description length: %d',","          item.id, item.description.length);","      }","    }","  }","","  // sync missing tags","  function* syncTag() {","    if (deletedTags.length > 0) {","      yield* packageService.removeModuleTagsByNames(name, deletedTags);","      that.log('  [%s] deleted %d tags: %j',","        name, deletedTags.length, deletedTags);","    }","","    if (missingTags.length === 0) {","      return;","    }","    that.log('  [%s] adding %d tags', name, missingTags.length);","    // sync tags","    var res = yield gather(missingTags.map(function (item) {","      return packageService.addModuleTag(name, item[0], item[1]);","    }));","","    for (var i = 0; i < res.length; i++) {","      var item = missingTags[i];","      var r = res[i];","      if (r.error) {","        that.log('    add tag %s:%s error, error: %s',","          item.id, item.description, r.error.message);","      } else {","        that.log('    added tag %s:%s, module_id: %s',","          item[0], item[1], r.value && r.value.module_id);","      }","    }","  }","","  // sycn missing readme","  function* syncReadme() {","    if (missingReadmes.length === 0) {","      return;","    }","    that.log('  [%s] saving %d readmes', name, missingReadmes.length);","","    var res = yield gather(missingReadmes.map(function (item) {","      return packageService.updateModuleReadme(item.id, item.readme);","    }));","","    for (var i = 0; i < res.length; i++) {","      var item = missingReadmes[i];","      var r = res[i];","      if (r.error) {","        that.log('    save error, id: %s, error: %s', item.id, r.error.message);","      } else {","        that.log('    saved, id: %s', item.id);","      }","    }","  }","","  function *syncDeprecateds() {","    if (missingDeprecateds.length === 0) {","      return;","    }","    that.log('  [%s] saving %d Deprecated fields', name, missingDeprecateds.length);","","    var res = yield gather(missingDeprecateds.map(function (item) {","      return packageService.updateModulePackageFields(item.id, {","        deprecated: item.deprecated","      });","    }));","","    for (var i = 0; i < res.length; i++) {","      var item = missingDeprecateds[i];","      var r = res[i];","      if (r.error) {","        that.log('    save error, id: %s, error: %s', item.id, r.error.message);","      } else {","        that.log('    saved, id: %s, deprecated: %j', item.id, item.deprecated);","      }","    }","  }","","  function* syncMissingUsers() {","    var missingUsers = [];","    var names = Object.keys(npmUsernames);","    if (names.length === 0) {","      return;","    }","    var rows = yield* User.listByNames(names);","    var map = {};","    rows.forEach(function (r) {","      map[r.name] = r;","    });","    names.forEach(function (username) {","      var r = map[username];","      if (!r || !r.json) {","        if (username[0] !== '\"' && username[0] !== \"'\") {","          missingUsers.push(username);","        }","      }","    });","","    if (missingUsers.length === 0) {","      that.log('  [%s] all %d npm users exists', name, names.length);","      return;","    }","","    that.log('  [%s] saving %d/%d missing npm users: %j',","      name, missingUsers.length, names.length, missingUsers);","    var res = yield gather(missingUsers.map(function (username) {","      return _saveNpmUser(username);","    }));","","    for (var i = 0; i < res.length; i++) {","      var r = res[i];","      if (r.error) {","        that.log('    save npm user error, %s', r.error.message);","      }","    }","  }","","  // sync missing star users","  function* syncMissingStarUsers() {","    if (missingStarUsers.length === 0) {","      return;","    }","","    that.log('  [%s] saving %d star users', name, missingStarUsers.length);","    var res = yield gather(missingStarUsers.map(function (username) {","      return packageService.addStar(name, username);","    }));","","    for (var i = 0; i < res.length; i++) {","      var r = res[i];","      if (r.error) {","        that.log('    add star user error, %s', r.error.stack);","      }","    }","  }","","  // sync diff npm package maintainers","  function* syncNpmPackageMaintainers() {","    if (diffNpmMaintainers.length === 0) {","      return;","    }","","    that.log('  [%s] syncing %d diff package maintainers: %j',","      name, diffNpmMaintainers.length, diffNpmMaintainers);","    var res = yield gather(diffNpmMaintainers.map(function (item) {","      return _saveMaintainer(name, item[0], item[1]);","    }));","","    for (var i = 0; i < res.length; i++) {","      var r = res[i];","      if (r.error) {","        that.log('    save package maintainer error, %s', r.error.stack);","      }","    }","  }","","  yield [","    syncDes(),","    syncTag(),","    syncReadme(),","    syncDeprecateds(),","    syncMissingStarUsers(),","    syncMissingUsers(),","    syncNpmPackageMaintainers(),","  ];","  return syncedVersionNames;","};","","SyncModuleWorker.prototype._syncOneVersion = function *(versionIndex, sourcePackage) {","  var delay = Date.now() - sourcePackage.publish_time;","  logger.syncInfo('[sync_module_worker] delay: %s ms, publish_time: %s, start sync %s@%s',","    delay, utility.logDate(new Date(sourcePackage.publish_time)),","    sourcePackage.name, sourcePackage.version);","  var that = this;","  var username = this.username;","  var downurl = sourcePackage.dist.tarball;","  var filename = path.basename(downurl);","  var filepath = common.getTarballFilepath(filename);","  var ws = fs.createWriteStream(filepath);","","  var options = {","    writeStream: ws,","    followRedirect: true,","    timeout: 600000, // 10 minutes download","    headers: {","      'user-agent': USER_AGENT","    },","    gzip: true,","  };","","  var dependencies = Object.keys(sourcePackage.dependencies || {});","  var devDependencies = [];","  if (this.syncDevDependencies) {","    devDependencies = Object.keys(sourcePackage.devDependencies || {});","  }","","  that.log('    [%s:%d] syncing, delay: %s ms, version: %s, dist: %j, no deps: %s, ' +","   'publish on cnpm: %s, dependencies: %d, devDependencies: %d, syncDevDependencies: %s',","    sourcePackage.name, versionIndex,","    delay,","    sourcePackage.version,","    sourcePackage.dist, that.noDep, that._publish,","    dependencies.length,","    devDependencies.length, this.syncDevDependencies);","","  if (dependencies.length > config.maxDependencies) {","    dependencies = dependencies.slice(0, config.maxDependencies);","  }","","  if (devDependencies.length > config.maxDependencies) {","    devDependencies = devDependencies.slice(0, config.maxDependencies);","  }","","  if (!that.noDep) {","    for (var i = 0; i < dependencies.length; i++) {","      that.add(dependencies[i]);","    }","","    for (var i = 0; i < devDependencies.length; i++) {","      that.add(devDependencies[i]);","    }","  }","","  // add module dependence","  yield packageService.addDependencies(sourcePackage.name, dependencies);","","  var shasum = crypto.createHash('sha1');","  var dataSize = 0;","","  try {","    // get tarball","    logger.syncInfo('[sync_module_worker] downloading %j to %j', downurl, filepath);","    var r;","    try {","      r = yield urllib.request(downurl, options);","    } catch (err) {","      logger.syncInfo('[sync_module_worker] download %j to %j error: %s', downurl, filepath, err);","      throw err;","    }","","    var statusCode = r.status || -1;","    // https://github.com/cnpm/cnpmjs.org/issues/325","    // if (statusCode === 404) {","    //   shasum = sourcePackage.dist.shasum;","    //   return yield *afterUpload({","    //     url: downurl","    //   });","    // }","","    if (statusCode !== 200) {","      var err = new Error('Download ' + downurl + ' fail, status: ' + statusCode);","      err.name = 'DownloadTarballError';","      err.data = sourcePackage;","      logger.syncInfo('[sync_module_worker] %s', err.message);","      throw err;","    }","","    // read and check","    var rs = fs.createReadStream(filepath);","    rs.on('data', function (data) {","      shasum.update(data);","      dataSize += data.length;","    });","    var end = thunkify.event(rs);","    yield end(); // after end event emit","","    if (dataSize === 0) {","      var err = new Error('Download ' + downurl + ' file size is zero');","      err.name = 'DownloadTarballSizeZeroError';","      err.data = sourcePackage;","      logger.syncInfo('[sync_module_worker] %s', err.message);","      throw err;","    }","","    // check shasum","    shasum = shasum.digest('hex');","    if (shasum !== sourcePackage.dist.shasum) {","      var err = new Error('Download ' + downurl + ' shasum:' + shasum +","        ' not match ' + sourcePackage.dist.shasum);","      err.name = 'DownloadTarballShasumError';","      err.data = sourcePackage;","      logger.syncInfo('[sync_module_worker] %s', err.message);","      throw err;","    }","","    options = {","      key: common.getCDNKey(sourcePackage.name, filename),","      size: dataSize,","      shasum: shasum","    };","    // upload to NFS","    logger.syncInfo('[sync_module_worker] uploading %j to nfs', options);","    var result;","    try {","      result = yield nfs.upload(filepath, options);","    } catch (err) {","      logger.syncInfo('[sync_module_worker] upload %j to nfs error: %s', err);","      throw err;","    }","    logger.syncInfo('[sync_module_worker] uploaded, saving %j to database', result);","    var r = yield afterUpload(result);","    logger.syncInfo('[sync_module_worker] sync %s@%s done!',","      sourcePackage.name, sourcePackage.version);","    return r;","  } finally {","    // remove tmp file whatever","    fs.unlink(filepath, utility.noop);","  }","","  function *afterUpload(result) {","    //make sure sync module have the correct author info","    //only if can not get maintainers, use the username","    var author = username;","    if (Array.isArray(sourcePackage.maintainers)) {","      author = sourcePackage.maintainers[0].name || username;","    }","","    var mod = {","      version: sourcePackage.version,","      name: sourcePackage.name,","      package: sourcePackage,","      author: author,","      publish_time: sourcePackage.publish_time,","    };","","    // delete _publish_on_cnpm, because other cnpm maybe sync from current cnpm","    delete mod.package._publish_on_cnpm;","    if (that._publish) {","      // sync as publish","      mod.package._publish_on_cnpm = true;","    }","","    var dist = {","      shasum: shasum,","      size: dataSize,","      noattachment: dataSize === 0,","    };","","    if (result.url) {","      dist.tarball = result.url;","    } else if (result.key) {","      dist.key = result.key;","      dist.tarball = result.key;","    }","","    mod.package.dist = dist;","    var r = yield packageService.saveModule(mod);","","    that.log('    [%s:%s] done, insertId: %s, author: %s, version: %s, '","      + 'size: %d, publish_time: %j, publish on cnpm: %s',","      sourcePackage.name, versionIndex,","      r.id,","      author, mod.version, dataSize,","      new Date(mod.publish_time),","      that._publish);","","    return r;","  }","};","","SyncModuleWorker.sync = function* (name, username, options) {","  options = options || {};","  var result = yield logService.create({name: name, username: username});","  var worker = new SyncModuleWorker({","    logId: result.id,","    type: options.type,","    name: name,","    username: username,","    noDep: options.noDep,","    publish: options.publish,","    syncUpstreamFirst: options.syncUpstreamFirst,","  });","  worker.start();","  return result.id;","};",""],"l":{"3":4,"4":4,"5":4,"6":4,"7":4,"8":4,"9":4,"10":4,"11":4,"12":4,"13":4,"14":4,"15":4,"16":4,"17":4,"18":4,"19":4,"20":4,"21":4,"22":4,"23":0,"24":0,"25":0,"27":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"43":0,"44":0,"45":0,"47":0,"48":0,"49":0,"50":0,"52":0,"53":0,"54":0,"55":0,"57":0,"58":0,"60":0,"61":0,"62":0,"65":0,"67":0,"69":0,"70":0,"71":0,"72":0,"74":0,"75":0,"80":0,"82":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"94":0,"95":0,"99":0,"100":0,"101":0,"102":0,"104":0,"105":0,"106":0,"107":0,"108":0,"110":0,"111":0,"112":0,"115":0,"116":0,"117":0,"118":0,"123":0,"124":0,"126":0,"127":0,"129":0,"130":0,"131":0,"133":0,"137":0,"138":0,"139":0,"142":0,"143":0,"144":0,"146":0,"148":0,"152":0,"153":0,"154":0,"157":0,"158":0,"159":0,"162":0,"163":0,"164":0,"166":0,"167":0,"168":0,"169":0,"172":0,"173":0,"175":0,"176":0,"178":0,"180":0,"181":0,"183":0,"184":0,"188":0,"189":0,"192":0,"194":0,"196":0,"197":0,"198":0,"200":0,"201":0,"202":0,"204":0,"214":0,"215":0,"219":0,"220":0,"221":0,"223":0,"224":0,"225":0,"226":0,"227":0,"233":0,"234":0,"236":0,"239":0,"240":0,"241":0,"242":0,"243":0,"246":0,"247":0,"250":0,"251":0,"254":0,"255":0,"256":0,"259":0,"260":0,"263":0,"265":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"276":0,"277":0,"280":0,"283":0,"284":0,"285":0,"287":0,"290":0,"291":0,"292":0,"296":0,"298":0,"299":0,"303":0,"307":0,"308":0,"309":0,"310":0,"311":0,"313":0,"316":0,"317":0,"319":0,"320":0,"324":0,"325":0,"326":0,"327":0,"328":0,"331":0,"332":0,"333":0,"335":0,"336":0,"340":0,"344":0,"345":0,"346":0,"347":0,"350":0,"351":0,"352":0,"354":0,"355":0,"360":0,"361":0,"364":0,"365":0,"367":0,"371":0,"372":0,"376":0,"377":0,"379":0,"380":0,"383":0,"388":0,"389":0,"390":0,"392":0,"393":0,"394":0,"396":0,"399":0,"400":0,"401":0,"403":0,"404":0,"405":0,"409":0,"410":0,"413":0,"415":0,"417":0,"420":1,"421":0,"422":0,"423":0,"424":0,"426":0,"429":1,"430":0,"431":0,"432":0,"433":0,"435":0,"440":0,"442":0,"444":0,"445":0,"448":1,"449":0,"450":0,"451":0,"452":0,"456":0,"457":0,"458":0,"460":0,"462":0,"463":0,"466":0,"467":0,"469":0,"470":0,"472":0,"473":0,"474":0,"475":0,"476":0,"477":0,"478":0,"479":0,"481":0,"484":0,"485":0,"486":0,"487":0,"491":0,"495":0,"498":0,"499":0,"500":0,"501":0,"507":0,"508":0,"509":0,"510":0,"512":0,"514":0,"515":0,"518":0,"519":0,"520":0,"521":0,"522":0,"523":0,"525":0,"527":0,"528":0,"530":0,"531":0,"534":0,"535":0,"536":0,"537":0,"539":0,"541":0,"544":0,"545":0,"546":0,"547":0,"548":0,"549":0,"550":0,"552":0,"555":0,"556":0,"557":0,"558":0,"559":0,"560":0,"561":0,"563":0,"564":0,"565":0,"566":0,"570":0,"571":0,"572":0,"573":0,"578":0,"579":0,"580":0,"581":0,"587":0,"588":0,"589":0,"590":0,"593":0,"595":0,"596":0,"597":0,"598":0,"604":0,"605":0,"606":0,"607":0,"609":0,"611":0,"613":0,"614":0,"615":0,"616":0,"619":0,"620":0,"621":0,"622":0,"623":0,"624":0,"625":0,"628":0,"629":0,"631":0,"632":0,"633":0,"634":0,"636":0,"639":0,"644":0,"646":0,"652":0,"654":0,"660":0,"662":0,"667":0,"669":0,"674":0,"677":0,"681":0,"682":0,"683":0,"684":0,"685":0,"690":0,"691":0,"692":0,"693":0,"694":0,"698":0,"699":0,"700":0,"702":0,"706":0,"707":0,"709":0,"710":0,"712":0,"715":0,"716":0,"719":0,"720":0,"721":0,"722":0,"723":0,"725":0,"726":0,"727":0,"729":0,"734":0,"735":0,"737":0,"739":0,"740":0,"742":0,"747":1,"748":0,"749":0,"751":0,"752":0,"753":0,"756":0,"757":0,"758":0,"759":0,"760":0,"763":0,"770":1,"771":0,"772":0,"773":0,"777":0,"778":0,"780":0,"782":0,"783":0,"786":0,"787":0,"788":0,"789":0,"790":0,"793":0,"800":1,"801":0,"802":0,"804":0,"806":0,"807":0,"810":0,"811":0,"812":0,"813":0,"814":0,"816":0,"821":1,"822":0,"823":0,"825":0,"827":0,"828":0,"833":0,"834":0,"835":0,"836":0,"837":0,"839":0,"844":1,"845":0,"846":0,"847":0,"848":0,"850":0,"851":0,"852":0,"853":0,"855":0,"856":0,"857":0,"858":0,"859":0,"864":0,"865":0,"866":0,"869":0,"871":0,"872":0,"875":0,"876":0,"877":0,"878":0,"884":1,"885":0,"886":0,"889":0,"890":0,"891":0,"894":0,"895":0,"896":0,"897":0,"903":1,"904":0,"905":0,"908":0,"910":0,"911":0,"914":0,"915":0,"916":0,"917":0,"922":0,"931":0,"934":0,"935":0,"936":0,"939":0,"940":0,"941":0,"942":0,"943":0,"944":0,"946":0,"956":0,"957":0,"958":0,"959":0,"962":0,"971":0,"972":0,"975":0,"976":0,"979":0,"980":0,"981":0,"984":0,"985":0,"990":0,"992":0,"993":0,"995":0,"997":0,"998":0,"999":0,"1000":0,"1002":0,"1003":0,"1006":0,"1015":0,"1016":0,"1017":0,"1018":0,"1019":0,"1020":0,"1024":0,"1025":0,"1026":0,"1027":0,"1029":0,"1030":0,"1032":0,"1033":0,"1034":0,"1035":0,"1036":0,"1037":0,"1041":0,"1042":0,"1043":0,"1045":0,"1046":0,"1047":0,"1048":0,"1051":0,"1057":0,"1058":0,"1059":0,"1060":0,"1062":0,"1063":0,"1065":0,"1066":0,"1067":0,"1069":0,"1072":0,"1075":1,"1078":0,"1079":0,"1080":0,"1083":0,"1092":0,"1093":0,"1095":0,"1098":0,"1104":0,"1105":0,"1106":0,"1107":0,"1108":0,"1111":0,"1112":0,"1114":0,"1122":0,"1126":0,"1127":0,"1128":0,"1129":0,"1138":0,"1139":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/lib/common.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/lib/common.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":1,"9":0,"10":0,"11":0,"12":1,"13":0,"14":0,"15":0,"16":1,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"32":1,"33":0,"34":0,"35":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":29},"end":{"line":22,"column":49}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":20},"end":{"line":29,"column":46}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":25},"end":{"line":38,"column":51}}},"4":{"name":"(anonymous_4)","line":47,"loc":{"start":{"line":47,"column":18},"end":{"line":47,"column":38}}},"5":{"name":"(anonymous_5)","line":51,"loc":{"start":{"line":51,"column":23},"end":{"line":51,"column":52}}},"6":{"name":"(anonymous_6)","line":58,"loc":{"start":{"line":58,"column":33},"end":{"line":58,"column":49}}},"7":{"name":"(anonymous_7)","line":65,"loc":{"start":{"line":65,"column":24},"end":{"line":65,"column":40}}},"8":{"name":"(anonymous_8)","line":75,"loc":{"start":{"line":75,"column":33},"end":{"line":75,"column":49}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":31}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":34}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":27}},"5":{"start":{"line":22,"column":0},"end":{"line":27,"column":2}},"6":{"start":{"line":25,"column":2},"end":{"line":25,"column":95}},"7":{"start":{"line":26,"column":2},"end":{"line":26,"column":43}},"8":{"start":{"line":29,"column":0},"end":{"line":36,"column":2}},"9":{"start":{"line":32,"column":2},"end":{"line":34,"column":3}},"10":{"start":{"line":33,"column":4},"end":{"line":33,"column":51}},"11":{"start":{"line":35,"column":2},"end":{"line":35,"column":39}},"12":{"start":{"line":38,"column":0},"end":{"line":45,"column":2}},"13":{"start":{"line":39,"column":2},"end":{"line":44,"column":3}},"14":{"start":{"line":40,"column":4},"end":{"line":40,"column":51}},"15":{"start":{"line":41,"column":4},"end":{"line":43,"column":45}},"16":{"start":{"line":47,"column":0},"end":{"line":49,"column":2}},"17":{"start":{"line":48,"column":2},"end":{"line":48,"column":53}},"18":{"start":{"line":51,"column":0},"end":{"line":63,"column":2}},"19":{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},"20":{"start":{"line":53,"column":4},"end":{"line":53,"column":16}},"21":{"start":{"line":56,"column":2},"end":{"line":56,"column":27}},"22":{"start":{"line":57,"column":2},"end":{"line":57,"column":34}},"23":{"start":{"line":58,"column":2},"end":{"line":60,"column":5}},"24":{"start":{"line":59,"column":4},"end":{"line":59,"column":34}},"25":{"start":{"line":62,"column":2},"end":{"line":62,"column":26}},"26":{"start":{"line":65,"column":0},"end":{"line":73,"column":2}},"27":{"start":{"line":66,"column":2},"end":{"line":71,"column":3}},"28":{"start":{"line":67,"column":4},"end":{"line":67,"column":20}},"29":{"start":{"line":68,"column":4},"end":{"line":70,"column":5}},"30":{"start":{"line":69,"column":6},"end":{"line":69,"column":18}},"31":{"start":{"line":72,"column":2},"end":{"line":72,"column":15}},"32":{"start":{"line":75,"column":0},"end":{"line":80,"column":2}},"33":{"start":{"line":76,"column":2},"end":{"line":78,"column":3}},"34":{"start":{"line":77,"column":4},"end":{"line":77,"column":17}},"35":{"start":{"line":79,"column":2},"end":{"line":79,"column":56}}},"branchMap":{"1":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"2":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":6},"end":{"line":32,"column":21}},{"start":{"line":32,"column":25},"end":{"line":32,"column":44}}]},"3":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]},"4":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":11},"end":{"line":40,"column":15}},{"start":{"line":40,"column":19},"end":{"line":40,"column":38}},{"start":{"line":40,"column":42},"end":{"line":40,"column":50}}]},"5":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":52,"column":2}},{"start":{"line":52,"column":2},"end":{"line":52,"column":2}}]},"6":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":16},"end":{"line":57,"column":27}},{"start":{"line":57,"column":31},"end":{"line":57,"column":33}}]},"7":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":4}},{"start":{"line":68,"column":4},"end":{"line":68,"column":4}}]},"8":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":8},"end":{"line":68,"column":17}},{"start":{"line":68,"column":21},"end":{"line":68,"column":47}}]},"9":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]}},"code":["/**!"," * cnpmjs.org - lib/common.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var crypto = require('crypto');","var path = require('path');","var config = require('../config');","var util = require('util');","","exports.getTarballFilepath = function (filename) {","  // ensure download file path unique","  // TODO: not only .tgz, and also other extname","  var name = filename.replace(/\\.tgz$/, '.' + crypto.randomBytes(16).toString('hex') + '.tgz');","  return path.join(config.uploadDir, name);","};","","exports.getCDNKey = function (name, filename) {","  // if name is scope package name, need to auto fix filename as a scope package file name","  // e.g.: @scope/foo, filename: foo-1.0.0.tgz => filename: @scope/foo-1.0.0.tgz","  if (name[0] === '@' && filename[0] !== '@') {","    filename = name.split('/')[0] + '/' + filename;","  }","  return '/' + name + '/-/' + filename;","};","","exports.setDownloadURL = function (pkg, ctx, host) {","  if (pkg.dist) {","    host = host || config.registryHost || ctx.host;","    pkg.dist.tarball = util.format('%s://%s/%s/download/%s-%s.tgz',","      ctx.protocol,","      host, pkg.name, pkg.name, pkg.version);","  }","};","","exports.isAdmin = function (username) {","  return typeof config.admins[username] === 'string';","};","","exports.isMaintainer = function (user, maintainers) {","  if (user.isAdmin) {","    return true;","  }","","  var username = user.name;","  maintainers = maintainers || [];","  var match = maintainers.filter(function (item) {","    return item.name === username;","  });","","  return match.length > 0;","};","","exports.isLocalModule = function (mods) {","  for (var i = 0; i < mods.length; i++) {","    var r = mods[i];","    if (r.package && r.package._publish_on_cnpm) {","      return true;","    }","  }","  return false;","};","","exports.isPrivateScopedPackage = function (name) {","  if (name[0] !== '@') {","    return false;","  }","  return config.scopes.indexOf(name.split('/')[0]) >= 0;","};",""],"l":{"17":1,"18":1,"19":1,"20":1,"22":1,"25":0,"26":0,"29":1,"32":0,"33":0,"35":0,"38":1,"39":0,"40":0,"41":0,"47":1,"48":0,"51":1,"52":0,"53":0,"56":0,"57":0,"58":0,"59":0,"62":0,"65":1,"66":0,"67":0,"68":0,"69":0,"72":0,"75":1,"76":0,"77":0,"79":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/npm.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/npm.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":1,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":1,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":1,"86":0,"87":0,"88":1,"89":0,"90":0,"91":1,"92":0,"93":0,"94":1,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0,0],"37":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"request","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":32}}},"2":{"name":"(anonymous_2)","line":43,"loc":{"start":{"line":43,"column":18},"end":{"line":43,"column":35}}},"3":{"name":"(anonymous_3)","line":54,"loc":{"start":{"line":54,"column":14},"end":{"line":54,"column":31}}},"4":{"name":"(anonymous_4)","line":63,"loc":{"start":{"line":63,"column":28},"end":{"line":63,"column":62}}},"5":{"name":"(anonymous_5)","line":76,"loc":{"start":{"line":76,"column":17},"end":{"line":76,"column":32}}},"6":{"name":"(anonymous_6)","line":103,"loc":{"start":{"line":103,"column":32},"end":{"line":103,"column":54}}},"7":{"name":"(anonymous_7)","line":140,"loc":{"start":{"line":140,"column":22},"end":{"line":140,"column":52}}},"8":{"name":"(anonymous_8)","line":147,"loc":{"start":{"line":147,"column":22},"end":{"line":147,"column":42}}},"9":{"name":"(anonymous_9)","line":155,"loc":{"start":{"line":155,"column":19},"end":{"line":155,"column":39}}},"10":{"name":"(anonymous_10)","line":164,"loc":{"start":{"line":164,"column":21},"end":{"line":164,"column":46}}},"11":{"name":"(anonymous_11)","line":174,"loc":{"start":{"line":174,"column":32},"end":{"line":174,"column":45}}},"12":{"name":"(anonymous_12)","line":178,"loc":{"start":{"line":178,"column":19},"end":{"line":178,"column":35}}},"13":{"name":"(anonymous_13)","line":182,"loc":{"start":{"line":182,"column":7},"end":{"line":182,"column":20}}},"14":{"name":"(anonymous_14)","line":185,"loc":{"start":{"line":185,"column":10},"end":{"line":185,"column":23}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":32}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":62}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":41}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":34}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":86}},"6":{"start":{"line":10,"column":0},"end":{"line":39,"column":1}},"7":{"start":{"line":11,"column":2},"end":{"line":11,"column":26}},"8":{"start":{"line":12,"column":2},"end":{"line":12,"column":48}},"9":{"start":{"line":13,"column":2},"end":{"line":13,"column":46}},"10":{"start":{"line":14,"column":2},"end":{"line":16,"column":4}},"11":{"start":{"line":17,"column":2},"end":{"line":17,"column":22}},"12":{"start":{"line":18,"column":2},"end":{"line":18,"column":32}},"13":{"start":{"line":19,"column":2},"end":{"line":19,"column":62}},"14":{"start":{"line":20,"column":2},"end":{"line":20,"column":23}},"15":{"start":{"line":21,"column":2},"end":{"line":21,"column":8}},"16":{"start":{"line":22,"column":2},"end":{"line":37,"column":3}},"17":{"start":{"line":23,"column":4},"end":{"line":23,"column":43}},"18":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"19":{"start":{"line":26,"column":6},"end":{"line":26,"column":31}},"20":{"start":{"line":29,"column":4},"end":{"line":29,"column":38}},"21":{"start":{"line":30,"column":4},"end":{"line":30,"column":37}},"22":{"start":{"line":31,"column":4},"end":{"line":35,"column":5}},"23":{"start":{"line":32,"column":6},"end":{"line":32,"column":34}},"24":{"start":{"line":33,"column":6},"end":{"line":33,"column":30}},"25":{"start":{"line":34,"column":6},"end":{"line":34,"column":86}},"26":{"start":{"line":36,"column":4},"end":{"line":36,"column":14}},"27":{"start":{"line":38,"column":2},"end":{"line":38,"column":11}},"28":{"start":{"line":41,"column":0},"end":{"line":41,"column":26}},"29":{"start":{"line":43,"column":0},"end":{"line":52,"column":2}},"30":{"start":{"line":44,"column":2},"end":{"line":44,"column":47}},"31":{"start":{"line":45,"column":2},"end":{"line":45,"column":30}},"32":{"start":{"line":46,"column":2},"end":{"line":46,"column":20}},"33":{"start":{"line":47,"column":2},"end":{"line":50,"column":3}},"34":{"start":{"line":49,"column":4},"end":{"line":49,"column":16}},"35":{"start":{"line":51,"column":2},"end":{"line":51,"column":14}},"36":{"start":{"line":54,"column":0},"end":{"line":61,"column":2}},"37":{"start":{"line":55,"column":2},"end":{"line":55,"column":37}},"38":{"start":{"line":56,"column":2},"end":{"line":56,"column":20}},"39":{"start":{"line":57,"column":2},"end":{"line":59,"column":3}},"40":{"start":{"line":58,"column":4},"end":{"line":58,"column":16}},"41":{"start":{"line":60,"column":2},"end":{"line":60,"column":14}},"42":{"start":{"line":63,"column":0},"end":{"line":101,"column":2}},"43":{"start":{"line":64,"column":2},"end":{"line":64,"column":46}},"44":{"start":{"line":65,"column":2},"end":{"line":65,"column":62}},"45":{"start":{"line":66,"column":2},"end":{"line":69,"column":4}},"46":{"start":{"line":70,"column":2},"end":{"line":72,"column":3}},"47":{"start":{"line":71,"column":4},"end":{"line":71,"column":18}},"48":{"start":{"line":73,"column":2},"end":{"line":99,"column":3}},"49":{"start":{"line":75,"column":4},"end":{"line":75,"column":20}},"50":{"start":{"line":76,"column":4},"end":{"line":88,"column":7}},"51":{"start":{"line":77,"column":6},"end":{"line":87,"column":7}},"52":{"start":{"line":78,"column":8},"end":{"line":78,"column":53}},"53":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"54":{"start":{"line":80,"column":10},"end":{"line":80,"column":38}},"55":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"56":{"start":{"line":83,"column":10},"end":{"line":83,"column":33}},"57":{"start":{"line":86,"column":8},"end":{"line":86,"column":36}},"58":{"start":{"line":89,"column":4},"end":{"line":91,"column":5}},"59":{"start":{"line":90,"column":6},"end":{"line":90,"column":40}},"60":{"start":{"line":94,"column":4},"end":{"line":97,"column":5}},"61":{"start":{"line":95,"column":6},"end":{"line":95,"column":42}},"62":{"start":{"line":96,"column":6},"end":{"line":96,"column":27}},"63":{"start":{"line":98,"column":4},"end":{"line":98,"column":37}},"64":{"start":{"line":100,"column":2},"end":{"line":100,"column":16}},"65":{"start":{"line":103,"column":0},"end":{"line":138,"column":2}},"66":{"start":{"line":104,"column":2},"end":{"line":107,"column":5}},"67":{"start":{"line":110,"column":2},"end":{"line":110,"column":20}},"68":{"start":{"line":111,"column":2},"end":{"line":115,"column":4}},"69":{"start":{"line":116,"column":2},"end":{"line":116,"column":18}},"70":{"start":{"line":117,"column":2},"end":{"line":133,"column":3}},"71":{"start":{"line":118,"column":4},"end":{"line":120,"column":5}},"72":{"start":{"line":119,"column":6},"end":{"line":119,"column":15}},"73":{"start":{"line":121,"column":4},"end":{"line":121,"column":24}},"74":{"start":{"line":122,"column":4},"end":{"line":124,"column":5}},"75":{"start":{"line":123,"column":6},"end":{"line":123,"column":15}},"76":{"start":{"line":125,"column":4},"end":{"line":125,"column":49}},"77":{"start":{"line":126,"column":4},"end":{"line":128,"column":5}},"78":{"start":{"line":127,"column":6},"end":{"line":127,"column":34}},"79":{"start":{"line":129,"column":4},"end":{"line":132,"column":5}},"80":{"start":{"line":130,"column":6},"end":{"line":130,"column":29}},"81":{"start":{"line":131,"column":6},"end":{"line":131,"column":41}},"82":{"start":{"line":134,"column":2},"end":{"line":136,"column":3}},"83":{"start":{"line":135,"column":4},"end":{"line":135,"column":38}},"84":{"start":{"line":137,"column":2},"end":{"line":137,"column":16}},"85":{"start":{"line":140,"column":0},"end":{"line":145,"column":2}},"86":{"start":{"line":141,"column":2},"end":{"line":143,"column":5}},"87":{"start":{"line":144,"column":2},"end":{"line":144,"column":16}},"88":{"start":{"line":147,"column":0},"end":{"line":153,"column":2}},"89":{"start":{"line":148,"column":2},"end":{"line":150,"column":5}},"90":{"start":{"line":152,"column":2},"end":{"line":152,"column":16}},"91":{"start":{"line":155,"column":0},"end":{"line":162,"column":2}},"92":{"start":{"line":156,"column":2},"end":{"line":160,"column":5}},"93":{"start":{"line":161,"column":2},"end":{"line":161,"column":16}},"94":{"start":{"line":164,"column":0},"end":{"line":188,"column":2}},"95":{"start":{"line":165,"column":2},"end":{"line":168,"column":5}},"96":{"start":{"line":169,"column":2},"end":{"line":171,"column":3}},"97":{"start":{"line":170,"column":4},"end":{"line":170,"column":14}},"98":{"start":{"line":174,"column":2},"end":{"line":176,"column":5}},"99":{"start":{"line":175,"column":4},"end":{"line":175,"column":26}},"100":{"start":{"line":178,"column":2},"end":{"line":187,"column":5}},"101":{"start":{"line":179,"column":4},"end":{"line":179,"column":29}},"102":{"start":{"line":183,"column":4},"end":{"line":183,"column":59}},"103":{"start":{"line":186,"column":4},"end":{"line":186,"column":16}}},"branchMap":{"1":{"line":11,"type":"binary-expr","locations":[{"start":{"line":11,"column":12},"end":{"line":11,"column":19}},{"start":{"line":11,"column":23},"end":{"line":11,"column":25}}]},"2":{"line":12,"type":"binary-expr","locations":[{"start":{"line":12,"column":21},"end":{"line":12,"column":37}},{"start":{"line":12,"column":41},"end":{"line":12,"column":47}}]},"3":{"line":13,"type":"binary-expr","locations":[{"start":{"line":13,"column":20},"end":{"line":13,"column":35}},{"start":{"line":13,"column":39},"end":{"line":13,"column":45}}]},"4":{"line":19,"type":"binary-expr","locations":[{"start":{"line":19,"column":17},"end":{"line":19,"column":33}},{"start":{"line":19,"column":37},"end":{"line":19,"column":61}}]},"5":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":4}},{"start":{"line":25,"column":4},"end":{"line":25,"column":4}}]},"6":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":35}},{"start":{"line":25,"column":39},"end":{"line":25,"column":45}},{"start":{"line":25,"column":49},"end":{"line":25,"column":89}}]},"7":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":21},"end":{"line":29,"column":31}},{"start":{"line":29,"column":35},"end":{"line":29,"column":37}}]},"8":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":15},"end":{"line":30,"column":23}},{"start":{"line":30,"column":27},"end":{"line":30,"column":36}}]},"9":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":31,"column":4}},{"start":{"line":31,"column":4},"end":{"line":31,"column":4}}]},"10":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":8},"end":{"line":31,"column":46}},{"start":{"line":31,"column":50},"end":{"line":31,"column":67}}]},"11":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"12":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":6},"end":{"line":47,"column":10}},{"start":{"line":47,"column":14},"end":{"line":47,"column":24}}]},"13":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":2},"end":{"line":57,"column":2}},{"start":{"line":57,"column":2},"end":{"line":57,"column":2}}]},"14":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]},"15":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":2},"end":{"line":73,"column":2}},{"start":{"line":73,"column":2},"end":{"line":73,"column":2}}]},"16":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":6},"end":{"line":77,"column":6}},{"start":{"line":77,"column":6},"end":{"line":77,"column":6}}]},"17":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":10},"end":{"line":77,"column":18}},{"start":{"line":77,"column":22},"end":{"line":77,"column":39}}]},"18":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":79,"column":8}},{"start":{"line":79,"column":8},"end":{"line":79,"column":8}}]},"19":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":82,"column":8}},{"start":{"line":82,"column":8},"end":{"line":82,"column":8}}]},"20":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":12},"end":{"line":82,"column":24}},{"start":{"line":82,"column":28},"end":{"line":82,"column":50}}]},"21":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":4},"end":{"line":89,"column":4}},{"start":{"line":89,"column":4},"end":{"line":89,"column":4}}]},"22":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":4},"end":{"line":94,"column":4}},{"start":{"line":94,"column":4},"end":{"line":94,"column":4}}]},"23":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":4},"end":{"line":118,"column":4}},{"start":{"line":118,"column":4},"end":{"line":118,"column":4}}]},"24":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":4},"end":{"line":122,"column":4}},{"start":{"line":122,"column":4},"end":{"line":122,"column":4}}]},"25":{"line":122,"type":"binary-expr","locations":[{"start":{"line":122,"column":8},"end":{"line":122,"column":17}},{"start":{"line":122,"column":21},"end":{"line":122,"column":39}}]},"26":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":4},"end":{"line":126,"column":4}},{"start":{"line":126,"column":4},"end":{"line":126,"column":4}}]},"27":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":4},"end":{"line":129,"column":4}},{"start":{"line":129,"column":4},"end":{"line":129,"column":4}}]},"28":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":8},"end":{"line":129,"column":20}},{"start":{"line":129,"column":24},"end":{"line":129,"column":46}}]},"29":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":2},"end":{"line":134,"column":2}},{"start":{"line":134,"column":2},"end":{"line":134,"column":2}}]},"30":{"line":142,"type":"binary-expr","locations":[{"start":{"line":142,"column":13},"end":{"line":142,"column":20}},{"start":{"line":142,"column":24},"end":{"line":142,"column":30}}]},"31":{"line":149,"type":"binary-expr","locations":[{"start":{"line":149,"column":13},"end":{"line":149,"column":20}},{"start":{"line":149,"column":24},"end":{"line":149,"column":30}}]},"32":{"line":157,"type":"binary-expr","locations":[{"start":{"line":157,"column":13},"end":{"line":157,"column":20}},{"start":{"line":157,"column":24},"end":{"line":157,"column":30}}]},"33":{"line":159,"type":"cond-expr","locations":[{"start":{"line":159,"column":47},"end":{"line":159,"column":71}},{"start":{"line":159,"column":74},"end":{"line":159,"column":95}}]},"34":{"line":167,"type":"binary-expr","locations":[{"start":{"line":167,"column":13},"end":{"line":167,"column":20}},{"start":{"line":167,"column":24},"end":{"line":167,"column":30}}]},"35":{"line":169,"type":"if","locations":[{"start":{"line":169,"column":2},"end":{"line":169,"column":2}},{"start":{"line":169,"column":2},"end":{"line":169,"column":2}}]},"36":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":6},"end":{"line":169,"column":13}},{"start":{"line":169,"column":17},"end":{"line":169,"column":29}},{"start":{"line":169,"column":33},"end":{"line":169,"column":52}}]},"37":{"line":183,"type":"binary-expr","locations":[{"start":{"line":183,"column":12},"end":{"line":183,"column":17}},{"start":{"line":183,"column":21},"end":{"line":183,"column":29}},{"start":{"line":183,"column":33},"end":{"line":183,"column":48}}]}},"code":["'use strict';","","var ms = require('humanize-ms');","var cleanNpmMetadata = require('normalize-registry-metadata');","var urllib = require('../common/urllib');","var config = require('../config');","","var USER_AGENT = 'npm_service.cnpmjs.org/' + config.version + ' ' + urllib.USER_AGENT;","","function* request(url, options) {","  options = options || {};","  options.dataType = options.dataType || 'json';","  options.timeout = options.timeout || 120000;","  options.headers = {","    'user-agent': USER_AGENT","  };","  options.gzip = true;","  options.followRedirect = true;","  var registry = options.registry || config.sourceNpmRegistry;","  url = registry + url;","  var r;","  try {","    r = yield urllib.request(url, options);","    // https://github.com/npm/registry/issues/87#issuecomment-261450090","    if (options.dataType === 'json' && r.data && config.officialNpmReplicate === registry) {","      cleanNpmMetadata(r.data);","    }","  } catch (err) {","    var statusCode = err.status || -1;","    var data = err.data || '[empty]';","    if (err.name === 'JSONResponseFormatError' && statusCode >= 500) {","      err.name = 'NPMServerError';","      err.status = statusCode;","      err.message = 'Url: ' + url + ', Status ' + statusCode + ', ' + data.toString();","    }","    throw err;","  }","  return r;","}","","exports.request = request;","","exports.getUser = function* (name) {","  var url = '/-/user/org.couchdb.user:' + name;","  var r = yield* request(url);","  var data = r.data;","  if (data && !data.name) {","    // 404","    data = null;","  }","  return data;","};","","exports.get = function* (name) {","  var r = yield* request('/' + name);","  var data = r.data;","  if (r.status === 404) {","    data = null;","  }","  return data;","};","","exports.fetchUpdatesSince = function* (lastSyncTime, timeout) {","  var lastModified = lastSyncTime - ms('10m');","  var data = yield exports.getAllSince(lastModified, timeout);","  var result = {","    lastModified: lastSyncTime,","    names: [],","  };","  if (!data) {","    return result;","  }","  if (Array.isArray(data)) {","    // support https://registry.npmjs.org/-/all/static/today.json","    var maxModified;","    data.forEach(function (pkg) {","      if (pkg.time && pkg.time.modified) {","        var modified = Date.parse(pkg.time.modified);","        if (modified >= lastModified) {","          result.names.push(pkg.name);","        }","        if (!maxModified || modified > maxModified) {","          maxModified = modified;","        }","      } else {","        result.names.push(pkg.name);","      }","    });","    if (maxModified) {","      result.lastModified = maxModified;","    }","  } else {","    // /-/all/since","    if (data._updated) {","      result.lastModified = data._updated;","      delete data._updated;","    }","    result.names = Object.keys(data);","  }","  return result;","};","","exports.fetchAllPackagesSince = function* (timestamp) {","  var r = yield request('/-/all/static/all.json', {","    registry: 'http://registry.npmjs.org',","    timeout: 600000","  });","  // {\"_updated\":1441520402174,\"0\":{\"name\":\"0\",\"dist-tags","  // \"time\":{\"modified\":\"2014-06-17T06:38:43.495Z\"}","  var data = r.data;","  var result = {","    lastModified: timestamp,","    lastModifiedName: null,","    names: [],","  };","  var maxModified;","  for (var key in data) {","    if (key === '_updated') {","      continue;","    }","    var pkg = data[key];","    if (!pkg.time || !pkg.time.modified) {","      continue;","    }","    var modified = Date.parse(pkg.time.modified);","    if (modified >= timestamp) {","      result.names.push(pkg.name);","    }","    if (!maxModified || modified > maxModified) {","      maxModified = modified;","      result.lastModifiedName = pkg.name;","    }","  }","  if (maxModified) {","    result.lastModified = maxModified;","  }","  return result;","};","","exports.getAllSince = function* (startkey, timeout) {","  var r = yield* request('/-/all/since?stale=update_after&startkey=' + startkey, {","    timeout: timeout || 300000","  });","  return r.data;","};","","exports.getAllToday = function* (timeout) {","  var r = yield* request('/-/all/static/today.json', {","    timeout: timeout || 300000","  });","  // data is array: see https://registry.npmjs.org/-/all/static/today.json","  return r.data;","};","","exports.getShort = function* (timeout) {","  var r = yield* request('/-/short', {","    timeout: timeout || 300000,","    // registry.npmjs.org/-/short is 404 now therefore have a fallback","    registry: config.sourceNpmRegistryIsCNpm ? config.sourceNpmRegistry : 'http://r.cnpmjs.org',","  });","  return r.data;","};","","exports.getPopular = function* (top, timeout) {","  var r = yield* request('/-/_view/dependedUpon?group_level=1', {","    registry: config.officialNpmRegistry,","    timeout: timeout || 120000","  });","  if (!r.data || !r.data.rows || !r.data.rows.length) {","    return [];","  }","","  // deps number must >= 100","  var rows = r.data.rows.filter(function (a) {","    return a.value >= 100;","  });","","  return rows.sort(function (a, b) {","    return b.value - a.value;","  })","  .slice(0, top)","  .map(function (r) {","    return [r.key && r.key[0] && r.key[0].trim(), r.value];","  })","  .filter(function (r) {","    return r[0];","  });","};",""],"l":{"3":1,"4":1,"5":1,"6":1,"8":1,"10":1,"11":0,"12":0,"13":0,"14":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"25":0,"26":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"36":0,"38":0,"41":1,"43":1,"44":0,"45":0,"46":0,"47":0,"49":0,"51":0,"54":1,"55":0,"56":0,"57":0,"58":0,"60":0,"63":1,"64":0,"65":0,"66":0,"70":0,"71":0,"73":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"82":0,"83":0,"86":0,"89":0,"90":0,"94":0,"95":0,"96":0,"98":0,"100":0,"103":1,"104":0,"110":0,"111":0,"116":0,"117":0,"118":0,"119":0,"121":0,"122":0,"123":0,"125":0,"126":0,"127":0,"129":0,"130":0,"131":0,"134":0,"135":0,"137":0,"140":1,"141":0,"144":0,"147":1,"148":0,"152":0,"155":1,"156":0,"161":0,"164":1,"165":0,"169":0,"170":0,"174":0,"175":0,"178":0,"179":0,"183":0,"186":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/total.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"showTotal","line":11,"loc":{"start":{"line":11,"column":17},"end":{"line":11,"column":39}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":51}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":36}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":61}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":34}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":17}},"7":{"start":{"line":11,"column":0},"end":{"line":34,"column":2}},"8":{"start":{"line":12,"column":2},"end":{"line":16,"column":3}},"9":{"start":{"line":14,"column":4},"end":{"line":14,"column":22}},"10":{"start":{"line":15,"column":4},"end":{"line":15,"column":11}},"11":{"start":{"line":18,"column":2},"end":{"line":18,"column":52}},"12":{"start":{"line":19,"column":2},"end":{"line":19,"column":21}},"13":{"start":{"line":20,"column":2},"end":{"line":20,"column":24}},"14":{"start":{"line":22,"column":2},"end":{"line":22,"column":28}},"15":{"start":{"line":23,"column":2},"end":{"line":23,"column":29}},"16":{"start":{"line":24,"column":2},"end":{"line":24,"column":40}},"17":{"start":{"line":25,"column":2},"end":{"line":25,"column":39}},"18":{"start":{"line":26,"column":2},"end":{"line":26,"column":30}},"19":{"start":{"line":27,"column":2},"end":{"line":27,"column":50}},"20":{"start":{"line":28,"column":2},"end":{"line":28,"column":38}},"21":{"start":{"line":30,"column":2},"end":{"line":30,"column":16}},"22":{"start":{"line":31,"column":2},"end":{"line":31,"column":32}},"23":{"start":{"line":33,"column":2},"end":{"line":33,"column":20}}},"branchMap":{"1":{"line":12,"type":"if","locations":[{"start":{"line":12,"column":2},"end":{"line":12,"column":2}},{"start":{"line":12,"column":2},"end":{"line":12,"column":2}}]},"2":{"line":12,"type":"binary-expr","locations":[{"start":{"line":12,"column":6},"end":{"line":12,"column":11}},{"start":{"line":12,"column":15},"end":{"line":12,"column":52}}]}},"code":["'use strict';","","const Total = require('../services/total');","const version = require('../package.json').version;","const config = require('../config');","const getDownloadTotal = require('./utils').getDownloadTotal;","","const startTime = '' + Date.now();","let cache = null;","","module.exports = function* showTotal() {","  if (cache && Date.now() - cache.cache_time < 10000) {","    // cache 10 seconds","    this.body = cache;","    return;","  }","","  const r = yield [Total.get(), getDownloadTotal()];","  const total = r[0];","  const download = r[1];","","  total.download = download;","  total.db_name = 'registry';","  total.instance_start_time = startTime;","  total.node_version = process.version;","  total.app_version = version;","  total.donate = 'https://www.gittip.com/fengmk2';","  total.sync_model = config.syncModel;","","  cache = total;","  total.cache_time = Date.now();","","  this.body = total;","};",""],"l":{"3":2,"4":0,"5":0,"6":0,"8":0,"9":0,"11":0,"12":0,"14":0,"15":0,"18":0,"19":0,"20":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"30":0,"31":0,"33":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/total.js","s":{"1":10,"2":10,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":27,"loc":{"start":{"line":27,"column":14},"end":{"line":27,"column":27}}},"2":{"name":"(anonymous_2)","line":91,"loc":{"start":{"line":91,"column":23},"end":{"line":91,"column":36}}},"3":{"name":"(anonymous_3)","line":103,"loc":{"start":{"line":103,"column":27},"end":{"line":103,"column":40}}},"4":{"name":"(anonymous_4)","line":108,"loc":{"start":{"line":108,"column":26},"end":{"line":108,"column":43}}},"5":{"name":"(anonymous_5)","line":113,"loc":{"start":{"line":113,"column":31},"end":{"line":113,"column":48}}},"6":{"name":"(anonymous_6)","line":118,"loc":{"start":{"line":118,"column":27},"end":{"line":118,"column":46}}},"7":{"name":"(anonymous_7)","line":123,"loc":{"start":{"line":123,"column":24},"end":{"line":123,"column":43}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":34}},"2":{"start":{"line":16,"column":0},"end":{"line":16,"column":34}},"3":{"start":{"line":17,"column":0},"end":{"line":17,"column":25}},"4":{"start":{"line":19,"column":0},"end":{"line":19,"column":76}},"5":{"start":{"line":20,"column":0},"end":{"line":20,"column":67}},"6":{"start":{"line":21,"column":0},"end":{"line":21,"column":62}},"7":{"start":{"line":22,"column":0},"end":{"line":25,"column":1}},"8":{"start":{"line":24,"column":2},"end":{"line":24,"column":67}},"9":{"start":{"line":27,"column":0},"end":{"line":89,"column":2}},"10":{"start":{"line":33,"column":2},"end":{"line":39,"column":4}},"11":{"start":{"line":42,"column":2},"end":{"line":42,"column":17}},"12":{"start":{"line":43,"column":2},"end":{"line":43,"column":17}},"13":{"start":{"line":44,"column":2},"end":{"line":44,"column":17}},"14":{"start":{"line":45,"column":2},"end":{"line":45,"column":25}},"15":{"start":{"line":47,"column":2},"end":{"line":49,"column":3}},"16":{"start":{"line":48,"column":4},"end":{"line":48,"column":52}},"17":{"start":{"line":51,"column":2},"end":{"line":74,"column":4}},"18":{"start":{"line":86,"column":2},"end":{"line":86,"column":55}},"19":{"start":{"line":88,"column":2},"end":{"line":88,"column":15}},"20":{"start":{"line":91,"column":0},"end":{"line":101,"column":2}},"21":{"start":{"line":92,"column":2},"end":{"line":96,"column":5}},"22":{"start":{"line":97,"column":2},"end":{"line":99,"column":3}},"23":{"start":{"line":98,"column":4},"end":{"line":98,"column":50}},"24":{"start":{"line":100,"column":2},"end":{"line":100,"column":13}},"25":{"start":{"line":103,"column":0},"end":{"line":106,"column":2}},"26":{"start":{"line":104,"column":2},"end":{"line":104,"column":82}},"27":{"start":{"line":105,"column":2},"end":{"line":105,"column":34}},"28":{"start":{"line":108,"column":0},"end":{"line":111,"column":2}},"29":{"start":{"line":109,"column":2},"end":{"line":109,"column":69}},"30":{"start":{"line":110,"column":2},"end":{"line":110,"column":50}},"31":{"start":{"line":113,"column":0},"end":{"line":116,"column":2}},"32":{"start":{"line":114,"column":2},"end":{"line":114,"column":75}},"33":{"start":{"line":115,"column":2},"end":{"line":115,"column":50}},"34":{"start":{"line":118,"column":0},"end":{"line":121,"column":2}},"35":{"start":{"line":119,"column":2},"end":{"line":119,"column":66}},"36":{"start":{"line":120,"column":2},"end":{"line":120,"column":44}},"37":{"start":{"line":123,"column":0},"end":{"line":137,"column":2}},"38":{"start":{"line":124,"column":2},"end":{"line":131,"column":4}},"39":{"start":{"line":132,"column":2},"end":{"line":135,"column":26}},"40":{"start":{"line":136,"column":2},"end":{"line":136,"column":40}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":0},"end":{"line":22,"column":0}},{"start":{"line":22,"column":0},"end":{"line":22,"column":0}}]},"2":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":13},"end":{"line":45,"column":18}},{"start":{"line":45,"column":22},"end":{"line":45,"column":24}}]},"3":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"4":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":19},"end":{"line":62,"column":37}},{"start":{"line":62,"column":41},"end":{"line":62,"column":42}}]},"5":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":19},"end":{"line":67,"column":37}},{"start":{"line":67,"column":41},"end":{"line":67,"column":42}}]},"6":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":22},"end":{"line":68,"column":43}},{"start":{"line":68,"column":47},"end":{"line":68,"column":48}}]},"7":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":19},"end":{"line":69,"column":37}},{"start":{"line":69,"column":41},"end":{"line":69,"column":42}}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":19},"end":{"line":70,"column":37}},{"start":{"line":70,"column":41},"end":{"line":70,"column":42}}]},"9":{"line":71,"type":"binary-expr","locations":[{"start":{"line":71,"column":20},"end":{"line":71,"column":39}},{"start":{"line":71,"column":43},"end":{"line":71,"column":44}}]},"10":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":26},"end":{"line":72,"column":51}},{"start":{"line":72,"column":55},"end":{"line":72,"column":56}}]},"11":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":22},"end":{"line":73,"column":43}},{"start":{"line":73,"column":47},"end":{"line":73,"column":49}}]},"12":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":2},"end":{"line":97,"column":2}},{"start":{"line":97,"column":2},"end":{"line":97,"column":2}}]},"13":{"line":97,"type":"binary-expr","locations":[{"start":{"line":97,"column":6},"end":{"line":97,"column":9}},{"start":{"line":97,"column":13},"end":{"line":97,"column":50}}]},"14":{"line":126,"type":"binary-expr","locations":[{"start":{"line":126,"column":4},"end":{"line":126,"column":15}},{"start":{"line":126,"column":19},"end":{"line":126,"column":20}}]},"15":{"line":127,"type":"binary-expr","locations":[{"start":{"line":127,"column":4},"end":{"line":127,"column":18}},{"start":{"line":127,"column":22},"end":{"line":127,"column":23}}]},"16":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":4},"end":{"line":128,"column":15}},{"start":{"line":128,"column":19},"end":{"line":128,"column":20}}]},"17":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":4},"end":{"line":129,"column":15}},{"start":{"line":129,"column":19},"end":{"line":129,"column":20}}]}},"code":["/**"," * Copyright(c) cnpm and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","var models = require('../models');","var Total = models.Total;","","var TOTAL_MODULE_SQL = 'SELECT count(distinct(name)) AS count FROM module;';","var TOTAL_VERSION_SQL = 'SELECT count(name) AS count FROM module;';","var TOTAL_USER_SQL = 'SELECT count(name) AS count FROM user;';","if (config.database.dialect === 'postgres') {","  // pg not allow table name as 'user'","  TOTAL_USER_SQL = 'SELECT count(name) AS count FROM public.user;';","}","","exports.get = function* () {","  // var DB_SIZE_SQL = 'SELECT TABLE_NAME AS name, data_length, index_length \\","  //   FROM information_schema.tables WHERE TABLE_SCHEMA = ? \\","  //   GROUP BY TABLE_NAME \\","  //   ORDER BY data_length DESC \\","  //   LIMIT 0, 200';","  var rs = yield [","    // models.query(DB_SIZE_SQL, [config.db]),","    models.queryOne(TOTAL_MODULE_SQL),","    models.queryOne(TOTAL_VERSION_SQL),","    models.queryOne(TOTAL_USER_SQL),","    exports.getTotalInfo(),","  ];","","  // var sizes = rs[0];","  var mc = rs[0];","  var vc = rs[1];","  var uc = rs[2];","  var info = rs[3] || {};","","  if (typeof info.module_delete === 'string') {","    info.module_delete = Number(info.module_delete);","  }","","  var total = {","    data_tables: {},","    disk_size: 0,","    data_size: 0,","    index_size: 0,","    disk_format_version: 0,","    committed_update_seq: 0,","    update_seq: 0,","    purge_seq: 0,","    compact_running: false,","    doc_count: mc.count,","    doc_del_count: info.module_delete || 0,","    doc_version_count: vc.count,","    user_count: uc.count,","    store_engine: config.database.dialect,","    sync_status: info.sync_status,","    need_sync_num: info.need_sync_num || 0,","    success_sync_num: info.success_sync_num || 0,","    fail_sync_num: info.fail_sync_num || 0,","    left_sync_num: info.left_sync_num || 0,","    last_sync_time: info.last_sync_time || 0,","    last_exist_sync_time: info.last_exist_sync_time || 0,","    last_sync_module: info.last_sync_module || '',","  };","","  // for (var i = 0; i < sizes.length; i++) {","  //   var row = sizes[i];","  //   total.data_tables[row.name] = {","  //     data_size: row.data_length,","  //     index_size: row.index_length,","  //   };","  //   total.data_size += row.data_length;","  //   total.index_size += row.index_length;","  // }","","  total.disk_size = total.data_size + total.index_size;","","  return total;","};","","exports.getTotalInfo = function* () {","  var row = yield Total.find({","    where: {","      name: 'total'","    }","  });","  if (row && typeof row.module_delete === 'string') {","    row.module_delete = Number(row.module_delete);","  }","  return row;","};","","exports.plusDeleteModule = function* () {","  var sql = 'UPDATE total SET module_delete=module_delete+1 WHERE name=\\'total\\'';","  return yield* models.query(sql);","};","","exports.setLastSyncTime = function* (time) {","  var sql = 'UPDATE total SET last_sync_time=? WHERE name=\\'total\\'';","  return yield* models.query(sql, [Number(time)]);","};","","exports.setLastExistSyncTime = function* (time) {","  var sql = 'UPDATE total SET last_exist_sync_time=? WHERE name=\\'total\\'';","  return yield* models.query(sql, [Number(time)]);","};","","exports.updateSyncStatus = function* (status) {","  var sql = 'UPDATE total SET sync_status=? WHERE name=\\'total\\'';","  return yield* models.query(sql, [status]);","};","","exports.updateSyncNum = function* (params) {","  var args = [","    params.syncStatus,","    params.need || 0,","    params.success || 0,","    params.fail || 0,","    params.left || 0,","    params.lastSyncModule","  ];","  var sql = 'UPDATE total SET \\","    sync_status=?, need_sync_num=?, success_sync_num=?, \\","    fail_sync_num=?, left_sync_num=?, last_sync_module=? \\","    WHERE name=\\'total\\'';","  return yield* models.query(sql, args);","};",""],"l":{"15":10,"16":10,"17":0,"19":0,"20":0,"21":0,"22":0,"24":0,"27":0,"33":0,"42":0,"43":0,"44":0,"45":0,"47":0,"48":0,"51":0,"86":0,"88":0,"91":0,"92":0,"97":0,"98":0,"100":0,"103":0,"104":0,"105":0,"108":0,"109":0,"110":0,"113":0,"114":0,"115":0,"118":0,"119":0,"120":0,"123":0,"124":0,"132":0,"136":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/utils.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/utils.js","s":{"1":4,"2":4,"3":4,"4":4,"5":4,"6":4,"7":4,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":31},"end":{"line":29,"column":47}}},"2":{"name":"cleanup","line":37,"loc":{"start":{"line":37,"column":2},"end":{"line":37,"column":21}}},"3":{"name":"(anonymous_3)","line":55,"loc":{"start":{"line":55,"column":27},"end":{"line":55,"column":44}}},"4":{"name":"(anonymous_4)","line":108,"loc":{"start":{"line":108,"column":21},"end":{"line":108,"column":36}}},"5":{"name":"(anonymous_5)","line":141,"loc":{"start":{"line":141,"column":35},"end":{"line":141,"column":51}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":61}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":23}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":33}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":32}},"6":{"start":{"line":22,"column":0},"end":{"line":22,"column":31}},"7":{"start":{"line":23,"column":0},"end":{"line":23,"column":65}},"8":{"start":{"line":24,"column":0},"end":{"line":24,"column":35}},"9":{"start":{"line":25,"column":0},"end":{"line":25,"column":34}},"10":{"start":{"line":27,"column":0},"end":{"line":27,"column":33}},"11":{"start":{"line":29,"column":0},"end":{"line":53,"column":2}},"12":{"start":{"line":30,"column":2},"end":{"line":30,"column":46}},"13":{"start":{"line":31,"column":2},"end":{"line":33,"column":3}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":56}},"15":{"start":{"line":35,"column":2},"end":{"line":36,"column":54}},"16":{"start":{"line":37,"column":2},"end":{"line":40,"column":3}},"17":{"start":{"line":38,"column":4},"end":{"line":38,"column":33}},"18":{"start":{"line":39,"column":4},"end":{"line":39,"column":37}},"19":{"start":{"line":41,"column":2},"end":{"line":41,"column":57}},"20":{"start":{"line":42,"column":2},"end":{"line":48,"column":3}},"21":{"start":{"line":43,"column":4},"end":{"line":43,"column":46}},"22":{"start":{"line":45,"column":4},"end":{"line":45,"column":80}},"23":{"start":{"line":46,"column":4},"end":{"line":46,"column":14}},"24":{"start":{"line":47,"column":4},"end":{"line":47,"column":14}},"25":{"start":{"line":49,"column":2},"end":{"line":49,"column":45}},"26":{"start":{"line":50,"column":2},"end":{"line":50,"column":33}},"27":{"start":{"line":51,"column":2},"end":{"line":51,"column":31}},"28":{"start":{"line":52,"column":2},"end":{"line":52,"column":17}},"29":{"start":{"line":55,"column":0},"end":{"line":106,"column":2}},"30":{"start":{"line":56,"column":2},"end":{"line":56,"column":21}},"31":{"start":{"line":57,"column":2},"end":{"line":57,"column":65}},"32":{"start":{"line":58,"column":2},"end":{"line":58,"column":69}},"33":{"start":{"line":59,"column":2},"end":{"line":59,"column":74}},"34":{"start":{"line":60,"column":2},"end":{"line":60,"column":80}},"35":{"start":{"line":61,"column":2},"end":{"line":61,"column":71}},"36":{"start":{"line":62,"column":2},"end":{"line":62,"column":73}},"37":{"start":{"line":63,"column":2},"end":{"line":63,"column":74}},"38":{"start":{"line":64,"column":2},"end":{"line":64,"column":37}},"39":{"start":{"line":65,"column":2},"end":{"line":65,"column":33}},"40":{"start":{"line":66,"column":2},"end":{"line":66,"column":53}},"41":{"start":{"line":67,"column":2},"end":{"line":67,"column":52}},"42":{"start":{"line":68,"column":2},"end":{"line":68,"column":26}},"43":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"44":{"start":{"line":70,"column":4},"end":{"line":70,"column":23}},"45":{"start":{"line":73,"column":2},"end":{"line":73,"column":83}},"46":{"start":{"line":74,"column":2},"end":{"line":81,"column":4}},"47":{"start":{"line":83,"column":2},"end":{"line":104,"column":3}},"48":{"start":{"line":84,"column":4},"end":{"line":84,"column":20}},"49":{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},"50":{"start":{"line":86,"column":6},"end":{"line":86,"column":32}},"51":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"52":{"start":{"line":89,"column":6},"end":{"line":89,"column":36}},"53":{"start":{"line":91,"column":4},"end":{"line":93,"column":5}},"54":{"start":{"line":92,"column":6},"end":{"line":92,"column":35}},"55":{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},"56":{"start":{"line":96,"column":6},"end":{"line":96,"column":34}},"57":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"58":{"start":{"line":99,"column":6},"end":{"line":99,"column":35}},"59":{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},"60":{"start":{"line":102,"column":6},"end":{"line":102,"column":36}},"61":{"start":{"line":105,"column":2},"end":{"line":105,"column":18}},"62":{"start":{"line":108,"column":0},"end":{"line":139,"column":2}},"63":{"start":{"line":109,"column":2},"end":{"line":109,"column":14}},"64":{"start":{"line":110,"column":2},"end":{"line":110,"column":71}},"65":{"start":{"line":111,"column":2},"end":{"line":113,"column":3}},"66":{"start":{"line":112,"column":4},"end":{"line":112,"column":12}},"67":{"start":{"line":115,"column":2},"end":{"line":117,"column":3}},"68":{"start":{"line":116,"column":4},"end":{"line":116,"column":25}},"69":{"start":{"line":119,"column":2},"end":{"line":124,"column":3}},"70":{"start":{"line":120,"column":4},"end":{"line":123,"column":6}},"71":{"start":{"line":126,"column":2},"end":{"line":138,"column":3}},"72":{"start":{"line":127,"column":4},"end":{"line":137,"column":5}},"73":{"start":{"line":128,"column":6},"end":{"line":131,"column":8}},"74":{"start":{"line":133,"column":6},"end":{"line":136,"column":8}},"75":{"start":{"line":141,"column":0},"end":{"line":166,"column":2}},"76":{"start":{"line":142,"column":2},"end":{"line":142,"column":47}},"77":{"start":{"line":144,"column":2},"end":{"line":162,"column":4}},"78":{"start":{"line":164,"column":2},"end":{"line":165,"column":56}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":2},"end":{"line":31,"column":2}},{"start":{"line":31,"column":2},"end":{"line":31,"column":2}}]},"2":{"line":67,"type":"cond-expr","locations":[{"start":{"line":67,"column":22},"end":{"line":67,"column":38}},{"start":{"line":67,"column":41},"end":{"line":67,"column":51}}]},"3":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]},"4":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":4},"end":{"line":85,"column":4}},{"start":{"line":85,"column":4},"end":{"line":85,"column":4}}]},"5":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":88,"column":4}},{"start":{"line":88,"column":4},"end":{"line":88,"column":4}}]},"6":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":91,"column":4}},{"start":{"line":91,"column":4},"end":{"line":91,"column":4}}]},"7":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":95,"column":4}},{"start":{"line":95,"column":4},"end":{"line":95,"column":4}}]},"8":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":98,"column":4}},{"start":{"line":98,"column":4},"end":{"line":98,"column":4}}]},"9":{"line":98,"type":"binary-expr","locations":[{"start":{"line":98,"column":8},"end":{"line":98,"column":31}},{"start":{"line":98,"column":35},"end":{"line":98,"column":56}}]},"10":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":101,"column":4}},{"start":{"line":101,"column":4},"end":{"line":101,"column":4}}]},"11":{"line":101,"type":"binary-expr","locations":[{"start":{"line":101,"column":8},"end":{"line":101,"column":23}},{"start":{"line":101,"column":27},"end":{"line":101,"column":49}}]},"12":{"line":110,"type":"binary-expr","locations":[{"start":{"line":110,"column":12},"end":{"line":110,"column":23}},{"start":{"line":110,"column":27},"end":{"line":110,"column":39}},{"start":{"line":110,"column":43},"end":{"line":110,"column":54}},{"start":{"line":110,"column":58},"end":{"line":110,"column":70}}]},"13":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":2},"end":{"line":111,"column":2}},{"start":{"line":111,"column":2},"end":{"line":111,"column":2}}]},"14":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":2},"end":{"line":115,"column":2}},{"start":{"line":115,"column":2},"end":{"line":115,"column":2}}]},"15":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":2},"end":{"line":119,"column":2}},{"start":{"line":119,"column":2},"end":{"line":119,"column":2}}]},"16":{"line":121,"type":"binary-expr","locations":[{"start":{"line":121,"column":12},"end":{"line":121,"column":24}},{"start":{"line":121,"column":28},"end":{"line":121,"column":40}}]},"17":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":2},"end":{"line":126,"column":2}},{"start":{"line":126,"column":2},"end":{"line":126,"column":2}}]},"18":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":4},"end":{"line":127,"column":4}},{"start":{"line":127,"column":4},"end":{"line":127,"column":4}}]},"19":{"line":164,"type":"cond-expr","locations":[{"start":{"line":165,"column":4},"end":{"line":165,"column":41}},{"start":{"line":165,"column":44},"end":{"line":165,"column":55}}]}},"code":["/**!"," * cnpmjs.org - controllers/utils.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:controllers:utils');","var path = require('path');","var fs = require('fs');","var utility = require('utility');","var ms = require('humanize-ms');","var moment = require('moment');","var downloadTotalService = require('../services/download_total');","var nfs = require('../common/nfs');","var config = require('../config');","","var DOWNLOAD_TIMEOUT = ms('10m');","","exports.downloadAsReadStream = function* (key) {","  var options = { timeout: DOWNLOAD_TIMEOUT };","  if (nfs.createDownloadStream) {","    return yield nfs.createDownloadStream(key, options);","  }","","  var tmpPath = path.join(config.uploadDir,","    utility.randomString() + key.replace(/\\//g, '-'));","  function cleanup() {","    debug('cleanup %s', tmpPath);","    fs.unlink(tmpPath, utility.noop);","  }","  debug('downloadAsReadStream() %s to %s', key, tmpPath);","  try {","    yield nfs.download(key, tmpPath, options);","  } catch (err) {","    debug('downloadAsReadStream() %s to %s error: %s', key, tmpPath, err.stack);","    cleanup();","    throw err;","  }","  var tarball = fs.createReadStream(tmpPath);","  tarball.once('error', cleanup);","  tarball.once('end', cleanup);","  return tarball;","};","","exports.getDownloadTotal = function* (name) {","  var end = moment();","  var start = end.clone().subtract(1, 'months').startOf('month');","  var lastday = end.clone().subtract(1, 'days').format('YYYY-MM-DD');","  var lastweekStart = end.clone().subtract(1, 'weeks').startOf('isoweek');","  var lastweekEnd = lastweekStart.clone().endOf('isoweek').format('YYYY-MM-DD');","  var lastmonthEnd = start.clone().endOf('month').format('YYYY-MM-DD');","  var thismonthStart = end.clone().startOf('month').format('YYYY-MM-DD');","  var thisweekStart = end.clone().startOf('isoweek').format('YYYY-MM-DD');","  start = start.format('YYYY-MM-DD');","  end = end.format('YYYY-MM-DD');","  lastweekStart = lastweekStart.format('YYYY-MM-DD');","  var method = name ? 'getModuleTotal' : 'getTotal';","  var args = [start, end];","  if (name) {","    args.unshift(name);","  }","","  var rows = yield* downloadTotalService[method].apply(downloadTotalService, args);","  var download = {","    today: 0,","    thisweek: 0,","    thismonth: 0,","    lastday: 0,","    lastweek: 0,","    lastmonth: 0,","  };","","  for (var i = 0; i < rows.length; i++) {","    var r = rows[i];","    if (r.date === end) {","      download.today += r.count;","    }","    if (r.date >= thismonthStart) {","      download.thismonth += r.count;","    }","    if (r.date >= thisweekStart) {","      download.thisweek += r.count;","    }","","    if (r.date === lastday) {","      download.lastday += r.count;","    }","    if (r.date >= lastweekStart && r.date <= lastweekEnd) {","      download.lastweek += r.count;","    }","    if (r.date >= start && r.date <= lastmonthEnd) {","      download.lastmonth += r.count;","    }","  }","  return download;","};","","exports.setLicense = function (pkg) {","  var license;","  license = pkg.license || pkg.licenses || pkg.licence || pkg.licences;","  if (!license) {","    return ;","  }","","  if (Array.isArray(license)) {","    license = license[0];","  }","","  if (typeof license === 'object') {","    pkg.license = {","      name: license.name || license.type,","      url: license.url","    };","  }","","  if (typeof license === 'string') {","    if (license.match(/(http|https)(:\\/\\/)/ig)) {","      pkg.license = {","        name: license,","        url: license","      };","    } else {","      pkg.license = {","        url: exports.getOssLicenseUrlFromName(license),","        name: license","      };","    }","  }","};","","exports.getOssLicenseUrlFromName = function (name) {","  var base = 'http://opensource.org/licenses/';","","  var licenseMap = {","    'bsd': 'BSD-2-Clause',","    'mit': 'MIT',","    'x11': 'MIT',","    'mit/x11': 'MIT',","    'apache 2.0': 'Apache-2.0',","    'apache2': 'Apache-2.0',","    'apache 2': 'Apache-2.0',","    'apache-2': 'Apache-2.0',","    'apache': 'Apache-2.0',","    'gpl': 'GPL-3.0',","    'gplv3': 'GPL-3.0',","    'gplv2': 'GPL-2.0',","    'gpl3': 'GPL-3.0',","    'gpl2': 'GPL-2.0',","    'lgpl': 'LGPL-2.1',","    'lgplv2.1': 'LGPL-2.1',","    'lgplv2': 'LGPL-2.1'","  };","","  return licenseMap[name.toLowerCase()] ?","    base + licenseMap[name.toLowerCase()] : base + name;","};",""],"l":{"17":4,"18":4,"19":4,"20":4,"21":4,"22":4,"23":4,"24":0,"25":0,"27":0,"29":0,"30":0,"31":0,"32":0,"35":0,"37":1,"38":0,"39":0,"41":0,"42":0,"43":0,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"52":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"73":0,"74":0,"83":0,"84":0,"85":0,"86":0,"88":0,"89":0,"91":0,"92":0,"95":0,"96":0,"98":0,"99":0,"101":0,"102":0,"105":0,"108":0,"109":0,"110":0,"111":0,"112":0,"115":0,"116":0,"119":0,"120":0,"126":0,"127":0,"128":0,"133":0,"141":0,"142":0,"144":0,"164":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/download_total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/download_total.js","s":{"1":4,"2":4,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":1,"44":0,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"(anonymous_1)","line":18,"loc":{"start":{"line":18,"column":25},"end":{"line":18,"column":54}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":25},"end":{"line":33,"column":42}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":30}}},"4":{"name":"(anonymous_4)","line":54,"loc":{"start":{"line":54,"column":26},"end":{"line":54,"column":43}}},"5":{"name":"(anonymous_5)","line":103,"loc":{"start":{"line":103,"column":19},"end":{"line":103,"column":42}}},"6":{"name":"parseYearMonth","line":107,"loc":{"start":{"line":107,"column":0},"end":{"line":107,"column":30}}},"7":{"name":"formatRows","line":111,"loc":{"start":{"line":111,"column":0},"end":{"line":111,"column":46}}},"8":{"name":"(anonymous_8)","line":113,"loc":{"start":{"line":113,"column":15},"end":{"line":113,"column":30}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":33}},"2":{"start":{"line":16,"column":0},"end":{"line":16,"column":55}},"3":{"start":{"line":18,"column":0},"end":{"line":31,"column":2}},"4":{"start":{"line":19,"column":2},"end":{"line":19,"column":41}},"5":{"start":{"line":20,"column":2},"end":{"line":20,"column":37}},"6":{"start":{"line":21,"column":2},"end":{"line":29,"column":5}},"7":{"start":{"line":30,"column":2},"end":{"line":30,"column":38}},"8":{"start":{"line":33,"column":0},"end":{"line":52,"column":2}},"9":{"start":{"line":34,"column":2},"end":{"line":38,"column":5}},"10":{"start":{"line":39,"column":2},"end":{"line":39,"column":16}},"11":{"start":{"line":40,"column":2},"end":{"line":50,"column":5}},"12":{"start":{"line":41,"column":4},"end":{"line":49,"column":5}},"13":{"start":{"line":42,"column":6},"end":{"line":42,"column":45}},"14":{"start":{"line":43,"column":6},"end":{"line":43,"column":28}},"15":{"start":{"line":44,"column":6},"end":{"line":44,"column":27}},"16":{"start":{"line":45,"column":6},"end":{"line":47,"column":7}},"17":{"start":{"line":46,"column":8},"end":{"line":46,"column":40}},"18":{"start":{"line":48,"column":6},"end":{"line":48,"column":19}},"19":{"start":{"line":51,"column":2},"end":{"line":51,"column":15}},"20":{"start":{"line":54,"column":0},"end":{"line":101,"column":2}},"21":{"start":{"line":55,"column":2},"end":{"line":55,"column":44}},"22":{"start":{"line":57,"column":2},"end":{"line":62,"column":5}},"23":{"start":{"line":63,"column":2},"end":{"line":68,"column":3}},"24":{"start":{"line":64,"column":4},"end":{"line":67,"column":7}},"25":{"start":{"line":69,"column":2},"end":{"line":69,"column":47}},"26":{"start":{"line":70,"column":2},"end":{"line":73,"column":3}},"27":{"start":{"line":72,"column":4},"end":{"line":72,"column":50}},"28":{"start":{"line":74,"column":2},"end":{"line":74,"column":27}},"29":{"start":{"line":75,"column":2},"end":{"line":77,"column":3}},"30":{"start":{"line":76,"column":4},"end":{"line":76,"column":21}},"31":{"start":{"line":79,"column":2},"end":{"line":84,"column":5}},"32":{"start":{"line":85,"column":2},"end":{"line":90,"column":3}},"33":{"start":{"line":86,"column":4},"end":{"line":89,"column":7}},"34":{"start":{"line":91,"column":2},"end":{"line":91,"column":47}},"35":{"start":{"line":92,"column":2},"end":{"line":95,"column":3}},"36":{"start":{"line":94,"column":4},"end":{"line":94,"column":50}},"37":{"start":{"line":96,"column":2},"end":{"line":96,"column":27}},"38":{"start":{"line":97,"column":2},"end":{"line":99,"column":3}},"39":{"start":{"line":98,"column":4},"end":{"line":98,"column":28}},"40":{"start":{"line":100,"column":2},"end":{"line":100,"column":13}},"41":{"start":{"line":103,"column":0},"end":{"line":105,"column":2}},"42":{"start":{"line":104,"column":2},"end":{"line":104,"column":61}},"43":{"start":{"line":107,"column":0},"end":{"line":109,"column":1}},"44":{"start":{"line":108,"column":2},"end":{"line":108,"column":55}},"45":{"start":{"line":111,"column":0},"end":{"line":136,"column":1}},"46":{"start":{"line":112,"column":2},"end":{"line":112,"column":17}},"47":{"start":{"line":113,"column":2},"end":{"line":134,"column":5}},"48":{"start":{"line":114,"column":4},"end":{"line":114,"column":32}},"49":{"start":{"line":115,"column":4},"end":{"line":115,"column":37}},"50":{"start":{"line":116,"column":4},"end":{"line":116,"column":36}},"51":{"start":{"line":117,"column":4},"end":{"line":117,"column":39}},"52":{"start":{"line":118,"column":4},"end":{"line":133,"column":5}},"53":{"start":{"line":119,"column":6},"end":{"line":119,"column":45}},"54":{"start":{"line":120,"column":6},"end":{"line":120,"column":28}},"55":{"start":{"line":121,"column":6},"end":{"line":121,"column":36}},"56":{"start":{"line":122,"column":6},"end":{"line":122,"column":29}},"57":{"start":{"line":123,"column":6},"end":{"line":125,"column":7}},"58":{"start":{"line":124,"column":8},"end":{"line":124,"column":44}},"59":{"start":{"line":126,"column":6},"end":{"line":132,"column":7}},"60":{"start":{"line":127,"column":8},"end":{"line":131,"column":11}},"61":{"start":{"line":135,"column":2},"end":{"line":135,"column":15}}},"branchMap":{"1":{"line":42,"type":"cond-expr","locations":[{"start":{"line":42,"column":25},"end":{"line":42,"column":32}},{"start":{"line":42,"column":35},"end":{"line":42,"column":44}}]},"2":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":6},"end":{"line":45,"column":6}},{"start":{"line":45,"column":6},"end":{"line":45,"column":6}}]},"3":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":2},"end":{"line":63,"column":2}},{"start":{"line":63,"column":2},"end":{"line":63,"column":2}}]},"4":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]},"5":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]},"6":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":2},"end":{"line":85,"column":2}},{"start":{"line":85,"column":2},"end":{"line":85,"column":2}}]},"7":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":2},"end":{"line":92,"column":2}},{"start":{"line":92,"column":2},"end":{"line":92,"column":2}}]},"8":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":2},"end":{"line":97,"column":2}},{"start":{"line":97,"column":2},"end":{"line":97,"column":2}}]},"9":{"line":119,"type":"cond-expr","locations":[{"start":{"line":119,"column":25},"end":{"line":119,"column":32}},{"start":{"line":119,"column":35},"end":{"line":119,"column":44}}]},"10":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":6},"end":{"line":123,"column":6}},{"start":{"line":123,"column":6},"end":{"line":123,"column":6}}]},"11":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":6},"end":{"line":126,"column":6}},{"start":{"line":126,"column":6},"end":{"line":126,"column":6}}]},"12":{"line":126,"type":"binary-expr","locations":[{"start":{"line":126,"column":10},"end":{"line":126,"column":19}},{"start":{"line":126,"column":23},"end":{"line":126,"column":37}},{"start":{"line":126,"column":41},"end":{"line":126,"column":53}}]}},"code":["/**!"," * Copyright(c) cnpm and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var utility = require('utility');","var DownloadTotal = require('../models').DownloadTotal;","","exports.getModuleTotal = function* (name, start, end) {","  var startMonth = parseYearMonth(start);","  var endMonth = parseYearMonth(end);","  var rows = yield DownloadTotal.findAll({","    where: {","      date: {","        gte: startMonth,","        lte: endMonth","      },","      name: name","    }","  });","  return formatRows(rows, start, end);","};","","exports.getTotalByName = function* (name) {","  var rows = yield DownloadTotal.findAll({","    where: {","      name: name","    }","  });","  var count = 0;","  rows.forEach(function (row) {","    for (var i = 1; i <= 31; i++) {","      var day = i < 10 ? '0' + i : String(i);","      var field = 'd' + day;","      var val = row[field];","      if (typeof val === 'string') {","        val = utility.toSafeNumber(val);","      }","      count += val;","    }","  });","  return count;","};","","exports.plusModuleTotal = function* (data) {","  var yearMonth = parseYearMonth(data.date);","  // all module download total","  var row = yield DownloadTotal.find({","    where: {","      name: '__all__',","      date: yearMonth","    }","  });","  if (!row) {","    row = DownloadTotal.build({","      name: '__all__',","      date: yearMonth,","    });","  }","  var field = 'd' + data.date.substring(8, 10);","  if (typeof row[field] === 'string') {","    // pg bigint is string...","    row[field] = utility.toSafeNumber(row[field]);","  }","  row[field] += data.count;","  if (row.changed()) {","    yield row.save();","  }","","  row = yield DownloadTotal.find({","    where: {","      name: data.name,","      date: yearMonth,","    }","  });","  if (!row) {","    row = DownloadTotal.build({","      name: data.name,","      date: yearMonth,","    });","  }","  var field = 'd' + data.date.substring(8, 10);","  if (typeof row[field] === 'string') {","    // pg bigint is string...","    row[field] = utility.toSafeNumber(row[field]);","  }","  row[field] += data.count;","  if (row.changed()) {","    return yield row.save();","  }","  return row;","};","","exports.getTotal = function* (start, end) {","  return yield exports.getModuleTotal('__all__', start, end);","};","","function parseYearMonth(date) {","  return Number(date.substring(0, 7).replace('-', ''));","}","","function formatRows(rows, startDate, endDate) {","  var dates = [];","  rows.forEach(function (row) {","    var date = String(row.date);","    var month = date.substring(4, 6);","    var year = date.substring(0, 4);","    var yearMonth = year + '-' + month;","    for (var i = 1; i <= 31; i++) {","      var day = i < 10 ? '0' + i : String(i);","      var field = 'd' + day;","      var d = yearMonth + '-' + day;","      var count = row[field];","      if (typeof count === 'string') {","        count = utility.toSafeNumber(count);","      }","      if (count > 0 && d >= startDate && d <= endDate) {","        dates.push({","          name: row.name,","          count: count,","          date: d","        });","      }","    }","  });","  return dates;","}",""],"l":{"15":4,"16":4,"18":0,"19":0,"20":0,"21":0,"30":0,"33":0,"34":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"48":0,"51":0,"54":0,"55":0,"57":0,"63":0,"64":0,"69":0,"70":0,"72":0,"74":0,"75":0,"76":0,"79":0,"85":0,"86":0,"91":0,"92":0,"94":0,"96":0,"97":0,"98":0,"100":0,"103":0,"104":0,"107":1,"108":0,"111":1,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"126":0,"127":0,"135":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/auth.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/auth.js","s":{"1":4,"2":4,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":17},"end":{"line":26,"column":29}}},"2":{"name":"auth","line":27,"loc":{"start":{"line":27,"column":9},"end":{"line":27,"column":30}}},"3":{"name":"unauthorized","line":68,"loc":{"start":{"line":68,"column":0},"end":{"line":68,"column":29}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":59}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":46}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":34}},"4":{"start":{"line":26,"column":0},"end":{"line":66,"column":2}},"5":{"start":{"line":27,"column":2},"end":{"line":65,"column":4}},"6":{"start":{"line":28,"column":4},"end":{"line":28,"column":19}},"7":{"start":{"line":30,"column":4},"end":{"line":30,"column":78}},"8":{"start":{"line":31,"column":4},"end":{"line":31,"column":41}},"9":{"start":{"line":32,"column":4},"end":{"line":32,"column":65}},"10":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"11":{"start":{"line":34,"column":6},"end":{"line":34,"column":50}},"12":{"start":{"line":37,"column":4},"end":{"line":37,"column":67}},"13":{"start":{"line":38,"column":4},"end":{"line":38,"column":41}},"14":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"15":{"start":{"line":40,"column":7},"end":{"line":40,"column":51}},"16":{"start":{"line":43,"column":4},"end":{"line":43,"column":47}},"17":{"start":{"line":44,"column":4},"end":{"line":44,"column":48}},"18":{"start":{"line":46,"column":4},"end":{"line":46,"column":12}},"19":{"start":{"line":47,"column":4},"end":{"line":53,"column":5}},"20":{"start":{"line":48,"column":6},"end":{"line":48,"column":56}},"21":{"start":{"line":52,"column":6},"end":{"line":52,"column":28}},"22":{"start":{"line":55,"column":4},"end":{"line":58,"column":5}},"23":{"start":{"line":56,"column":6},"end":{"line":56,"column":65}},"24":{"start":{"line":57,"column":6},"end":{"line":57,"column":50}},"25":{"start":{"line":60,"column":4},"end":{"line":60,"column":31}},"26":{"start":{"line":61,"column":4},"end":{"line":61,"column":39}},"27":{"start":{"line":62,"column":4},"end":{"line":62,"column":34}},"28":{"start":{"line":63,"column":4},"end":{"line":63,"column":69}},"29":{"start":{"line":64,"column":4},"end":{"line":64,"column":16}},"30":{"start":{"line":68,"column":0},"end":{"line":82,"column":1}},"31":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"32":{"start":{"line":70,"column":4},"end":{"line":70,"column":23}},"33":{"start":{"line":72,"column":2},"end":{"line":72,"column":20}},"34":{"start":{"line":73,"column":2},"end":{"line":73,"column":55}},"35":{"start":{"line":74,"column":2},"end":{"line":81,"column":3}},"36":{"start":{"line":75,"column":4},"end":{"line":78,"column":6}},"37":{"start":{"line":80,"column":4},"end":{"line":80,"column":30}}},"branchMap":{"1":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":24},"end":{"line":30,"column":71}},{"start":{"line":30,"column":75},"end":{"line":30,"column":77}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":25},"end":{"line":30,"column":50}},{"start":{"line":30,"column":54},"end":{"line":30,"column":56}}]},"3":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":33,"column":4}},{"start":{"line":33,"column":4},"end":{"line":33,"column":4}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":39,"column":4}},{"start":{"line":39,"column":4},"end":{"line":39,"column":4}}]},"5":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":4}},{"start":{"line":55,"column":4},"end":{"line":55,"column":4}}]},"6":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]},"7":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":6},"end":{"line":69,"column":24}},{"start":{"line":69,"column":28},"end":{"line":69,"column":49}}]},"8":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":2},"end":{"line":74,"column":2}},{"start":{"line":74,"column":2},"end":{"line":74,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/auth.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:middleware:auth');","var UserService = require('../services/user');","var config = require('../config');","","/**"," * Parse the request authorization"," * get the real user"," */","","module.exports = function () {","  return function* auth(next) {","    this.user = {};","","    var authorization = (this.get('authorization') || '').split(' ')[1] || '';","    authorization = authorization.trim();","    debug('%s %s with %j', this.method, this.url, authorization);","    if (!authorization) {","      return yield* unauthorized.call(this, next);","    }","","    authorization = new Buffer(authorization, 'base64').toString();","    var pos = authorization.indexOf(':');","    if (pos === -1) {","       return yield* unauthorized.call(this, next);","    }","","    var username = authorization.slice(0, pos);","    var password = authorization.slice(pos + 1);","","    var row;","    try {","      row = yield* UserService.auth(username, password);","    } catch (err) {","      // do not response error here","      // many request do not need login","      this.user.error = err;","    }","","    if (!row) {","      debug('auth fail user: %j, headers: %j', row, this.header);","      return yield* unauthorized.call(this, next);","    }","","    this.user.name = row.login;","    this.user.isAdmin = row.site_admin;","    this.user.scopes = row.scopes;","    debug('auth pass user: %j, headers: %j', this.user, this.header);","    yield* next;","  };","};","","function* unauthorized(next) {","  if (!config.alwaysAuth || this.method !== 'GET') {","    return yield* next;","  }","  this.status = 401;","  this.set('WWW-Authenticate', 'Basic realm=\"sample\"');","  if (this.accepts(['html', 'json']) === 'json') {","    this.body = {","      error: 'unauthorized',","      reason: 'login first'","    };","  } else {","    this.body = 'login first';","  }","}",""],"l":{"17":4,"18":4,"19":0,"26":0,"27":0,"28":0,"30":0,"31":0,"32":0,"33":0,"34":0,"37":0,"38":0,"39":0,"40":0,"43":0,"44":0,"46":0,"47":0,"48":0,"52":0,"55":0,"56":0,"57":0,"60":0,"61":0,"62":0,"63":0,"64":0,"68":1,"69":0,"70":0,"72":0,"73":0,"74":0,"75":0,"80":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/user.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/user.js","s":{"1":4,"2":4,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"convertUser","line":29,"loc":{"start":{"line":29,"column":0},"end":{"line":29,"column":27}}},"2":{"name":"(anonymous_2)","line":40,"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":43}}},"3":{"name":"(anonymous_3)","line":45,"loc":{"start":{"line":45,"column":14},"end":{"line":45,"column":32}}},"4":{"name":"(anonymous_4)","line":50,"loc":{"start":{"line":50,"column":15},"end":{"line":50,"column":34}}},"5":{"name":"(anonymous_5)","line":55,"loc":{"start":{"line":55,"column":17},"end":{"line":55,"column":44}}},"6":{"name":"(anonymous_6)","line":60,"loc":{"start":{"line":60,"column":21},"end":{"line":60,"column":39}}},"7":{"name":"(anonymous_7)","line":73,"loc":{"start":{"line":73,"column":22},"end":{"line":73,"column":50}}},"8":{"name":"(anonymous_8)","line":88,"loc":{"start":{"line":88,"column":14},"end":{"line":88,"column":31}}},"9":{"name":"(anonymous_9)","line":92,"loc":{"start":{"line":92,"column":17},"end":{"line":92,"column":34}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":37}},"3":{"start":{"line":20,"column":0},"end":{"line":26,"column":1}},"4":{"start":{"line":21,"column":2},"end":{"line":21,"column":61}},"5":{"start":{"line":22,"column":2},"end":{"line":22,"column":48}},"6":{"start":{"line":23,"column":2},"end":{"line":23,"column":35}},"7":{"start":{"line":25,"column":2},"end":{"line":25,"column":34}},"8":{"start":{"line":27,"column":0},"end":{"line":27,"column":36}},"9":{"start":{"line":29,"column":0},"end":{"line":38,"column":1}},"10":{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},"11":{"start":{"line":31,"column":4},"end":{"line":31,"column":16}},"12":{"start":{"line":33,"column":2},"end":{"line":33,"column":34}},"13":{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},"14":{"start":{"line":35,"column":4},"end":{"line":35,"column":40}},"15":{"start":{"line":37,"column":2},"end":{"line":37,"column":14}},"16":{"start":{"line":40,"column":0},"end":{"line":43,"column":2}},"17":{"start":{"line":41,"column":2},"end":{"line":41,"column":61}},"18":{"start":{"line":42,"column":2},"end":{"line":42,"column":27}},"19":{"start":{"line":45,"column":0},"end":{"line":48,"column":2}},"20":{"start":{"line":46,"column":2},"end":{"line":46,"column":50}},"21":{"start":{"line":47,"column":2},"end":{"line":47,"column":27}},"22":{"start":{"line":50,"column":0},"end":{"line":53,"column":2}},"23":{"start":{"line":51,"column":2},"end":{"line":51,"column":53}},"24":{"start":{"line":52,"column":2},"end":{"line":52,"column":32}},"25":{"start":{"line":55,"column":0},"end":{"line":58,"column":2}},"26":{"start":{"line":56,"column":2},"end":{"line":56,"column":63}},"27":{"start":{"line":57,"column":2},"end":{"line":57,"column":32}},"28":{"start":{"line":60,"column":0},"end":{"line":71,"column":2}},"29":{"start":{"line":61,"column":2},"end":{"line":69,"column":3}},"30":{"start":{"line":62,"column":4},"end":{"line":62,"column":41}},"31":{"start":{"line":63,"column":4},"end":{"line":68,"column":5}},"32":{"start":{"line":64,"column":6},"end":{"line":66,"column":8}},"33":{"start":{"line":67,"column":6},"end":{"line":67,"column":39}},"34":{"start":{"line":70,"column":2},"end":{"line":70,"column":39}},"35":{"start":{"line":73,"column":0},"end":{"line":86,"column":2}},"36":{"start":{"line":74,"column":2},"end":{"line":74,"column":50}},"37":{"start":{"line":75,"column":2},"end":{"line":84,"column":3}},"38":{"start":{"line":76,"column":4},"end":{"line":83,"column":5}},"39":{"start":{"line":78,"column":6},"end":{"line":81,"column":8}},"40":{"start":{"line":82,"column":6},"end":{"line":82,"column":39}},"41":{"start":{"line":85,"column":2},"end":{"line":85,"column":14}},"42":{"start":{"line":88,"column":0},"end":{"line":90,"column":2}},"43":{"start":{"line":89,"column":2},"end":{"line":89,"column":31}},"44":{"start":{"line":92,"column":0},"end":{"line":94,"column":2}},"45":{"start":{"line":93,"column":2},"end":{"line":93,"column":34}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":0},"end":{"line":20,"column":0}},{"start":{"line":20,"column":0},"end":{"line":20,"column":0}}]},"2":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":16},"end":{"line":27,"column":29}},{"start":{"line":27,"column":33},"end":{"line":27,"column":35}}]},"3":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":30,"column":2}},{"start":{"line":30,"column":2},"end":{"line":30,"column":2}}]},"4":{"line":33,"type":"binary-expr","locations":[{"start":{"line":33,"column":16},"end":{"line":33,"column":27}},{"start":{"line":33,"column":31},"end":{"line":33,"column":33}}]},"5":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"6":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":30}},{"start":{"line":34,"column":34},"end":{"line":34,"column":58}}]},"7":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":2},"end":{"line":61,"column":2}},{"start":{"line":61,"column":2},"end":{"line":61,"column":2}}]},"8":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":63,"column":4}},{"start":{"line":63,"column":4},"end":{"line":63,"column":4}}]},"9":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]},"10":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":76,"column":4}},{"start":{"line":76,"column":4},"end":{"line":76,"column":4}}]}},"code":["/**!"," * cnpmjs.org - services/user.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","var User = require('../models').User;","","if (!config.userService) {","  var DefaultUserService = require('./default_user_service');","  config.userService = new DefaultUserService();","  config.customUserService = false;","} else {","  config.customUserService = true;","}","config.scopes = config.scopes || [];","","function convertUser(user) {","  if (!user) {","    return null;","  }","  user.scopes = user.scopes || [];","  if (user.scopes.length === 0 && config.scopes.length > 0) {","    user.scopes = config.scopes.slice();","  }","  return user;","}","","exports.auth = function* (login, password) {","  var user = yield* config.userService.auth(login, password);","  return convertUser(user);","};","","exports.get = function* (login) {","  var user = yield* config.userService.get(login);","  return convertUser(user);","};","","exports.list = function* (logins) {","  var users = yield* config.userService.list(logins);","  return users.map(convertUser);","};","","exports.search = function* (query, options) {","  var users = yield* config.userService.search(query, options);","  return users.map(convertUser);","};","","exports.getAndSave = function* (login) {","  if (config.customUserService) {","    var user = yield* exports.get(login);","    if (user) {","      var data = {","        user: user","      };","      yield* User.saveCustomUser(data);","    }","  }","  return yield* User.findByName(login);","};","","exports.authAndSave = function* (login, password) {","  var user = yield* exports.auth(login, password);","  if (user) {","    if (config.customUserService) {","      // make sure sync user meta to cnpm database","      var data = {","        rev: Date.now() + '-' + user.login,","        user: user","      };","      yield* User.saveCustomUser(data);","    }","  }","  return user;","};","","exports.add = function* (user) {","  return yield* User.add(user);","};","","exports.update = function* (user) {","  return yield* User.update(user);","};",""],"l":{"17":4,"18":4,"20":0,"21":0,"22":0,"23":0,"25":0,"27":0,"29":1,"30":0,"31":0,"33":0,"34":0,"35":0,"37":0,"40":0,"41":0,"42":0,"45":0,"46":0,"47":0,"50":0,"51":0,"52":0,"55":0,"56":0,"57":0,"60":0,"61":0,"62":0,"63":0,"64":0,"67":0,"70":0,"73":0,"74":0,"75":0,"76":0,"78":0,"82":0,"85":0,"88":0,"89":0,"92":0,"93":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/block.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/block.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":17},"end":{"line":17,"column":29}}},"2":{"name":"block","line":18,"loc":{"start":{"line":18,"column":9},"end":{"line":18,"column":31}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":28,"column":2}},"2":{"start":{"line":18,"column":2},"end":{"line":27,"column":4}},"3":{"start":{"line":19,"column":4},"end":{"line":19,"column":58}},"4":{"start":{"line":20,"column":4},"end":{"line":25,"column":5}},"5":{"start":{"line":21,"column":6},"end":{"line":21,"column":24}},"6":{"start":{"line":22,"column":6},"end":{"line":24,"column":8}},"7":{"start":{"line":26,"column":4},"end":{"line":26,"column":16}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":20,"column":4}},{"start":{"line":20,"column":4},"end":{"line":20,"column":4}}]}},"code":["/**!"," * cnpmjs.org - middleware/block.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","module.exports = function () {","  return function* block(next) {","    var ua = String(this.get('user-agent')).toLowerCase();","    if (ua === 'ruby') {","      this.status = 403;","      return this.body = {","        message: 'forbidden Ruby user-agent, ip: ' + this.ip","      };","    }","    yield* next;","  };","};",""],"l":{"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"26":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/exists_package.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/exists_package.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":17},"end":{"line":17,"column":34}}}},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":15,"column":52}},"2":{"start":{"line":17,"column":0},"end":{"line":28,"column":2}},"3":{"start":{"line":18,"column":2},"end":{"line":18,"column":48}},"4":{"start":{"line":19,"column":2},"end":{"line":19,"column":55}},"5":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"6":{"start":{"line":21,"column":4},"end":{"line":21,"column":23}},"7":{"start":{"line":23,"column":2},"end":{"line":23,"column":20}},"8":{"start":{"line":24,"column":2},"end":{"line":27,"column":4}}},"branchMap":{"1":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":13},"end":{"line":18,"column":29}},{"start":{"line":18,"column":33},"end":{"line":18,"column":47}}]},"2":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]}},"code":["/**!"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var packageService = require('../services/package');","","module.exports = function* (next) {","  var name = this.params.name || this.params[0];","  var pkg = yield packageService.getLatestModule(name);","  if (pkg) {","    return yield* next;","  }","  this.status = 404;","  this.body = {","    error: 'not_found',","    reason: 'document not found'","  };","};",""],"l":{"15":2,"17":0,"18":0,"19":0,"20":0,"21":0,"23":0,"24":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/opensearch.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/opensearch.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"opensearch","line":25,"loc":{"start":{"line":25,"column":17},"end":{"line":25,"column":44}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":23,"column":27}},"2":{"start":{"line":25,"column":0},"end":{"line":32,"column":2}},"3":{"start":{"line":26,"column":2},"end":{"line":30,"column":3}},"4":{"start":{"line":27,"column":4},"end":{"line":27,"column":27}},"5":{"start":{"line":28,"column":4},"end":{"line":28,"column":27}},"6":{"start":{"line":29,"column":4},"end":{"line":29,"column":55}},"7":{"start":{"line":31,"column":2},"end":{"line":31,"column":14}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/opensearch.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var template = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\"," <OpenSearchDescription xmlns=\"http://a9.com/-/spec/opensearch/1.1/\">\\","   <ShortName>CNPM</ShortName>\\","   <Description>Search packages in CNPM.</Description>\\","   <Tags>CNPM</Tags>\\","    <Url method=\"get\" type=\"text/html\" template=\"http://${host}/browse/keyword/{searchTerms}\"/>\\"," </OpenSearchDescription>';","","module.exports = function *opensearch(next) {","  if (this.path === '/opensearch.xml') {","    this.type = 'text/xml';","    this.charset = 'utf-8';","    this.body = template.replace('${host}', this.host);","  }","  yield *next;","};",""],"l":{"17":1,"25":1,"26":0,"27":0,"28":0,"29":0,"31":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/proxy_to_npm.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/proxy_to_npm.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":10,"loc":{"start":{"line":10,"column":17},"end":{"line":10,"column":36}}},"2":{"name":"proxyToNpm","line":25,"loc":{"start":{"line":25,"column":9},"end":{"line":25,"column":36}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":7,"column":67}},"2":{"start":{"line":8,"column":0},"end":{"line":8,"column":34}},"3":{"start":{"line":10,"column":0},"end":{"line":50,"column":2}},"4":{"start":{"line":11,"column":2},"end":{"line":11,"column":45}},"5":{"start":{"line":12,"column":2},"end":{"line":17,"column":4}},"6":{"start":{"line":18,"column":2},"end":{"line":24,"column":3}},"7":{"start":{"line":19,"column":4},"end":{"line":19,"column":59}},"8":{"start":{"line":20,"column":4},"end":{"line":23,"column":6}},"9":{"start":{"line":25,"column":2},"end":{"line":49,"column":4}},"10":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"11":{"start":{"line":27,"column":6},"end":{"line":27,"column":24}},"12":{"start":{"line":30,"column":4},"end":{"line":32,"column":5}},"13":{"start":{"line":31,"column":6},"end":{"line":31,"column":24}},"14":{"start":{"line":34,"column":4},"end":{"line":34,"column":29}},"15":{"start":{"line":35,"column":4},"end":{"line":35,"column":14}},"16":{"start":{"line":36,"column":4},"end":{"line":41,"column":5}},"17":{"start":{"line":37,"column":6},"end":{"line":37,"column":42}},"18":{"start":{"line":38,"column":6},"end":{"line":40,"column":7}},"19":{"start":{"line":39,"column":8},"end":{"line":39,"column":14}},"20":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"21":{"start":{"line":43,"column":6},"end":{"line":43,"column":24}},"22":{"start":{"line":46,"column":4},"end":{"line":46,"column":37}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":30}},"24":{"start":{"line":48,"column":4},"end":{"line":48,"column":23}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":2}},{"start":{"line":18,"column":2},"end":{"line":18,"column":2}}]},"2":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":6},"end":{"line":18,"column":13}},{"start":{"line":18,"column":17},"end":{"line":18,"column":30}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":26,"column":4}},{"start":{"line":26,"column":4},"end":{"line":26,"column":4}}]},"4":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":4},"end":{"line":30,"column":4}},{"start":{"line":30,"column":4},"end":{"line":30,"column":4}}]},"5":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":8},"end":{"line":30,"column":29}},{"start":{"line":30,"column":33},"end":{"line":30,"column":55}}]},"6":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":6},"end":{"line":38,"column":6}},{"start":{"line":38,"column":6},"end":{"line":38,"column":6}}]},"7":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":4}},{"start":{"line":42,"column":4},"end":{"line":42,"column":4}}]}},"code":["'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:middleware:proxy_to_npm');","var config = require('../config');","","module.exports = function (options) {","  var redirectUrl = config.sourceNpmRegistry;","  var proxyUrls = [","    // /:pkg, dont contains scoped package","    /^\\/[\\w\\-\\.]+$/,","    // /-/package/:pkg/dist-tags","    /^\\/\\-\\/package\\/[\\w\\-\\.]+\\/dist-tags/,","  ];","  if (options && options.isWeb) {","    redirectUrl = redirectUrl.replace('//registry.', '//');","    proxyUrls = [","      // /package/:pkg","      /^\\/package\\/[\\w\\-\\.]+$/,","    ];","  }","  return function* proxyToNpm(next) {","    if (config.syncModel !== 'none') {","      return yield next;","    }","    // only proxy read requests","    if (this.method !== 'GET' && this.method !== 'HEAD') {","      return yield next;","    }","","    var pathname = this.path;","    var match;","    for (var i = 0; i < proxyUrls.length; i++) {","      match = proxyUrls[i].test(pathname);","      if (match) {","        break;","      }","    }","    if (!match) {","      return yield next;","    }","","    var url = redirectUrl + this.url;","    debug('proxy to %s', url);","    this.redirect(url);","  };","};",""],"l":{"7":1,"8":1,"10":1,"11":0,"12":0,"18":0,"19":0,"20":0,"25":0,"26":0,"27":0,"30":0,"31":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"42":0,"43":0,"46":0,"47":0,"48":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/registry_not_found.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/registry_not_found.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"notFound","line":17,"loc":{"start":{"line":17,"column":17},"end":{"line":17,"column":42}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":32,"column":2}},"2":{"start":{"line":18,"column":2},"end":{"line":18,"column":14}},"3":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":11}},"5":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"6":{"start":{"line":24,"column":4},"end":{"line":24,"column":11}},"7":{"start":{"line":27,"column":2},"end":{"line":27,"column":20}},"8":{"start":{"line":28,"column":2},"end":{"line":31,"column":4}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]},"2":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":6},"end":{"line":20,"column":17}},{"start":{"line":20,"column":21},"end":{"line":20,"column":40}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"4":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":6},"end":{"line":23,"column":15}},{"start":{"line":23,"column":19},"end":{"line":23,"column":33}}]}},"code":["/**!"," * cnpmjs.org - middleware/registry_not_found.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","module.exports = function* notFound(next) {","  yield* next;","","  if (this.status && this.status !== 404) {","    return;","  }","  if (this.body && this.body.name) {","    return;","  }","","  this.status = 404;","  this.body = {","    error: 'not_found',","    reason: 'document not found'","  };","};",""],"l":{"17":1,"18":0,"20":0,"21":0,"23":0,"24":0,"27":0,"28":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/static.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/static.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1},"b":{"1":[0,1],"2":[0,1]},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":45}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":34}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":61}},"5":{"start":{"line":23,"column":0},"end":{"line":30,"column":3}}},"branchMap":{"1":{"line":24,"type":"cond-expr","locations":[{"start":{"line":24,"column":25},"end":{"line":24,"column":30}},{"start":{"line":24,"column":33},"end":{"line":24,"column":37}}]},"2":{"line":25,"type":"cond-expr","locations":[{"start":{"line":25,"column":25},"end":{"line":25,"column":26}},{"start":{"line":25,"column":29},"end":{"line":25,"column":45}}]}},"code":["/**!"," * cnpmjs.org - middleware/static.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var path = require('path');","var middlewares = require('koa-middlewares');","var config = require('../config');","","var staticDir = path.join(path.dirname(__dirname), 'public');","","module.exports = middlewares.staticCache(staticDir, {","  buffer: config.debug ? false : true,","  maxAge: config.debug ? 0 : 60 * 60 * 24 * 7,","  alias: {","    '/favicon.ico': '/favicon.png'","  },","  gzip: config.enableCompress,","});",""],"l":{"17":1,"18":1,"19":1,"21":1,"23":1}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/unpublishable.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/unpublishable.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"unpublishable","line":13,"loc":{"start":{"line":13,"column":17},"end":{"line":13,"column":47}}}},"statementMap":{"1":{"start":{"line":13,"column":0},"end":{"line":24,"column":2}},"2":{"start":{"line":15,"column":2},"end":{"line":22,"column":3}},"3":{"start":{"line":16,"column":4},"end":{"line":16,"column":22}},"4":{"start":{"line":17,"column":4},"end":{"line":20,"column":6}},"5":{"start":{"line":21,"column":4},"end":{"line":21,"column":11}},"6":{"start":{"line":23,"column":2},"end":{"line":23,"column":13}}},"branchMap":{"1":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":2},"end":{"line":15,"column":2}},{"start":{"line":15,"column":2},"end":{"line":15,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/unpublishable.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com>"," */","","'use strict';","","module.exports = function *unpublishable(next) {","  // only admin user can unpublish","  if (!this.user.isAdmin) {","    this.status = 403;","    this.body = {","      error: 'no_perms',","      reason: 'Only administrators can unpublish module',","    };","    return;","  }","  yield next;","};",""],"l":{"13":1,"15":0,"16":0,"17":0,"21":0,"23":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/web_not_found.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/middleware/web_not_found.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"notFound","line":19,"loc":{"start":{"line":19,"column":17},"end":{"line":19,"column":42}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":68}},"2":{"start":{"line":19,"column":0},"end":{"line":53,"column":2}},"3":{"start":{"line":20,"column":2},"end":{"line":20,"column":14}},"4":{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},"5":{"start":{"line":23,"column":4},"end":{"line":23,"column":11}},"6":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"7":{"start":{"line":26,"column":4},"end":{"line":26,"column":11}},"8":{"start":{"line":29,"column":2},"end":{"line":29,"column":47}},"9":{"start":{"line":30,"column":2},"end":{"line":33,"column":3}},"10":{"start":{"line":32,"column":4},"end":{"line":32,"column":54}},"11":{"start":{"line":34,"column":2},"end":{"line":34,"column":36}},"12":{"start":{"line":35,"column":2},"end":{"line":37,"column":3}},"13":{"start":{"line":36,"column":4},"end":{"line":36,"column":45}},"14":{"start":{"line":40,"column":2},"end":{"line":40,"column":52}},"15":{"start":{"line":41,"column":2},"end":{"line":41,"column":18}},"16":{"start":{"line":42,"column":2},"end":{"line":42,"column":36}},"17":{"start":{"line":43,"column":2},"end":{"line":46,"column":3}},"18":{"start":{"line":44,"column":4},"end":{"line":44,"column":16}},"19":{"start":{"line":45,"column":4},"end":{"line":45,"column":32}},"20":{"start":{"line":48,"column":2},"end":{"line":48,"column":20}},"21":{"start":{"line":49,"column":2},"end":{"line":52,"column":5}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":22,"column":2}},{"start":{"line":22,"column":2},"end":{"line":22,"column":2}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":6},"end":{"line":22,"column":17}},{"start":{"line":22,"column":21},"end":{"line":22,"column":40}}]},"3":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"4":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":30,"column":2}},{"start":{"line":30,"column":2},"end":{"line":30,"column":2}}]},"5":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]},"6":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]}},"code":["/**!"," * cnpmjs.org - middleware/web_not_found.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var debug = require('debug')('cnpmjs.org:middleware:web_not_found');","","module.exports = function* notFound(next) {","  yield* next;","","  if (this.status && this.status !== 404) {","    return;","  }","  if (this.body) {","    return;","  }","","  var m = /^\\/([\\w\\-\\.]+)\\/?$/.exec(this.path);","  if (!m) {","    // scoped packages","    m = /^\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/.exec(this.path);","  }","  debug('%s match %j', this.url, m);","  if (m) {","    return this.redirect('/package/' + m[1]);","  }","","  // package not found","  m = /\\/package\\/([\\w\\-\\_\\.]+)\\/?$/.exec(this.url);","  var name = null;","  var title = '404: Page Not Found';","  if (m) {","    name = m[1];","    title = name + ' Not Found';","  }","","  this.status = 404;","  yield* this.render('404', {","    title: title,","    name: name","  });","};",""],"l":{"17":1,"19":1,"20":0,"22":0,"23":0,"25":0,"26":0,"29":0,"30":0,"32":0,"34":0,"35":0,"36":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"48":0,"49":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/download_total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/download_total.js","s":{"1":1,"2":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":59,"loc":{"start":{"line":59,"column":17},"end":{"line":59,"column":49}}}},"statementMap":{"1":{"start":{"line":59,"column":0},"end":{"line":273,"column":2}},"2":{"start":{"line":60,"column":2},"end":{"line":272,"column":5}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/download_total.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","// CREATE TABLE IF NOT EXISTS `downloads` (","//  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',","//  `gmt_create` datetime NOT NULL COMMENT 'create time',","//  `gmt_modified` datetime NOT NULL COMMENT 'modified time',","//  `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',","//  `date` int unsigned NOT NULL COMMENT 'YYYYMM format',","//  `d01` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '01 download count',","//  `d02` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '02 download count',","//  `d03` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '03 download count',","//  `d04` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '04 download count',","//  `d05` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '05 download count',","//  `d06` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '06 download count',","//  `d07` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '07 download count',","//  `d08` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '08 download count',","//  `d09` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '09 download count',","//  `d10` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '10 download count',","//  `d11` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '11 download count',","//  `d12` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '12 download count',","//  `d13` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '13 download count',","//  `d14` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '14 download count',","//  `d15` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '15 download count',","//  `d16` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '16 download count',","//  `d17` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '17 download count',","//  `d18` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '18 download count',","//  `d19` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '19 download count',","//  `d20` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '20 download count',","//  `d21` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '21 download count',","//  `d22` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '22 download count',","//  `d23` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '23 download count',","//  `d24` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '24 download count',","//  `d25` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '25 download count',","//  `d26` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '26 download count',","//  `d27` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '27 download count',","//  `d28` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '28 download count',","//  `d29` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '29 download count',","//  `d30` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '30 download count',","//  `d31` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '31 download count',","//  PRIMARY KEY (`id`),","//  UNIQUE KEY `name_date` (`name`, `date`)","//  KEY `date` (`date`)","// ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module download total info';","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('DownloadTotal', {","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    },","    date: {","      type: DataTypes.INTEGER,","      allowNull: false,","      comment: 'YYYYMM format',","    },","    d01: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '01 download count',","    },","    d02: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '02 download count',","    },","    d03: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '03 download count',","    },","    d04: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '04 download count',","    },","    d05: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '05 download count',","    },","    d06: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '06 download count',","    },","    d07: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '07 download count',","    },","    d08: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '08 download count',","    },","    d09: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '09 download count',","    },","    d10: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '10 download count',","    },","    d11: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '11 download count',","    },","    d12: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '12 download count',","    },","    d13: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '13 download count',","    },","    d14: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '14 download count',","    },","    d15: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '15 download count',","    },","    d16: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '16 download count',","    },","    d17: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '17 download count',","    },","    d18: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '18 download count',","    },","    d19: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '19 download count',","    },","    d20: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '20 download count',","    },","    d21: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '21 download count',","    },","    d22: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '22 download count',","    },","    d23: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '23 download count',","    },","    d24: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '24 download count',","    },","    d25: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '25 download count',","    },","    d26: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '26 download count',","    },","    d27: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '27 download count',","    },","    d28: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '28 download count',","    },","    d29: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '29 download count',","    },","    d30: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '30 download count',","    },","    d31: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: '31 download count',","    },","  }, {","    tableName: 'downloads',","    comment: 'module download total info',","    indexes: [","      {","        unique: true,","        fields: ['name', 'date']","      },","      {","        fields: ['date']","      }","    ],","    classMethods: {","","    }","  });","};",""],"l":{"59":1,"60":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/init_script.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/init_script.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":0,"7":2,"8":2,"9":0,"10":2,"11":2,"12":0,"13":2,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"b":{"1":[0,2],"2":[0,2],"3":[0,2],"4":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":42,"loc":{"start":{"line":42,"column":8},"end":{"line":42,"column":20}}},"2":{"name":"(anonymous_2)","line":43,"loc":{"start":{"line":43,"column":22},"end":{"line":43,"column":37}}},"3":{"name":"(anonymous_3)","line":55,"loc":{"start":{"line":55,"column":9},"end":{"line":55,"column":24}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":38}},"3":{"start":{"line":22,"column":0},"end":{"line":22,"column":39}},"4":{"start":{"line":23,"column":0},"end":{"line":23,"column":30}},"5":{"start":{"line":24,"column":0},"end":{"line":26,"column":1}},"6":{"start":{"line":25,"column":2},"end":{"line":25,"column":36}},"7":{"start":{"line":27,"column":0},"end":{"line":27,"column":27}},"8":{"start":{"line":28,"column":0},"end":{"line":30,"column":1}},"9":{"start":{"line":29,"column":2},"end":{"line":29,"column":40}},"10":{"start":{"line":31,"column":0},"end":{"line":31,"column":31}},"11":{"start":{"line":32,"column":0},"end":{"line":34,"column":1}},"12":{"start":{"line":33,"column":2},"end":{"line":33,"column":38}},"13":{"start":{"line":36,"column":0},"end":{"line":36,"column":27}},"14":{"start":{"line":38,"column":0},"end":{"line":59,"column":5}},"15":{"start":{"line":43,"column":4},"end":{"line":53,"column":7}},"16":{"start":{"line":44,"column":6},"end":{"line":52,"column":7}},"17":{"start":{"line":45,"column":8},"end":{"line":45,"column":69}},"18":{"start":{"line":46,"column":8},"end":{"line":46,"column":27}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":18}},"20":{"start":{"line":49,"column":8},"end":{"line":50,"column":35}},"21":{"start":{"line":51,"column":8},"end":{"line":51,"column":24}},"22":{"start":{"line":56,"column":4},"end":{"line":56,"column":65}},"23":{"start":{"line":57,"column":4},"end":{"line":57,"column":23}},"24":{"start":{"line":58,"column":4},"end":{"line":58,"column":20}}},"branchMap":{"1":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":0},"end":{"line":24,"column":0}},{"start":{"line":24,"column":0},"end":{"line":24,"column":0}}]},"2":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":0},"end":{"line":28,"column":0}},{"start":{"line":28,"column":0},"end":{"line":28,"column":0}}]},"3":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":0},"end":{"line":32,"column":0}},{"start":{"line":32,"column":0},"end":{"line":32,"column":0}}]},"4":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":6},"end":{"line":44,"column":6}},{"start":{"line":44,"column":6},"end":{"line":44,"column":6}}]}},"code":["/**!"," * cnpmjs.org - models/init_script.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var config = require('../config');","","config.database.logging = console.log;","","// $ node --harmony models/init_script.js <force> <dialect> <port> <username>","var force = process.argv[2] === 'true';","var dialect = process.argv[3];","if (dialect) {","  config.database.dialect = dialect;","}","var port = process.argv[4];","if (port) {","  config.database.port = parseInt(port);","}","var username = process.argv[5];","if (username) {","  config.database.username = username;","}","","var models = require('./');","","models.sequelize.sync({","  force: force,","  logging: console.log,"," })","  .then(function () {","    models.Total.init(function (err) {","      if (err) {","        console.error('[models/init_script.js] sequelize init fail');","        console.error(err);","        throw err;","      } else {","        console.log('[models/init_script.js] `%s` sequelize sync and init success',","          config.database.dialect);","        process.exit(0);","      }","    });","  })","  .catch(function (err) {","    console.error('[models/init_script.js] sequelize sync fail');","    console.error(err);","    process.exit(1);","  });",""],"l":{"17":2,"19":2,"22":2,"23":2,"24":2,"25":0,"27":2,"28":2,"29":0,"31":2,"32":2,"33":0,"36":2,"38":0,"43":0,"44":0,"45":0,"46":0,"47":0,"49":0,"51":0,"56":0,"57":0,"58":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_deps.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_deps.js","s":{"1":1,"2":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":17},"end":{"line":29,"column":49}}}},"statementMap":{"1":{"start":{"line":29,"column":0},"end":{"line":58,"column":2}},"2":{"start":{"line":30,"column":2},"end":{"line":57,"column":5}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/module_deps.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `module_deps` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," `deps` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT '`name` is deped by `deps`',"," PRIMARY KEY (`id`),"," UNIQUE KEY `module_deps_name_deps` (`name`,`deps`),"," KEY `deps` (`module_deps_deps`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module deps';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('ModuleDependency', {","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    },","    dependent: {","      field: 'deps',","      type: DataTypes.STRING(100),","      comment: '`name` is depended by `deps`. `deps` == depend => `name`'","    }","  }, {","    tableName: 'module_deps',","    comment: 'module deps',","    // no need update timestamp","    updatedAt: false,","    indexes: [","      {","        unique: true,","        fields: ['name', 'deps']","      },","      {","        fields: ['deps']","      }","    ],","    classMethods: {","    }","  });","};",""],"l":{"29":1,"30":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module.js","s":{"1":1,"2":0,"3":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":41,"loc":{"start":{"line":41,"column":17},"end":{"line":41,"column":49}}},"2":{"name":"(anonymous_2)","line":101,"loc":{"start":{"line":101,"column":28},"end":{"line":101,"column":54}}}},"statementMap":{"1":{"start":{"line":41,"column":0},"end":{"line":108,"column":2}},"2":{"start":{"line":42,"column":2},"end":{"line":107,"column":5}},"3":{"start":{"line":102,"column":8},"end":{"line":104,"column":11}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/module.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `module` (","  `id` INTEGER NOT NULL auto_increment ,","  `author` VARCHAR(100) NOT NULL,","  `name` VARCHAR(100) NOT NULL,","  `version` VARCHAR(30) NOT NULL,","  `description` LONGTEXT,","  `package` LONGTEXT,","  `dist_shasum` VARCHAR(100),","  `dist_tarball` VARCHAR(2048),","  `dist_size` INTEGER UNSIGNED NOT NULL DEFAULT 0,","  `publish_time` BIGINT(20) UNSIGNED,","  `gmt_create` DATETIME NOT NULL,","  `gmt_modified` DATETIME NOT NULL,","  PRIMARY KEY (`id`)",")","COMMENT 'module info' ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE utf8_general_ci;","","CREATE UNIQUE INDEX `module_name_version` ON `module` (`name`, `version`);","CREATE INDEX `module_gmt_modified` ON `module` (`gmt_modified`);","CREATE INDEX `module_publish_time` ON `module` (`publish_time`);","CREATE INDEX `module_author` ON `module` (`author`);","*/","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('Module', {","    author: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'first maintainer name'","    },","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name'","    },","    version: {","      type: DataTypes.STRING(30),","      allowNull: false,","      comment: 'module version'","    },","    description: {","      type: DataTypes.LONGTEXT,","    },","    package: {","      type: DataTypes.LONGTEXT,","      comment: 'package.json',","    },","    dist_shasum: {","      type: DataTypes.STRING(100),","      allowNull: true,","    },","    dist_tarball: {","      type: DataTypes.STRING(2048),","      allowNull: true,","    },","    dist_size: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","    },","    publish_time: {","      type: DataTypes.BIGINT(20),","      allowNull: true,","    }","  }, {","    tableName: 'module',","    comment: 'module info',","    indexes: [","      {","        unique: true,","        fields: ['name', 'version']","      },","      {","        fields: ['gmt_modified']","      },","      {","        fields: ['publish_time']","      },","      {","        fields: ['author']","      }","    ],","    classMethods: {","      findByNameAndVersion: function* (name, version) {","        return yield this.find({","          where: { name: name, version: version }","        });","      }","    }","  });","};",""],"l":{"41":1,"42":0,"102":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_keyword.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_keyword.js","s":{"1":1,"2":0,"3":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":30,"loc":{"start":{"line":30,"column":17},"end":{"line":30,"column":49}}},"2":{"name":"(anonymous_2)","line":59,"loc":{"start":{"line":59,"column":28},"end":{"line":59,"column":54}}}},"statementMap":{"1":{"start":{"line":30,"column":0},"end":{"line":69,"column":2}},"2":{"start":{"line":31,"column":2},"end":{"line":68,"column":5}},"3":{"start":{"line":60,"column":8},"end":{"line":65,"column":11}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/module_keyword.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `module_keyword` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `keyword` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'keyword',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," `description` longtext,"," PRIMARY KEY (`id`),"," UNIQUE KEY `keyword_module_name` (`keyword`,`name`),"," KEY `name` (`name`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module keyword';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('ModuleKeyword', {","    keyword: {","      type: DataTypes.STRING(100),","      allowNull: false,","    },","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    },","    description: {","      type: DataTypes.LONGTEXT,","      allowNull: true,","    }","  }, {","    tableName: 'module_keyword',","    comment: 'module keyword',","    updatedAt: false,","    indexes: [","      {","        unique: true,","        fields: ['keyword', 'name']","      },","      {","        fields: ['name']","      }","    ],","    classMethods: {","      findByKeywordAndName: function* (keyword, name) {","        return yield this.find({","          where: {","            keyword: keyword,","            name: name","          }","        });","      }","    }","  });","};",""],"l":{"30":1,"31":0,"60":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/_module_maintainer_class_methods.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/_module_maintainer_class_methods.js","s":{"1":1,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":1,"10":0,"11":0,"12":0,"13":0,"14":1,"15":0,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":22,"loc":{"start":{"line":22,"column":32},"end":{"line":22,"column":49}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":18},"end":{"line":29,"column":33}}},"3":{"name":"(anonymous_3)","line":39,"loc":{"start":{"line":39,"column":26},"end":{"line":39,"column":43}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":18},"end":{"line":46,"column":33}}},"5":{"name":"(anonymous_5)","line":57,"loc":{"start":{"line":57,"column":24},"end":{"line":57,"column":47}}},"6":{"name":"(anonymous_6)","line":79,"loc":{"start":{"line":79,"column":25},"end":{"line":79,"column":49}}},"7":{"name":"(anonymous_7)","line":80,"loc":{"start":{"line":80,"column":25},"end":{"line":80,"column":41}}},"8":{"name":"(anonymous_8)","line":91,"loc":{"start":{"line":91,"column":28},"end":{"line":91,"column":52}}},"9":{"name":"(anonymous_9)","line":112,"loc":{"start":{"line":112,"column":31},"end":{"line":112,"column":48}}},"10":{"name":"(anonymous_10)","line":126,"loc":{"start":{"line":126,"column":28},"end":{"line":126,"column":52}}},"11":{"name":"(anonymous_11)","line":139,"loc":{"start":{"line":139,"column":30},"end":{"line":139,"column":50}}},"12":{"name":"(anonymous_12)","line":144,"loc":{"start":{"line":144,"column":34},"end":{"line":144,"column":54}}}},"statementMap":{"1":{"start":{"line":22,"column":0},"end":{"line":32,"column":2}},"2":{"start":{"line":23,"column":2},"end":{"line":28,"column":5}},"3":{"start":{"line":29,"column":2},"end":{"line":31,"column":5}},"4":{"start":{"line":30,"column":4},"end":{"line":30,"column":20}},"5":{"start":{"line":39,"column":0},"end":{"line":49,"column":2}},"6":{"start":{"line":40,"column":2},"end":{"line":45,"column":5}},"7":{"start":{"line":46,"column":2},"end":{"line":48,"column":5}},"8":{"start":{"line":47,"column":4},"end":{"line":47,"column":20}},"9":{"start":{"line":57,"column":0},"end":{"line":71,"column":2}},"10":{"start":{"line":58,"column":2},"end":{"line":63,"column":5}},"11":{"start":{"line":64,"column":2},"end":{"line":69,"column":3}},"12":{"start":{"line":65,"column":4},"end":{"line":68,"column":14}},"13":{"start":{"line":70,"column":2},"end":{"line":70,"column":13}},"14":{"start":{"line":79,"column":0},"end":{"line":83,"column":2}},"15":{"start":{"line":80,"column":2},"end":{"line":82,"column":16}},"16":{"start":{"line":81,"column":4},"end":{"line":81,"column":42}},"17":{"start":{"line":91,"column":0},"end":{"line":105,"column":2}},"18":{"start":{"line":93,"column":2},"end":{"line":95,"column":3}},"19":{"start":{"line":94,"column":4},"end":{"line":94,"column":20}},"20":{"start":{"line":96,"column":2},"end":{"line":98,"column":3}},"21":{"start":{"line":97,"column":4},"end":{"line":97,"column":11}},"22":{"start":{"line":99,"column":2},"end":{"line":104,"column":5}},"23":{"start":{"line":112,"column":0},"end":{"line":118,"column":2}},"24":{"start":{"line":113,"column":2},"end":{"line":117,"column":5}},"25":{"start":{"line":126,"column":0},"end":{"line":158,"column":2}},"26":{"start":{"line":131,"column":2},"end":{"line":136,"column":3}},"27":{"start":{"line":132,"column":4},"end":{"line":135,"column":6}},"28":{"start":{"line":137,"column":2},"end":{"line":137,"column":49}},"29":{"start":{"line":139,"column":2},"end":{"line":142,"column":5}},"30":{"start":{"line":141,"column":4},"end":{"line":141,"column":43}},"31":{"start":{"line":144,"column":2},"end":{"line":147,"column":5}},"32":{"start":{"line":146,"column":4},"end":{"line":146,"column":42}},"33":{"start":{"line":149,"column":2},"end":{"line":152,"column":4}},"34":{"start":{"line":154,"column":2},"end":{"line":157,"column":4}}},"branchMap":{"1":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":64,"column":2}},{"start":{"line":64,"column":2},"end":{"line":64,"column":2}}]},"2":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":2},"end":{"line":93,"column":2}},{"start":{"line":93,"column":2},"end":{"line":93,"column":2}}]},"3":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":2},"end":{"line":96,"column":2}},{"start":{"line":96,"column":2},"end":{"line":96,"column":2}}]},"4":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":2},"end":{"line":131,"column":2}},{"start":{"line":131,"column":2},"end":{"line":131,"column":2}}]}},"code":["/**!"," * cnpmjs.org - models/_module_maintainer_class_methods.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/**"," * list all module names by user"," * @param {String} user"," */","","exports.listModuleNamesByUser = function* (user) {","  var rows = yield this.findAll({","    attributrs: ['name'],","    where: {","      user: user","    }","  });","  return rows.map(function (row) {","    return row.name;","  });","};","","/**"," * list all maintainers of module `name`"," * @param {String} name"," */","","exports.listMaintainers = function* (name) {","  var rows = yield this.findAll({","    attributrs: ['user'],","    where: {","      name: name","    }","  });","  return rows.map(function (row) {","    return row.user;","  });","};","","/**"," * add a maintainer for module `name`"," * @param {String} name"," * @param {String} user"," */","","exports.addMaintainer = function* (name, user) {","  var row = yield this.find({","    where: {","      user: user,","      name: name","    }","  });","  if (!row) {","    row = yield this.build({","      user: user,","      name: name","    }).save();","  }","  return row;","};","","/**"," * add maintainers for module `name`"," * @param {String} name"," * @param {Array} users"," */","","exports.addMaintainers = function* (name, users) {","  return yield users.map(function (user) {","    return this.addMaintainer(name, user);","  }.bind(this));","};","","/**"," * remove maintainers for module `name`"," * @param {String} name"," * @param {Array} users"," */","","exports.removeMaintainers = function* (name, users) {","  // removeMaintainers(name, oneUserName)","  if (typeof users === 'string') {","    users = [users];","  }","  if (users.length === 0) {","    return;","  }","  yield this.destroy({","    where: {","      name: name,","      user: users,","    }","  });","};","","/**"," * remove all maintainers for module `name`"," * @param {String} name"," */","","exports.removeAllMaintainers = function* (name) {","  yield this.destroy({","    where: {","      name: name","    }","  });","};","","/**"," * add maintainers to module"," * @param {String} name"," * @param {Array} users"," */","","exports.updateMaintainers = function* (name, users) {","  // maintainers should be [username1, username2, ...] format","  // find out the exists maintainers","  // then remove all the users not present and add all the left","","  if (users.length === 0) {","    return {","      add: [],","      remove: []","    };","  }","  var exists = yield* this.listMaintainers(name);","","  var addUsers = users.filter(function (username) {","    // add user which in `users` but do not in `exists`","    return exists.indexOf(username) === -1;","  });","","  var removeUsers = exists.filter(function (username) {","    // remove user which in `exists` by not in `users`","    return users.indexOf(username) === -1;","  });","","  yield [","    this.addMaintainers(name, addUsers),","    this.removeMaintainers(name, removeUsers),","  ];","","  return {","    add: addUsers,","    remove: removeUsers","  };","};","",""],"l":{"22":1,"23":0,"29":0,"30":0,"39":1,"40":0,"46":0,"47":0,"57":1,"58":0,"64":0,"65":0,"70":0,"79":1,"80":0,"81":0,"91":1,"93":0,"94":0,"96":0,"97":0,"99":0,"112":1,"113":0,"126":1,"131":0,"132":0,"137":0,"139":0,"141":0,"144":0,"146":0,"149":0,"154":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_maintainer.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_maintainer.js","s":{"1":1,"2":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":17},"end":{"line":29,"column":49}}}},"statementMap":{"1":{"start":{"line":29,"column":0},"end":{"line":56,"column":2}},"2":{"start":{"line":30,"column":2},"end":{"line":55,"column":5}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/module_maintainer.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `module_maintainer` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `user` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'user name',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," PRIMARY KEY (`id`),"," UNIQUE KEY `module_maintainer_user_name` (`user`,`name`),"," KEY `name` (`name`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='private module maintainers';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('ModuleMaintainer', {","    user: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'user name'","    },","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    }","  }, {","    tableName: 'module_maintainer',","    comment: 'private module maintainers',","    updatedAt: false,","    indexes: [","      {","        unique: true,","        fields: ['user', 'name']","      },","      {","        fields: ['name']","      }","    ],","    classMethods: require('./_module_maintainer_class_methods'),","  });","};",""],"l":{"29":1,"30":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_star.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_star.js","s":{"1":1,"2":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":17},"end":{"line":29,"column":49}}}},"statementMap":{"1":{"start":{"line":29,"column":0},"end":{"line":57,"column":2}},"2":{"start":{"line":30,"column":2},"end":{"line":56,"column":5}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/module_star.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `module_star` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `user` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'user name',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," PRIMARY KEY (`id`),"," UNIQUE KEY `module_star_user_name` (`user`,`name`),"," KEY `module_star_name` (`name`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module star';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('ModuleStar', {","    user: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'user name'","    },","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    }","  }, {","    tableName: 'module_star',","    comment: 'module star',","    updatedAt: false,","    indexes: [","      {","        unique: true,","        fields: ['user', 'name']","      },","      {","        fields: ['name']","      }","    ],","    classMethods: {","    }","  });","};",""],"l":{"29":1,"30":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_unpublished.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/module_unpublished.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":32,"loc":{"start":{"line":32,"column":17},"end":{"line":32,"column":49}}},"2":{"name":"(anonymous_2)","line":58,"loc":{"start":{"line":58,"column":18},"end":{"line":58,"column":35}}},"3":{"name":"(anonymous_3)","line":65,"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":34}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":31}},"2":{"start":{"line":32,"column":0},"end":{"line":87,"column":2}},"3":{"start":{"line":33,"column":2},"end":{"line":86,"column":5}},"4":{"start":{"line":59,"column":8},"end":{"line":63,"column":11}},"5":{"start":{"line":66,"column":8},"end":{"line":70,"column":11}},"6":{"start":{"line":71,"column":8},"end":{"line":77,"column":9}},"7":{"start":{"line":72,"column":10},"end":{"line":72,"column":28}},"8":{"start":{"line":73,"column":10},"end":{"line":75,"column":11}},"9":{"start":{"line":74,"column":12},"end":{"line":74,"column":46}},"10":{"start":{"line":76,"column":10},"end":{"line":76,"column":21}},"11":{"start":{"line":79,"column":8},"end":{"line":82,"column":11}},"12":{"start":{"line":83,"column":8},"end":{"line":83,"column":32}}},"branchMap":{"1":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":71,"column":8}},{"start":{"line":71,"column":8},"end":{"line":71,"column":8}}]},"2":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":10},"end":{"line":73,"column":10}},{"start":{"line":73,"column":10},"end":{"line":73,"column":10}}]}},"code":["/**!"," * cnpmjs.org - models/module_unpublished.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var utils = require('./utils');","","/*","CREATE TABLE IF NOT EXISTS `module_unpublished` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `gmt_modified` datetime NOT NULL COMMENT 'modified time',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," `package` longtext CHARACTER SET utf8 COLLATE utf8_general_ci COMMENT 'base info: tags, time, maintainers, description, versions',"," PRIMARY KEY (`id`),"," UNIQUE KEY `module_unpublished_name` (`name`),"," KEY `module_unpublished_gmt_modified` (`gmt_modified`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module unpublished info';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('ModuleUnpublished', {","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    },","    package: {","      type: DataTypes.LONGTEXT,","      comment: 'base info: tags, time, maintainers, description, versions',","      get: utils.JSONGetter('package'),","      set: utils.JSONSetter('package'),","    }","  }, {","    tableName: 'module_unpublished',","    comment: 'module unpublished info',","    indexes: [","      {","        unique: true,","        fields: ['name']","      },","      {","        fields: ['gmt_modified']","      }","    ],","    classMethods: {","      findByName: function* (name) {","        return yield this.find({","          where: {","            name: name","          }","        });","      },","      save: function* (name, pkg) {","        var row = yield this.find({","          where: {","            name: name","          }","        });","        if (row) {","          row.package = pkg;","          if (row.changed()) {","            row = yield row.save(['package']);","          }","          return row;","        }","","        row = this.build({","          name: name,","          package: pkg,","        });","        return yield row.save();","      }","    }","  });","};",""],"l":{"17":1,"32":1,"33":0,"59":0,"66":0,"71":0,"72":0,"73":0,"74":0,"76":0,"79":0,"83":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/utils.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/utils.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1,"8":0,"9":0,"10":0,"11":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":17,"loc":{"start":{"line":17,"column":21},"end":{"line":17,"column":45}}},"2":{"name":"JSONGetter","line":18,"loc":{"start":{"line":18,"column":9},"end":{"line":18,"column":31}}},"3":{"name":"(anonymous_3)","line":27,"loc":{"start":{"line":27,"column":21},"end":{"line":27,"column":45}}},"4":{"name":"JSONSetter","line":28,"loc":{"start":{"line":28,"column":9},"end":{"line":28,"column":36}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":25,"column":2}},"2":{"start":{"line":18,"column":2},"end":{"line":24,"column":4}},"3":{"start":{"line":19,"column":4},"end":{"line":19,"column":48}},"4":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"5":{"start":{"line":21,"column":6},"end":{"line":21,"column":32}},"6":{"start":{"line":23,"column":4},"end":{"line":23,"column":17}},"7":{"start":{"line":27,"column":0},"end":{"line":34,"column":2}},"8":{"start":{"line":28,"column":2},"end":{"line":33,"column":4}},"9":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"10":{"start":{"line":30,"column":6},"end":{"line":30,"column":36}},"11":{"start":{"line":32,"column":4},"end":{"line":32,"column":43}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":20,"column":4}},{"start":{"line":20,"column":4},"end":{"line":20,"column":4}}]},"2":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":8},"end":{"line":20,"column":13}},{"start":{"line":20,"column":17},"end":{"line":20,"column":42}}]},"3":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":29,"column":4}},{"start":{"line":29,"column":4},"end":{"line":29,"column":4}}]}},"code":["/**!"," * cnpmjs.org - models/utils.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","exports.JSONGetter = function (propertyName) {","  return function JSONGetter() {","    var value = this.getDataValue(propertyName);","    if (value && typeof value === 'string') {","      value = JSON.parse(value);","    }","    return value;","  };","};","","exports.JSONSetter = function (propertyName) {","  return function JSONSetter(value) {","    if (typeof value !== 'string') {","      value = JSON.stringify(value);","    }","    this.setDataValue(propertyName, value);","  };","};",""],"l":{"17":1,"18":0,"19":0,"20":0,"21":0,"23":0,"27":1,"28":0,"29":0,"30":0,"32":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/npm_module_maintainer.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/npm_module_maintainer.js","s":{"1":1,"2":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":29,"loc":{"start":{"line":29,"column":17},"end":{"line":29,"column":49}}}},"statementMap":{"1":{"start":{"line":29,"column":0},"end":{"line":56,"column":2}},"2":{"start":{"line":30,"column":2},"end":{"line":55,"column":5}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/npm_module_maintainer.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `npm_module_maintainer` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `user` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'user name',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," PRIMARY KEY (`id`),"," UNIQUE KEY `npm_module_maintainer_user_name` (`user`,`name`),"," KEY `name` (`name`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='npm original module maintainers';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('NpmModuleMaintainer', {","    user: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'user name'","    },","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    }","  }, {","    tableName: 'npm_module_maintainer',","    comment: 'npm original module maintainers',","    updatedAt: false,","    indexes: [","      {","        unique: true,","        fields: ['user', 'name']","      },","      {","        fields: ['name']","      }","    ],","    classMethods: require('./_module_maintainer_class_methods'),","  });","};",""],"l":{"29":1,"30":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/tag.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/tag.js","s":{"1":1,"2":0,"3":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":32,"loc":{"start":{"line":32,"column":17},"end":{"line":32,"column":49}}},"2":{"name":"(anonymous_2)","line":67,"loc":{"start":{"line":67,"column":24},"end":{"line":67,"column":46}}}},"statementMap":{"1":{"start":{"line":32,"column":0},"end":{"line":72,"column":2}},"2":{"start":{"line":33,"column":2},"end":{"line":71,"column":5}},"3":{"start":{"line":68,"column":8},"end":{"line":68,"column":68}}},"branchMap":{},"code":["/**!"," * cnpmjs.org - models/tag.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","/*","CREATE TABLE IF NOT EXISTS `tag` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `gmt_modified` datetime NOT NULL COMMENT 'modified time',"," `name` varchar(100) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT 'module name',"," `tag` varchar(30) NOT NULL COMMENT 'tag name',"," `version` varchar(30) NOT NULL COMMENT 'module version',"," `module_id` bigint(20) unsigned NOT NULL COMMENT 'module id',"," PRIMARY KEY (`id`),"," UNIQUE KEY `tag_name_tag` (`name`, `tag`),"," KEY `tag_gmt_modified` (`gmt_modified`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='module tag';"," */","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('Tag', {","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'module name',","    },","    tag: {","      type: DataTypes.STRING(30),","      allowNull: false,","      comment: 'tag name',","    },","    version: {","      type: DataTypes.STRING(30),","      allowNull: false,","      comment: 'module version',","    },","    module_id: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      comment: 'module id'","    }","  }, {","    tableName: 'tag',","    comment: 'module tag',","    indexes: [","      {","        unique: true,","        fields: ['name', 'tag']","      },","      {","        fields: ['gmt_modified']","      }","    ],","    classMethods: {","      findByNameAndTag: function* (name, tag) {","        return yield this.find({ where: { name: name, tag: tag } });","      }","    }","  });","};",""],"l":{"32":1,"33":0,"68":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/total.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"b":{"1":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"(anonymous_1)","line":35,"loc":{"start":{"line":35,"column":17},"end":{"line":35,"column":49}}},"2":{"name":"(anonymous_2)","line":100,"loc":{"start":{"line":100,"column":12},"end":{"line":100,"column":32}}},"3":{"name":"(anonymous_3)","line":104,"loc":{"start":{"line":104,"column":16},"end":{"line":104,"column":31}}},"4":{"name":"(anonymous_4)","line":107,"loc":{"start":{"line":107,"column":20},"end":{"line":107,"column":32}}}},"statementMap":{"1":{"start":{"line":35,"column":0},"end":{"line":118,"column":2}},"2":{"start":{"line":36,"column":2},"end":{"line":117,"column":5}},"3":{"start":{"line":101,"column":8},"end":{"line":101,"column":24}},"4":{"start":{"line":102,"column":8},"end":{"line":114,"column":27}},"5":{"start":{"line":105,"column":10},"end":{"line":112,"column":11}},"6":{"start":{"line":106,"column":12},"end":{"line":110,"column":31}},"7":{"start":{"line":108,"column":16},"end":{"line":108,"column":27}},"8":{"start":{"line":111,"column":12},"end":{"line":111,"column":19}},"9":{"start":{"line":113,"column":10},"end":{"line":113,"column":21}}},"branchMap":{"1":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":10},"end":{"line":105,"column":10}},{"start":{"line":105,"column":10},"end":{"line":105,"column":10}}]}},"code":["/**!"," * cnpmjs.org - models/total.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","// CREATE TABLE IF NOT EXISTS `total` (","//  `name` varchar(100) NOT NULL COMMENT 'total name',","//  `gmt_modified` datetime NOT NULL COMMENT 'modified time',","//  `module_delete` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT 'module delete count',","//  `last_sync_time` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT 'last timestamp sync from official registry',","//  `last_exist_sync_time` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT 'last timestamp sync exist packages from official registry',","//  `sync_status` tinyint unsigned NOT NULL DEFAULT '0' COMMENT 'system sync from official registry status',","//  `need_sync_num` int unsigned NOT NULL DEFAULT '0' COMMENT 'how many packages need to be sync',","//  `success_sync_num` int unsigned NOT NULL DEFAULT '0' COMMENT 'how many packages sync success at this time',","//  `fail_sync_num` int unsigned NOT NULL DEFAULT '0' COMMENT 'how many packages sync fail at this time',","//  `left_sync_num` int unsigned NOT NULL DEFAULT '0' COMMENT 'how many packages left to be sync',","//  `last_sync_module` varchar(100) COMMENT 'last sync success module name',","//  PRIMARY KEY (`name`)","// ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='total info';","// -- init `total` count","// INSERT INTO total(name, gmt_modified) VALUES('total', now())","//   ON DUPLICATE KEY UPDATE gmt_modified=now();","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('Total', {","    name: {","      type: DataTypes.STRING(100),","      primaryKey: true,","      comment: 'total name'","    },","    module_delete: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: 'module delete count',","    },","    last_sync_time: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: 'last timestamp sync from official registry',","    },","    last_exist_sync_time: {","      type: DataTypes.BIGINT(20),","      allowNull: false,","      defaultValue: 0,","      comment: 'last timestamp sync exist packages from official registry',","    },","    sync_status: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","      comment: 'system sync from official registry status',","    },","    need_sync_num: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","      comment: 'how many packages need to be sync',","    },","    success_sync_num: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","      comment: 'how many packages sync success at this time',","    },","    fail_sync_num: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","      comment: 'how many packages sync fail at this time',","    },","    left_sync_num: {","      type: DataTypes.INTEGER,","      allowNull: false,","      defaultValue: 0,","      comment: 'how many packages left to be sync',","    },","    last_sync_module: {","      type: DataTypes.STRING(100),","      allowNull: true,","      comment: 'last sync success module name',","    },","  }, {","    tableName: 'total',","    comment: 'total info',","    createdAt: false,","    classMethods: {","      init: function (callback) {","        var that = this;","        that.find({","          where: { name: 'total' }","        }).then(function (row) {","          if (!row) {","            that.build({name: 'total'}).save()","              .then(function () {","                callback();","              })","              .catch(callback);","            return;","          }","          callback();","        }).catch(callback);","      }","    }","  });","};",""],"l":{"35":1,"36":0,"101":0,"102":0,"105":0,"106":0,"108":0,"111":0,"113":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/user.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/models/user.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"(anonymous_1)","line":40,"loc":{"start":{"line":40,"column":17},"end":{"line":40,"column":49}}},"2":{"name":"(anonymous_2)","line":101,"loc":{"start":{"line":101,"column":25},"end":{"line":101,"column":51}}},"3":{"name":"(anonymous_3)","line":106,"loc":{"start":{"line":106,"column":12},"end":{"line":106,"column":39}}},"4":{"name":"(anonymous_4)","line":116,"loc":{"start":{"line":116,"column":18},"end":{"line":116,"column":35}}},"5":{"name":"(anonymous_5)","line":119,"loc":{"start":{"line":119,"column":19},"end":{"line":119,"column":37}}},"6":{"name":"(anonymous_6)","line":131,"loc":{"start":{"line":131,"column":14},"end":{"line":131,"column":41}}},"7":{"name":"(anonymous_7)","line":143,"loc":{"start":{"line":143,"column":19},"end":{"line":143,"column":36}}},"8":{"name":"(anonymous_8)","line":163,"loc":{"start":{"line":163,"column":22},"end":{"line":163,"column":39}}},"9":{"name":"(anonymous_9)","line":192,"loc":{"start":{"line":192,"column":11},"end":{"line":192,"column":28}}},"10":{"name":"(anonymous_10)","line":215,"loc":{"start":{"line":215,"column":14},"end":{"line":215,"column":31}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":31}},"3":{"start":{"line":40,"column":0},"end":{"line":250,"column":2}},"4":{"start":{"line":41,"column":2},"end":{"line":249,"column":5}},"5":{"start":{"line":102,"column":8},"end":{"line":102,"column":45}},"6":{"start":{"line":107,"column":8},"end":{"line":107,"column":48}},"7":{"start":{"line":108,"column":8},"end":{"line":113,"column":9}},"8":{"start":{"line":109,"column":10},"end":{"line":109,"column":64}},"9":{"start":{"line":110,"column":10},"end":{"line":112,"column":11}},"10":{"start":{"line":111,"column":12},"end":{"line":111,"column":24}},"11":{"start":{"line":114,"column":8},"end":{"line":114,"column":20}},"12":{"start":{"line":117,"column":8},"end":{"line":117,"column":58}},"13":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"14":{"start":{"line":121,"column":10},"end":{"line":121,"column":20}},"15":{"start":{"line":123,"column":8},"end":{"line":129,"column":11}},"16":{"start":{"line":132,"column":8},"end":{"line":139,"column":11}},"17":{"start":{"line":144,"column":8},"end":{"line":144,"column":53}},"18":{"start":{"line":145,"column":8},"end":{"line":153,"column":9}},"19":{"start":{"line":146,"column":10},"end":{"line":152,"column":13}},"20":{"start":{"line":154,"column":8},"end":{"line":154,"column":30}},"21":{"start":{"line":155,"column":8},"end":{"line":155,"column":25}},"22":{"start":{"line":156,"column":8},"end":{"line":156,"column":38}},"23":{"start":{"line":157,"column":8},"end":{"line":157,"column":35}},"24":{"start":{"line":158,"column":8},"end":{"line":160,"column":9}},"25":{"start":{"line":159,"column":10},"end":{"line":159,"column":35}},"26":{"start":{"line":161,"column":8},"end":{"line":161,"column":20}},"27":{"start":{"line":164,"column":8},"end":{"line":164,"column":35}},"28":{"start":{"line":165,"column":8},"end":{"line":165,"column":48}},"29":{"start":{"line":166,"column":8},"end":{"line":171,"column":9}},"30":{"start":{"line":167,"column":10},"end":{"line":170,"column":13}},"31":{"start":{"line":173,"column":8},"end":{"line":173,"column":41}},"32":{"start":{"line":174,"column":8},"end":{"line":174,"column":36}},"33":{"start":{"line":175,"column":8},"end":{"line":175,"column":51}},"34":{"start":{"line":176,"column":8},"end":{"line":176,"column":32}},"35":{"start":{"line":178,"column":8},"end":{"line":178,"column":31}},"36":{"start":{"line":179,"column":8},"end":{"line":179,"column":37}},"37":{"start":{"line":180,"column":8},"end":{"line":180,"column":21}},"38":{"start":{"line":181,"column":8},"end":{"line":181,"column":30}},"39":{"start":{"line":182,"column":8},"end":{"line":182,"column":23}},"40":{"start":{"line":183,"column":8},"end":{"line":183,"column":25}},"41":{"start":{"line":184,"column":8},"end":{"line":184,"column":40}},"42":{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},"43":{"start":{"line":186,"column":10},"end":{"line":186,"column":35}},"44":{"start":{"line":188,"column":8},"end":{"line":188,"column":20}},"45":{"start":{"line":193,"column":8},"end":{"line":193,"column":37}},"46":{"start":{"line":194,"column":8},"end":{"line":198,"column":9}},"47":{"start":{"line":195,"column":10},"end":{"line":195,"column":40}},"48":{"start":{"line":197,"column":10},"end":{"line":197,"column":23}},"49":{"start":{"line":199,"column":8},"end":{"line":199,"column":59}},"50":{"start":{"line":201,"column":8},"end":{"line":210,"column":11}},"51":{"start":{"line":212,"column":8},"end":{"line":212,"column":32}},"52":{"start":{"line":216,"column":8},"end":{"line":216,"column":40}},"53":{"start":{"line":217,"column":8},"end":{"line":217,"column":46}},"54":{"start":{"line":218,"column":8},"end":{"line":223,"column":9}},"55":{"start":{"line":219,"column":10},"end":{"line":219,"column":53}},"56":{"start":{"line":220,"column":10},"end":{"line":220,"column":38}},"57":{"start":{"line":221,"column":10},"end":{"line":221,"column":34}},"58":{"start":{"line":222,"column":10},"end":{"line":222,"column":20}},"59":{"start":{"line":224,"column":8},"end":{"line":224,"column":16}},"60":{"start":{"line":225,"column":8},"end":{"line":225,"column":69}},"61":{"start":{"line":226,"column":8},"end":{"line":226,"column":37}},"62":{"start":{"line":227,"column":8},"end":{"line":231,"column":9}},"63":{"start":{"line":228,"column":10},"end":{"line":228,"column":40}},"64":{"start":{"line":230,"column":10},"end":{"line":230,"column":23}},"65":{"start":{"line":233,"column":8},"end":{"line":233,"column":52}},"66":{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},"67":{"start":{"line":235,"column":10},"end":{"line":235,"column":22}},"68":{"start":{"line":238,"column":8},"end":{"line":238,"column":25}},"69":{"start":{"line":239,"column":8},"end":{"line":239,"column":31}},"70":{"start":{"line":240,"column":8},"end":{"line":240,"column":29}},"71":{"start":{"line":241,"column":8},"end":{"line":241,"column":45}},"72":{"start":{"line":242,"column":8},"end":{"line":242,"column":25}},"73":{"start":{"line":243,"column":8},"end":{"line":243,"column":26}},"74":{"start":{"line":244,"column":8},"end":{"line":244,"column":30}},"75":{"start":{"line":246,"column":8},"end":{"line":246,"column":100}}},"branchMap":{"1":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":8},"end":{"line":108,"column":8}},{"start":{"line":108,"column":8},"end":{"line":108,"column":8}}]},"2":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":10},"end":{"line":110,"column":10}},{"start":{"line":110,"column":10},"end":{"line":110,"column":10}}]},"3":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":120,"column":8}},{"start":{"line":120,"column":8},"end":{"line":120,"column":8}}]},"4":{"line":120,"type":"binary-expr","locations":[{"start":{"line":120,"column":12},"end":{"line":120,"column":18}},{"start":{"line":120,"column":22},"end":{"line":120,"column":40}}]},"5":{"line":145,"type":"if","locations":[{"start":{"line":145,"column":8},"end":{"line":145,"column":8}},{"start":{"line":145,"column":8},"end":{"line":145,"column":8}}]},"6":{"line":156,"type":"binary-expr","locations":[{"start":{"line":156,"column":21},"end":{"line":156,"column":31}},{"start":{"line":156,"column":35},"end":{"line":156,"column":37}}]},"7":{"line":157,"type":"binary-expr","locations":[{"start":{"line":157,"column":19},"end":{"line":157,"column":28}},{"start":{"line":157,"column":32},"end":{"line":157,"column":34}}]},"8":{"line":158,"type":"if","locations":[{"start":{"line":158,"column":8},"end":{"line":158,"column":8}},{"start":{"line":158,"column":8},"end":{"line":158,"column":8}}]},"9":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":166,"column":8}},{"start":{"line":166,"column":8},"end":{"line":166,"column":8}}]},"10":{"line":174,"type":"binary-expr","locations":[{"start":{"line":174,"column":19},"end":{"line":174,"column":28}},{"start":{"line":174,"column":32},"end":{"line":174,"column":35}}]},"11":{"line":175,"type":"binary-expr","locations":[{"start":{"line":175,"column":26},"end":{"line":175,"column":43}},{"start":{"line":175,"column":47},"end":{"line":175,"column":50}}]},"12":{"line":176,"type":"binary-expr","locations":[{"start":{"line":176,"column":17},"end":{"line":176,"column":24}},{"start":{"line":176,"column":28},"end":{"line":176,"column":31}}]},"13":{"line":185,"type":"if","locations":[{"start":{"line":185,"column":8},"end":{"line":185,"column":8}},{"start":{"line":185,"column":8},"end":{"line":185,"column":8}}]},"14":{"line":193,"type":"binary-expr","locations":[{"start":{"line":193,"column":20},"end":{"line":193,"column":30}},{"start":{"line":193,"column":34},"end":{"line":193,"column":36}}]},"15":{"line":216,"type":"binary-expr","locations":[{"start":{"line":216,"column":18},"end":{"line":216,"column":26}},{"start":{"line":216,"column":30},"end":{"line":216,"column":39}}]},"16":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":8},"end":{"line":218,"column":8}},{"start":{"line":218,"column":8},"end":{"line":218,"column":8}}]},"17":{"line":226,"type":"binary-expr","locations":[{"start":{"line":226,"column":20},"end":{"line":226,"column":30}},{"start":{"line":226,"column":34},"end":{"line":226,"column":36}}]},"18":{"line":234,"type":"if","locations":[{"start":{"line":234,"column":8},"end":{"line":234,"column":8}},{"start":{"line":234,"column":8},"end":{"line":234,"column":8}}]}},"code":["/**!"," * cnpmjs.org - models/user.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var utility = require('utility');","var utils = require('./utils');","","/*","CREATE TABLE IF NOT EXISTS `user` ("," `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'primary key',"," `gmt_create` datetime NOT NULL COMMENT 'create time',"," `gmt_modified` datetime NOT NULL COMMENT 'modified time',"," `name` varchar(100) NOT NULL COMMENT 'user name',"," `salt` varchar(100) NOT NULL,"," `password_sha` varchar(100) NOT NULL COMMENT 'user password hash',"," `ip` varchar(64) NOT NULL COMMENT 'user last request ip',"," `roles` varchar(200) NOT NULL DEFAULT '[]',"," `rev` varchar(40) NOT NULL,"," `email` varchar(400) NOT NULL,"," `json` longtext CHARACTER SET utf8 COLLATE utf8_general_ci COMMENT 'json details',"," `npm_user` tinyint(1) DEFAULT '0' COMMENT 'user sync from npm or not, 1: true, other: false',"," PRIMARY KEY (`id`),"," UNIQUE KEY `user_name` (`name`),"," KEY `user_gmt_modified` (`gmt_modified`)",") ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='user base info';","*/","","module.exports = function (sequelize, DataTypes) {","  return sequelize.define('User', {","    name: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'user name',","    },","    salt: {","      type: DataTypes.STRING(100),","      allowNull: false,","    },","    password_sha: {","      type: DataTypes.STRING(100),","      allowNull: false,","      comment: 'user password hash',","    },","    ip: {","      type: DataTypes.STRING(64),","      allowNull: false,","      comment: 'user last request ip',","    },","    roles: {","      type: DataTypes.STRING(200),","      allowNull: false,","      defaultValue: '[]',","    },","    rev: {","      type: DataTypes.STRING(40),","      allowNull: false,","    },","    email: {","      type: DataTypes.STRING(400),","      allowNull: false,","    },","    json: {","      type: DataTypes.LONGTEXT,","      allowNull: true,","      get: utils.JSONGetter('json'),","      set: utils.JSONSetter('json'),","    },","    isNpmUser: {","      field: 'npm_user',","      type: DataTypes.BOOLEAN,","      allowNull: false,","      defaultValue: false,","      comment: 'user sync from npm or not, 1: true, other: false',","    }","  }, {","    tableName: 'user',","    comment: 'user base info',","    indexes: [","      {","        unique: true,","        fields: ['name']","      },","      {","        fields: ['gmt_modified']","      }","    ],","    classMethods: {","      // utils","      createPasswordSha: function (password, salt) {","        return utility.sha1(password + salt);","      },","","      // read","      auth: function* (name, password) {","        var user = yield* this.findByName(name);","        if (user) {","          var sha = this.createPasswordSha(password, user.salt);","          if (user.password_sha !== sha) {","            user = null;","          }","        }","        return user;","      },","      findByName: function* (name) {","        return yield this.find({ where: { name: name } });","      },","      listByNames: function* (names) {","        if (!names || names.length === 0) {","          return [];","        }","        return yield this.findAll({","          where: {","            name: {","              in: names","            }","          }","        });","      },","      search: function* (query, options) {","        return yield this.findAll({","          where: {","            name: {","              like: query + '%'","            }","          },","          limit: options.limit","        });","      },","","      // write","      saveNpmUser: function* (data) {","        var user = yield* this.findByName(data.name);","        if (!user) {","          user = this.build({","            isNpmUser: true,","            name: data.name,","            salt: '0',","            password_sha: '0',","            ip: '0',","          });","        }","        user.isNpmUser = true;","        user.json = data;","        user.email = data.email || '';","        user.rev = data._rev || '';","        if (user.changed()) {","          user = yield user.save();","        }","        return user;","      },","      saveCustomUser: function* (data) {","        var name = data.user.login;","        var user = yield* this.findByName(name);","        if (!user) {","          user = this.build({","            isNpmUser: false,","            name: name,","          });","        }","","        var rev = '1-' + data.user.login;","        var salt = data.salt || '0';","        var passwordSha = data.password_sha || '0';","        var ip = data.ip || '0';","","        user.isNpmUser = false;","        user.email = data.user.email;","        user.ip = ip;","        user.json = data.user;","        user.rev = rev;","        user.salt = salt;","        user.password_sha = passwordSha;","        if (user.changed()) {","          user = yield user.save();","        }","        return user;","      },","","      // add cnpm user","      add: function* (user) {","        var roles = user.roles || [];","        try {","          roles = JSON.stringify(roles);","        } catch (e) {","          roles = '[]';","        }","        var rev = '1-' + utility.md5(JSON.stringify(user));","","        var row = this.build({","          rev: rev,","          name: user.name,","          email: user.email,","          salt: user.salt,","          password_sha: user.password_sha,","          ip: user.ip,","          roles: roles,","          isNpmUser: false,","        });","","        return yield row.save();","      },","","      update: function* (user) {","        var rev = user.rev || user._rev;","        var revNo = Number(rev.split('-', 1));","        if (!revNo) {","          var err = new Error(rev + ' format error');","          err.name = 'RevFormatError';","          err.data = {user: user};","          throw err;","        }","        revNo++;","        var newRev = revNo + '-' + utility.md5(JSON.stringify(user));","        var roles = user.roles || [];","        try {","          roles = JSON.stringify(roles);","        } catch (e) {","          roles = '[]';","        }","","        var row = yield* this.findByName(user.name);","        if (!row) {","          return null;","        }","","        row.rev = newRev;","        row.email = user.email;","        row.salt = user.salt;","        row.password_sha = user.password_sha;","        row.ip = user.ip;","        row.roles = roles;","        row.isNpmUser = false;","","        return yield row.save(['rev', 'email', 'salt', 'password_sha', 'ip', 'roles', 'isNpmUser']);","      }","    }","  });","};",""],"l":{"17":1,"18":1,"40":1,"41":0,"102":0,"107":0,"108":0,"109":0,"110":0,"111":0,"114":0,"117":0,"120":0,"121":0,"123":0,"132":0,"144":0,"145":0,"146":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"161":0,"164":0,"165":0,"166":0,"167":0,"173":0,"174":0,"175":0,"176":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"188":0,"193":0,"194":0,"195":0,"197":0,"199":0,"201":0,"212":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"224":0,"225":0,"226":0,"227":0,"228":0,"230":0,"233":0,"234":0,"235":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"246":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/routes/web.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/routes/web.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"routes","line":13,"loc":{"start":{"line":13,"column":0},"end":{"line":13,"column":21}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":61}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":65}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":69}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":71}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":55}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":55}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":42}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":48}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":48}},"10":{"start":{"line":13,"column":0},"end":{"line":43,"column":1}},"11":{"start":{"line":14,"column":2},"end":{"line":14,"column":31}},"12":{"start":{"line":17,"column":2},"end":{"line":17,"column":62}},"13":{"start":{"line":19,"column":2},"end":{"line":19,"column":75}},"14":{"start":{"line":20,"column":2},"end":{"line":20,"column":41}},"15":{"start":{"line":21,"column":2},"end":{"line":21,"column":50}},"16":{"start":{"line":23,"column":2},"end":{"line":23,"column":37}},"17":{"start":{"line":25,"column":2},"end":{"line":25,"column":72}},"18":{"start":{"line":26,"column":2},"end":{"line":26,"column":50}},"19":{"start":{"line":28,"column":2},"end":{"line":28,"column":31}},"20":{"start":{"line":30,"column":2},"end":{"line":30,"column":56}},"21":{"start":{"line":31,"column":2},"end":{"line":31,"column":35}},"22":{"start":{"line":32,"column":2},"end":{"line":32,"column":29}},"23":{"start":{"line":33,"column":2},"end":{"line":33,"column":57}},"24":{"start":{"line":34,"column":2},"end":{"line":34,"column":36}},"25":{"start":{"line":36,"column":2},"end":{"line":36,"column":75}},"26":{"start":{"line":37,"column":2},"end":{"line":37,"column":50}},"27":{"start":{"line":39,"column":2},"end":{"line":39,"column":47}},"28":{"start":{"line":41,"column":2},"end":{"line":41,"column":62}},"29":{"start":{"line":42,"column":2},"end":{"line":42,"column":64}},"30":{"start":{"line":45,"column":0},"end":{"line":45,"column":24}}},"branchMap":{},"code":["'use strict';","","var showPackage = require('../controllers/web/package/show');","var searchPackage = require('../controllers/web/package/search');","var searchRange = require('../controllers/web/package/search_range');","var listPrivates = require('../controllers/web/package/list_privates');","var showSync = require('../controllers/web/show_sync');","var showUser = require('../controllers/web/user/show');","var sync = require('../controllers/sync');","var showTotal = require('../controllers/total');","var badge = require('../controllers/web/badge');","","function routes(app) {","  app.get('/total', showTotal);","","  // scope package without version","  app.get(/\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, showPackage);","  // scope package with version","  app.get(/\\/package\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/([\\w\\d\\.]+)$/, showPackage);","  app.get('/package/:name', showPackage);","  app.get('/package/:name/:version', showPackage);","","  app.get('/privates', listPrivates);","","  app.get(/\\/browse\\/keyword\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, searchPackage);","  app.get('/browse/keyword/:word', searchPackage);","","  app.get('/~:name', showUser);","","  app.get(/\\/sync\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, showSync);","  app.get('/sync/:name', showSync);","  app.get('/sync', showSync);","  app.put(/\\/sync\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)$/, sync.sync);","  app.put('/sync/:name', sync.sync);","","  app.get(/\\/sync\\/(@[\\w\\-\\.]+\\/[\\w\\-\\.]+)\\/log\\/(\\d+)$/, sync.getSyncLog);","  app.get('/sync/:name/log/:id', sync.getSyncLog);","","  app.get('/_list/search/search', searchRange);","","  app.get(/^\\/badge\\/v\\/([@\\w\\-\\.\\/]+)\\.svg$/, badge.version);","  app.get(/^\\/badge\\/d\\/([@\\w\\-\\.\\/]+)\\.svg$/, badge.downloads);","}","","module.exports = routes;",""],"l":{"3":2,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"13":1,"14":0,"17":0,"19":0,"20":0,"21":0,"23":0,"25":0,"26":0,"28":0,"30":0,"31":0,"32":0,"33":0,"34":0,"36":0,"37":0,"39":0,"41":0,"42":0,"45":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/package/show.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/package/show.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0,0,0],"37":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"show","line":16,"loc":{"start":{"line":16,"column":17},"end":{"line":16,"column":38}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":72}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":31}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":31}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":35}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":42}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":40}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":35}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":67}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":64}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":58}},"13":{"start":{"line":16,"column":0},"end":{"line":189,"column":2}},"14":{"start":{"line":17,"column":2},"end":{"line":17,"column":27}},"15":{"start":{"line":20,"column":2},"end":{"line":20,"column":45}},"16":{"start":{"line":21,"column":2},"end":{"line":21,"column":25}},"17":{"start":{"line":22,"column":2},"end":{"line":22,"column":40}},"18":{"start":{"line":23,"column":2},"end":{"line":23,"column":44}},"19":{"start":{"line":25,"column":2},"end":{"line":25,"column":23}},"20":{"start":{"line":26,"column":2},"end":{"line":26,"column":21}},"21":{"start":{"line":27,"column":2},"end":{"line":27,"column":40}},"22":{"start":{"line":28,"column":2},"end":{"line":34,"column":3}},"23":{"start":{"line":29,"column":4},"end":{"line":29,"column":35}},"24":{"start":{"line":30,"column":4},"end":{"line":30,"column":37}},"25":{"start":{"line":32,"column":4},"end":{"line":32,"column":40}},"26":{"start":{"line":33,"column":4},"end":{"line":33,"column":45}},"27":{"start":{"line":36,"column":2},"end":{"line":36,"column":89}},"28":{"start":{"line":37,"column":2},"end":{"line":63,"column":3}},"29":{"start":{"line":39,"column":4},"end":{"line":39,"column":75}},"30":{"start":{"line":40,"column":4},"end":{"line":40,"column":50}},"31":{"start":{"line":41,"column":4},"end":{"line":60,"column":5}},"32":{"start":{"line":42,"column":6},"end":{"line":45,"column":8}},"33":{"start":{"line":46,"column":6},"end":{"line":46,"column":62}},"34":{"start":{"line":47,"column":6},"end":{"line":54,"column":7}},"35":{"start":{"line":48,"column":8},"end":{"line":53,"column":9}},"36":{"start":{"line":49,"column":10},"end":{"line":49,"column":59}},"37":{"start":{"line":50,"column":10},"end":{"line":52,"column":11}},"38":{"start":{"line":51,"column":12},"end":{"line":51,"column":94}},"39":{"start":{"line":55,"column":6},"end":{"line":58,"column":9}},"40":{"start":{"line":59,"column":6},"end":{"line":59,"column":13}},"41":{"start":{"line":62,"column":4},"end":{"line":62,"column":23}},"42":{"start":{"line":65,"column":2},"end":{"line":70,"column":4}},"43":{"start":{"line":71,"column":2},"end":{"line":71,"column":22}},"44":{"start":{"line":72,"column":2},"end":{"line":72,"column":24}},"45":{"start":{"line":73,"column":2},"end":{"line":73,"column":19}},"46":{"start":{"line":74,"column":2},"end":{"line":74,"column":25}},"47":{"start":{"line":76,"column":2},"end":{"line":76,"column":59}},"48":{"start":{"line":77,"column":2},"end":{"line":77,"column":20}},"49":{"start":{"line":78,"column":2},"end":{"line":78,"column":20}},"50":{"start":{"line":79,"column":2},"end":{"line":83,"column":3}},"51":{"start":{"line":80,"column":4},"end":{"line":80,"column":71}},"52":{"start":{"line":82,"column":4},"end":{"line":82,"column":50}},"53":{"start":{"line":85,"column":2},"end":{"line":87,"column":3}},"54":{"start":{"line":86,"column":4},"end":{"line":86,"column":39}},"55":{"start":{"line":89,"column":2},"end":{"line":91,"column":3}},"56":{"start":{"line":90,"column":4},"end":{"line":90,"column":34}},"57":{"start":{"line":93,"column":2},"end":{"line":100,"column":3}},"58":{"start":{"line":94,"column":4},"end":{"line":99,"column":5}},"59":{"start":{"line":95,"column":6},"end":{"line":95,"column":42}},"60":{"start":{"line":96,"column":6},"end":{"line":98,"column":7}},"61":{"start":{"line":97,"column":8},"end":{"line":97,"column":90}},"62":{"start":{"line":102,"column":2},"end":{"line":107,"column":3}},"63":{"start":{"line":103,"column":4},"end":{"line":103,"column":41}},"64":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"65":{"start":{"line":105,"column":6},"end":{"line":105,"column":110}},"66":{"start":{"line":109,"column":2},"end":{"line":111,"column":3}},"67":{"start":{"line":110,"column":4},"end":{"line":110,"column":26}},"68":{"start":{"line":112,"column":2},"end":{"line":114,"column":3}},"69":{"start":{"line":113,"column":4},"end":{"line":113,"column":148}},"70":{"start":{"line":115,"column":2},"end":{"line":117,"column":3}},"71":{"start":{"line":116,"column":4},"end":{"line":116,"column":18}},"72":{"start":{"line":119,"column":2},"end":{"line":119,"column":24}},"73":{"start":{"line":121,"column":2},"end":{"line":123,"column":3}},"74":{"start":{"line":122,"column":4},"end":{"line":122,"column":40}},"75":{"start":{"line":124,"column":2},"end":{"line":124,"column":49}},"76":{"start":{"line":126,"column":2},"end":{"line":126,"column":30}},"77":{"start":{"line":128,"column":2},"end":{"line":130,"column":3}},"78":{"start":{"line":129,"column":4},"end":{"line":129,"column":46}},"79":{"start":{"line":132,"column":2},"end":{"line":134,"column":3}},"80":{"start":{"line":133,"column":4},"end":{"line":133,"column":27}},"81":{"start":{"line":136,"column":2},"end":{"line":136,"column":64}},"82":{"start":{"line":145,"column":2},"end":{"line":171,"column":3}},"83":{"start":{"line":146,"column":4},"end":{"line":170,"column":5}},"84":{"start":{"line":147,"column":6},"end":{"line":147,"column":55}},"85":{"start":{"line":148,"column":6},"end":{"line":148,"column":25}},"86":{"start":{"line":149,"column":6},"end":{"line":163,"column":7}},"87":{"start":{"line":150,"column":8},"end":{"line":150,"column":30}},"88":{"start":{"line":151,"column":8},"end":{"line":151,"column":53}},"89":{"start":{"line":152,"column":8},"end":{"line":162,"column":9}},"90":{"start":{"line":153,"column":10},"end":{"line":153,"column":31}},"91":{"start":{"line":154,"column":10},"end":{"line":161,"column":11}},"92":{"start":{"line":155,"column":12},"end":{"line":155,"column":26}},"93":{"start":{"line":156,"column":17},"end":{"line":161,"column":11}},"94":{"start":{"line":160,"column":12},"end":{"line":160,"column":34}},"95":{"start":{"line":164,"column":6},"end":{"line":169,"column":8}},"96":{"start":{"line":173,"column":2},"end":{"line":182,"column":3}},"97":{"start":{"line":174,"column":4},"end":{"line":174,"column":25}},"98":{"start":{"line":176,"column":4},"end":{"line":176,"column":26}},"99":{"start":{"line":178,"column":4},"end":{"line":181,"column":6}},"100":{"start":{"line":184,"column":2},"end":{"line":188,"column":5}}},"branchMap":{"1":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":20},"end":{"line":20,"column":31}},{"start":{"line":20,"column":35},"end":{"line":20,"column":44}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":12},"end":{"line":22,"column":26}},{"start":{"line":22,"column":30},"end":{"line":22,"column":39}}]},"3":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":29},"end":{"line":27,"column":32}},{"start":{"line":27,"column":36},"end":{"line":27,"column":38}}]},"4":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":28,"column":2}},{"start":{"line":28,"column":2},"end":{"line":28,"column":2}}]},"5":{"line":33,"type":"binary-expr","locations":[{"start":{"line":33,"column":28},"end":{"line":33,"column":31}},{"start":{"line":33,"column":35},"end":{"line":33,"column":43}}]},"6":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":37,"column":2}},{"start":{"line":37,"column":2},"end":{"line":37,"column":2}}]},"7":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":6},"end":{"line":37,"column":10}},{"start":{"line":37,"column":14},"end":{"line":37,"column":26}}]},"8":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]},"9":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":6},"end":{"line":47,"column":6}},{"start":{"line":47,"column":6},"end":{"line":47,"column":6}}]},"10":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":10},"end":{"line":50,"column":10}},{"start":{"line":50,"column":10},"end":{"line":50,"column":10}}]},"11":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":2},"end":{"line":79,"column":2}},{"start":{"line":79,"column":2},"end":{"line":79,"column":2}}]},"12":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":6},"end":{"line":79,"column":16}},{"start":{"line":79,"column":20},"end":{"line":79,"column":50}}]},"13":{"line":82,"type":"binary-expr","locations":[{"start":{"line":82,"column":32},"end":{"line":82,"column":42}},{"start":{"line":82,"column":46},"end":{"line":82,"column":48}}]},"14":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":2},"end":{"line":85,"column":2}},{"start":{"line":85,"column":2},"end":{"line":85,"column":2}}]},"15":{"line":86,"type":"binary-expr","locations":[{"start":{"line":86,"column":17},"end":{"line":86,"column":32}},{"start":{"line":86,"column":36},"end":{"line":86,"column":38}}]},"16":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]},"17":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":2},"end":{"line":93,"column":2}},{"start":{"line":93,"column":2},"end":{"line":93,"column":2}}]},"18":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":6},"end":{"line":96,"column":6}},{"start":{"line":96,"column":6},"end":{"line":96,"column":6}}]},"19":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":2},"end":{"line":102,"column":2}},{"start":{"line":102,"column":2},"end":{"line":102,"column":2}}]},"20":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":104,"column":4}},{"start":{"line":104,"column":4},"end":{"line":104,"column":4}}]},"21":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":2},"end":{"line":109,"column":2}},{"start":{"line":109,"column":2},"end":{"line":109,"column":2}}]},"22":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":2},"end":{"line":112,"column":2}},{"start":{"line":112,"column":2},"end":{"line":112,"column":2}}]},"23":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":6},"end":{"line":112,"column":20}},{"start":{"line":112,"column":24},"end":{"line":112,"column":42}}]},"24":{"line":113,"type":"cond-expr","locations":[{"start":{"line":113,"column":70},"end":{"line":113,"column":88}},{"start":{"line":113,"column":92},"end":{"line":113,"column":146}}]},"25":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":92},"end":{"line":113,"column":124}},{"start":{"line":113,"column":128},"end":{"line":113,"column":146}}]},"26":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":2},"end":{"line":115,"column":2}},{"start":{"line":115,"column":2},"end":{"line":115,"column":2}}]},"27":{"line":128,"type":"if","locations":[{"start":{"line":128,"column":2},"end":{"line":128,"column":2}},{"start":{"line":128,"column":2},"end":{"line":128,"column":2}}]},"28":{"line":129,"type":"binary-expr","locations":[{"start":{"line":129,"column":26},"end":{"line":129,"column":39}},{"start":{"line":129,"column":43},"end":{"line":129,"column":44}}]},"29":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":2},"end":{"line":132,"column":2}},{"start":{"line":132,"column":2},"end":{"line":132,"column":2}}]},"30":{"line":145,"type":"if","locations":[{"start":{"line":145,"column":2},"end":{"line":145,"column":2}},{"start":{"line":145,"column":2},"end":{"line":145,"column":2}}]},"31":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":26},"end":{"line":147,"column":40}},{"start":{"line":147,"column":44},"end":{"line":147,"column":46}}]},"32":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":6},"end":{"line":149,"column":6}},{"start":{"line":149,"column":6},"end":{"line":149,"column":6}}]},"33":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":8},"end":{"line":152,"column":8}},{"start":{"line":152,"column":8},"end":{"line":152,"column":8}}]},"34":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":10},"end":{"line":154,"column":10}},{"start":{"line":154,"column":10},"end":{"line":154,"column":10}}]},"35":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":17},"end":{"line":156,"column":17}},{"start":{"line":156,"column":17},"end":{"line":156,"column":17}}]},"36":{"line":156,"type":"binary-expr","locations":[{"start":{"line":156,"column":21},"end":{"line":156,"column":45}},{"start":{"line":157,"column":14},"end":{"line":157,"column":38}},{"start":{"line":158,"column":14},"end":{"line":158,"column":38}},{"start":{"line":159,"column":14},"end":{"line":159,"column":38}}]},"37":{"line":173,"type":"if","locations":[{"start":{"line":173,"column":2},"end":{"line":173,"column":2}},{"start":{"line":173,"column":2},"end":{"line":173,"column":2}}]}},"code":["'use strict';","","var debug = require('debug')('cnpmjs.org:controllers:web:package:show');","var bytes = require('bytes');","var giturl = require('giturl');","var moment = require('moment');","var semver = require('semver');","var gravatar = require('gravatar');","var humanize = require('humanize-number');","var config = require('../../../config');","var utils = require('../../utils');","var setDownloadURL = require('../../../lib/common').setDownloadURL;","var renderMarkdown = require('../../../common/markdown').render;","var packageService = require('../../../services/package');","","module.exports = function* show(next) {","  var params = this.params;","  // normal: {name: $name, version: $version}","  // scope: [$name, $version]","  var orginalName = params.name || params[0];","  var name = orginalName;","  var tag = params.version || params[1];","  debug('display %s with %j', name, params);","","  var getPackageMethod;","  var getPackageArgs;","  var version = semver.valid(tag || '');","  if (version) {","    getPackageMethod = 'getModule';","    getPackageArgs = [name, version];","  } else {","    getPackageMethod = 'getModuleByTag';","    getPackageArgs = [name, tag || 'latest'];","  }","","  var pkg = yield packageService[getPackageMethod].apply(packageService, getPackageArgs);","  if (!pkg || !pkg.package) {","    // check if unpublished","    var unpublishedInfo = yield* packageService.getUnpublishedModule(name);","    debug('show unpublished %j', unpublishedInfo);","    if (unpublishedInfo) {","      var data = {","        name: name,","        unpublished: unpublishedInfo.package","      };","      data.unpublished.time = new Date(data.unpublished.time);","      if (data.unpublished.maintainers) {","        for (var i = 0; i < data.unpublished.maintainers.length; i++) {","          var maintainer = data.unpublished.maintainers[i];","          if (maintainer.email) {","            maintainer.gravatar = gravatar.url(maintainer.email, {s: '50', d: 'retro'}, true);","          }","        }","      }","      yield this.render('package_unpublished', {","        package: data,","        title: 'Package - ' + name","      });","      return;","    }","","    return yield* next;","  }","","  var r = yield [","    utils.getDownloadTotal(name),","    packageService.listDependents(name),","    packageService.listStarUserNames(name),","    packageService.listMaintainers(name)","  ];","  var download = r[0];","  var dependents = r[1];","  var users = r[2];","  var maintainers = r[3];","","  pkg.package.fromNow = moment(pkg.publish_time).fromNow();","  pkg = pkg.package;","  pkg.users = users;","  if (pkg.readme && typeof pkg.readme !== 'string') {","    pkg.readme = 'readme is not string: ' + JSON.stringify(pkg.readme);","  } else {","    pkg.readme = renderMarkdown(pkg.readme || '');","  }","","  if (!pkg.readme) {","    pkg.readme = pkg.description || '';","  }","","  if (maintainers.length > 0) {","    pkg.maintainers = maintainers;","  }","","  if (pkg.maintainers) {","    for (var i = 0; i < pkg.maintainers.length; i++) {","      var maintainer = pkg.maintainers[i];","      if (maintainer.email) {","        maintainer.gravatar = gravatar.url(maintainer.email, {s: '50', d: 'retro'}, true);","      }","    }","  }","","  if (pkg._npmUser) {","    pkg.lastPublishedUser = pkg._npmUser;","    if (pkg.lastPublishedUser.email) {","      pkg.lastPublishedUser.gravatar = gravatar.url(pkg.lastPublishedUser.email, {s: '50', d: 'retro'}, true);","    }","  }","","  if (pkg.repository === 'undefined') {","    pkg.repository = null;","  }","  if (pkg.repository && pkg.repository.url) {","    pkg.repository.weburl = /^https?:\\/\\//.test(pkg.repository.url) ? pkg.repository.url : (giturl.parse(pkg.repository.url) || pkg.repository.url);","  }","  if (!pkg.bugs) {","    pkg.bugs = {};","  }","","  utils.setLicense(pkg);","","  for (var k in download) {","    download[k] = humanize(download[k]);","  }","  setDownloadURL(pkg, this, config.registryHost);","","  pkg.dependents = dependents;","","  if (pkg.dist) {","    pkg.dist.size = bytes(pkg.dist.size || 0);","  }","","  if (pkg.name !== orginalName) {","    pkg.name = orginalName;","  }","","  pkg.registryUrl = '//' + config.registryHost + '/' + pkg.name;","","  // pkg.engines = {","  //   \"python\": \">= 0.11.9\",","  //   \"node\": \">= 0.11.9\",","  //   \"node1\": \">= 0.8.9\",","  //   \"node2\": \">= 0.10.9\",","  //   \"node3\": \">= 0.6.9\",","  // };","  if (pkg.engines) {","    for (var k in pkg.engines) {","      var engine = String(pkg.engines[k] || '').trim();","      var color = 'blue';","      if (k.indexOf('node') === 0) {","        color = 'yellowgreen';","        var version = /(\\d+\\.\\d+\\.\\d+)/.exec(engine);","        if (version) {","          version = version[0];","          if (/^0\\.11\\.\\d+/.test(version)) {","            color = 'red';","          } else if (/^0\\.10\\./.test(version) ||","              /^0\\.12\\./.test(version) ||","              /^0\\.14\\./.test(version) ||","              /^[^0]+\\./.test(version)) {","            color = 'brightgreen';","          }","        }","      }","      pkg.engines[k] = {","        version: engine,","        title: k + ': ' + engine,","        badgeURL: config.badgePrefixURL + '/' + encodeURIComponent(k) +","          '-' + encodeURIComponent(engine) + '-' + color + '.svg?style=flat-square',","      };","    }","  }","","  if (pkg._publish_on_cnpm) {","    pkg.isPrivate = true;","  } else {","    pkg.isPrivate = false;","    // add security check badge","    pkg.snyk = {","      badge: `${config.snykUrl}/test/npm/${pkg.name}/badge.svg?style=flat-square`,","      url: `${config.snykUrl}/test/npm/${pkg.name}`,","    };","  }","","  yield this.render('package', {","    title: 'Package - ' + pkg.name,","    package: pkg,","    download: download","  });","};",""],"l":{"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":2,"11":2,"12":0,"13":0,"14":0,"16":0,"17":0,"20":0,"21":0,"22":0,"23":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"32":0,"33":0,"36":0,"37":0,"39":0,"40":0,"41":0,"42":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"55":0,"59":0,"62":0,"65":0,"71":0,"72":0,"73":0,"74":0,"76":0,"77":0,"78":0,"79":0,"80":0,"82":0,"85":0,"86":0,"89":0,"90":0,"93":0,"94":0,"95":0,"96":0,"97":0,"102":0,"103":0,"104":0,"105":0,"109":0,"110":0,"112":0,"113":0,"115":0,"116":0,"119":0,"121":0,"122":0,"124":0,"126":0,"128":0,"129":0,"132":0,"133":0,"136":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"160":0,"164":0,"173":0,"174":0,"176":0,"178":0,"184":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/servers/web.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/servers/web.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":86,"loc":{"start":{"line":86,"column":10},"end":{"line":86,"column":29}}},"2":{"name":"(anonymous_2)","line":114,"loc":{"start":{"line":114,"column":16},"end":{"line":114,"column":36}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":53}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":54}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":50}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":49}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":58}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":41}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":55}},"11":{"start":{"line":13,"column":0},"end":{"line":13,"column":38}},"12":{"start":{"line":14,"column":0},"end":{"line":14,"column":34}},"13":{"start":{"line":15,"column":0},"end":{"line":15,"column":38}},"14":{"start":{"line":16,"column":0},"end":{"line":16,"column":27}},"15":{"start":{"line":17,"column":0},"end":{"line":17,"column":27}},"16":{"start":{"line":18,"column":0},"end":{"line":18,"column":25}},"17":{"start":{"line":19,"column":0},"end":{"line":19,"column":23}},"18":{"start":{"line":20,"column":0},"end":{"line":20,"column":45}},"19":{"start":{"line":22,"column":0},"end":{"line":22,"column":16}},"20":{"start":{"line":24,"column":0},"end":{"line":24,"column":11}},"21":{"start":{"line":26,"column":0},"end":{"line":26,"column":38}},"22":{"start":{"line":28,"column":0},"end":{"line":28,"column":23}},"23":{"start":{"line":29,"column":0},"end":{"line":29,"column":17}},"24":{"start":{"line":30,"column":0},"end":{"line":30,"column":52}},"25":{"start":{"line":31,"column":0},"end":{"line":31,"column":61}},"26":{"start":{"line":32,"column":0},"end":{"line":32,"column":21}},"27":{"start":{"line":34,"column":0},"end":{"line":38,"column":1}},"28":{"start":{"line":35,"column":2},"end":{"line":37,"column":6}},"29":{"start":{"line":40,"column":0},"end":{"line":40,"column":20}},"30":{"start":{"line":41,"column":0},"end":{"line":41,"column":45}},"31":{"start":{"line":42,"column":0},"end":{"line":42,"column":17}},"32":{"start":{"line":43,"column":0},"end":{"line":45,"column":4}},"33":{"start":{"line":46,"column":0},"end":{"line":46,"column":34}},"34":{"start":{"line":47,"column":0},"end":{"line":47,"column":16}},"35":{"start":{"line":48,"column":0},"end":{"line":48,"column":18}},"36":{"start":{"line":50,"column":0},"end":{"line":52,"column":1}},"37":{"start":{"line":51,"column":2},"end":{"line":51,"column":50}},"38":{"start":{"line":54,"column":0},"end":{"line":54,"column":35}},"39":{"start":{"line":55,"column":0},"end":{"line":55,"column":28}},"40":{"start":{"line":57,"column":0},"end":{"line":57,"column":48}},"41":{"start":{"line":58,"column":0},"end":{"line":58,"column":47}},"42":{"start":{"line":60,"column":0},"end":{"line":60,"column":52}},"43":{"start":{"line":61,"column":0},"end":{"line":61,"column":95}},"44":{"start":{"line":62,"column":0},"end":{"line":65,"column":50}},"45":{"start":{"line":66,"column":0},"end":{"line":66,"column":37}},"46":{"start":{"line":69,"column":0},"end":{"line":69,"column":49}},"47":{"start":{"line":70,"column":0},"end":{"line":70,"column":18}},"48":{"start":{"line":71,"column":0},"end":{"line":75,"column":1}},"49":{"start":{"line":72,"column":2},"end":{"line":72,"column":67}},"50":{"start":{"line":74,"column":2},"end":{"line":74,"column":74}},"51":{"start":{"line":76,"column":0},"end":{"line":76,"column":44}},"52":{"start":{"line":78,"column":0},"end":{"line":89,"column":4}},"53":{"start":{"line":87,"column":4},"end":{"line":87,"column":42}},"54":{"start":{"line":91,"column":0},"end":{"line":93,"column":2}},"55":{"start":{"line":95,"column":0},"end":{"line":102,"column":3}},"56":{"start":{"line":107,"column":0},"end":{"line":107,"column":33}},"57":{"start":{"line":108,"column":0},"end":{"line":108,"column":12}},"58":{"start":{"line":114,"column":0},"end":{"line":119,"column":3}},"59":{"start":{"line":115,"column":2},"end":{"line":115,"column":39}},"60":{"start":{"line":116,"column":2},"end":{"line":116,"column":19}},"61":{"start":{"line":117,"column":2},"end":{"line":117,"column":25}},"62":{"start":{"line":118,"column":2},"end":{"line":118,"column":20}},"63":{"start":{"line":121,"column":0},"end":{"line":121,"column":40}},"64":{"start":{"line":123,"column":0},"end":{"line":125,"column":1}},"65":{"start":{"line":124,"column":2},"end":{"line":124,"column":29}},"66":{"start":{"line":127,"column":0},"end":{"line":127,"column":21}}},"branchMap":{"1":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":0},"end":{"line":34,"column":0}},{"start":{"line":34,"column":0},"end":{"line":34,"column":0}}]},"2":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":0},"end":{"line":50,"column":0}},{"start":{"line":50,"column":0},"end":{"line":50,"column":0}}]},"3":{"line":61,"type":"binary-expr","locations":[{"start":{"line":61,"column":13},"end":{"line":61,"column":32}},{"start":{"line":61,"column":36},"end":{"line":61,"column":94}}]},"4":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":27},"end":{"line":65,"column":42}},{"start":{"line":65,"column":46},"end":{"line":65,"column":48}}]},"5":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":0},"end":{"line":71,"column":0}},{"start":{"line":71,"column":0},"end":{"line":71,"column":0}}]},"6":{"line":115,"type":"binary-expr","locations":[{"start":{"line":115,"column":12},"end":{"line":115,"column":19}},{"start":{"line":115,"column":23},"end":{"line":115,"column":38}}]},"7":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":0},"end":{"line":123,"column":0}},{"start":{"line":123,"column":0},"end":{"line":123,"column":0}}]}},"code":["'use strict';","","var opensearch = require('../middleware/opensearch');","var notFound = require('../middleware/web_not_found');","var staticCache = require('../middleware/static');","var middlewares = require('koa-middlewares');","var markdownMiddleware = require('koa-markdown');","var block = require('../middleware/block');","var logger = require('../common/logger');","var renderMarkdown = require('../common/markdown').render;","var auth = require('../middleware/auth');","var proxyToNpm = require('../middleware/proxy_to_npm');","var routes = require('../routes/web');","var config = require('../config');","var jsonp = require('koa-safe-jsonp');","var path = require('path');","var http = require('http');","var koa = require('koa');","var fs = require('fs');","var maxrequests = require('koa-maxrequests');","","var app = koa();","","jsonp(app);","","var rootdir = path.dirname(__dirname);","","app.use(maxrequests());","app.use(block());","app.use(middlewares.rt({headerName: 'X-ReadTime'}));","app.use(middlewares.rewrite('/favicon.ico', '/favicon.png'));","app.use(staticCache);","","if (config.pagemock) {","  app.use(require('koa-mock')({","    datadir: path.join(rootdir, 'test', 'mocks')","  }));","}","","app.use(opensearch);","app.keys = ['todokey', config.sessionSecret];","app.proxy = true;","app.use(proxyToNpm({","  isWeb: true","}));","app.use(middlewares.bodyParser());","app.use(auth());","app.use(notFound);","","if (config.enableCompress) {","  app.use(middlewares.compress({threshold: 150}));","}","","app.use(middlewares.conditional());","app.use(middlewares.etag());","","var viewDir = path.join(rootdir, 'view', 'web');","var docDir = path.join(rootdir, 'docs', 'web');","","var layoutFile = path.join(viewDir, '_layout.html');","var footer = config.customFooter || fs.readFileSync(path.join(viewDir, 'footer.html'), 'utf8');","var layout = fs.readFileSync(path.join(viewDir, 'layout.html'), 'utf8')","  .replace('{{footer}}', footer)","  .replace('{{logoURL}}', config.logoURL)","  .replace('{{adBanner}}', config.adBanner || '');","fs.writeFileSync(layoutFile, layout);","","// custom web readme home page support","var readmeFile = path.join(docDir, '_readme.md');","var readmeContent;","if (config.customReadmeFile) {","  readmeContent = fs.readFileSync(config.customReadmeFile, 'utf8');","} else {","  readmeContent = fs.readFileSync(path.join(docDir, 'readme.md'), 'utf8');","}","fs.writeFileSync(readmeFile, readmeContent);","","app.use(markdownMiddleware({","  baseUrl: '/',","  root: docDir,","  layout: layoutFile,","  titleHolder: '<%= locals.title %>',","  bodyHolder: '<%- locals.body %>',","  indexName: '_readme',","  cache: true,","  render: function (content) {","    return renderMarkdown(content, false);","  },","}));","","var locals = {","  config: config","};","","middlewares.ejs(app, {","  root: viewDir,","  viewExt: 'html',","  layout: '_layout',","  cache: config.viewCache,","  debug: config.debug,","  locals: locals","});","","/**"," * Routes"," */","app.use(middlewares.router(app));","routes(app);","","/**"," * Error handler"," */","","app.on('error', function (err, ctx) {","  err.url = err.url || ctx.request.url;","  console.log(err);","  console.log(err.stack);","  logger.error(err);","});","","app = http.createServer(app.callback());","","if (!module.parent) {","  app.listen(config.webPort);","}","","module.exports = app;",""],"l":{"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":2,"11":2,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"22":0,"24":0,"26":0,"28":0,"29":0,"30":0,"31":0,"32":0,"34":0,"35":0,"40":0,"41":0,"42":0,"43":0,"46":0,"47":0,"48":0,"50":0,"51":0,"54":0,"55":0,"57":0,"58":0,"60":0,"61":0,"62":0,"66":0,"69":0,"70":0,"71":0,"72":0,"74":0,"76":0,"78":0,"87":0,"91":0,"95":0,"107":0,"108":0,"114":0,"115":0,"116":0,"117":0,"118":0,"121":0,"123":0,"124":0,"127":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/default_user_service.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/services/default_user_service.js","s":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"convertToUser","line":37,"loc":{"start":{"line":37,"column":0},"end":{"line":37,"column":28}}},"2":{"name":"DefaultUserService","line":75,"loc":{"start":{"line":75,"column":0},"end":{"line":75,"column":30}}},"3":{"name":"(anonymous_3)","line":85,"loc":{"start":{"line":85,"column":13},"end":{"line":85,"column":41}}},"4":{"name":"(anonymous_4)","line":98,"loc":{"start":{"line":98,"column":12},"end":{"line":98,"column":30}}},"5":{"name":"(anonymous_5)","line":111,"loc":{"start":{"line":111,"column":13},"end":{"line":111,"column":32}}},"6":{"name":"(anonymous_6)","line":114,"loc":{"start":{"line":114,"column":15},"end":{"line":114,"column":30}}},"7":{"name":"(anonymous_7)","line":127,"loc":{"start":{"line":127,"column":15},"end":{"line":127,"column":42}}},"8":{"name":"(anonymous_8)","line":136,"loc":{"start":{"line":136,"column":15},"end":{"line":136,"column":30}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":35}},"2":{"start":{"line":19,"column":0},"end":{"line":19,"column":37}},"3":{"start":{"line":20,"column":0},"end":{"line":20,"column":47}},"4":{"start":{"line":21,"column":0},"end":{"line":21,"column":34}},"5":{"start":{"line":35,"column":0},"end":{"line":35,"column":36}},"6":{"start":{"line":37,"column":0},"end":{"line":73,"column":1}},"7":{"start":{"line":38,"column":2},"end":{"line":47,"column":4}},"8":{"start":{"line":48,"column":2},"end":{"line":68,"column":3}},"9":{"start":{"line":49,"column":4},"end":{"line":49,"column":24}},"10":{"start":{"line":50,"column":4},"end":{"line":67,"column":5}},"11":{"start":{"line":52,"column":6},"end":{"line":52,"column":18}},"12":{"start":{"line":55,"column":6},"end":{"line":57,"column":7}},"13":{"start":{"line":56,"column":8},"end":{"line":56,"column":38}},"14":{"start":{"line":58,"column":6},"end":{"line":60,"column":7}},"15":{"start":{"line":59,"column":8},"end":{"line":59,"column":34}},"16":{"start":{"line":61,"column":6},"end":{"line":63,"column":7}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":38}},"18":{"start":{"line":64,"column":6},"end":{"line":66,"column":7}},"19":{"start":{"line":65,"column":8},"end":{"line":65,"column":60}},"20":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"21":{"start":{"line":70,"column":4},"end":{"line":70,"column":76}},"22":{"start":{"line":72,"column":2},"end":{"line":72,"column":14}},"23":{"start":{"line":75,"column":0},"end":{"line":75,"column":32}},"24":{"start":{"line":77,"column":0},"end":{"line":77,"column":41}},"25":{"start":{"line":85,"column":0},"end":{"line":91,"column":2}},"26":{"start":{"line":86,"column":2},"end":{"line":86,"column":46}},"27":{"start":{"line":87,"column":2},"end":{"line":89,"column":3}},"28":{"start":{"line":88,"column":4},"end":{"line":88,"column":16}},"29":{"start":{"line":90,"column":2},"end":{"line":90,"column":28}},"30":{"start":{"line":98,"column":0},"end":{"line":104,"column":2}},"31":{"start":{"line":99,"column":2},"end":{"line":99,"column":41}},"32":{"start":{"line":100,"column":2},"end":{"line":102,"column":3}},"33":{"start":{"line":101,"column":4},"end":{"line":101,"column":16}},"34":{"start":{"line":103,"column":2},"end":{"line":103,"column":28}},"35":{"start":{"line":111,"column":0},"end":{"line":118,"column":2}},"36":{"start":{"line":112,"column":2},"end":{"line":112,"column":45}},"37":{"start":{"line":113,"column":2},"end":{"line":113,"column":17}},"38":{"start":{"line":114,"column":2},"end":{"line":116,"column":5}},"39":{"start":{"line":115,"column":4},"end":{"line":115,"column":35}},"40":{"start":{"line":117,"column":2},"end":{"line":117,"column":15}},"41":{"start":{"line":127,"column":0},"end":{"line":140,"column":2}},"42":{"start":{"line":128,"column":2},"end":{"line":128,"column":26}},"43":{"start":{"line":129,"column":2},"end":{"line":129,"column":42}},"44":{"start":{"line":130,"column":2},"end":{"line":132,"column":3}},"45":{"start":{"line":131,"column":4},"end":{"line":131,"column":23}},"46":{"start":{"line":134,"column":2},"end":{"line":134,"column":48}},"47":{"start":{"line":135,"column":2},"end":{"line":135,"column":17}},"48":{"start":{"line":136,"column":2},"end":{"line":138,"column":5}},"49":{"start":{"line":137,"column":4},"end":{"line":137,"column":35}},"50":{"start":{"line":139,"column":2},"end":{"line":139,"column":15}}},"branchMap":{"1":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":2},"end":{"line":48,"column":2}},{"start":{"line":48,"column":2},"end":{"line":48,"column":2}}]},"2":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":50,"column":4}},{"start":{"line":50,"column":4},"end":{"line":50,"column":4}}]},"3":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":6},"end":{"line":55,"column":6}},{"start":{"line":55,"column":6},"end":{"line":55,"column":6}}]},"4":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":6},"end":{"line":58,"column":6}},{"start":{"line":58,"column":6},"end":{"line":58,"column":6}}]},"5":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":6},"end":{"line":61,"column":6}},{"start":{"line":61,"column":6},"end":{"line":61,"column":6}}]},"6":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":6},"end":{"line":64,"column":6}},{"start":{"line":64,"column":6},"end":{"line":64,"column":6}}]},"7":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]},"8":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":2},"end":{"line":87,"column":2}},{"start":{"line":87,"column":2},"end":{"line":87,"column":2}}]},"9":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":2},"end":{"line":100,"column":2}},{"start":{"line":100,"column":2},"end":{"line":100,"column":2}}]},"10":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":12},"end":{"line":128,"column":19}},{"start":{"line":128,"column":23},"end":{"line":128,"column":25}}]},"11":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":2},"end":{"line":130,"column":2}},{"start":{"line":130,"column":2},"end":{"line":130,"column":2}}]},"12":{"line":130,"type":"binary-expr","locations":[{"start":{"line":130,"column":6},"end":{"line":130,"column":20}},{"start":{"line":130,"column":24},"end":{"line":130,"column":41}}]}},"code":["/**!"," * cnpmjs.org - services/default_user_service.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var gravatar = require('gravatar');","// var User = require('../proxy/user');","var User = require('../models').User;","var isAdmin = require('../lib/common').isAdmin;","var config = require('../config');","","// User: https://github.com/cnpm/cnpmjs.org/wiki/Use-Your-Own-User-Authorization#user-data-structure","// {","//   \"login\": \"fengmk2\",","//   \"email\": \"fengmk2@gmail.com\",","//   \"name\": \"Yuan Feng\",","//   \"html_url\": \"http://fengmk2.github.com\",","//   \"avatar_url\": \"https://avatars3.githubusercontent.com/u/156269?s=460\",","//   \"im_url\": \"\",","//   \"site_admin\": false,","//   \"scopes\": [\"@org1\", \"@org2\"]","// }","","module.exports = DefaultUserService;","","function convertToUser(row) {","  var user = {","    login: row.name,","    email: row.email,","    name: row.name,","    html_url: 'http://cnpmjs.org/~' + row.name,","    avatar_url: '',","    im_url: '',","    site_admin: isAdmin(row.name),","    scopes: config.scopes,","  };","  if (row.json) {","    var data = row.json;","    if (data.login) {","      // custom user","      user = data;","    } else {","      // npm user","      if (data.avatar) {","        user.avatar_url = data.avatar;","      }","      if (data.fullname) {","        user.name = data.fullname;","      }","      if (data.homepage) {","        user.html_url = data.homepage;","      }","      if (data.twitter) {","        user.im_url = 'https://twitter.com/' + data.twitter;","      }","    }","  }","  if (!user.avatar_url) {","    user.avatar_url = gravatar.url(user.email, {s: '50', d: 'retro'}, true);","  }","  return user;","}","","function DefaultUserService() {}","","var proto = DefaultUserService.prototype;","","/**"," * Auth user with login name and password"," * @param  {String} login    login name"," * @param  {String} password login password"," * @return {User}"," */","proto.auth = function* (login, password) {","  var row = yield* User.auth(login, password);","  if (!row) {","    return null;","  }","  return convertToUser(row);","};","","/**"," * Get user by login name"," * @param  {String} login  login name"," * @return {User}"," */","proto.get = function* (login) {","  var row = yield User.findByName(login);","  if (!row) {","    return null;","  }","  return convertToUser(row);","};","","/**"," * List users"," * @param  {Array<String>} logins  login names"," * @return {Array<User>}"," */","proto.list = function* (logins) {","  var rows = yield* User.listByNames(logins);","  var users = [];","  rows.forEach(function (row) {","    users.push(convertToUser(row));","  });","  return users;","};","","/**"," * Search users"," * @param  {String} query  query keyword"," * @param  {Object} [options] optional query params"," *  - {Number} limit match users count, default is `20`"," * @return {Array<User>}"," */","proto.search = function* (query, options) {","  options = options || {};","  options.limit = parseInt(options.limit);","  if (!options.limit || options.limit < 0) {","    options.limit = 20;","  }","","  var rows = yield* User.search(query, options);","  var users = [];","  rows.forEach(function (row) {","    users.push(convertToUser(row));","  });","  return users;","};",""],"l":{"17":2,"19":2,"20":0,"21":0,"35":0,"37":1,"38":0,"48":0,"49":0,"50":0,"52":0,"55":0,"56":0,"58":0,"59":0,"61":0,"62":0,"64":0,"65":0,"69":0,"70":0,"72":0,"75":1,"77":0,"85":0,"86":0,"87":0,"88":0,"90":0,"98":0,"99":0,"100":0,"101":0,"103":0,"111":0,"112":0,"113":0,"114":0,"115":0,"117":0,"127":0,"128":0,"129":0,"130":0,"131":0,"134":0,"135":0,"136":0,"137":0,"139":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/changes_stream_syncer.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/changes_stream_syncer.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"sync","line":15,"loc":{"start":{"line":15,"column":17},"end":{"line":15,"column":34}}},"2":{"name":"syncPackage","line":42,"loc":{"start":{"line":42,"column":0},"end":{"line":42,"column":29}}},"3":{"name":"getLastSequence","line":63,"loc":{"start":{"line":63,"column":0},"end":{"line":63,"column":28}}},"4":{"name":"saveLastSequence","line":83,"loc":{"start":{"line":83,"column":0},"end":{"line":83,"column":31}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":48}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":29}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":28}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":33}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":43}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":43}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":36}},"8":{"start":{"line":11,"column":0},"end":{"line":11,"column":39}},"9":{"start":{"line":12,"column":0},"end":{"line":12,"column":74}},"10":{"start":{"line":13,"column":0},"end":{"line":13,"column":19}},"11":{"start":{"line":15,"column":0},"end":{"line":40,"column":2}},"12":{"start":{"line":16,"column":2},"end":{"line":16,"column":40}},"13":{"start":{"line":17,"column":2},"end":{"line":17,"column":32}},"14":{"start":{"line":18,"column":2},"end":{"line":18,"column":23}},"15":{"start":{"line":19,"column":2},"end":{"line":19,"column":73}},"16":{"start":{"line":20,"column":2},"end":{"line":24,"column":5}},"17":{"start":{"line":25,"column":2},"end":{"line":25,"column":30}},"18":{"start":{"line":26,"column":2},"end":{"line":30,"column":5}},"19":{"start":{"line":27,"column":4},"end":{"line":27,"column":19}},"20":{"start":{"line":28,"column":4},"end":{"line":28,"column":83}},"21":{"start":{"line":29,"column":4},"end":{"line":29,"column":24}},"22":{"start":{"line":32,"column":2},"end":{"line":39,"column":3}},"23":{"start":{"line":33,"column":4},"end":{"line":33,"column":33}},"24":{"start":{"line":36,"column":4},"end":{"line":36,"column":22}},"25":{"start":{"line":37,"column":4},"end":{"line":37,"column":72}},"26":{"start":{"line":38,"column":4},"end":{"line":38,"column":14}},"27":{"start":{"line":42,"column":0},"end":{"line":61,"column":1}},"28":{"start":{"line":43,"column":2},"end":{"line":43,"column":63}},"29":{"start":{"line":44,"column":2},"end":{"line":60,"column":5}},"30":{"start":{"line":49,"column":4},"end":{"line":59,"column":5}},"31":{"start":{"line":50,"column":6},"end":{"line":51,"column":41}},"32":{"start":{"line":52,"column":6},"end":{"line":52,"column":28}},"33":{"start":{"line":53,"column":6},"end":{"line":53,"column":26}},"34":{"start":{"line":54,"column":6},"end":{"line":54,"column":50}},"35":{"start":{"line":54,"column":23},"end":{"line":54,"column":42}},"36":{"start":{"line":56,"column":6},"end":{"line":56,"column":35}},"37":{"start":{"line":57,"column":6},"end":{"line":58,"column":48}},"38":{"start":{"line":63,"column":0},"end":{"line":81,"column":1}},"39":{"start":{"line":64,"column":2},"end":{"line":64,"column":14}},"40":{"start":{"line":65,"column":2},"end":{"line":68,"column":3}},"41":{"start":{"line":66,"column":4},"end":{"line":66,"column":53}},"42":{"start":{"line":67,"column":4},"end":{"line":67,"column":30}},"43":{"start":{"line":69,"column":2},"end":{"line":71,"column":3}},"44":{"start":{"line":70,"column":4},"end":{"line":70,"column":22}},"45":{"start":{"line":80,"column":2},"end":{"line":80,"column":17}},"46":{"start":{"line":83,"column":0},"end":{"line":85,"column":1}},"47":{"start":{"line":84,"column":2},"end":{"line":84,"column":51}}},"branchMap":{"1":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":49,"column":4}},{"start":{"line":49,"column":4},"end":{"line":49,"column":4}}]},"2":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":65,"column":2}},{"start":{"line":65,"column":2},"end":{"line":65,"column":2}}]},"3":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]}},"code":["'use strict';","","const ChangesStream = require('changes-stream');","const path = require('path');","const fs = require('mz/fs');","const urllib = require('urllib');","const streamAwait = require('await-event');","const logger = require('../common/logger');","const config = require('../config');","","const db = config.officialNpmReplicate;","const lastSeqFile = path.join(config.dataDir, '.cnpmjs.org.last_seq.txt');","let _STREAM_ID = 0;","","module.exports = function* sync() {","  const since = yield getLastSequence();","  const streamId = _STREAM_ID++;","  let changesCount = 0;","  logger.syncInfo('start changes stream#%d, since: %s', streamId, since);","  const changes = new ChangesStream({","    db,","    since,","    include_docs: false,","  });","  changes.await = streamAwait;","  changes.on('data', change => {","    changesCount++;","    logger.syncInfo('stream#%d get change#%d: %j', streamId, changesCount, change);","    syncPackage(change);","  });","","  try {","    yield changes.await('error');","  } catch (err) {","    // make sure changes steam is destroy","    changes.destroy();","    err.message += `, stream#${streamId}, changesCount#${changesCount}`;","    throw err;","  }","};","","function syncPackage(change) {","  const url = `${config.handleSyncRegistry}/${change.id}/sync`;","  urllib.request(url, {","    method: 'PUT',","    dataType: 'json',","    timeout: 10000,","  }, (err, data) => {","    if (err) {","      logger.syncInfo('%s:%s PUT %s error: %s, retry after 5s',","        change.seq, change.id, url, err);","      logger.syncError(err);","      syncPackage(change);","      setTimeout(() => syncPackage(change), 5000);","    } else {","      saveLastSequence(change.seq);","      logger.syncInfo('%s:%s sync request sent, log: %s/log/%s',","        change.seq, change.id, url, data.logId);","    }","  });","}","","function* getLastSequence() {","  let lastSeq;","  if (yield fs.exists(lastSeqFile)) {","    lastSeq = yield fs.readFile(lastSeqFile, 'utf8');","    lastSeq = Number(lastSeq);","  }","  if (!lastSeq) {","    lastSeq = 2649694;","  }","  // const r = yield urllib.request(db, {","  //   dataType: 'json',","  //   timeout: 15000,","  // });","  // logger.syncInfo('get registry info: %j', r.data);","  // if (lastSeq < r.data.update_seq) {","  //   lastSeq = r.data.update_seq;","  // }","  return lastSeq;","}","","function saveLastSequence(seq) {","  fs.writeFile(lastSeqFile, String(seq), () => {});","}",""],"l":{"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"11":1,"12":1,"13":1,"15":1,"16":0,"17":0,"18":0,"19":0,"20":0,"25":0,"26":0,"27":0,"28":0,"29":0,"32":0,"33":0,"36":0,"37":0,"38":0,"42":1,"43":0,"44":0,"49":0,"50":0,"52":0,"53":0,"54":0,"56":0,"57":0,"63":1,"64":0,"65":0,"66":0,"67":0,"69":0,"70":0,"80":0,"83":1,"84":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/status.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/status.js","s":{"1":8,"2":8,"3":8,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"Status","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":25}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":23},"end":{"line":15,"column":43}}},"3":{"name":"(anonymous_3)","line":24,"loc":{"start":{"line":24,"column":5},"end":{"line":24,"column":18}}},"4":{"name":"(anonymous_4)","line":26,"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":23}}},"5":{"name":"(anonymous_5)","line":29,"loc":{"start":{"line":29,"column":25},"end":{"line":29,"column":37}}},"6":{"name":"(anonymous_6)","line":38,"loc":{"start":{"line":38,"column":24},"end":{"line":38,"column":36}}},"7":{"name":"(anonymous_7)","line":45,"loc":{"start":{"line":45,"column":14},"end":{"line":45,"column":41}}},"8":{"name":"(anonymous_8)","line":48,"loc":{"start":{"line":48,"column":23},"end":{"line":48,"column":45}}},"9":{"name":"(anonymous_9)","line":54,"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":32}}},"10":{"name":"(anonymous_10)","line":58,"loc":{"start":{"line":58,"column":19},"end":{"line":58,"column":31}}},"11":{"name":"(anonymous_11)","line":62,"loc":{"start":{"line":62,"column":19},"end":{"line":62,"column":31}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":55}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":23}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":41}},"4":{"start":{"line":7,"column":0},"end":{"line":13,"column":1}},"5":{"start":{"line":8,"column":2},"end":{"line":8,"column":27}},"6":{"start":{"line":9,"column":2},"end":{"line":9,"column":27}},"7":{"start":{"line":10,"column":2},"end":{"line":10,"column":21}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":17}},"9":{"start":{"line":12,"column":2},"end":{"line":12,"column":27}},"10":{"start":{"line":15,"column":0},"end":{"line":27,"column":2}},"11":{"start":{"line":16,"column":2},"end":{"line":23,"column":4}},"12":{"start":{"line":24,"column":2},"end":{"line":26,"column":27}},"13":{"start":{"line":25,"column":4},"end":{"line":25,"column":38}},"14":{"start":{"line":29,"column":0},"end":{"line":36,"column":2}},"15":{"start":{"line":30,"column":2},"end":{"line":32,"column":3}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":11}},"17":{"start":{"line":33,"column":2},"end":{"line":33,"column":22}},"18":{"start":{"line":35,"column":2},"end":{"line":35,"column":55}},"19":{"start":{"line":38,"column":0},"end":{"line":43,"column":2}},"20":{"start":{"line":39,"column":2},"end":{"line":39,"column":17}},"21":{"start":{"line":40,"column":2},"end":{"line":40,"column":28}},"22":{"start":{"line":41,"column":2},"end":{"line":41,"column":20}},"23":{"start":{"line":42,"column":2},"end":{"line":42,"column":23}},"24":{"start":{"line":45,"column":0},"end":{"line":65,"column":2}},"25":{"start":{"line":46,"column":2},"end":{"line":46,"column":35}},"26":{"start":{"line":47,"column":2},"end":{"line":47,"column":17}},"27":{"start":{"line":48,"column":2},"end":{"line":53,"column":5}},"28":{"start":{"line":49,"column":4},"end":{"line":49,"column":43}},"29":{"start":{"line":50,"column":4},"end":{"line":50,"column":39}},"30":{"start":{"line":51,"column":4},"end":{"line":51,"column":23}},"31":{"start":{"line":52,"column":4},"end":{"line":52,"column":18}},"32":{"start":{"line":54,"column":2},"end":{"line":57,"column":5}},"33":{"start":{"line":55,"column":4},"end":{"line":55,"column":19}},"34":{"start":{"line":56,"column":4},"end":{"line":56,"column":18}},"35":{"start":{"line":58,"column":2},"end":{"line":60,"column":5}},"36":{"start":{"line":59,"column":4},"end":{"line":59,"column":18}},"37":{"start":{"line":62,"column":2},"end":{"line":64,"column":5}},"38":{"start":{"line":63,"column":4},"end":{"line":63,"column":18}},"39":{"start":{"line":67,"column":0},"end":{"line":67,"column":24}}},"branchMap":{"1":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":27},"end":{"line":17,"column":28}},{"start":{"line":17,"column":31},"end":{"line":17,"column":32}}]},"2":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":2},"end":{"line":30,"column":2}},{"start":{"line":30,"column":2},"end":{"line":30,"column":2}}]}},"code":["'use strict';","","var debug = require('debug')('cnpmjs.org:sync:status');","var co = require('co');","var Total = require('../services/total');","","function Status(options) {","  this.need = options.need;","  this.lastSyncModule = '';","  this.successes = 0;","  this.fails = 0;","  this.left = options.need;","}","","Status.prototype.log = function (syncDone) {","  var params = {","    syncStatus: syncDone ? 0 : 1,","    need: this.need,","    success: this.successes,","    fail: this.fails,","    left: this.left,","    lastSyncModule: this.lastSyncModule,","  };","  co(function* () {","    yield Total.updateSyncNum(params);","  }).catch(function () {});","};","","Status.prototype.start = function () {","  if (this.started) {","    return;","  }","  this.started = true;","  //every 30s log it into mysql","  this.timer = setInterval(this.log.bind(this), 30000);","};","","Status.prototype.stop = function () {","  this.log(true);","  clearInterval(this.timer);","  this.timer = null;","  this.started = false;","};","","Status.init = function (options, worker) {","  var status = new Status(options);","  status.start();","  worker.on('success', function (moduleName) {","    debug('sync [%s] success', moduleName);","    status.lastSyncModule = moduleName;","    status.successes++;","    status.left--;","  });","  worker.on('fail', function () {","    status.fails++;","    status.left--;","  });","  worker.on('add', function () {","    status.left++;","  });","","  worker.on('end', function () {","    status.stop();","  });","};","","module.exports = Status;",""],"l":{"3":8,"4":8,"5":8,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"15":0,"16":0,"24":0,"25":0,"29":0,"30":0,"31":0,"33":0,"35":0,"38":0,"39":0,"40":0,"41":0,"42":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"54":0,"55":0,"56":0,"58":0,"59":0,"62":0,"63":0,"67":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_all.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_all.js","s":{"1":2,"2":2,"3":2,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getFirstSyncPackages","line":16,"loc":{"start":{"line":16,"column":0},"end":{"line":16,"column":47}}},"2":{"name":"sync","line":28,"loc":{"start":{"line":28,"column":17},"end":{"line":28,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":40}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":34}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":44}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":48}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":68}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"8":{"start":{"line":16,"column":0},"end":{"line":26,"column":1}},"9":{"start":{"line":17,"column":2},"end":{"line":17,"column":42}},"10":{"start":{"line":18,"column":2},"end":{"line":20,"column":3}},"11":{"start":{"line":19,"column":4},"end":{"line":19,"column":16}},"12":{"start":{"line":22,"column":2},"end":{"line":22,"column":47}},"13":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"14":{"start":{"line":24,"column":4},"end":{"line":24,"column":33}},"15":{"start":{"line":28,"column":0},"end":{"line":78,"column":2}},"16":{"start":{"line":29,"column":2},"end":{"line":29,"column":28}},"17":{"start":{"line":30,"column":2},"end":{"line":30,"column":48}},"18":{"start":{"line":31,"column":2},"end":{"line":33,"column":3}},"19":{"start":{"line":32,"column":4},"end":{"line":32,"column":48}},"20":{"start":{"line":35,"column":2},"end":{"line":35,"column":15}},"21":{"start":{"line":36,"column":2},"end":{"line":36,"column":70}},"22":{"start":{"line":37,"column":2},"end":{"line":44,"column":3}},"23":{"start":{"line":38,"column":4},"end":{"line":38,"column":75}},"24":{"start":{"line":39,"column":4},"end":{"line":39,"column":66}},"25":{"start":{"line":41,"column":4},"end":{"line":41,"column":73}},"26":{"start":{"line":42,"column":4},"end":{"line":42,"column":35}},"27":{"start":{"line":43,"column":4},"end":{"line":43,"column":28}},"28":{"start":{"line":46,"column":2},"end":{"line":46,"column":28}},"29":{"start":{"line":47,"column":2},"end":{"line":50,"column":3}},"30":{"start":{"line":48,"column":4},"end":{"line":48,"column":48}},"31":{"start":{"line":49,"column":4},"end":{"line":49,"column":11}},"32":{"start":{"line":51,"column":2},"end":{"line":51,"column":78}},"33":{"start":{"line":53,"column":2},"end":{"line":59,"column":5}},"34":{"start":{"line":60,"column":2},"end":{"line":62,"column":13}},"35":{"start":{"line":63,"column":2},"end":{"line":63,"column":17}},"36":{"start":{"line":64,"column":2},"end":{"line":64,"column":35}},"37":{"start":{"line":65,"column":2},"end":{"line":65,"column":14}},"38":{"start":{"line":67,"column":2},"end":{"line":68,"column":75}},"39":{"start":{"line":70,"column":2},"end":{"line":72,"column":3}},"40":{"start":{"line":71,"column":4},"end":{"line":71,"column":49}},"41":{"start":{"line":73,"column":2},"end":{"line":77,"column":4}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":2}},{"start":{"line":18,"column":2},"end":{"line":18,"column":2}}]},"2":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":2},"end":{"line":31,"column":2}},{"start":{"line":31,"column":2},"end":{"line":31,"column":2}}]},"4":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":37,"column":2}},{"start":{"line":37,"column":2},"end":{"line":37,"column":2}}]},"5":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":13},"end":{"line":46,"column":21}},{"start":{"line":46,"column":25},"end":{"line":46,"column":27}}]},"6":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]}},"code":["'use strict';","","var thunkify = require('thunkify-wrap');","var config = require('../config');","var Status = require('./status');","var npmService = require('../services/npm');","var totalService = require('../services/total');","var SyncModuleWorker = require('../controllers/sync_module_worker');","var logger = require('../common/logger');","","/**"," * when sync from official at the first time"," * get all packages by short and restart from last synced module"," * @param {String} lastSyncModule"," */","function* getFirstSyncPackages(lastSyncModule) {","  var pkgs = yield* npmService.getShort();","  if (!lastSyncModule) {","    return pkgs;","  }","  // start from last success","  var lastIndex = pkgs.indexOf(lastSyncModule);","  if (lastIndex > 0) {","    return pkgs.slice(lastIndex);","  }","}","","module.exports = function* sync() {","  var syncTime = Date.now();","  var info = yield* totalService.getTotalInfo();","  if (!info) {","    throw new Error('can not found total info');","  }","","  var packages;","  logger.syncInfo('Last sync time %s', new Date(info.last_sync_time));","  if (!info.last_sync_time) {","    logger.syncInfo('First time sync all packages from official registry');","    packages = yield* getFirstSyncPackages(info.last_sync_module);","  } else {","    var result = yield npmService.fetchUpdatesSince(info.last_sync_time);","    syncTime = result.lastModified;","    packages = result.names;","  }","","  packages = packages || [];","  if (!packages.length) {","    logger.syncInfo('no packages need be sync');","    return;","  }","  logger.syncInfo('Total %d packages to sync: %j', packages.length, packages);","","  var worker = new SyncModuleWorker({","    username: 'admin',","    name: packages,","    noDep: true,","    concurrency: config.syncConcurrency,","    syncUpstreamFirst: false,","  });","  Status.init({","    need: packages.length,","  }, worker);","  worker.start();","  var end = thunkify.event(worker);","  yield end();","","  logger.syncInfo('All packages sync done, successes %d, fails %d, updates %d',","      worker.successes.length, worker.fails.length, worker.updates.length);","  //only when all succss, set last sync time","  if (!worker.fails.length) {","    yield totalService.setLastSyncTime(syncTime);","  }","  return {","    successes: worker.successes,","    fails: worker.fails,","    updates: worker.updates,","  };","};",""],"l":{"3":2,"4":2,"5":2,"6":0,"7":0,"8":0,"9":0,"16":1,"17":0,"18":0,"19":0,"22":0,"23":0,"24":0,"28":0,"29":0,"30":0,"31":0,"32":0,"35":0,"36":0,"37":0,"38":0,"39":0,"41":0,"42":0,"43":0,"46":0,"47":0,"48":0,"49":0,"51":0,"53":0,"60":0,"63":0,"64":0,"65":0,"67":0,"70":0,"71":0,"73":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_exist.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_exist.js","s":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"intersection","line":13,"loc":{"start":{"line":13,"column":0},"end":{"line":13,"column":38}}},"2":{"name":"(anonymous_2)","line":18,"loc":{"start":{"line":18,"column":17},"end":{"line":18,"column":33}}},"3":{"name":"(anonymous_3)","line":21,"loc":{"start":{"line":21,"column":17},"end":{"line":21,"column":33}}},"4":{"name":"sync","line":27,"loc":{"start":{"line":27,"column":17},"end":{"line":27,"column":34}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":59}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":40}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":34}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":44}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":52}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":48}},"8":{"start":{"line":10,"column":0},"end":{"line":10,"column":33}},"9":{"start":{"line":11,"column":0},"end":{"line":11,"column":68}},"10":{"start":{"line":13,"column":0},"end":{"line":25,"column":1}},"11":{"start":{"line":14,"column":2},"end":{"line":14,"column":24}},"12":{"start":{"line":15,"column":2},"end":{"line":15,"column":24}},"13":{"start":{"line":16,"column":2},"end":{"line":16,"column":15}},"14":{"start":{"line":17,"column":2},"end":{"line":17,"column":19}},"15":{"start":{"line":18,"column":2},"end":{"line":20,"column":5}},"16":{"start":{"line":19,"column":4},"end":{"line":19,"column":21}},"17":{"start":{"line":21,"column":2},"end":{"line":23,"column":5}},"18":{"start":{"line":22,"column":4},"end":{"line":22,"column":45}},"19":{"start":{"line":24,"column":2},"end":{"line":24,"column":17}},"20":{"start":{"line":27,"column":0},"end":{"line":86,"column":2}},"21":{"start":{"line":28,"column":2},"end":{"line":28,"column":28}},"22":{"start":{"line":30,"column":2},"end":{"line":30,"column":89}},"23":{"start":{"line":31,"column":2},"end":{"line":31,"column":27}},"24":{"start":{"line":32,"column":2},"end":{"line":32,"column":18}},"25":{"start":{"line":33,"column":2},"end":{"line":35,"column":3}},"26":{"start":{"line":34,"column":4},"end":{"line":34,"column":48}},"27":{"start":{"line":37,"column":2},"end":{"line":37,"column":18}},"28":{"start":{"line":38,"column":2},"end":{"line":55,"column":3}},"29":{"start":{"line":39,"column":4},"end":{"line":39,"column":43}},"30":{"start":{"line":40,"column":4},"end":{"line":40,"column":95}},"31":{"start":{"line":41,"column":4},"end":{"line":48,"column":5}},"32":{"start":{"line":43,"column":6},"end":{"line":43,"column":58}},"33":{"start":{"line":44,"column":6},"end":{"line":47,"column":7}},"34":{"start":{"line":45,"column":8},"end":{"line":45,"column":37}},"35":{"start":{"line":46,"column":8},"end":{"line":46,"column":71}},"36":{"start":{"line":49,"column":4},"end":{"line":49,"column":23}},"37":{"start":{"line":51,"column":4},"end":{"line":51,"column":86}},"38":{"start":{"line":52,"column":4},"end":{"line":52,"column":79}},"39":{"start":{"line":53,"column":4},"end":{"line":53,"column":31}},"40":{"start":{"line":54,"column":4},"end":{"line":54,"column":35}},"41":{"start":{"line":57,"column":2},"end":{"line":57,"column":58}},"42":{"start":{"line":58,"column":2},"end":{"line":64,"column":3}},"43":{"start":{"line":59,"column":4},"end":{"line":59,"column":38}},"44":{"start":{"line":60,"column":4},"end":{"line":63,"column":6}},"45":{"start":{"line":65,"column":2},"end":{"line":65,"column":89}},"46":{"start":{"line":67,"column":2},"end":{"line":72,"column":5}},"47":{"start":{"line":73,"column":2},"end":{"line":73,"column":47}},"48":{"start":{"line":74,"column":2},"end":{"line":74,"column":17}},"49":{"start":{"line":75,"column":2},"end":{"line":75,"column":35}},"50":{"start":{"line":76,"column":2},"end":{"line":76,"column":14}},"51":{"start":{"line":78,"column":2},"end":{"line":79,"column":50}},"52":{"start":{"line":81,"column":2},"end":{"line":81,"column":53}},"53":{"start":{"line":82,"column":2},"end":{"line":85,"column":4}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":17}},{"start":{"line":14,"column":21},"end":{"line":14,"column":23}}]},"2":{"line":15,"type":"binary-expr","locations":[{"start":{"line":15,"column":11},"end":{"line":15,"column":17}},{"start":{"line":15,"column":21},"end":{"line":15,"column":23}}]},"3":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":4},"end":{"line":22,"column":22}},{"start":{"line":22,"column":26},"end":{"line":22,"column":44}}]},"4":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":33,"column":2}},{"start":{"line":33,"column":2},"end":{"line":33,"column":2}}]},"5":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":2}},{"start":{"line":38,"column":2},"end":{"line":38,"column":2}}]},"6":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]},"7":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":6},"end":{"line":44,"column":6}},{"start":{"line":44,"column":6},"end":{"line":44,"column":6}}]},"8":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":2},"end":{"line":58,"column":2}},{"start":{"line":58,"column":2},"end":{"line":58,"column":2}}]}},"code":["'use strict';","","var debug = require('debug')('cnpmjs.org:sync:sync_exist');","var Status = require('./status');","var thunkify = require('thunkify-wrap');","var config = require('../config');","var npmService = require('../services/npm');","var packageService = require('../services/package');","var totalService = require('../services/total');","var Status = require('./status');","var SyncModuleWorker = require('../controllers/sync_module_worker');","","function intersection(arrOne, arrTwo) {","  arrOne = arrOne || [];","  arrTwo = arrTwo || [];","  var map = {};","  var results = [];","  arrOne.forEach(function (name) {","    map[name] = true;","  });","  arrTwo.forEach(function (name) {","    map[name] === true && results.push(name);","  });","  return results;","}","","module.exports = function* sync() {","  var syncTime = Date.now();","","  var r = yield [packageService.listAllPublicModuleNames(), totalService.getTotalInfo()];","  var existPackages = r[0];","  var info = r[1];","  if (!info) {","    throw new Error('can not found total info');","  }","","  var allPackages;","  if (!info.last_exist_sync_time) {","    var pkgs = yield npmService.getShort();","    debug('First time sync all packages from official registry, got %d packages', pkgs.length);","    if (info.last_sync_module) {","      // start from last success","      var lastIndex = pkgs.indexOf(info.last_sync_module);","      if (lastIndex > 0) {","        pkgs = pkgs.slice(lastIndex);","        debug('recover from %d: %s', lastIndex, info.last_sync_module);","      }","    }","    allPackages = pkgs;","  } else {","    debug('sync new module from last exist sync time: %s', info.last_exist_sync_time);","    var result = yield npmService.fetchUpdatesSince(info.last_exist_sync_time);","    allPackages = result.names;","    syncTime = result.lastModified;","  }","","  var packages = intersection(existPackages, allPackages);","  if (!packages.length) {","    debug('no packages need be sync');","    return {","      successes: [],","      fails: []","    };","  }","  debug('Total %d packages to sync, top 10: %j', packages.length, packages.slice(0, 10));","","  var worker = new SyncModuleWorker({","    username: 'admin',","    name: packages,","    concurrency: config.syncConcurrency,","    syncUpstreamFirst: false,","  });","  Status.init({need: packages.length}, worker);","  worker.start();","  var end = thunkify.event(worker);","  yield end();","","  debug('All packages sync done, successes %d, fails %d',","    worker.successes.length, worker.fails.length);","","  yield* totalService.setLastExistSyncTime(syncTime);","  return {","    successes: worker.successes,","    fails: worker.fails","  };","};",""],"l":{"3":2,"4":2,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"21":0,"22":0,"24":0,"27":0,"28":0,"30":0,"31":0,"32":0,"33":0,"34":0,"37":0,"38":0,"39":0,"40":0,"41":0,"43":0,"44":0,"45":0,"46":0,"49":0,"51":0,"52":0,"53":0,"54":0,"57":0,"58":0,"59":0,"60":0,"65":0,"67":0,"73":0,"74":0,"75":0,"76":0,"78":0,"81":0,"82":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_popular.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_popular.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"syncPopular","line":11,"loc":{"start":{"line":11,"column":17},"end":{"line":11,"column":41}}},"2":{"name":"(anonymous_2)","line":13,"loc":{"start":{"line":13,"column":26},"end":{"line":13,"column":39}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":61}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":40}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":44}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"6":{"start":{"line":8,"column":0},"end":{"line":8,"column":68}},"7":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"8":{"start":{"line":11,"column":0},"end":{"line":38,"column":2}},"9":{"start":{"line":12,"column":2},"end":{"line":12,"column":65}},"10":{"start":{"line":13,"column":2},"end":{"line":15,"column":5}},"11":{"start":{"line":14,"column":4},"end":{"line":14,"column":16}},"12":{"start":{"line":17,"column":2},"end":{"line":17,"column":101}},"13":{"start":{"line":19,"column":2},"end":{"line":24,"column":5}},"14":{"start":{"line":26,"column":2},"end":{"line":26,"column":47}},"15":{"start":{"line":27,"column":2},"end":{"line":27,"column":17}},"16":{"start":{"line":28,"column":2},"end":{"line":28,"column":35}},"17":{"start":{"line":29,"column":2},"end":{"line":29,"column":14}},"18":{"start":{"line":31,"column":2},"end":{"line":32,"column":50}},"19":{"start":{"line":34,"column":2},"end":{"line":37,"column":4}}},"branchMap":{},"code":["'use strict';","","var debug = require('debug')('cnpmjs.org:sync:sync_popular');","var thunkify = require('thunkify-wrap');","var config = require('../config');","var npmService = require('../services/npm');","var Status = require('./status');","var SyncModuleWorker = require('../controllers/sync_module_worker');","var logger = require('../common/logger');","","module.exports = function* syncPopular() {","  var packages = yield* npmService.getPopular(config.topPopular);","  packages = packages.map(function (r) {","    return r[0];","  });","","  logger.syncInfo('Syncing %d popular packages, top 10: %j', packages.length, packages.slice(0, 10));","","  var worker = new SyncModuleWorker({","    username: 'admin',","    name: packages,","    concurrency: config.syncConcurrency,","    syncUpstreamFirst: false,","  });","","  Status.init({need: packages.length}, worker);","  worker.start();","  var end = thunkify.event(worker);","  yield end();","","  debug('All popular packages sync done, successes %d, fails %d',","    worker.successes.length, worker.fails.length);","","  return {","    successes: worker.successes,","    fails: worker.fails","  };","};",""],"l":{"3":2,"4":2,"5":2,"6":2,"7":2,"8":0,"9":0,"11":0,"12":0,"13":0,"14":0,"17":0,"19":0,"26":0,"27":0,"28":0,"29":0,"31":0,"34":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_since.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/sync/sync_since.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"sync","line":9,"loc":{"start":{"line":9,"column":0},"end":{"line":9,"column":31}}},"2":{"name":"(anonymous_2)","line":46,"loc":{"start":{"line":46,"column":3},"end":{"line":46,"column":16}}},"3":{"name":"(anonymous_3)","line":49,"loc":{"start":{"line":49,"column":9},"end":{"line":49,"column":24}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":42}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":34}},"4":{"start":{"line":6,"column":0},"end":{"line":6,"column":46}},"5":{"start":{"line":7,"column":0},"end":{"line":7,"column":70}},"6":{"start":{"line":9,"column":0},"end":{"line":44,"column":1}},"7":{"start":{"line":10,"column":2},"end":{"line":10,"column":71}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":70}},"9":{"start":{"line":12,"column":2},"end":{"line":12,"column":30}},"10":{"start":{"line":14,"column":2},"end":{"line":14,"column":28}},"11":{"start":{"line":15,"column":2},"end":{"line":18,"column":3}},"12":{"start":{"line":16,"column":4},"end":{"line":16,"column":44}},"13":{"start":{"line":17,"column":4},"end":{"line":17,"column":20}},"14":{"start":{"line":27,"column":2},"end":{"line":28,"column":87}},"15":{"start":{"line":30,"column":2},"end":{"line":36,"column":5}},"16":{"start":{"line":37,"column":2},"end":{"line":37,"column":17}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":35}},"18":{"start":{"line":39,"column":2},"end":{"line":39,"column":14}},"19":{"start":{"line":41,"column":2},"end":{"line":42,"column":52}},"20":{"start":{"line":43,"column":2},"end":{"line":43,"column":18}},"21":{"start":{"line":46,"column":0},"end":{"line":52,"column":3}},"22":{"start":{"line":47,"column":2},"end":{"line":47,"column":60}},"23":{"start":{"line":48,"column":2},"end":{"line":48,"column":24}},"24":{"start":{"line":50,"column":2},"end":{"line":50,"column":27}},"25":{"start":{"line":51,"column":2},"end":{"line":51,"column":18}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":13},"end":{"line":14,"column":21}},{"start":{"line":14,"column":25},"end":{"line":14,"column":27}}]},"2":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":2},"end":{"line":15,"column":2}},{"start":{"line":15,"column":2},"end":{"line":15,"column":2}}]},"3":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":34},"end":{"line":47,"column":49}},{"start":{"line":47,"column":53},"end":{"line":47,"column":58}}]}},"code":["'use strict';","","const thunkify = require('thunkify-wrap');","const co = require('co');","const ms = require('humanize-ms');","const npmService = require('../services/npm');","const SyncModuleWorker = require('../controllers/sync_module_worker');","","function* sync(sinceTimestamp) {","  console.log('Fetching packages since: %s', new Date(sinceTimestamp));","  var result = yield npmService.fetchAllPackagesSince(sinceTimestamp);","  var packages = result.names;","","  packages = packages || [];","  if (!packages.length) {","    console.log('no packages need be sync');","    process.exit(0);","  }","  // var news = [];","  // for (var i = 0; i < packages.length; i++) {","  //   if (packages[i] === 'elwms') {","  //     news = packages.slice(i);","  //     break;","  //   }","  // }","  // packages = news;","  console.log('lastModified: %s, lastModified package: %s, total %d packages to sync: %j',","    new Date(result.lastModified), result.lastModifiedName, packages.length, packages);","","  var worker = new SyncModuleWorker({","    username: 'sync_since',","    name: packages,","    noDep: true,","    concurrency: 1,","    syncUpstreamFirst: false,","  });","  worker.start();","  var end = thunkify.event(worker);","  yield end();","","  console.log('All packages sync done, successes %d, fails %d',","      worker.successes.length, worker.fails.length);","  process.exit(0);","}","","co(function* () {","  var timestamp = Date.now() - ms(process.argv[2] || '30d');","  yield sync(timestamp);","}).catch(function (err) {","  console.error(err.stack);","  process.exit(1);","});",""],"l":{"3":2,"4":2,"5":2,"6":2,"7":2,"9":1,"10":0,"11":0,"12":0,"14":0,"15":0,"16":0,"17":0,"27":0,"30":0,"37":0,"38":0,"39":0,"41":0,"43":0,"46":0,"47":0,"48":0,"50":0,"51":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/tools/resync_npm_issue_87.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/tools/resync_npm_issue_87.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":12,"14":12,"15":12,"16":12,"17":0,"18":12,"19":11,"20":11,"21":11,"22":11,"23":0,"24":0,"25":0,"26":0,"27":0},"b":{"1":[1,1],"2":[0,12],"3":[11,0],"4":[0,11]},"f":{"1":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":3},"end":{"line":12,"column":16}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":25}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":45}},"4":{"start":{"line":6,"column":20},"end":{"line":6,"column":44}},"5":{"start":{"line":6,"column":26},"end":{"line":6,"column":44}},"6":{"start":{"line":9,"column":0},"end":{"line":9,"column":75}},"7":{"start":{"line":10,"column":0},"end":{"line":10,"column":91}},"8":{"start":{"line":12,"column":0},"end":{"line":43,"column":3}},"9":{"start":{"line":13,"column":2},"end":{"line":13,"column":43}},"10":{"start":{"line":14,"column":2},"end":{"line":14,"column":51}},"11":{"start":{"line":15,"column":2},"end":{"line":15,"column":16}},"12":{"start":{"line":16,"column":2},"end":{"line":37,"column":3}},"13":{"start":{"line":17,"column":4},"end":{"line":17,"column":34}},"14":{"start":{"line":18,"column":4},"end":{"line":18,"column":23}},"15":{"start":{"line":19,"column":4},"end":{"line":19,"column":46}},"16":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"17":{"start":{"line":21,"column":6},"end":{"line":21,"column":15}},"18":{"start":{"line":24,"column":4},"end":{"line":27,"column":7}},"19":{"start":{"line":29,"column":4},"end":{"line":29,"column":26}},"20":{"start":{"line":31,"column":4},"end":{"line":31,"column":12}},"21":{"start":{"line":32,"column":4},"end":{"line":33,"column":77}},"22":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"23":{"start":{"line":35,"column":6},"end":{"line":35,"column":25}},"24":{"start":{"line":38,"column":2},"end":{"line":38,"column":57}},"25":{"start":{"line":39,"column":2},"end":{"line":39,"column":18}},"26":{"start":{"line":41,"column":2},"end":{"line":41,"column":27}},"27":{"start":{"line":42,"column":2},"end":{"line":42,"column":18}}},"branchMap":{"1":{"line":9,"type":"binary-expr","locations":[{"start":{"line":9,"column":17},"end":{"line":9,"column":32}},{"start":{"line":9,"column":36},"end":{"line":9,"column":74}}]},"2":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":20,"column":4}},{"start":{"line":20,"column":4},"end":{"line":20,"column":4}}]},"3":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":13},"end":{"line":29,"column":19}},{"start":{"line":29,"column":23},"end":{"line":29,"column":25}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":34,"column":4}},{"start":{"line":34,"column":4},"end":{"line":34,"column":4}}]}},"code":["// try to fix https://github.com/npm/registry/issues/87","","const urllib = require('urllib');","const co = require('co');","","const sleep = ms => cb => setTimeout(cb, ms);","","// node resync_npm.js [registry]","const registry = process.argv[2] || require('../config').sourceNpmRegistry;","const url = 'https://os.alipayobjects.com/rmsportal/eDMScnlBhNhHaGXMJWxjvCjfxMHhYwEx.html';","","co(function* () {","  const result = yield urllib.request(url);","  const items = result.data.toString().split('\\n');","  let count = 0;","  for (let item of items) {","    item = item.trim().split(',');","    let name = item[0];","    name = name.substring(1, name.length - 1);","    if (!name) {","      continue;","    }","","    const r = yield urllib.request(`${registry}/${name}/sync`, {","      method: 'PUT',","      dataType: 'json',","    });","","    r.data = r.data || {};","","    count++;","    console.log('#%d %s %s, log: %s',","      count, name, r.status, `${registry}/${name}/sync/log/${r.data.logId}`);","    if (count % 50 === 0) {","      yield sleep(10000);","    }","  }","  console.log('All %d packages sync done', items.length);","  process.exit(0);","}).catch(err => {","  console.error(err.stack);","  process.exit(1);","});",""],"l":{"3":1,"4":1,"6":1,"9":1,"10":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":12,"18":12,"19":12,"20":12,"21":0,"24":12,"29":11,"31":11,"32":11,"34":11,"35":0,"38":0,"39":0,"41":0,"42":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/tools/sync_download_total.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/tools/sync_download_total.js","s":{"1":2,"2":2,"3":2,"4":0,"5":1,"6":0,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"parseYearMonth","line":6,"loc":{"start":{"line":6,"column":0},"end":{"line":6,"column":30}}},"2":{"name":"plusModuleTotal","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":32}}},"3":{"name":"(anonymous_3)","line":32,"loc":{"start":{"line":32,"column":3},"end":{"line":32,"column":16}}},"4":{"name":"(anonymous_4)","line":108,"loc":{"start":{"line":108,"column":8},"end":{"line":108,"column":20}}},"5":{"name":"(anonymous_5)","line":111,"loc":{"start":{"line":111,"column":9},"end":{"line":111,"column":24}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":23}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":31}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":34}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":41}},"5":{"start":{"line":6,"column":0},"end":{"line":8,"column":1}},"6":{"start":{"line":7,"column":2},"end":{"line":7,"column":55}},"7":{"start":{"line":10,"column":0},"end":{"line":30,"column":1}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":44}},"9":{"start":{"line":12,"column":2},"end":{"line":17,"column":5}},"10":{"start":{"line":18,"column":2},"end":{"line":23,"column":3}},"11":{"start":{"line":19,"column":4},"end":{"line":22,"column":7}},"12":{"start":{"line":24,"column":2},"end":{"line":24,"column":47}},"13":{"start":{"line":25,"column":2},"end":{"line":25,"column":27}},"14":{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},"15":{"start":{"line":27,"column":4},"end":{"line":27,"column":28}},"16":{"start":{"line":29,"column":2},"end":{"line":29,"column":13}},"17":{"start":{"line":32,"column":0},"end":{"line":114,"column":3}},"18":{"start":{"line":33,"column":2},"end":{"line":33,"column":78}},"19":{"start":{"line":34,"column":2},"end":{"line":37,"column":3}},"20":{"start":{"line":35,"column":4},"end":{"line":35,"column":75}},"21":{"start":{"line":36,"column":4},"end":{"line":36,"column":11}},"22":{"start":{"line":38,"column":2},"end":{"line":38,"column":17}},"23":{"start":{"line":39,"column":2},"end":{"line":39,"column":16}},"24":{"start":{"line":40,"column":2},"end":{"line":107,"column":3}},"25":{"start":{"line":41,"column":4},"end":{"line":41,"column":122}},"26":{"start":{"line":42,"column":4},"end":{"line":42,"column":25}},"27":{"start":{"line":43,"column":4},"end":{"line":43,"column":95}},"28":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"29":{"start":{"line":45,"column":6},"end":{"line":45,"column":12}},"30":{"start":{"line":47,"column":4},"end":{"line":47,"column":31}},"31":{"start":{"line":48,"column":4},"end":{"line":48,"column":19}},"32":{"start":{"line":49,"column":4},"end":{"line":49,"column":27}},"33":{"start":{"line":50,"column":4},"end":{"line":50,"column":21}},"34":{"start":{"line":51,"column":4},"end":{"line":94,"column":5}},"35":{"start":{"line":52,"column":6},"end":{"line":52,"column":24}},"36":{"start":{"line":53,"column":6},"end":{"line":53,"column":22}},"37":{"start":{"line":54,"column":6},"end":{"line":54,"column":26}},"38":{"start":{"line":55,"column":6},"end":{"line":57,"column":7}},"39":{"start":{"line":56,"column":8},"end":{"line":56,"column":49}},"40":{"start":{"line":58,"column":6},"end":{"line":60,"column":7}},"41":{"start":{"line":59,"column":8},"end":{"line":59,"column":27}},"42":{"start":{"line":61,"column":6},"end":{"line":73,"column":7}},"43":{"start":{"line":62,"column":8},"end":{"line":62,"column":94}},"44":{"start":{"line":64,"column":8},"end":{"line":68,"column":12}},"45":{"start":{"line":69,"column":8},"end":{"line":69,"column":21}},"46":{"start":{"line":70,"column":8},"end":{"line":70,"column":20}},"47":{"start":{"line":71,"column":8},"end":{"line":71,"column":19}},"48":{"start":{"line":72,"column":8},"end":{"line":72,"column":27}},"49":{"start":{"line":75,"column":6},"end":{"line":79,"column":10}},"50":{"start":{"line":80,"column":6},"end":{"line":80,"column":28}},"51":{"start":{"line":82,"column":6},"end":{"line":93,"column":7}},"52":{"start":{"line":83,"column":8},"end":{"line":83,"column":94}},"53":{"start":{"line":84,"column":8},"end":{"line":88,"column":12}},"54":{"start":{"line":89,"column":8},"end":{"line":89,"column":21}},"55":{"start":{"line":90,"column":8},"end":{"line":90,"column":20}},"56":{"start":{"line":91,"column":8},"end":{"line":91,"column":19}},"57":{"start":{"line":92,"column":8},"end":{"line":92,"column":27}},"58":{"start":{"line":96,"column":4},"end":{"line":102,"column":5}},"59":{"start":{"line":97,"column":6},"end":{"line":101,"column":9}},"60":{"start":{"line":103,"column":4},"end":{"line":106,"column":5}},"61":{"start":{"line":104,"column":6},"end":{"line":104,"column":92}},"62":{"start":{"line":105,"column":6},"end":{"line":105,"column":18}},"63":{"start":{"line":109,"column":2},"end":{"line":109,"column":56}},"64":{"start":{"line":110,"column":2},"end":{"line":110,"column":18}},"65":{"start":{"line":112,"column":2},"end":{"line":112,"column":21}},"66":{"start":{"line":113,"column":2},"end":{"line":113,"column":12}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":2}},{"start":{"line":18,"column":2},"end":{"line":18,"column":2}}]},"2":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"3":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"4":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":4}},{"start":{"line":44,"column":4},"end":{"line":44,"column":4}}]},"5":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":6},"end":{"line":55,"column":6}},{"start":{"line":55,"column":6},"end":{"line":55,"column":6}}]},"6":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":6},"end":{"line":58,"column":6}},{"start":{"line":58,"column":6},"end":{"line":58,"column":6}}]},"7":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":6},"end":{"line":61,"column":6}},{"start":{"line":61,"column":6},"end":{"line":61,"column":6}}]},"8":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":6},"end":{"line":82,"column":6}},{"start":{"line":82,"column":6},"end":{"line":82,"column":6}}]},"9":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":96,"column":4}},{"start":{"line":96,"column":4},"end":{"line":96,"column":4}}]},"10":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":4},"end":{"line":103,"column":4}},{"start":{"line":103,"column":4},"end":{"line":103,"column":4}}]}},"code":["var co = require('co');","var moment = require('moment');","var models = require('../models');","var DownloadTotal = models.DownloadTotal;","","function parseYearMonth(date) {","  return Number(date.substring(0, 7).replace('-', ''));","}","","function* plusModuleTotal(data) {","  var yearMonth = parseYearMonth(data.date);","  row = yield DownloadTotal.find({","    where: {","      name: data.name,","      date: yearMonth,","    }","  });","  if (!row) {","    row = DownloadTotal.build({","      name: data.name,","      date: yearMonth,","    });","  }","  var field = 'd' + data.date.substring(8, 10);","  row[field] += data.count;","  if (row.isDirty) {","    return yield row.save();","  }","  return row;","}","","co(function* () {","  var result = yield models.query('select count(*) as count from downloads;');","  if (result[0].count > 0) {","    console.log('downloads has %d rows, no need to sync', result[0].count);","    return;","  }","  var lastId = 0;","  var count = 0;","  while (true) {","    var rows = yield models.query('select id, name, date, count from download_total where id > ? limit 10000;', [lastId]);","    count += rows.length;","    console.log('[%s] last id: %s, got %d rows, total %d', Date(), lastId, rows.length, count);","    if (rows.length === 0) {","      break;","    }","    console.log('%j', rows[0]);","    var tasks = [];","    var currentDate = null;","    var allCount = 0;","    for (var i = 0; i < rows.length; i++) {","      var row = rows[i];","      lastId = row.id;","      var date = row.date;","      if (typeof date !== 'string') {","        date = moment(date).format('YYYY-MM-DD');","      }","      if (!currentDate) {","        currentDate = date;","      }","      if (currentDate !== date) {","        console.log('saving %s %d rows, total count %d', currentDate, tasks.length, allCount);","        // date change, flush tasks","        tasks.push(plusModuleTotal({","          date: currentDate,","          name: '__all__',","          count: allCount","        }));","        allCount = 0;","        yield tasks;","        tasks = [];","        currentDate = null;","      }","","      tasks.push(plusModuleTotal({","        date: date,","        name: row.name,","        count: row.count,","      }));","      allCount += row.count;","","      if (tasks.length >= 100) {","        console.log('saving %s %d rows, total count %d', currentDate, tasks.length, allCount);","        tasks.push(plusModuleTotal({","          date: currentDate,","          name: '__all__',","          count: allCount","        }));","        allCount = 0;","        yield tasks;","        tasks = [];","        currentDate = null;","      }","    }","","    if (allCount > 0) {","      tasks.push({","        date: currentDate,","        name: '__all__',","        count: allCount","      });","    }","    if (tasks.length > 0) {","      console.log('saving %s %d rows, total count %d', currentDate, tasks.length, allCount);","      yield tasks;","    }","  }","}).then(function () {","  console.log('sync done, you can upgrade to 2.x now.');","  process.exit(0);","}).catch(function (err) {","  console.error(err);","  throw err;","});",""],"l":{"1":2,"2":2,"3":2,"4":0,"6":1,"7":0,"10":1,"11":0,"12":0,"18":0,"19":0,"24":0,"25":0,"26":0,"27":0,"29":0,"32":0,"33":0,"34":0,"35":0,"36":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"58":0,"59":0,"61":0,"62":0,"64":0,"69":0,"70":0,"71":0,"72":0,"75":0,"80":0,"82":0,"83":0,"84":0,"89":0,"90":0,"91":0,"92":0,"96":0,"97":0,"103":0,"104":0,"105":0,"109":0,"110":0,"112":0,"113":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/registry/user_package.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/registry/user_package.js","s":{"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":15},"end":{"line":20,"column":28}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":55}},"2":{"start":{"line":20,"column":0},"end":{"line":51,"column":2}},"3":{"start":{"line":21,"column":2},"end":{"line":21,"column":42}},"4":{"start":{"line":22,"column":2},"end":{"line":29,"column":3}},"5":{"start":{"line":23,"column":4},"end":{"line":23,"column":22}},"6":{"start":{"line":24,"column":4},"end":{"line":27,"column":6}},"7":{"start":{"line":28,"column":4},"end":{"line":28,"column":11}},"8":{"start":{"line":31,"column":2},"end":{"line":31,"column":27}},"9":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"10":{"start":{"line":34,"column":4},"end":{"line":34,"column":19}},"11":{"start":{"line":35,"column":4},"end":{"line":35,"column":11}},"12":{"start":{"line":38,"column":2},"end":{"line":38,"column":17}},"13":{"start":{"line":39,"column":2},"end":{"line":42,"column":3}},"14":{"start":{"line":40,"column":4},"end":{"line":40,"column":28}},"15":{"start":{"line":41,"column":4},"end":{"line":41,"column":75}},"16":{"start":{"line":44,"column":2},"end":{"line":44,"column":25}},"17":{"start":{"line":45,"column":2},"end":{"line":49,"column":3}},"18":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"19":{"start":{"line":47,"column":6},"end":{"line":47,"column":26}},"20":{"start":{"line":50,"column":2},"end":{"line":50,"column":19}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":22,"column":2}},{"start":{"line":22,"column":2},"end":{"line":22,"column":2}}]},"2":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"3":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]}},"code":["/**!"," * cnpmjs.org - controllers/registry/user_package.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var packageService = require('../../services/package');","","// GET /-/by-user/:user","exports.list = function* () {","  var users = this.params.user.split('|');","  if (users.length > 20) {","    this.status = 400;","    this.body = {","      error: 'bad_request',","      reason: 'reach max user names limit, must <= 20 user names'","    };","    return;","  }","","  var firstUser = users[0];","  if (!firstUser) {","    // params.user = '|'","    this.body = {};","    return;","  }","","  var tasks = {};","  for (var i = 0; i < users.length; i++) {","    var username = users[i];","    tasks[username] = packageService.listPublicModuleNamesByUser(username);","  }","","  var data = yield tasks;","  for (var k in data) {","    if (data[k].length === 0) {","      data[k] = undefined;","    }","  }","  this.body = data;","};",""],"l":{"17":2,"20":0,"21":0,"22":0,"23":0,"24":0,"28":0,"31":0,"32":0,"34":0,"35":0,"38":0,"39":0,"40":0,"41":0,"44":0,"45":0,"46":0,"47":0,"50":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/badge.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/badge.js","s":{"1":2,"2":2,"3":2,"4":2,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":23,"loc":{"start":{"line":23,"column":18},"end":{"line":23,"column":31}}},"2":{"name":"(anonymous_2)","line":54,"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":33}}}},"statementMap":{"1":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}},"2":{"start":{"line":18,"column":0},"end":{"line":18,"column":27}},"3":{"start":{"line":19,"column":0},"end":{"line":19,"column":37}},"4":{"start":{"line":20,"column":0},"end":{"line":20,"column":55}},"5":{"start":{"line":21,"column":0},"end":{"line":21,"column":61}},"6":{"start":{"line":23,"column":0},"end":{"line":52,"column":2}},"7":{"start":{"line":24,"column":2},"end":{"line":24,"column":26}},"8":{"start":{"line":25,"column":2},"end":{"line":25,"column":26}},"9":{"start":{"line":26,"column":2},"end":{"line":26,"column":28}},"10":{"start":{"line":27,"column":2},"end":{"line":27,"column":39}},"11":{"start":{"line":28,"column":2},"end":{"line":28,"column":61}},"12":{"start":{"line":29,"column":2},"end":{"line":41,"column":3}},"13":{"start":{"line":30,"column":4},"end":{"line":30,"column":27}},"14":{"start":{"line":31,"column":4},"end":{"line":40,"column":5}},"15":{"start":{"line":33,"column":6},"end":{"line":33,"column":20}},"16":{"start":{"line":34,"column":11},"end":{"line":40,"column":5}},"17":{"start":{"line":36,"column":6},"end":{"line":36,"column":22}},"18":{"start":{"line":39,"column":6},"end":{"line":39,"column":21}},"19":{"start":{"line":43,"column":2},"end":{"line":43,"column":57}},"20":{"start":{"line":44,"column":2},"end":{"line":46,"column":3}},"21":{"start":{"line":45,"column":4},"end":{"line":45,"column":54}},"22":{"start":{"line":47,"column":2},"end":{"line":47,"column":41}},"23":{"start":{"line":48,"column":2},"end":{"line":48,"column":48}},"24":{"start":{"line":49,"column":2},"end":{"line":50,"column":92}},"25":{"start":{"line":51,"column":2},"end":{"line":51,"column":21}},"26":{"start":{"line":54,"column":0},"end":{"line":62,"column":2}},"27":{"start":{"line":56,"column":2},"end":{"line":56,"column":28}},"28":{"start":{"line":57,"column":2},"end":{"line":57,"column":55}},"29":{"start":{"line":58,"column":2},"end":{"line":58,"column":48}},"30":{"start":{"line":59,"column":2},"end":{"line":60,"column":46}},"31":{"start":{"line":61,"column":2},"end":{"line":61,"column":21}}},"branchMap":{"1":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":12},"end":{"line":27,"column":26}},{"start":{"line":27,"column":30},"end":{"line":27,"column":38}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":31,"column":4}},{"start":{"line":31,"column":4},"end":{"line":31,"column":4}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":11},"end":{"line":34,"column":11}},{"start":{"line":34,"column":11},"end":{"line":34,"column":11}}]},"5":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":44,"column":2}},{"start":{"line":44,"column":2},"end":{"line":44,"column":2}}]},"6":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":14},"end":{"line":48,"column":30}},{"start":{"line":48,"column":34},"end":{"line":48,"column":47}}]},"7":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":14},"end":{"line":58,"column":30}},{"start":{"line":58,"column":34},"end":{"line":58,"column":47}}]}},"code":["/**!"," * cnpmjs.org - controllers/web/badge.js"," *"," * Copyright(c) fengmk2 and other contributors."," * MIT Licensed"," *"," * Authors:"," *   fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","var utility = require('utility');","var util = require('util');","var config = require('../../config');","var packageService = require('../../services/package');","var DownloadTotal = require('../../services/download_total');","","exports.version = function* () {","  var color = 'lightgrey';","  var version = 'invalid';","  var name = this.params[0];","  var tag = this.query.tag || 'latest';","  var info = yield* packageService.getModuleByTag(name, tag);","  if (info) {","    version = info.version;","    if (/^0\\.0\\./.test(version)) {","      // <0.1.0 & >=0.0.0","      color = 'red';","    } else if (/^0\\./.test(version)) {","      // <1.0.0 & >=0.1.0","      color = 'green';","    } else {","      // >=1.0.0","      color = 'blue';","    }","  }","","  var subject = config.badgeSubject.replace(/\\-/g, '--');","  if (this.query.subject) {","    subject = this.query.subject.replace(/\\-/g, '--');","  }","  version = version.replace(/\\-/g, '--');","  var style = this.query.style || 'flat-square';","  var url = util.format(config.badgePrefixURL + '/%s-%s-%s.svg?style=%s',","    utility.encodeURIComponent(subject), version, color, utility.encodeURIComponent(style));","  this.redirect(url);","};","","exports.downloads = function* () {","  // https://dn-img-shields-io.qbox.me/badge/downloads-100k/month-brightgreen.svg?style=flat-square","  var name = this.params[0];","  var count = yield DownloadTotal.getTotalByName(name);","  var style = this.query.style || 'flat-square';","  var url = util.format(config.badgePrefixURL + '/downloads-%s-brightgreen.svg?style=%s',","    count, utility.encodeURIComponent(style));","  this.redirect(url);","};",""],"l":{"17":2,"18":2,"19":2,"20":2,"21":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"33":0,"34":0,"36":0,"39":0,"43":0,"44":0,"45":0,"47":0,"48":0,"49":0,"51":0,"54":0,"56":0,"57":0,"58":0,"59":0,"61":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/show_sync.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/controllers/web/show_sync.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"b":{"1":[0,0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"showSync","line":18,"loc":{"start":{"line":18,"column":17},"end":{"line":18,"column":38}}}},"statementMap":{"1":{"start":{"line":18,"column":0},"end":{"line":34,"column":2}},"2":{"start":{"line":19,"column":2},"end":{"line":19,"column":67}},"3":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"4":{"start":{"line":21,"column":4},"end":{"line":21,"column":30}},"5":{"start":{"line":23,"column":2},"end":{"line":23,"column":23}},"6":{"start":{"line":24,"column":2},"end":{"line":28,"column":3}},"7":{"start":{"line":25,"column":4},"end":{"line":25,"column":33}},"8":{"start":{"line":26,"column":4},"end":{"line":26,"column":21}},"9":{"start":{"line":27,"column":4},"end":{"line":27,"column":21}},"10":{"start":{"line":29,"column":2},"end":{"line":33,"column":5}}},"branchMap":{"1":{"line":19,"type":"binary-expr","locations":[{"start":{"line":19,"column":13},"end":{"line":19,"column":29}},{"start":{"line":19,"column":33},"end":{"line":19,"column":47}},{"start":{"line":19,"column":51},"end":{"line":19,"column":66}}]},"2":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]},"3":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":2}},{"start":{"line":24,"column":2},"end":{"line":24,"column":2}}]}},"code":["/**!"," * cnpmjs.org - controllers/web/show_sync.js"," *"," * Copyright(c) cnpmjs.org and other contributors."," * MIT Licensed"," *"," * Authors:"," *  dead_horse <dead_horse@qq.com> (http://deadhorse.me)"," *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.github.com)"," */","","'use strict';","","/**"," * Module dependencies."," */","","module.exports = function* showSync() {","  var name = this.params.name || this.params[0] || this.query.name;","  if (!name) {","    return this.redirect('/');","  }","  var type = 'package';","  if (name.indexOf(':') > 0) {","    var splits = name.split(':');","    name = splits[1];","    type = splits[0];","  }","  yield this.render('sync', {","    type: type,","    name: name,","    title: 'Sync ' + type + ' - ' + name,","  });","};",""],"l":{"18":1,"19":0,"20":0,"21":0,"23":0,"24":0,"25":0,"26":0,"27":0,"29":0}},"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/public/js/readme.js":{"path":"/home/travis/build/npmtest/node-npmtest-cnpmjs.org/node_modules/cnpmjs.org/public/js/readme.js","s":{"1":2,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":2},"end":{"line":1,"column":14}}},"2":{"name":"humanize","line":2,"loc":{"start":{"line":2,"column":2},"end":{"line":2,"column":32}}},"3":{"name":"(anonymous_3)","line":11,"loc":{"start":{"line":11,"column":22},"end":{"line":11,"column":38}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":49,"column":3}},"2":{"start":{"line":2,"column":2},"end":{"line":9,"column":3}},"3":{"start":{"line":3,"column":4},"end":{"line":3,"column":28}},"4":{"start":{"line":4,"column":4},"end":{"line":4,"column":37}},"5":{"start":{"line":5,"column":4},"end":{"line":5,"column":37}},"6":{"start":{"line":6,"column":4},"end":{"line":6,"column":32}},"7":{"start":{"line":7,"column":4},"end":{"line":7,"column":62}},"8":{"start":{"line":8,"column":4},"end":{"line":8,"column":21}},"9":{"start":{"line":11,"column":2},"end":{"line":48,"column":5}},"10":{"start":{"line":12,"column":4},"end":{"line":12,"column":56}},"11":{"start":{"line":13,"column":4},"end":{"line":13,"column":64}},"12":{"start":{"line":14,"column":4},"end":{"line":14,"column":59}},"13":{"start":{"line":16,"column":4},"end":{"line":16,"column":41}},"14":{"start":{"line":17,"column":4},"end":{"line":17,"column":73}},"15":{"start":{"line":18,"column":4},"end":{"line":18,"column":76}},"16":{"start":{"line":19,"column":4},"end":{"line":19,"column":77}},"17":{"start":{"line":20,"column":4},"end":{"line":20,"column":75}},"18":{"start":{"line":21,"column":4},"end":{"line":21,"column":76}},"19":{"start":{"line":22,"column":4},"end":{"line":22,"column":77}},"20":{"start":{"line":24,"column":4},"end":{"line":24,"column":61}},"21":{"start":{"line":25,"column":4},"end":{"line":25,"column":56}},"22":{"start":{"line":27,"column":4},"end":{"line":33,"column":5}},"23":{"start":{"line":28,"column":6},"end":{"line":28,"column":92}},"24":{"start":{"line":29,"column":6},"end":{"line":29,"column":63}},"25":{"start":{"line":30,"column":11},"end":{"line":33,"column":5}},"26":{"start":{"line":31,"column":6},"end":{"line":31,"column":101}},"27":{"start":{"line":32,"column":6},"end":{"line":32,"column":69}},"28":{"start":{"line":35,"column":4},"end":{"line":35,"column":45}},"29":{"start":{"line":36,"column":4},"end":{"line":36,"column":51}},"30":{"start":{"line":37,"column":4},"end":{"line":37,"column":45}},"31":{"start":{"line":38,"column":4},"end":{"line":38,"column":45}},"32":{"start":{"line":39,"column":4},"end":{"line":39,"column":90}},"33":{"start":{"line":40,"column":4},"end":{"line":41,"column":38}},"34":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"35":{"start":{"line":44,"column":6},"end":{"line":44,"column":29}},"36":{"start":{"line":47,"column":4},"end":{"line":47,"column":22}}},"branchMap":{"1":{"line":3,"type":"binary-expr","locations":[{"start":{"line":3,"column":14},"end":{"line":3,"column":21}},{"start":{"line":3,"column":25},"end":{"line":3,"column":27}}]},"2":{"line":4,"type":"binary-expr","locations":[{"start":{"line":4,"column":12},"end":{"line":4,"column":29}},{"start":{"line":4,"column":33},"end":{"line":4,"column":36}}]},"3":{"line":5,"type":"binary-expr","locations":[{"start":{"line":5,"column":12},"end":{"line":5,"column":29}},{"start":{"line":5,"column":33},"end":{"line":5,"column":36}}]},"4":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":28},"end":{"line":24,"column":45}},{"start":{"line":24,"column":49},"end":{"line":24,"column":59}}]},"5":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":27},"end":{"line":25,"column":43}},{"start":{"line":25,"column":47},"end":{"line":25,"column":54}}]},"6":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":27,"column":4}},{"start":{"line":27,"column":4},"end":{"line":27,"column":4}}]},"7":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":11},"end":{"line":30,"column":11}},{"start":{"line":30,"column":11},"end":{"line":30,"column":11}}]},"8":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]}},"code":["$(function () {","  function humanize(n, options) {","    options = options || {};","    var d = options.delimiter || ',';","    var s = options.separator || '.';","    n = n.toString().split('.');","    n[0] = n[0].replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1' + d);","    return n.join(s);","  }","","  $.getJSON('/total', function (data) {","    $('#total-packages').html(humanize(data.doc_count));","    $('#total-versions').html(humanize(data.doc_version_count));","    $('#total-deletes').html(humanize(data.doc_del_count));","","    var downloads = $('table.downloads');","    downloads.find('td.count:eq(3)').html(humanize(data.download.today));","    downloads.find('td.count:eq(4)').html(humanize(data.download.thisweek));","    downloads.find('td.count:eq(5)').html(humanize(data.download.thismonth));","    downloads.find('td.count:eq(6)').html(humanize(data.download.lastday));","    downloads.find('td.count:eq(7)').html(humanize(data.download.lastweek));","    downloads.find('td.count:eq(8)').html(humanize(data.download.lastmonth));","","    $('#node-version').html(data.node_version || 'v0.10.22');","    $('#app-version').html(data.app_version || '0.0.0');","","    if (data.sync_model === 'all') {","      $('#sync-model').html('This registry will sync all packages from official registry.');","      $('#last-sync-time').html(new Date(data.last_sync_time));","    } else if (data.sync_model === 'exist') {","      $('#sync-model').html('This registry will only update exist packages from official registry.');","      $('#last-sync-time').html(new Date(data.last_exist_sync_time));","    }","","    $('#need-sync').html(data.need_sync_num);","    $('#success-sync').html(data.success_sync_num);","    $('#fail-sync').html(data.fail_sync_num);","    $('#left-sync').html(data.left_sync_num);","    $('#percent-sync').html(Math.floor(data.success_sync_num / data.need_sync_num * 100));","    $('#last-success-name').html('<a target=\"_blank\" href=\"/package/' + data.last_sync_module + '\">' +","      data.last_sync_module + '</a>');","","    if (!data.sync_status) {","      $('.syncing').remove();","    }","","    $('.sync').show();","  });","});",""],"l":{"1":2,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"11":0,"12":0,"13":0,"14":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"24":0,"25":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"43":0,"44":0,"47":0}}}